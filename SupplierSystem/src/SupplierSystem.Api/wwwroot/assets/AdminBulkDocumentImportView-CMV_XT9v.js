const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/documents-DE00ERWW.js","assets/index-BqVgmY2a.js","assets/index-D5VxGV9f.css"])))=>i.map(i=>d[i]);
import{d as e,h as l,c as a,b as t,j as s,z as i,y as r,k as o,aK as u,H as n,e as d,F as c,r as p,t as m,x as v,O as f,f as y,aL as g,ad as h,a3 as b,A as _,w as k,S as w,aM as C,a0 as x,aE as V,aN as D,aO as S,q as T,o as F,J as U,_ as A}from"./index-BqVgmY2a.js";import{E as j,a as z}from"./el-table-column-CYI6_cgf.js";import"./el-scrollbar-Hhg6XmGO.js";import{E as q}from"./el-tag-BFFTmzKO.js";import{E}from"./el-statistic-COLtttTR.js";import{E as I}from"./el-alert-ZQ_1rrnl.js";import{E as B}from"./el-date-picker-panel-Cwmluhur.js";/* empty css                 */import{E as O}from"./el-card-SNoibE19.js";import{E as M,a as P}from"./el-select-D64LpT3y.js";import{P as $}from"./PageHeader-e2pKlIF2.js";import{u as N}from"./useNotification-CGrCsW-s.js";import"./_baseClone-DnYTnrzK.js";import"./castArray-B2VphuOT.js";import"./debounce-BP_d4msr.js";import"./dayjs.min-CuEfV50W.js";import"./index-Y15cOsir.js";const R={class:"bulk-doc-import-page"},L={class:"supplier-selection"},Q={class:"supplier-option"},G={class:"supplier-name"},H={key:0,class:"selected-info"},K={class:"default-type-section"},J={key:0,class:"file-list"},Y={class:"list-header"},W={class:"file-items"},X={class:"file-info"},Z={key:1},ee={class:"file-details"},le={class:"file-name"},ae={class:"file-size"},te={class:"file-metadata"},se={key:0,class:"file-error"},ie={class:"upload-summary"},re={class:"summary-row"},oe={class:"value"},ue={class:"summary-row"},ne={class:"value"},de={class:"summary-row highlight"},ce={class:"value"},pe={class:"action-buttons"},me={class:"results-summary"},ve={key:1},fe={key:1},ye={key:0},ge=A(e({__name:"AdminBulkDocumentImportView",setup(e){const A=N();T();const ge=l([]),he=history.state?.preSelectedSupplierIds;he&&Array.isArray(he)&&he.length>0&&(ge.value=he);const be=l([]),_e=l(!1),ke=l(),we=l(!1),Ce=l([]),xe=l(!1),Ve=l(""),De=l([]),Se=l(!1),Te=l(null),Fe=[{value:"business_license",label:"Business License"},{value:"tax_certificate",label:"Tax Registration Certificate"},{value:"bank_information",label:"Bank Account Information"},{value:"quality_cert",label:"Quality Certification"},{value:"iso_cert",label:"ISO Certification"},{value:"insurance",label:"Insurance Policy"},{value:"contract",label:"Contract"},{value:"incoming_packaging_transport_agreement",label:"Incoming Material Packaging and Transportation Agreement"},{value:"quality_compensation_agreement",label:"Quality Compensation Agreement"},{value:"quality_assurance_agreement",label:"Quality Assurance Agreement"},{value:"quality_kpi_targets",label:"Quality KPI Targets"},{value:"supplier_handbook_template",label:"Supplier Handbook Template"},{value:"supplemental_agreement",label:"Supplemental Agreement"},{value:"other",label:"Other Document"}],Ue=["business_license","tax_certificate","bank_information"],Ae=e=>Ue.includes(e),je=a(()=>0!==ge.value.length&&(0!==Ce.value.length&&(!xe.value&&Ce.value.every(e=>!!e.docType&&!!(!Ae(e.docType)||e.validFrom&&e.expiresAt))))),ze=async e=>{if(e){_e.value=!0;try{const l=await u({q:e,limit:50});be.value=l}catch(l){console.error("Failed to search suppliers:",l)}finally{_e.value=!1}}else{_e.value=!0;try{const e=await u({limit:50});be.value=e}catch(l){console.error("Failed to fetch suppliers:",l),A.error("Failed to load suppliers")}finally{_e.value=!1}}},qe=()=>{ke.value?.click()},Ee=e=>{const l=e.target;l.files&&Be(Array.from(l.files)),ke.value&&(ke.value.value="")},Ie=e=>{we.value=!1,e.dataTransfer?.files&&Be(Array.from(e.dataTransfer.files))},Be=e=>{e.forEach(e=>{if(!Oe(e))return;const l=Ve.value||Me(e.name);Ce.value.push({file:e,docType:l,category:void 0,validFrom:null,expiresAt:null,error:void 0})})},Oe=e=>e.size>10485760?(A.error(`File too large: ${e.name} (Max 10MB)`),!1):!(!["application/pdf","image/jpeg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)&&!e.name.match(/\.(pdf|jpe?g|png|docx?)$/i))||(A.error(`Unsupported file type: ${e.name}`),!1),Me=e=>{const l=e.toLowerCase();return l.includes("license")||l.includes("营业执照")?"business_license":l.includes("tax")||l.includes("税务")?"tax_certificate":l.includes("bank")||l.includes("银行")?"bank_information":l.includes("quality")||l.includes("质量")?"quality_cert":l.includes("iso")?"iso_cert":l.includes("insurance")||l.includes("保险")?"insurance":l.includes("contract")||l.includes("合同")?"contract":""},Pe=()=>{Ce.value=[]},$e=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,l)*100)/100+" "+["B","KB","MB","GB"][l]},Ne=async()=>{for(const l of Ce.value){if(!l.docType)return l.error="Document type is required",void A.error("Please select document type for all files");if(Ae(l.docType)&&(!l.validFrom||!l.expiresAt))return l.error="Valid From and Expiry dates are required for this document type",void A.error(`Valid From and Expiry dates are required for ${l.file.name}`);if(l.validFrom&&l.expiresAt&&new Date(l.validFrom)>=new Date(l.expiresAt))return l.error="Valid from date must be earlier than expiry date",void A.error("Date validation failed for "+l.file.name);l.error=void 0}xe.value=!0,De.value=[];try{const{bulkUploadDocuments:l}=await U(async()=>{const{bulkUploadDocuments:e}=await import("./documents-DE00ERWW.js");return{bulkUploadDocuments:e}},__vite__mapDeps([0,1,2]));for(const s of ge.value){const a=be.value.find(e=>e.id===s),t=a?a.companyName:`Supplier #${s}`;try{const e=Ce.value.map(e=>({file:e.file,docType:e.docType,category:e.category,validFrom:e.validFrom?.toISOString(),expiresAt:e.expiresAt?.toISOString()})),a=await l(s,e);De.value.push({supplierId:s,supplierName:t,successCount:a.success.length,failedCount:a.failed.length,errors:a.failed})}catch(e){De.value.push({supplierId:s,supplierName:t,successCount:0,failedCount:Ce.value.length,errors:Ce.value.map(l=>({filename:l.file.name,error:e.message||"Upload failed"}))})}}const a=De.value.reduce((e,l)=>e+l.successCount,0),t=De.value.reduce((e,l)=>e+l.failedCount,0);0===t?A.success(`Successfully uploaded ${a} documents to all suppliers!`):A.warning(`Upload completed: ${a} successful, ${t} failed`)}catch(e){console.error("Bulk upload failed:",e),A.error("Bulk upload process failed")}finally{xe.value=!1}},Re=()=>{ge.value=[],Ce.value=[],De.value=[]};return(async()=>{if(await ze(""),he&&Array.isArray(he)&&he.length>0)for(const l of he)if(!be.value.find(e=>e.id===l))try{const e=await u({id:l});e.length>0&&be.value.push(e[0])}catch(e){console.error(`Failed to load supplier ${l}:`,e)}})(),(e,l)=>{const a=q,u=P,T=M,U=f,A=O,N=_,he=B,Ue=I,Be=E,Oe=j,Me=z,Le=n;return F(),t("div",R,[s($,{title:"Bulk Document Import",subtitle:"Upload required documents for multiple suppliers at once"}),s(A,{class:"selection-card",shadow:"never"},{header:o(()=>[...l[5]||(l[5]=[d("div",{class:"card-header"},[d("h2",null,"Step 1: Select Suppliers")],-1)])]),default:o(()=>[d("div",L,[s(T,{modelValue:ge.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ge.value=e),multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"Search and select suppliers","remote-method":ze,loading:_e.value,class:"supplier-select",size:"large"},{default:o(()=>[(F(!0),t(c,null,p(be.value,e=>(F(),i(u,{key:e.id,label:`${e.companyName} (${e.companyId})`,value:e.id},{default:o(()=>{return[d("div",Q,[d("span",G,m(e.companyName),1),s(a,{type:(l=e.status,{approved:"success",qualified:"success",pending:"warning",under_review:"info",rejected:"danger"}[l]||"info"),size:"small"},{default:o(()=>[v(m(e.status),1)]),_:2},1032,["type"])])];var l}),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),ge.value.length>0?(F(),t("div",H,[s(U,null,{default:o(()=>[s(y(g))]),_:1}),d("span",null,m(ge.value.length)+" supplier(s) selected",1)])):r("",!0)])]),_:1}),ge.value.length>0?(F(),i(A,{key:0,class:"upload-card",shadow:"never"},{header:o(()=>[...l[6]||(l[6]=[d("div",{class:"card-header"},[d("h2",null,"Step 2: Select Documents to Upload"),d("p",{class:"hint"},"These documents will be uploaded to all selected suppliers")],-1)])]),default:o(()=>[d("div",K,[l[7]||(l[7]=d("label",{class:"default-type-label"},"Default Document Type (Optional)",-1)),s(T,{modelValue:Ve.value,"onUpdate:modelValue":l[1]||(l[1]=e=>Ve.value=e),placeholder:"Select a default document type for all files",size:"large",clearable:"",class:"default-type-select"},{default:o(()=>[(F(),t(c,null,p(Fe,e=>s(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l[8]||(l[8]=d("p",{class:"hint-text"}," If selected, all uploaded files will be assigned this document type by default. You can change individual files later. ",-1))]),d("div",{class:w(["dropzone",{"is-dragover":we.value,"has-files":Ce.value.length>0}]),onDrop:k(Ie,["prevent"]),onDragover:l[2]||(l[2]=k(e=>we.value=!0,["prevent"])),onDragleave:l[3]||(l[3]=k(e=>we.value=!1,["prevent"]))},[s(U,{size:64,class:"upload-icon"},{default:o(()=>[s(y(h))]),_:1}),l[10]||(l[10]=d("h3",null,"Drag and drop files here",-1)),l[11]||(l[11]=d("p",null,"or",-1)),s(N,{type:"primary",size:"large",onClick:qe},{default:o(()=>[s(U,null,{default:o(()=>[s(y(b))]),_:1}),l[9]||(l[9]=v(" Browse Files ",-1))]),_:1}),d("input",{ref_key:"fileInputRef",ref:ke,type:"file",multiple:"",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",style:{display:"none"},onChange:Ee},null,544),l[12]||(l[12]=d("p",{class:"hint"},"Supported formats: PDF, JPG, PNG, DOC, DOCX (Max 10MB per file)",-1))],34),Ce.value.length>0?(F(),t("div",J,[d("div",Y,[d("h4",null,"Selected Documents ("+m(Ce.value.length)+")",1),s(N,{size:"small",text:"",onClick:Pe},{default:o(()=>[s(U,null,{default:o(()=>[s(y(C))]),_:1}),l[13]||(l[13]=v(" Clear All ",-1))]),_:1})]),d("div",W,[(F(!0),t(c,null,p(Ce.value,(e,l)=>(F(),t("div",{key:l,class:"file-item"},[d("div",X,[s(U,{size:24,class:"file-icon"},{default:o(()=>["application/pdf"===e.file.type?(F(),i(y(x),{key:0})):e.file.type.startsWith("image/")?(F(),t("picture",Z)):(F(),i(y(x),{key:2}))]),_:2},1024),d("div",ee,[d("span",le,m(e.file.name),1),d("span",ae,m($e(e.file.size)),1)]),s(U,{class:"remove-icon",onClick:e=>(e=>{Ce.value.splice(e,1)})(l)},{default:o(()=>[s(y(V))]),_:1},8,["onClick"])]),d("div",te,[s(T,{modelValue:e.docType,"onUpdate:modelValue":l=>e.docType=l,placeholder:"Document Type (Required)",size:"small",class:"meta-input"},{default:o(()=>[(F(),t(c,null,p(Fe,e=>s(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"]),s(T,{modelValue:e.category,"onUpdate:modelValue":l=>e.category=l,placeholder:"Category (Optional)",size:"small",clearable:"",class:"meta-input"},{default:o(()=>[s(u,{label:"Compliance",value:"compliance"}),s(u,{label:"Financial",value:"finance"}),s(u,{label:"Tax",value:"tax"}),s(u,{label:"Quality",value:"quality"}),s(u,{label:"Legal",value:"legal"}),s(u,{label:"Other",value:"other"})]),_:1},8,["modelValue","onUpdate:modelValue"]),s(he,{modelValue:e.validFrom,"onUpdate:modelValue":l=>e.validFrom=l,type:"date",placeholder:Ae(e.docType)?"Valid From (Required)":"Valid From (Optional)",size:"small",clearable:"",class:"meta-input date-picker"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(he,{modelValue:e.expiresAt,"onUpdate:modelValue":l=>e.expiresAt=l,type:"date",placeholder:Ae(e.docType)?"Expiry Date (Required)":"Expiry Date (Optional)",size:"small",clearable:"","disabled-date":l=>((e,l)=>{if(l.validFrom){const a=new Date(l.validFrom).getTime();return e.getTime()<=a}return e.getTime()<Date.now()-864e5})(l,e),class:"meta-input date-picker"},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled-date"])]),e.error?(F(),t("div",se,[s(U,null,{default:o(()=>[s(y(D))]),_:1}),d("span",null,m(e.error),1)])):r("",!0)]))),128))])])):r("",!0)]),_:1})):r("",!0),ge.value.length>0&&Ce.value.length>0?(F(),i(A,{key:1,class:"summary-card",shadow:"never"},{header:o(()=>[...l[14]||(l[14]=[d("div",{class:"card-header"},[d("h2",null,"Step 3: Review and Upload")],-1)])]),default:o(()=>[d("div",ie,[d("div",re,[l[15]||(l[15]=d("span",{class:"label"},"Total Suppliers:",-1)),d("span",oe,m(ge.value.length),1)]),d("div",ue,[l[16]||(l[16]=d("span",{class:"label"},"Total Documents per Supplier:",-1)),d("span",ne,m(Ce.value.length),1)]),d("div",de,[l[17]||(l[17]=d("span",{class:"label"},"Total Documents to Upload:",-1)),d("span",ce,m(ge.value.length*Ce.value.length),1)])]),s(Ue,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{title:o(()=>[v(" Each selected document will be uploaded to all "+m(ge.value.length)+" selected supplier(s) ",1)]),_:1}),d("div",pe,[s(N,{size:"large",onClick:Re},{default:o(()=>[...l[18]||(l[18]=[v("Cancel",-1)])]),_:1}),s(N,{type:"primary",size:"large",loading:xe.value,disabled:!je.value,onClick:Ne},{default:o(()=>[xe.value?r("",!0):(F(),i(U,{key:0},{default:o(()=>[s(y(S))]),_:1})),v(" "+m(xe.value?"Uploading...":"Start Bulk Upload"),1)]),_:1},8,["loading","disabled"])])]),_:1})):r("",!0),De.value.length>0?(F(),i(A,{key:2,class:"results-card",shadow:"never"},{header:o(()=>[...l[19]||(l[19]=[d("div",{class:"card-header"},[d("h2",null,"Upload Results")],-1)])]),default:o(()=>[d("div",me,[s(Be,{title:"Total Suppliers Processed",value:De.value.length},null,8,["value"]),s(Be,{title:"Successful Uploads",value:De.value.filter(e=>e.successCount>0).length,"value-style":"color: #67c23a"},null,8,["value"]),s(Be,{title:"Failed Uploads",value:De.value.filter(e=>e.failedCount>0).length,"value-style":"color: #f56c6c"},null,8,["value"])]),s(Me,{data:De.value,style:{width:"100%","margin-top":"20px"}},{default:o(()=>[s(Oe,{prop:"supplierName",label:"Supplier","min-width":"200"}),s(Oe,{prop:"successCount",label:"Success",width:"100",align:"center"},{default:o(({row:e})=>[e.successCount>0?(F(),i(a,{key:0,type:"success"},{default:o(()=>[v(m(e.successCount),1)]),_:2},1024)):(F(),t("span",ve,"-"))]),_:1}),s(Oe,{prop:"failedCount",label:"Failed",width:"100",align:"center"},{default:o(({row:e})=>[e.failedCount>0?(F(),i(a,{key:0,type:"danger"},{default:o(()=>[v(m(e.failedCount),1)]),_:2},1024)):(F(),t("span",fe,"-"))]),_:1}),s(Oe,{label:"Status",width:"120",align:"center"},{default:o(({row:e})=>[0===e.failedCount?(F(),i(a,{key:0,type:"success"},{default:o(()=>[...l[20]||(l[20]=[v("Complete",-1)])]),_:1})):e.successCount>0?(F(),i(a,{key:1,type:"warning"},{default:o(()=>[...l[21]||(l[21]=[v("Partial",-1)])]),_:1})):(F(),i(a,{key:2,type:"danger"},{default:o(()=>[...l[22]||(l[22]=[v("Failed",-1)])]),_:1}))]),_:1}),s(Oe,{label:"Details",width:"100"},{default:o(({row:e})=>[e.failedCount>0?(F(),i(N,{key:0,size:"small",text:"",onClick:l=>{return a=e,Te.value=a,void(Se.value=!0);var a}},{default:o(()=>[...l[23]||(l[23]=[v(" View Errors ",-1)])]),_:1},8,["onClick"])):r("",!0)]),_:1})]),_:1},8,["data"])]),_:1})):r("",!0),Se.value?(F(),i(Le,{key:3,modelValue:Se.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Se.value=e),title:"Upload Errors",width:"600px"},{default:o(()=>[Te.value?(F(),t("div",ye,[d("h4",null,m(Te.value.supplierName),1),(F(!0),t(c,null,p(Te.value.errors,(e,l)=>(F(),i(Ue,{key:l,title:e.filename,description:e.error,type:"error",closable:!1,style:{"margin-bottom":"10px"}},null,8,["title","description"]))),128))])):r("",!0)]),_:1},8,["modelValue"])):r("",!0)])}}}),[["__scopeId","data-v-734dceaa"]]);export{ge as default};
