const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/reconciliation-BEVXEeTN.js","assets/index-CA1ThEvj.js","assets/index-CMY-P_dF.css"])))=>i.map(i=>d[i]);
import{d as e,u as a,h as l,i,c as o,C as t,b as n,j as c,z as r,y as u,k as s,f as d,H as m,e as v,t as p,A as _,x as f,m as b,S as h,w as g,E as y,J as D,o as w,_ as V}from"./index-CA1ThEvj.js";import{v as A}from"./el-loading-hoFXZ3d6.js";import{E as j,a as k}from"./el-descriptions-item-Dhl6RC2O.js";import{E as F}from"./el-upload-fKDgI81Q.js";import"./el-progress-zXB2nP8i.js";/* empty css                 */import{E as N}from"./el-input-number-C0RYay6m.js";import{E as I,a as R}from"./el-table-column-CkSadyqs.js";import"./el-scrollbar-DefzV4pD.js";import{E as x}from"./el-tag-CxTn4T_Z.js";import{E,a as C}from"./el-form-item-CIgjZRq6.js";import{E as q,a as Y}from"./el-select-DVJnbJgC.js";import{E as S}from"./el-date-picker-panel-DXckY9Ty.js";import{E as O}from"./el-card-CgDnKMj1.js";import{E as U,a as L}from"./el-col-CbuKrUkC.js";import{E as M}from"./el-statistic-BrXYPADd.js";import{fetchSupplierReconciliations as W}from"./reconciliation-BEVXEeTN.js";import{u as z}from"./useNotification-BAKLaPVZ.js";import"./cloneDeep-BbGJWJjn.js";import"./_baseClone-AiIcXXKO.js";import"./index-BHkcXN0Y.js";import"./castArray-BAWcvkMO.js";import"./debounce-D9fFbg8F.js";import"./dayjs.min-CuEfV50W.js";const B={class:"supplier-reconciliation-view"},P={class:"header-title"},Q={class:"stat-percent"},T={class:"el-upload__tip"},J=V(e({__name:"SupplierReconciliationView",setup(e){const V=z(),{t:J}=a(),H=l(!1),K=l(!1),G=l([]),X=l({total_reconciliations:0,matched_count:0,variance_count:0,unmatched_count:0,confirmed_count:0,total_variance_amount:0,avg_variance_amount:0}),Z=l({pending_confirmations:0,pending_variances:0}),$=i({startDate:"",endDate:"",status:""}),ee=l(!1),ae=l(!1),le=l(!1),ie=l({}),oe=l(null),te=l(null),ne=i({invoiceNumber:"",invoiceDate:"",invoiceAmount:0,invoiceFile:null}),ce=l(),re=l(),ue=o(()=>({invoiceNumber:[{required:!0,message:J("reconciliation.validation.invoiceNoRequired"),trigger:"blur"}],invoiceDate:[{required:!0,message:J("reconciliation.validation.invoiceDateRequired"),trigger:"change"}],invoiceAmount:[{required:!0,message:J("reconciliation.validation.invoiceAmountRequired"),trigger:"blur"}],invoiceFile:[{required:!0,message:J("reconciliation.validation.invoiceFileRequired"),trigger:"change"}]})),se=o(()=>0===X.value.total_reconciliations?0:(X.value.matched_count/X.value.total_reconciliations*100).toFixed(1)),de=async()=>{H.value=!0;try{const e=await W($);G.value=e.reconciliations,X.value=e.stats,Z.value=e.pendingActions}catch(e){console.error(J("reconciliation.messages.loadFailed"),e),V.error(J("reconciliation.messages.loadFailed"))}finally{H.value=!1}},me=()=>{$.startDate="",$.endDate="",$.status="",de()},ve=e=>{ne.invoiceFile=e.raw},pe=()=>{ne.invoiceFile=null},_e=async()=>{ce.value&&await ce.value.validate(async e=>{if(e){K.value=!0;try{const{uploadInvoice:e}=await D(async()=>{const{uploadInvoice:e}=await import("./reconciliation-BEVXEeTN.js");return{uploadInvoice:e}},__vite__mapDeps([0,1,2]));await e({reconciliationId:ie.value.id,invoiceNumber:ne.invoiceNumber,invoiceDate:ne.invoiceDate,invoiceAmount:ne.invoiceAmount,invoiceFile:ne.invoiceFile}),V.success(J("reconciliation.messages.uploadSuccess")),ee.value=!1,de()}catch(a){console.error(J("reconciliation.messages.uploadFailed"),a),V.error(J("reconciliation.messages.uploadFailed"))}finally{K.value=!1}}})},fe=async e=>{try{const{fetchReconciliationById:a}=await D(async()=>{const{fetchReconciliationById:e}=await import("./reconciliation-BEVXEeTN.js");return{fetchReconciliationById:e}},__vite__mapDeps([0,1,2]));oe.value=await a(e.id),ae.value=!0}catch(a){console.error(J("reconciliation.messages.detailsLoadFailed"),a),V.error(J("reconciliation.messages.detailsLoadFailed"))}},be=e=>({matched:"success",variance:"warning",unmatched:"info"}[e]||"info"),he=e=>({matched:J("reconciliation.status.matched"),variance:J("reconciliation.status.variance"),unmatched:J("reconciliation.status.unmatched")}[e]||e);return t(()=>{de()}),(e,a)=>{const l=M,i=L,o=U,t=O,W=S,z=C,ge=Y,ye=q,De=_,we=E,Ve=I,Ae=x,je=R,ke=y,Fe=N,Ne=F,Ie=m,Re=k,xe=j,Ee=A;return w(),n("div",B,[c(t,{class:"header-card"},{header:s(()=>[v("div",P,[v("h2",null,p(d(J)("reconciliation.title")),1)])]),default:s(()=>[c(o,{gutter:20,class:"stats-row"},{default:s(()=>[c(i,{span:6},{default:s(()=>[c(l,{title:d(J)("reconciliation.stats.totalRecords"),value:X.value.total_reconciliations},null,8,["title","value"])]),_:1}),c(i,{span:6},{default:s(()=>[c(l,{title:d(J)("reconciliation.stats.matched"),value:X.value.matched_count},{suffix:s(()=>[v("span",Q," ("+p(se.value)+"%) ",1)]),_:1},8,["title","value"])]),_:1}),c(i,{span:6},{default:s(()=>[c(l,{title:d(J)("reconciliation.stats.varianceRecords"),value:X.value.variance_count,"value-style":"color: #f56c6c"},null,8,["title","value"])]),_:1}),c(i,{span:6},{default:s(()=>[c(l,{title:d(J)("reconciliation.stats.unconfirmed"),value:Z.value.pending_confirmations,"value-style":"color: #e6a23c"},null,8,["title","value"])]),_:1})]),_:1})]),_:1}),c(t,{class:"filter-card"},{default:s(()=>[c(we,{inline:!0,model:$},{default:s(()=>[c(z,{label:d(J)("common.startDate")},{default:s(()=>[c(W,{modelValue:$.startDate,"onUpdate:modelValue":a[0]||(a[0]=e=>$.startDate=e),type:"date",placeholder:d(J)("placeholders.selectStartDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c(z,{label:d(J)("common.endDate")},{default:s(()=>[c(W,{modelValue:$.endDate,"onUpdate:modelValue":a[1]||(a[1]=e=>$.endDate=e),type:"date",placeholder:d(J)("placeholders.selectEndDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c(z,{label:d(J)("common.status")},{default:s(()=>[c(ye,{modelValue:$.status,"onUpdate:modelValue":a[2]||(a[2]=e=>$.status=e),placeholder:d(J)("placeholders.selectStatus"),clearable:""},{default:s(()=>[c(ge,{label:d(J)("reconciliation.status.all"),value:""},null,8,["label"]),c(ge,{label:d(J)("reconciliation.status.matched"),value:"matched"},null,8,["label"]),c(ge,{label:d(J)("reconciliation.status.variance"),value:"variance"},null,8,["label"]),c(ge,{label:d(J)("reconciliation.status.unmatched"),value:"unmatched"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),c(z,null,{default:s(()=>[c(De,{type:"primary",onClick:de},{default:s(()=>[f(p(d(J)("common.search")),1)]),_:1}),c(De,{onClick:me},{default:s(()=>[f(p(d(J)("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),c(t,null,{default:s(()=>[b((w(),r(je,{data:G.value,style:{width:"100%"},onRowClick:fe},{default:s(()=>[c(Ve,{prop:"warehouseOrderNo",label:d(J)("reconciliation.table.warehouseOrderNo"),width:"160"},null,8,["label"]),c(Ve,{prop:"received_date",label:d(J)("reconciliation.table.receivedDate"),width:"120"},null,8,["label"]),c(Ve,{prop:"totalAmount",label:d(J)("reconciliation.table.reconciliationAmount"),width:"120"},{default:s(({row:e})=>[f(" ¥"+p(e.totalAmount.toFixed(2)),1)]),_:1},8,["label"]),c(Ve,{prop:"total_quantity",label:d(J)("reconciliation.table.quantity"),width:"100"},null,8,["label"]),c(Ve,{prop:"status",label:d(J)("common.status"),width:"100"},{default:s(({row:e})=>[c(Ae,{type:be(e.status)},{default:s(()=>[f(p(he(e.status)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),c(Ve,{prop:"variance_amount",label:d(J)("reconciliation.table.varianceAmount"),width:"120"},{default:s(({row:e})=>[v("span",{class:h({"variance-positive":e.variance_amount>0,"variance-negative":e.variance_amount<0})},p(e.variance_amount>=0?"+":"")+"¥"+p(e.variance_amount.toFixed(2)),3)]),_:1},8,["label"]),c(Ve,{prop:"invoiceNumber",label:d(J)("reconciliation.table.invoiceNumber"),width:"150"},null,8,["label"]),c(Ve,{prop:"accountant_confirmed",label:d(J)("reconciliation.table.accountantConfirmed"),width:"100"},{default:s(({row:e})=>[e.accountant_confirmed?(w(),r(Ae,{key:0,type:"success"},{default:s(()=>[f(p(d(J)("reconciliation.confirmStatus.confirmed")),1)]),_:1})):(w(),r(Ae,{key:1,type:"warning"},{default:s(()=>[f(p(d(J)("reconciliation.confirmStatus.unconfirmed")),1)]),_:1}))]),_:1},8,["label"]),c(Ve,{label:d(J)("common.operations"),fixed:"right",width:"200"},{default:s(({row:e})=>[e.invoice_id?u("",!0):(w(),r(De,{key:0,type:"primary",size:"small",onClick:g(a=>(e=>{ie.value=e,ne.invoiceNumber="",ne.invoiceDate="",ne.invoiceAmount=e.totalAmount,ne.invoiceFile=null,ee.value=!0})(e),["stop"])},{default:s(()=>[f(p(d(J)("reconciliation.uploadInvoice")),1)]),_:1},8,["onClick"])),c(De,{size:"small",onClick:g(a=>(async e=>{try{const{fetchWarehouseReceipts:a}=await D(async()=>{const{fetchWarehouseReceipts:e}=await import("./reconciliation-BEVXEeTN.js");return{fetchWarehouseReceipts:e}},__vite__mapDeps([0,1,2])),l=await a({reconciliationId:e.id});l.warehouseReceipts.length>0?(te.value=l.warehouseReceipts[0],le.value=!0):V.warning(J("reconciliation.messages.receiptNotFound"))}catch(a){console.error(J("reconciliation.messages.receiptLoadFailed"),a),V.error(J("reconciliation.messages.receiptLoadFailed"))}})(e),["stop"])},{default:s(()=>[f(p(d(J)("reconciliation.viewWarehouseReceipt")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[Ee,H.value]])]),_:1}),ee.value?(w(),r(Ie,{key:0,modelValue:ee.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ee.value=e),title:d(J)("reconciliation.uploadInvoiceDialog.title"),width:"600px"},{footer:s(()=>[c(De,{onClick:a[7]||(a[7]=e=>ee.value=!1)},{default:s(()=>[f(p(d(J)("common.cancel")),1)]),_:1}),c(De,{type:"primary",loading:K.value,onClick:_e},{default:s(()=>[f(p(d(J)("common.upload")),1)]),_:1},8,["loading"])]),default:s(()=>[c(we,{model:ne,rules:ue.value,ref_key:"uploadFormRef",ref:ce,"label-width":"120px"},{default:s(()=>[c(z,{label:d(J)("reconciliation.uploadInvoiceDialog.reconciliationNo")},{default:s(()=>[c(ke,{modelValue:ie.value.warehouseOrderNo,"onUpdate:modelValue":a[3]||(a[3]=e=>ie.value.warehouseOrderNo=e),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),c(z,{label:d(J)("reconciliation.uploadInvoiceDialog.invoiceNo"),prop:"invoiceNumber"},{default:s(()=>[c(ke,{modelValue:ne.invoiceNumber,"onUpdate:modelValue":a[4]||(a[4]=e=>ne.invoiceNumber=e),placeholder:d(J)("reconciliation.uploadInvoiceDialog.invoiceNo")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c(z,{label:d(J)("reconciliation.uploadInvoiceDialog.invoiceDate"),prop:"invoiceDate"},{default:s(()=>[c(W,{modelValue:ne.invoiceDate,"onUpdate:modelValue":a[5]||(a[5]=e=>ne.invoiceDate=e),type:"date",placeholder:d(J)("reconciliation.uploadInvoiceDialog.invoiceDate"),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c(z,{label:d(J)("reconciliation.uploadInvoiceDialog.invoiceAmount"),prop:"invoiceAmount"},{default:s(()=>[c(Fe,{modelValue:ne.invoiceAmount,"onUpdate:modelValue":a[6]||(a[6]=e=>ne.invoiceAmount=e),precision:2,min:0,controls:!1,style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"]),c(z,{label:d(J)("reconciliation.uploadInvoiceDialog.invoiceFile"),prop:"invoiceFile"},{default:s(()=>[c(Ne,{ref_key:"uploadRef",ref:re,"auto-upload":!1,limit:1,"on-change":ve,"on-remove":pe,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"},{tip:s(()=>[v("div",T,p(d(J)("reconciliation.uploadInvoiceDialog.supportedFormats")),1)]),default:s(()=>[c(De,{type:"primary"},{default:s(()=>[f(p(d(J)("reconciliation.uploadInvoiceDialog.selectFile")),1)]),_:1})]),_:1},512)]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])):u("",!0),ae.value?(w(),r(Ie,{key:1,modelValue:ae.value,"onUpdate:modelValue":a[10]||(a[10]=e=>ae.value=e),title:d(J)("reconciliation.detailsDialog.title"),width:"900px"},{footer:s(()=>[c(De,{onClick:a[9]||(a[9]=e=>ae.value=!1)},{default:s(()=>[f(p(d(J)("common.close")),1)]),_:1})]),default:s(()=>[oe.value?(w(),r(xe,{key:0,column:2,border:""},{default:s(()=>[c(Re,{label:d(J)("reconciliation.table.warehouseOrderNo")},{default:s(()=>[f(p(oe.value.warehouseOrderNo),1)]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.table.receivedDate")},{default:s(()=>[f(p(oe.value.received_date),1)]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.table.reconciliationAmount")},{default:s(()=>[f(" ¥"+p(oe.value.totalAmount.toFixed(2)),1)]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.table.quantity")},{default:s(()=>[f(p(oe.value.total_quantity),1)]),_:1},8,["label"]),c(Re,{label:d(J)("common.status")},{default:s(()=>[c(Ae,{type:be(oe.value.status)},{default:s(()=>[f(p(he(oe.value.status)),1)]),_:1},8,["type"])]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.table.varianceAmount")},{default:s(()=>[v("span",{class:h({"variance-positive":oe.value.variance_amount>0,"variance-negative":oe.value.variance_amount<0})},p(oe.value.variance_amount>=0?"+":"")+"¥"+p(oe.value.variance_amount.toFixed(2)),3)]),_:1},8,["label"]),oe.value.invoiceNumber?(w(),r(Re,{key:0,label:d(J)("reconciliation.table.invoiceNumber")},{default:s(()=>[f(p(oe.value.invoiceNumber),1)]),_:1},8,["label"])):u("",!0),oe.value.invoiceDate?(w(),r(Re,{key:1,label:d(J)("reconciliation.uploadInvoiceDialog.invoiceDate")},{default:s(()=>[f(p(oe.value.invoiceDate),1)]),_:1},8,["label"])):u("",!0),oe.value.invoiceAmount?(w(),r(Re,{key:2,label:d(J)("reconciliation.uploadInvoiceDialog.invoiceAmount")},{default:s(()=>[f(" ¥"+p(oe.value.invoiceAmount.toFixed(2)),1)]),_:1},8,["label"])):u("",!0),c(Re,{label:d(J)("reconciliation.table.accountantConfirmed")},{default:s(()=>[oe.value.accountant_confirmed?(w(),r(Ae,{key:0,type:"success"},{default:s(()=>[f(p(d(J)("reconciliation.confirmStatus.confirmed")),1)]),_:1})):(w(),r(Ae,{key:1,type:"warning"},{default:s(()=>[f(p(d(J)("reconciliation.confirmStatus.unconfirmed")),1)]),_:1}))]),_:1},8,["label"]),oe.value.accountant_notes?(w(),r(Re,{key:3,label:d(J)("common.notes"),span:2},{default:s(()=>[f(p(oe.value.accountant_notes),1)]),_:1},8,["label"])):u("",!0)]),_:1})):u("",!0),oe.value?.varianceAnalysis?(w(),r(t,{key:1,class:"variance-card",style:{"margin-top":"20px"}},{header:s(()=>[v("span",null,p(d(J)("reconciliation.detailsDialog.varianceAnalysis")),1)]),default:s(()=>[c(xe,{column:2,border:""},{default:s(()=>[c(Re,{label:d(J)("reconciliation.table.varianceAmount")},{default:s(()=>[f(" ¥"+p(oe.value.varianceAnalysis.variance_amount.toFixed(2)),1)]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.detailsDialog.variancePercentage")},{default:s(()=>[f(p(oe.value.varianceAnalysis.variance_percentage.toFixed(2))+"% ",1)]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.detailsDialog.varianceReason"),span:2},{default:s(()=>[f(p(oe.value.varianceAnalysis.variance_reason||d(J)("reconciliation.detailsDialog.noReason")),1)]),_:1},8,["label"])]),_:1})]),_:1})):u("",!0)]),_:1},8,["modelValue","title"])):u("",!0),le.value?(w(),r(Ie,{key:2,modelValue:le.value,"onUpdate:modelValue":a[12]||(a[12]=e=>le.value=e),title:d(J)("reconciliation.warehouseDialog.title"),width:"800px"},{footer:s(()=>[c(De,{onClick:a[11]||(a[11]=e=>le.value=!1)},{default:s(()=>[f(p(d(J)("common.close")),1)]),_:1})]),default:s(()=>[te.value?(w(),r(xe,{key:0,column:2,border:""},{default:s(()=>[c(Re,{label:d(J)("reconciliation.warehouseDialog.receiptNo")},{default:s(()=>[f(p(te.value.receipt_number),1)]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.warehouseDialog.receiptDate")},{default:s(()=>[f(p(te.value.receipt_date),1)]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.warehouseDialog.warehouseLocation")},{default:s(()=>[f(p(te.value.warehouse_location||d(J)("reconciliation.warehouseDialog.notSpecified")),1)]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.warehouseDialog.receivedBy")},{default:s(()=>[f(p(te.value.received_by||d(J)("reconciliation.warehouseDialog.notSpecified")),1)]),_:1},8,["label"]),c(Re,{label:d(J)("reconciliation.warehouseDialog.totalItems")},{default:s(()=>[f(p(te.value.total_items),1)]),_:1},8,["label"])]),_:1})):u("",!0)]),_:1},8,["modelValue","title"])):u("",!0)])}}}),[["__scopeId","data-v-684d2fb5"]]);export{J as default};
