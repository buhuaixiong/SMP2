import{d as e,c as a,X as t,Z as s,V as l,a1 as n,P as r,aE as p,b as i,j as o,k as c,z as u,y as d,F as m,r as v,e as y,t as f,x as g,O as _,f as j,S as h,o as k,_ as w}from"./index-rw7zlv6S.js";import{a as x,E as z}from"./el-timeline-item-aXPvNhyq.js";import{E as N}from"./el-tag-cdPnKa4g.js";const b={class:"change-request-timeline"},H={class:"timeline-header"},S={key:0,class:"timeline-content"},T={key:0},q={key:1,class:"comments"},A={key:1,class:"timeline-content pending-hint"},C={key:2,class:"timeline-content future-hint"},E={class:"timeline-header"},D={key:0,class:"timeline-content"},L=w(e({__name:"ChangeRequestTimeline",props:{workflow:{},approvalHistory:{},currentStep:{},status:{}},setup(e){const w=e,L={purchaser:"采购员审批",quality_manager:"品质审批",procurement_manager:"采购经理审批",procurement_director:"采购总监审批",finance_director:"财务总监审批"},F=a(()=>w.workflow.map((e,a)=>{const r=w.approvalHistory.find(a=>a.step===e.step);let p="future",i="info",o=t,c="#909399",u="info",d="未开始";return r?"approved"===r.decision?(p="completed",i="success",o=s,c="#67c23a",u="success",d="已批准"):"rejected"===r.decision&&(p="rejected",i="danger",o=l,c="#f56c6c",u="danger",d="已拒绝"):e.step===w.currentStep&&w.status.includes("pending")&&(p="pending",i="warning",o=n,c="#e6a23c",u="warning",d="审批中"),{step:e.step,label:L[e.step]||e.label,status:p,type:i,icon:o,color:c,tagType:u,statusText:d,approverName:r?.approverName,decision:r?.decision,comments:r?.comments,timestamp:r?.createdAt?new Date(r.createdAt).toLocaleString("zh-CN"):void 0}})),I=a(()=>"approved"===w.status?"approved":"rejected"===w.status?"rejected":null),O=a(()=>{if(!w.approvalHistory.length)return;const e=w.approvalHistory[w.approvalHistory.length-1];return new Date(e.createdAt).toLocaleString("zh-CN")}),P=a(()=>"approved"===I.value?r:"rejected"===I.value?p:void 0),R=a(()=>"approved"===I.value?"success":"rejected"===I.value?"danger":"info"),V=a(()=>"approved"===I.value?"审批完成":"rejected"===I.value?"审批被拒绝":"流程进行中"),X=a(()=>"approved"===I.value?"变更已应用":"rejected"===I.value?"流程终止":"进行中"),Z=a(()=>"approved"===I.value?"所有审批步骤已通过,您的资料修改已自动应用。":"rejected"===I.value?"审批流程已被拒绝,资料未做任何修改。如需修改,请重新提交申请。":null);return(e,a)=>{const t=N,s=_,l=x,r=z;return k(),i("div",b,[o(r,null,{default:c(()=>[(k(!0),i(m,null,v(F.value,(e,r)=>(k(),u(l,{key:e.step,timestamp:e.timestamp,type:e.type,icon:e.icon,color:e.color,placement:"top"},{default:c(()=>[y("div",{class:h(["timeline-card",e.status])},[y("div",H,[y("h4",null,f(e.label),1),o(t,{type:e.tagType,size:"small"},{default:c(()=>[g(f(e.statusText),1)]),_:2},1032,["type"])]),e.approverName?(k(),i("div",S,[y("p",null,[a[0]||(a[0]=y("strong",null,"审批人:",-1)),g(" "+f(e.approverName),1)]),e.decision?(k(),i("p",T,[a[1]||(a[1]=y("strong",null,"决定:",-1)),o(t,{type:"approved"===e.decision?"success":"danger",size:"small",style:{"margin-left":"8px"}},{default:c(()=>[g(f("approved"===e.decision?"批准":"拒绝"),1)]),_:2},1032,["type"])])):d("",!0),e.comments?(k(),i("p",q,[a[2]||(a[2]=y("strong",null,"备注:",-1)),g(" "+f(e.comments),1)])):d("",!0)])):"pending"===e.status?(k(),i("div",A,[o(s,null,{default:c(()=>[o(j(n))]),_:1}),a[3]||(a[3]=y("span",null,"等待审批中...",-1))])):"future"===e.status?(k(),i("div",C,[...a[4]||(a[4]=[y("span",null,"待前序步骤完成",-1)])])):d("",!0)],2)]),_:2},1032,["timestamp","type","icon","color"]))),128)),I.value?(k(),u(l,{key:0,timestamp:O.value,type:"approved"===I.value?"success":"rejected"===I.value?"danger":"info",icon:P.value,placement:"top"},{default:c(()=>[y("div",{class:h(["timeline-card final",I.value])},[y("div",E,[y("h4",null,f(V.value),1),o(t,{type:R.value,size:"small"},{default:c(()=>[g(f(X.value),1)]),_:1},8,["type"])]),Z.value?(k(),i("div",D,[y("p",null,f(Z.value),1)])):d("",!0)],2)]),_:1},8,["timestamp","type","icon"])):d("",!0)]),_:1})])}}}),[["__scopeId","data-v-698b8e74"]]);export{L as default};
