import{d as e,u as a,g as t,h as n,i as l,c as r,C as i,aU as o,m as d,b as s,j as u,z as p,y as m,k as c,f as g,s as f,e as _,x as y,t as v,A as w,O as h,aO as M,a4 as b,P as k,bO as T,eq as j,er as Y,Z as q,cH as F,F as D,r as I,ad as x,dh as C,a0 as S,o as A,bA as E,I as L,_ as z}from"./index-CyQdnTIC.js";import{v as U}from"./el-loading-oesi7HFc.js";import{a as N,E as R}from"./el-timeline-item-CvFovLIE.js";import{E as H}from"./el-link-CQNmh80k.js";import{E as $,a as V}from"./el-form-item-DJ87vTOW.js";import{E as O}from"./el-upload-wfA8ygZ8.js";import{E as P}from"./el-progress-D5jEkcdx.js";import{E as B}from"./el-date-picker-panel-CmBAD9wS.js";/* empty css                 */import"./el-scrollbar-CTtrnhms.js";import{E as W}from"./el-tag-eQgnjs1v.js";import{E as Z,a as K}from"./el-select-CdADVnxU.js";import{a as Q,E as G}from"./el-table-column-DvsfEAIW.js";import{E as J}from"./el-alert-BXhB-eTB.js";import{E as X}from"./el-card-DJj_OhI8.js";import{a as ee,E as ae}from"./el-step-YP-zL8TP.js";import{g as te,r as ne,d as le}from"./dayjs.min-CuEfV50W.js";import{P as re}from"./PageHeader-CMpTsfBB.js";import{f as ie,a as oe,u as de,s as se,d as ue}from"./upgrade-BALzIUu3.js";import{r as pe}from"./apiBaseUrl-Bx8aB0Mq.js";import{u as me}from"./useNotification-DAUqvaBw.js";import"./castArray-C2ko8TfK.js";import"./_baseClone-CxGxK45k.js";import"./cloneDeep-B3nGyXfn.js";import"./index-CubmMpUU.js";import"./debounce-B4S_WZO2.js";import"./index-k8eOE22U.js";var ce,ge={exports:{}};const fe=te(ce?ge.exports:(ce=1,ge.exports=function(e,a,t){e=e||{};var n=a.prototype,l={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function r(e,a,t,l){return n.fromToBase(e,a,t,l)}t.en.relativeTime=l,n.fromToBase=function(a,n,r,i,o){for(var d,s,u,p=r.$locale().relativeTime||l,m=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],c=m.length,g=0;g<c;g+=1){var f=m[g];f.d&&(d=i?t(a).diff(r,f.d,!0):r.diff(a,f.d,!0));var _=(e.rounding||Math.round)(Math.abs(d));if(u=d>0,_<=f.r||!f.r){_<=1&&g>0&&(f=m[g-1]);var y=p[f.l];o&&(_=o(""+_)),s="string"==typeof y?y.replace("%d",_):y(_,n,f.l,u);break}}if(n)return s;var v=u?p.future:p.past;return"function"==typeof v?v(s):v.replace("%s",s)},n.to=function(e,a){return r(e,a,this,!0)},n.from=function(e,a){return r(e,a,this)};var i=function(e){return e.$u?t.utc():t()};n.toNow=function(e){return this.to(i(this),e)},n.fromNow=function(e){return this.from(i(this),e)}}));var _e,ye={exports:{}};_e||(_e=1,ye.exports=function(e){function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=a(e),n={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(e,a){return"W"===a?e+"周":e+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(e,a){var t=100*e+a;return t<600?"凌晨":t<900?"早上":t<1100?"上午":t<1300?"中午":t<1800?"下午":"晚上"}};return t.default.locale(n,null,!0),n}(ne()));const ve={class:"upgrade-page"},we={class:"header-actions"},he={key:0,class:"deadline-date"},Me={class:"card-header-content"},be={class:"progress-text"},ke={class:"document-types-section"},Te={class:"doc-name-cell"},je={key:1,class:"text-muted"},Ye={key:1,class:"upload-section"},qe={class:"select-option-content"},Fe={class:"el-upload__tip"},De={key:2,class:"uploaded-documents-section"},Ie={key:0},xe={class:"timeline-item"},Ce={class:"timeline-title"},Se={key:0},Ae=z(e({__name:"UpgradeManagementView",setup(e){const E=me();le.extend(fe),le.locale("zh-cn");const{t:z}=a();function te(e){const a=`upgradeManagement.status.${e}`,t=z(a);return t!==a?t:e}const ne={not_submitted:"info",under_review:"warning",pending_procurement_review:"warning",pending_quality_review:"warning",pending_procurement_manager_review:"warning",pending_procurement_director_review:"warning",pending_finance_director_review:"warning",returned:"danger",approved:"success",rejected:"danger"};function ce(e){const a=`upgradeManagement.steps.${e}`,t=z(a);return t!==a?t:e}const ge={pending:"warning",approved:"success",rejected:"danger",cancelled:"info"},_e=new Set(["not_submitted","returned","rejected"]),ye=new Set(["not_submitted","returned","rejected","pending_procurement_review","pending_quality_review","pending_procurement_manager_review","pending_procurement_director_review","pending_finance_director_review"]),Ae=f(),Ee=t(),Le=n(!1),ze=n(!1),Ue=n(null),Ne=n(!1),Re=l({}),He=l({supplierId:null,status:"not_submitted",requirements:[],documents:[],workflow:null,reviews:[],fileApprovals:[],application:null}),$e=n(!1),Ve=n(),Oe=l({documentType:"",validFrom:null,validTo:null,file:null}),Pe=r(()=>He.documents),Be=r(()=>Oe.documentType&&Oe.validFrom&&Oe.validTo&&Oe.file),We=r(()=>te(He.status)),Ze=r(()=>ne[He.status]||"info"),Ke=r(()=>!!He.supplierId),Qe=r(()=>Ke.value&&_e.has(He.status)),Ge=r(()=>Ke.value&&ye.has(He.status)),Je=(r(()=>Ke.value?ye.has(He.status)?"":z("upgradeManagement.upload.statusNotEditable"):z("upgradeManagement.upload.noSupplier")),r(()=>He.requirements.map(e=>{const a=He.documents.find(a=>a.requirementCode===e.code)??null,t=a?.file??null,n=Re[e.code],l=n?.fileId??t?.id??e.documentId??null,r=n?.fileName??t?.originalName??"",i=t?.validFrom?new Date(t.validFrom):null,o=t?.validTo?new Date(t.validTo):null;return{code:e.code,name:e.name,description:e.description,required:!!e.required,fulfilled:!!n||!!(e.fulfilled||a||e.documentId),templateUrl:e.template?.downloadUrl?pe(e.template.downloadUrl):null,fileId:l,fileName:r,fileUrl:l?ia(l):null,validFrom:i,validTo:o}}))),Xe=r(()=>!Qe.value||Je.value.every(e=>!e.fileId)),ea=r(()=>{const e=[];He.application&&e.push({key:"application",source:"upgrade_application",title:z("upgradeManagement.workflow.supplierSubmitted"),statusLabel:te(He.application.status)||z("upgradeManagement.workflow.submitted"),actor:He.application.submittedBy||"",time:ra(He.application.submittedAt),remark:He.application.rejectionReason||"",tagType:ne[He.application.status]||"info"}),He.fileApprovals.forEach(a=>{const t=a.fileName?` - ${a.fileName}`:"";e.push({key:`file_approval_${a.id}`,source:a.source,title:`${a.stepName}${t}`,statusLabel:"approved"===a.decision?z("common.approved"):z("common.rejected"),actor:a.decidedByName||"",time:ra(a.decidedAt),remark:a.comments||"",tagType:"approved"===a.decision?"success":"danger"})});const a=new Map(He.reviews.map(e=>[e.stepKey,e]));return He.workflow?.steps?.forEach(t=>{const n=a.get(t.key),l=n?.decision||t.status||"pending";e.push({key:t.key,source:n?.source||"upgrade_application",title:t.name,statusLabel:ce(l),actor:n?.decidedByName||t.permission||"",time:ra(n?.decidedAt||t.completedAt),remark:n?.comments||t.notes||"",tagType:ge[l]||ge.pending})}),e.sort((e,a)=>new Date(e.time||0).getTime()-new Date(a.time||0).getTime())}),aa=r(()=>"not_submitted"!==He.status),ta=r(()=>({not_submitted:0,pending_procurement_review:1,pending_quality_review:2,pending_procurement_manager_review:3,pending_procurement_director_review:4,pending_finance_director_review:5,approved:6,returned:0,rejected:0}[He.status]??0)),na=r(()=>{if(!He.application?.dueAt||"not_submitted"===He.status||"approved"===He.status)return null;const e=le(),a=le(He.application.dueAt).diff(e,"hour"),t=Math.ceil(a/24);return a<0?{title:z("upgradeManagement.deadline.overtime"),message:z("upgradeManagement.deadline.overtimeMessage",{days:Math.abs(t)}),type:"error"}:t<1?{title:z("upgradeManagement.deadline.lessThanOneDay"),message:z("upgradeManagement.deadline.lessThanOneDayMessage",{hours:a}),type:"error"}:t<2?{title:z("upgradeManagement.deadline.remaining",{days:t}),message:z("upgradeManagement.deadline.urgent"),type:"warning"}:{title:z("upgradeManagement.deadline.remaining",{days:t}),message:z("upgradeManagement.deadline.inProgress"),type:"info"}}),la=r(()=>{const e=Je.value.filter(e=>e.required).length;if(0===e)return 0;const a=Je.value.filter(e=>e.required&&e.fulfilled).length;return Math.round(a/e*100)});function ra(e){return e?le(e).format("YYYY-MM-DD HH:mm"):""}function ia(e){const a=localStorage.getItem("token"),t=pe(`/api/files/download/${e}`);if(!a)return t;const n=t.includes("?")?"&":"?";return`${t}${n}token=${a}`}function oa(e){if(Array.isArray(e))return oa(e[0]);if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e&&e.trim().length){const a=Number(e);return Number.isFinite(a)?a:null}return null}async function da(){Le.value=!0,Ue.value=null;const e=oa(Ae.params.id)??oa(Ae.query.supplierId)??oa(Ee.user?.supplierId)??He.supplierId;if(!e)return await sa(z("upgradeManagement.warnings.noSupplierInfo")),void(Le.value=!1);He.supplierId=e,Object.keys(Re).forEach(e=>Reflect.deleteProperty(Re,e));try{const a=await ie(e);He.status=a.status??a.application?.status??"not_submitted",He.requirements=a.requirements??[],He.documents=a.documents??[],He.workflow=a.workflow??null,He.reviews=a.reviews??[],He.fileApprovals=a.fileApprovals??[],He.application=a.application??null,He.requirements.length||await sa()}catch(a){console.error(z("upgradeManagement.warnings.loadStatusFailed"),a),await sa(z("upgradeManagement.warnings.loadStatusFailed"))}finally{Le.value=!1}}async function sa(e){try{const a=await oe();He.status="not_submitted",Object.keys(Re).forEach(e=>Reflect.deleteProperty(Re,e)),He.requirements=a??[],He.documents=[],He.workflow=null,He.reviews=[],He.application=null,e?Ue.value=e:He.requirements.length||(Ue.value=z("upgradeManagement.warnings.noRequirements"))}catch(a){console.error(z("upgradeManagement.warnings.loadRequirementsFailed"),a),Ue.value=e||z("upgradeManagement.warnings.loadRequirementsFailed")}}async function ua(){if(!He.supplierId)return E.error(z("upgradeManagement.warnings.noSupplierInfo")),!1;if(He.application)return!0;try{await se(He.supplierId)}catch(e){console.error(z("upgradeManagement.actions.submitFailed"),e)}return await da(),!!He.application||(E.error(z("upgradeManagement.actions.submitFailed")),!1)}function pa(e){if(!(e.size/1024/1024<20))return E.error(z("upgradeManagement.upload.fileSizeLimit")),!1;const a=e.name.toLowerCase(),t=[".pdf",".doc",".docx",".xls",".xlsx",".jpg",".jpeg",".png"];return!!t.some(e=>a.endsWith(e))||(E.error({message:z("upgradeManagement.upload.unsupportedFormat",{formats:t.join(", ")}),duration:5e3}),!1)}function ma(){}function ca(e){Oe.file=e.raw}async function ga(){if(Be.value&&He.supplierId)try{if($e.value=!0,!(await ua()))return;await de({supplierId:He.supplierId,requirementCode:Oe.documentType,file:Oe.file,status:"submitted",validFrom:le(Oe.validFrom).format("YYYY-MM-DD"),validTo:le(Oe.validTo).format("YYYY-MM-DD")});E.success(z("upgradeManagement.upload.uploadSuccess")),await da(),fa()}catch(e){console.error("Upload failed:",e),E.error(e.message||z("upgradeManagement.upload.uploadFailed"))}finally{$e.value=!1}else E.warning(z("upgradeManagement.upload.pleaseCompleteForm"))}function fa(){Oe.documentType="",Oe.validFrom=null,Oe.validTo=null,Oe.file=null,Ve.value&&Ve.value.clearFiles()}async function _a(e){if(e)try{let a=e;e.startsWith("http")||(a=pe(e));const t=localStorage.getItem("token"),n={};t&&(n.Authorization=`Bearer ${t}`);const l=await fetch(a,{headers:n});if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);const r=await l.blob();if(0===r.size)throw new Error("Downloaded file is empty");let i="template";const o=l.headers.get("Content-Disposition");if(o){const e=o.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(i=e[1].replace(/['"]/g,""))}else{const e=a.split("/");i=e[e.length-1]}if(!(await(async()=>!(!Ne.value||"undefined"==typeof document||"undefined"==typeof window||(await L(),0)))()))return;const d=window.URL.createObjectURL(r),s=document.createElement("a");s.href=d,s.download=decodeURIComponent(i),s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(d)},100),E.success(z("upgradeManagement.upload.downloadStarted"))}catch(a){console.error("[Template Download] Error:",a),E.error(z("upgradeManagement.upload.downloadFailed"))}else E.warning(z("upgradeManagement.notifications.templateNotProvided"))}function ya(e){e?(window.open(e,"_blank"),E.success(z("upgradeManagement.preview.downloadStarted"))):E.warning(z("upgradeManagement.preview.noContent"))}function va(e){return e.getTime()<Date.now()-864e5}function wa(e,a){if(a.validFrom){const t=new Date(a.validFrom).getTime();return e.getTime()<=t}return e.getTime()<Date.now()-864e5}async function ha(){if(!He.supplierId)return void E.error(z("upgradeManagement.warnings.noSupplierInfo"));const e=Je.value.filter(e=>e.fileId),a=Je.value.filter(e=>e.required&&!e.fileId);if(a.length){const e=a.map(e=>e.name).join("、");E.info(z("upgradeManagement.actions.missingDocumentsWarning",{names:e}))}try{await E.confirm(z("upgradeManagement.actions.confirmSubmit"),z("upgradeManagement.actions.hint"),{type:"warning",confirmButtonText:z("upgradeManagement.actions.submit"),cancelButtonText:z("upgradeManagement.actions.cancel")})}catch{return}ze.value=!0;try{const a=e.map(e=>({requirementCode:e.code,fileId:e.fileId})),t=a.length?{documents:a}:{};await se(He.supplierId,t),E.success(z("upgradeManagement.actions.applicationSubmitted")),await da()}catch(t){console.error(z("upgradeManagement.actions.submitFailed"),t),E.error(z("upgradeManagement.actions.submitFailed"))}finally{ze.value=!1}}function Ma(){da()}function ba(e){const a=He.workflow?.steps?.find(a=>a.key===e);return a?ce(a.status):""}let ka=null;return i(()=>{Ne.value=!0,da().then(()=>{He.status&&"not_submitted"!==He.status&&"approved"!==He.status&&"returned"!==He.status&&(ka=setInterval(()=>{da()},3e4))})}),o(()=>{Ne.value=!1,ka&&(clearInterval(ka),ka=null)}),(e,a)=>{const t=W,n=w,l=h,r=ee,i=ae,o=X,f=J,L=P,te=G,ne=Q,le=K,ie=Z,oe=V,de=B,se=O,pe=$,me=H,ce=N,ge=R,fe=U;return d((A(),s("div",ve,[u(re,{title:g(z)("upgradeManagement.title"),subtitle:g(z)("upgradeManagement.subtitle")},{actions:c(()=>[_("div",we,[We.value?(A(),p(t,{key:0,type:Ze.value},{default:c(()=>[y(v(We.value),1)]),_:1},8,["type"])):m("",!0),u(n,{size:"small",onClick:Ma},{default:c(()=>[y(v(g(z)("upgradeManagement.refresh")),1)]),_:1}),Qe.value?(A(),p(n,{key:1,size:"small",type:"primary",loading:ze.value,disabled:Xe.value,onClick:ha},{default:c(()=>[y(v(g(z)("upgradeManagement.submitApplication")),1)]),_:1},8,["loading","disabled"])):m("",!0)])]),_:1},8,["title","subtitle"]),aa.value?(A(),p(o,{key:0,class:"progress-card",shadow:"never"},{default:c(()=>[u(i,{active:ta.value,"finish-status":"success","align-center":""},{default:c(()=>[u(r,{title:g(z)("upgradeManagement.steps.submitApplication"),description:g(z)("upgradeManagement.steps.uploadFiles")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(M))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(z)("upgradeManagement.steps.purchaserReview"),description:ba("procurement_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(b))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(z)("upgradeManagement.steps.qualityReview"),description:ba("quality_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(k))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(z)("upgradeManagement.steps.procurementManagerReview"),description:ba("procurement_manager_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(T))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(z)("upgradeManagement.steps.procurementDirectorReview"),description:ba("procurement_director_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(j))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(z)("upgradeManagement.steps.financeDirectorReview"),description:ba("finance_director_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(Y))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(z)("upgradeManagement.steps.complete"),description:g(z)("upgradeManagement.steps.upgradeToFormal")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(q))]),_:1})]),_:1},8,["title","description"])]),_:1},8,["active"])]),_:1})):m("",!0),na.value?(A(),p(f,{key:1,title:na.value.title,type:na.value.type,closable:!1,"show-icon":"",class:"deadline-alert"},{default:c(()=>[_("p",null,v(na.value.message),1),He.application?.dueAt?(A(),s("p",he,v(g(z)("upgradeManagement.deadline.expectedCompletion"))+": "+v(ra(He.application.dueAt)),1)):m("",!0)]),_:1},8,["title","type"])):m("",!0),u(o,{class:"info-card",shadow:"never"},{header:c(()=>[_("span",null,v(g(z)("upgradeManagement.requirements.title")),1)]),default:c(()=>[u(f,{title:g(z)("upgradeManagement.requirements.description"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),Ue.value?(A(),p(f,{key:0,title:Ue.value,type:"warning",closable:!1,"show-icon":"",class:"mt-12"},null,8,["title"])):m("",!0)]),_:1}),u(o,{class:"upload-card",shadow:"never"},{header:c(()=>[_("div",Me,[_("span",null,v(g(z)("upgradeManagement.upload.title")),1),la.value<100?(A(),p(L,{key:0,percentage:la.value,"stroke-width":8,color:100===la.value?"#67c23a":"#409eff"},{default:c(({percentage:e})=>[_("span",be,v(e)+"%",1)]),_:1},8,["percentage","color"])):(A(),p(t,{key:1,type:"success"},{default:c(()=>[u(l,null,{default:c(()=>[u(g(C))]),_:1}),y(" "+v(g(z)("upgradeManagement.requirements.completed")),1)]),_:1}))])]),default:c(()=>[Ke.value?m("",!0):(A(),p(f,{key:0,type:"warning","show-icon":"",closable:!1,title:g(z)("upgradeManagement.upload.noSupplier"),class:"mb-20"},null,8,["title"])),_("div",ke,[_("h3",null,v(g(z)("upgradeManagement.documentTypes.title")),1),u(ne,{data:Je.value,border:"",stripe:""},{default:c(()=>[u(te,{type:"index",width:"50"}),u(te,{label:g(z)("upgradeManagement.documentTypes.name"),prop:"name","min-width":"200"},{default:c(({row:e})=>[_("div",Te,[_("span",null,v(e.name),1),e.required?(A(),p(t,{key:0,type:"danger",size:"small",class:"ml-2"},{default:c(()=>[y(v(g(z)("upgradeManagement.upload.required")),1)]),_:1})):m("",!0)])]),_:1},8,["label"]),u(te,{label:g(z)("upgradeManagement.documentTypes.description"),prop:"description","min-width":"250"},null,8,["label"]),u(te,{label:g(z)("upgradeManagement.documentTypes.status"),width:"120",align:"center"},{default:c(({row:e})=>[e.fulfilled?(A(),p(t,{key:0,type:"success",size:"small"},{default:c(()=>[u(l,null,{default:c(()=>[u(g(k))]),_:1}),y(" "+v(g(z)("upgradeManagement.upload.uploaded")),1)]),_:1})):(A(),p(t,{key:1,type:"info",size:"small"},{default:c(()=>[y(v(g(z)("upgradeManagement.upload.notUploaded")),1)]),_:1}))]),_:1},8,["label"]),u(te,{label:g(z)("upgradeManagement.documentTypes.template"),width:"150",align:"center"},{default:c(({row:e})=>[e.templateUrl?(A(),p(n,{key:0,size:"small",type:"primary",link:"",onClick:a=>_a(e.templateUrl)},{default:c(()=>[u(l,null,{default:c(()=>[u(g(F))]),_:1}),y(" "+v(g(z)("common.download")),1)]),_:1},8,["onClick"])):(A(),s("span",je,v(g(z)("upgradeManagement.upload.noTemplate")),1))]),_:1},8,["label"])]),_:1},8,["data"])]),Ge.value?(A(),s("div",Ye,[_("h3",null,v(g(z)("upgradeManagement.upload.title")),1),u(pe,{model:Oe,"label-width":"140px"},{default:c(()=>[u(oe,{label:g(z)("upgradeManagement.upload.documentType"),required:""},{default:c(()=>[u(ie,{modelValue:Oe.documentType,"onUpdate:modelValue":a[0]||(a[0]=e=>Oe.documentType=e),placeholder:g(z)("upgradeManagement.upload.selectDocumentType"),style:{width:"100%"},onChange:ma},{default:c(()=>[(A(!0),s(D,null,I(Je.value,e=>(A(),p(le,{key:e.code,label:e.name,value:e.code},{default:c(()=>[_("div",qe,[_("span",null,v(e.name),1),e.required?(A(),p(t,{key:0,type:"danger",size:"small"},{default:c(()=>[y(v(g(z)("upgradeManagement.upload.required")),1)]),_:1})):m("",!0),e.fulfilled?(A(),p(t,{key:1,type:"success",size:"small"},{default:c(()=>[y(v(g(z)("upgradeManagement.upload.uploaded")),1)]),_:1})):m("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(oe,{label:g(z)("upgradeManagement.upload.validFrom"),required:""},{default:c(()=>[u(de,{modelValue:Oe.validFrom,"onUpdate:modelValue":a[1]||(a[1]=e=>Oe.validFrom=e),type:"date",placeholder:g(z)("upgradeManagement.upload.selectDate"),"disabled-date":va,style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(oe,{label:g(z)("upgradeManagement.upload.validTo"),required:""},{default:c(()=>[u(de,{modelValue:Oe.validTo,"onUpdate:modelValue":a[2]||(a[2]=e=>Oe.validTo=e),type:"date",placeholder:g(z)("upgradeManagement.upload.selectDate"),"disabled-date":e=>wa(e,Oe),style:{width:"100%"}},null,8,["modelValue","placeholder","disabled-date"])]),_:1},8,["label"]),u(oe,{label:g(z)("upgradeManagement.upload.file"),required:""},{default:c(()=>[u(se,{ref_key:"uploadRef",ref:Ve,class:"upload-demo","auto-upload":!1,limit:1,"on-change":ca,"before-upload":pa,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"},{trigger:c(()=>[u(n,{type:"primary"},{default:c(()=>[u(l,null,{default:c(()=>[u(g(M))]),_:1}),y(" "+v(g(z)("upgradeManagement.upload.chooseFile")),1)]),_:1})]),tip:c(()=>[_("div",Fe,v(g(z)("upgradeManagement.upload.fileTypeHint")),1)]),_:1},512)]),_:1},8,["label"]),u(oe,null,{default:c(()=>[u(n,{type:"primary",loading:$e.value,disabled:!Be.value,onClick:ga},{default:c(()=>[u(l,null,{default:c(()=>[u(g(x))]),_:1}),y(" "+v(g(z)("upgradeManagement.upload.uploadFile")),1)]),_:1},8,["loading","disabled"]),u(n,{onClick:fa},{default:c(()=>[y(v(g(z)("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])])):m("",!0),Pe.value.length?(A(),s("div",De,[_("h3",null,v(g(z)("upgradeManagement.upload.uploadedDocuments")),1),u(ne,{data:Pe.value,border:"",stripe:""},{default:c(()=>[u(te,{type:"index",width:"50"}),u(te,{label:g(z)("upgradeManagement.documentTypes.type"),prop:"requirementName","min-width":"180"},null,8,["label"]),u(te,{label:g(z)("upgradeManagement.documentTypes.fileName"),"min-width":"200"},{default:c(({row:e})=>[e.file?(A(),p(me,{key:0,type:"primary",onClick:a=>ya(ia(e.file.id))},{default:c(()=>[y(v(e.file.originalName),1)]),_:2},1032,["onClick"])):m("",!0)]),_:1},8,["label"]),u(te,{label:g(z)("upgradeManagement.documentTypes.validityPeriod"),width:"220"},{default:c(({row:e})=>[e.file&&e.file.validFrom&&e.file.validTo?(A(),s("span",Ie,v(ra(e.file.validFrom))+" ~ "+v(ra(e.file.validTo)),1)):m("",!0)]),_:1},8,["label"]),u(te,{label:g(z)("upgradeManagement.documentTypes.uploadedAt"),width:"180"},{default:c(({row:e})=>[y(v(e.file?ra(e.file.uploadTime):"-"),1)]),_:1},8,["label"]),u(te,{label:g(z)("common.actions"),width:"120",align:"center"},{default:c(({row:e})=>[Ge.value&&e.file?(A(),p(n,{key:0,size:"small",type:"danger",link:"",onClick:a=>async function(e){await E.confirm(z("upgradeManagement.upload.confirmDelete"),z("common.confirm"),{type:"warning"});try{if(!He.supplierId)return void E.error(z("upgradeManagement.upload.noSupplier"));await ue(He.supplierId,e.id),E.success(z("common.operationSuccess")),await da()}catch(a){E.error(a.message||z("common.operationFailed"))}}(e)},{default:c(()=>[y(v(g(z)("common.delete")),1)]),_:1},8,["onClick"])):m("",!0)]),_:1},8,["label"])]),_:1},8,["data"])])):m("",!0),m("",!0)]),_:1}),ea.value.length?(A(),p(o,{key:2,class:"timeline-card",shadow:"never"},{header:c(()=>[_("span",null,v(g(z)("upgradeManagement.workflow.title")),1)]),default:c(()=>[u(ge,null,{default:c(()=>[(A(!0),s(D,null,I(ea.value,e=>(A(),p(ce,{key:e.key,timestamp:e.time,type:e.tagType,placement:"top"},{default:c(()=>[_("div",xe,[_("div",Ce,["file_upload"===e.source?(A(),p(t,{key:0,size:"small",class:"source-tag file-upload-tag"},{default:c(()=>[u(l,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:c(()=>[u(g(S))]),_:1}),a[5]||(a[5]=y(" 文件审批 ",-1))]),_:1})):"upgrade_application"===e.source?(A(),p(t,{key:1,size:"small",class:"source-tag upgrade-app-tag"},{default:c(()=>[u(l,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:c(()=>[u(g(M))]),_:1}),a[6]||(a[6]=y(" 升级申请 ",-1))]),_:1})):m("",!0),_("span",null,v(e.title),1),u(t,{size:"small",type:e.tagType},{default:c(()=>[y(v(e.statusLabel),1)]),_:2},1032,["type"])]),_("p",null,v(g(z)("upgradeManagement.workflow.handler"))+": "+v(e.actor||"—"),1),e.remark?(A(),s("p",Se,v(g(z)("upgradeManagement.workflow.remark"))+": "+v(e.remark),1)):m("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})]),_:1})):m("",!0)])),[[fe,Le.value]])}}}),[["__scopeId","data-v-6fc36297"]]);export{Ae as default};
