import{d as a,g as e,h as s,C as t,s as o,q as r,T as u,b as i,e as l,j as n,k as c,O as d,t as g,f as p,U as f,o as m,_ as v}from"./index-CA1ThEvj.js";import{u as h}from"./useNotification-BAKLaPVZ.js";const y={class:"auto-login-page"},_={class:"login-box"},w=v(a({__name:"AutoLoginView",setup(a){const v=h(),w=o(),b=r(),k=e(),q=s("正在自动登录..."),T=s("请稍候，即将跳转");return t(async()=>{const a=w.query.token,e=w.query.redirect;if(!a)return v.error("缺少登录凭证"),void b.push("/login");try{q.value="验证邀请链接...";const s=await u.get(`/api/public/auto-login/${a}`);if(!s.data.success)throw new Error(s.data?.message||"Auto login failed");q.value="登录成功！",T.value="正在跳转到询价详情页...",localStorage.setItem("token",s.data.token),localStorage.setItem("user",JSON.stringify(s.data.user)),await k.fetchMe(),setTimeout(()=>{const a=e||s.data.redirectTo||"/dashboard";b.push(a),v.success("欢迎回来！")},800)}catch(s){console.error("[AutoLogin] Error:",s),q.value="登录失败",T.value=s.response?.data?.message||"自动登录失败，请手动登录",!s.response?.data?.message&&s?.message&&(T.value=s.message),v.error(T.value),setTimeout(()=>{b.push({path:"/login",query:{redirect:e}})},2e3)}}),(a,e)=>{const s=d;return m(),i("div",y,[l("div",_,[n(s,{class:"is-loading",size:60,color:"#409eff"},{default:c(()=>[n(p(f))]),_:1}),l("h2",null,g(q.value),1),l("p",null,g(T.value),1)])])}}}),[["__scopeId","data-v-fc621005"]]);export{w as default};
