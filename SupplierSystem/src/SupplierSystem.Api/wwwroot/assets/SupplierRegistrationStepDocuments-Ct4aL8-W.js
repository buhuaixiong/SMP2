import{d as e,b as t,e as s,z as i,y as a,j as r,A as n,k as l,x as o,t as p,F as c,r as u,S as d,o as m,h as v,C as f,aU as g,f as w,I as y,_ as k}from"./index-CS8qqvyX.js";import{E as F}from"./el-alert-Co_UA7So.js";import{u as b}from"./useNotification-B-0zv-mz.js";const R={class:"preview-panel"},O={class:"preview-actions"},P={key:1,class:"preview-result"},h={class:"preview-meta"},L={class:"preview-steps"},_={class:"step-name"},A={class:"step-role"},C={class:"step-eta"},E={key:0,class:"preview-risks"},j=e({__name:"SupplierRegistrationPreviewPanel",props:{translateOr:{type:Function},previewLoading:{type:Boolean},previewError:{},approvalPreview:{},formatEta:{type:Function},requestPreview:{type:Function}},setup:e=>(v,f)=>{const g=n,w=F;return m(),t("div",R,[s("div",O,[r(g,{size:"small",loading:e.previewLoading,onClick:e.requestPreview},{default:l(()=>[o(p(e.translateOr("supplierRegistration.actions.previewApproval","Preview Approval Flow")),1)]),_:1},8,["loading","onClick"])]),e.previewError?(m(),i(w,{key:0,type:"error",closable:!1,class:"preview-alert"},{default:l(()=>[o(p(e.previewError),1)]),_:1})):a("",!0),e.approvalPreview?(m(),t("div",P,[s("h3",null,p(e.approvalPreview.templateLabel),1),s("p",h,[o(p(e.translateOr("supplierRegistration.preview.estimatedTimeline","Estimated completion"))+": ",1),s("strong",null,p(e.approvalPreview.estimatedWorkingDays),1),o(" "+p(e.translateOr("supplierRegistration.preview.workingDays","working days")),1)]),s("ul",L,[(m(!0),t(c,null,u(e.approvalPreview.steps,i=>(m(),t("li",{key:i.key},[s("div",_,p(i.title),1),s("div",A,p(i.role),1),s("div",C,p(e.formatEta(i.eta)),1)]))),128))]),e.approvalPreview.riskFlags.length?(m(),t("div",E,[s("h4",null,p(e.translateOr("supplierRegistration.preview.riskFlags","Attention points")),1),s("ul",null,[(m(!0),t(c,null,u(e.approvalPreview.riskFlags,e=>(m(),t("li",{key:e.key,class:d(["risk-flag",e.level])},p(e.message),3))),128))])])):a("",!0)])):a("",!0)])}}),z={class:"wizard-step"},B={class:"step-title"},x={class:"step-description"},q={class:"documents-intro"},N={class:"documents-hint"},D={class:"documents-grid"},U={class:"document-card"},W={class:"document-hint"},S={class:"document-actions"},I=["accept"],M={key:0,class:"file-meta"},T={key:1,class:"file-empty"},G={class:"document-card"},$={class:"document-hint"},K={class:"document-actions"},J=["accept"],Y={key:0,class:"file-meta"},H={key:1,class:"file-empty"},Q=k(e({__name:"SupplierRegistrationStepDocuments",props:{title:{},description:{},form:{},translateOr:{type:Function},approvalPreview:{},previewLoading:{type:Boolean},previewError:{},formatEta:{type:Function},requestPreview:{type:Function}},emits:["update:form"],setup(e,{emit:c}){const u=b(),d=new Set(["application/pdf","image/jpeg","image/png","image/jpg"]),k=[".pdf",".jpg",".jpeg",".png"],F=e,R=c,O=v(null),P=v(null),h=v(!1),L=v(!1),_=k.join(",");f(()=>{L.value=!0}),g(()=>{L.value=!1});const A=e=>{const t=e.toLowerCase();return t.endsWith(".pdf")?"application/pdf":t.endsWith(".jpg")||t.endsWith(".jpeg")?"image/jpeg":t.endsWith(".png")?"image/png":"application/octet-stream"},C=e=>!e||Number.isNaN(e)?"0 KB":e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`,E=async e=>{await(async()=>!(!L.value||"undefined"==typeof document||(await y(),0)))()&&e?.click()},Q=(e,t)=>{R("update:form",{...F.form,[e]:t})},V=e=>{Q(e,null)},X=async(e,t)=>{const s=t.target,i=s?.files?.[0]??null;if(s&&(s.value=""),i)if(i.size>10485760)u.error(F.translateOr("supplierRegistration.documents.errors.fileTooLarge","File size exceeds 10MB limit."));else if((e=>{if(e.type&&d.has(e.type))return!0;const t=e.name.toLowerCase();return k.some(e=>t.endsWith(e))})(i))try{h.value=!0;const t=await(e=>new Promise((t,s)=>{const i=new FileReader;i.onload=()=>{"string"==typeof i.result?t(i.result):s(new Error("Failed to read file"))},i.onerror=()=>s(i.error??new Error("Failed to read file")),i.readAsDataURL(e)}))(i),s={name:i.name,type:i.type||A(i.name),size:i.size,content:t};Q(e,s),u.success(F.translateOr("supplierRegistration.documents.success","File ready for submission."))}catch(a){console.error("Failed to read file",a),u.error(F.translateOr("supplierRegistration.documents.errors.readFailed","Unable to read the selected file. Please try again."))}finally{h.value=!1}else u.error(F.translateOr("supplierRegistration.documents.errors.unsupportedType","Unsupported file type. Please upload a PDF or image."))};return(c,u)=>{const d=n;return m(),t("section",z,[s("h2",B,p(e.title),1),s("p",x,p(e.description),1),s("div",q,[s("p",null,p(e.translateOr("supplierRegistration.documents.instructions","Please upload clear copies of the required certificates so we can verify your registration.")),1),s("p",N,p(e.translateOr("supplierRegistration.documents.acceptedTypes","Accepted formats: PDF, JPG, PNG. Maximum size 10MB per file.")),1)]),s("div",D,[s("div",U,[s("h3",null,p(e.translateOr("supplierRegistration.documents.businessLicense.title","Business License")),1),s("p",W,p(e.translateOr("supplierRegistration.documents.businessLicense.hint","Government issued business registration certificate.")),1),s("div",S,[s("input",{ref_key:"businessInput",ref:O,type:"file",class:"file-input",accept:w(_),onChange:u[0]||(u[0]=e=>X("businessLicenseFile",e))},null,40,I),r(d,{type:"primary",onClick:u[1]||(u[1]=e=>E(O.value)),loading:h.value},{default:l(()=>[o(p(e.form.businessLicenseFile?e.translateOr("supplierRegistration.documents.actions.replace","Replace File"):e.translateOr("supplierRegistration.documents.actions.upload","Upload File")),1)]),_:1},8,["loading"]),e.form.businessLicenseFile?(m(),i(d,{key:0,type:"danger",text:"",size:"small",onClick:u[2]||(u[2]=e=>V("businessLicenseFile"))},{default:l(()=>[o(p(e.translateOr("common.remove","Remove")),1)]),_:1})):a("",!0)]),e.form.businessLicenseFile?(m(),t("div",M,[s("strong",null,p(e.form.businessLicenseFile.name),1),s("span",null,"("+p(C(e.form.businessLicenseFile.size))+")",1)])):(m(),t("p",T,p(e.translateOr("supplierRegistration.documents.noFile","No file selected yet.")),1))]),s("div",G,[s("h3",null,p(e.translateOr("supplierRegistration.documents.bankCertificate.title","Bank Account Certificate")),1),s("p",$,p(e.translateOr("supplierRegistration.documents.bankCertificate.hint","Bank-issued account opening information or equivalent proof.")),1),s("div",K,[s("input",{ref_key:"bankInput",ref:P,type:"file",class:"file-input",accept:w(_),onChange:u[3]||(u[3]=e=>X("bankAccountFile",e))},null,40,J),r(d,{type:"primary",onClick:u[4]||(u[4]=e=>E(P.value)),loading:h.value},{default:l(()=>[o(p(e.form.bankAccountFile?e.translateOr("supplierRegistration.documents.actions.replace","Replace File"):e.translateOr("supplierRegistration.documents.actions.upload","Upload File")),1)]),_:1},8,["loading"]),e.form.bankAccountFile?(m(),i(d,{key:0,type:"danger",text:"",size:"small",onClick:u[5]||(u[5]=e=>V("bankAccountFile"))},{default:l(()=>[o(p(e.translateOr("common.remove","Remove")),1)]),_:1})):a("",!0)]),e.form.bankAccountFile?(m(),t("div",Y,[s("strong",null,p(e.form.bankAccountFile.name),1),s("span",null,"("+p(C(e.form.bankAccountFile.size))+")",1)])):(m(),t("p",H,p(e.translateOr("supplierRegistration.documents.noFile","No file selected yet.")),1))])]),r(j,{class:"preview-container","translate-or":e.translateOr,"preview-loading":e.previewLoading,"preview-error":e.previewError,"approval-preview":e.approvalPreview,"format-eta":e.formatEta,"request-preview":e.requestPreview},null,8,["translate-or","preview-loading","preview-error","approval-preview","format-eta","request-preview"])])}}}),[["__scopeId","data-v-a7931f8b"]]);export{Q as default};
