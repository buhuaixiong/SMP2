const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TemplateFileInfo-BiZ5lXqk.js","assets/formatting-JD-iopQE.js","assets/index-DXSUgVsS.js","assets/index-D5VxGV9f.css","assets/TemplateFileInfo-kAlDyXKY.css","assets/TemplateHistoryList-B9xVJ9wc.js","assets/TemplateHistoryList-llrMVW_P.css","assets/TemplateUploadPanel-Cza5tosd.js","assets/TemplateUploadPanel-CnZG2-Ju.css"])))=>i.map(i=>d[i]);
import{d as a,aS as e,b as t,e as l,y as i,aa as r,t as o,o as s,_ as d,W as n,aP as p,h as m,i as c,u as y,c as u,C as b,j as v,F as L,r as _,z as f,k as g,f as h,G as $,aA as w,J as T}from"./index-DXSUgVsS.js";import{P as k}from"./PageHeader-4WSdsSzt.js";const F={class:"template-card"},x={class:"card-header"},H={class:"card-titles"},P={class:"card-title"},j={key:0,class:"card-code"},A={key:0,class:"card-actions"},E={key:0,class:"card-description"},V=d(a({name:"TemplateCard",__name:"TemplateCard",props:{template:{}},setup(a){const d=e(a,"template");return(a,e)=>(s(),t("article",F,[l("header",x,[l("div",H,[l("h2",P,o(d.value.name),1),d.value.code?(s(),t("p",j,o(d.value.code),1)):i("",!0)]),a.$slots.actions?(s(),t("div",A,[r(a.$slots,"actions",{template:d.value},void 0,!0)])):i("",!0)]),d.value.description?(s(),t("p",E,o(d.value.description),1)):i("",!0),r(a.$slots,"default",{template:d.value},void 0,!0)]))}}),[["__scopeId","data-v-c3017c0f"]]),C=p("templateLibrary",()=>{const a=m([]),e=m(!1),t=m(!1),l=m({}),i=c({}),r=async a=>{i[a]=!0;try{const e=await(async a=>(await n(`/templates/history/${a}`)).data)(a);return l.value={...l.value,[a]:e.history},e.history}finally{i[a]=!1}};return{templates:a,loading:e,uploading:t,history:l,historyLoading:i,loadTemplates:async()=>{e.value=!0;try{a.value=await(async()=>(await n("/templates")).data)()}finally{e.value=!1}},loadHistory:r,uploadTemplate:async(e,l)=>{t.value=!0;try{a.value=await(async(a,e)=>{const t=new FormData;return t.append("templateCode",a),t.append("file",e),(await n("/templates",{method:"POST",body:t})).data})(e,l),await r(e)}finally{t.value=!1}},reset:()=>{a.value=[],l.value={},Object.keys(i).forEach(a=>{delete i[a]})}}}),I={class:"admin-template-library"},O={key:0,class:"panel"},D={key:1,class:"template-grid"},R=["onClick"],S=d(a({name:"AdminTemplateLibraryView",__name:"AdminTemplateLibraryView",setup(a){const{t:e}=y(),r=C(),d=$(()=>T(()=>import("./TemplateFileInfo-BiZ5lXqk.js"),__vite__mapDeps([0,1,2,3,4]))),n=$(()=>T(()=>import("./TemplateHistoryList-B9xVJ9wc.js"),__vite__mapDeps([5,1,2,3,6]))),p=$(()=>T(()=>import("./TemplateUploadPanel-Cza5tosd.js"),__vite__mapDeps([7,2,3,8]))),F=u(()=>r.templates),x=u(()=>r.loading),H=u(()=>r.uploading),P=u(()=>r.history),j=r.historyLoading,A=c({}),E=m(null),S=c({}),U=async a=>{if(!P.value[a])try{await r.loadHistory(a)}catch(t){console.error(e("templateLibrary.admin.errors.historyLoadFailed"),t),S[a]=t?.message||e("templateLibrary.admin.errors.historyLoadFailed")}},z=async({code:a,file:t})=>{if(t){S[a]=null,E.value=a;try{await r.uploadTemplate(a,t),await U(a)}catch(l){console.error(e("templateLibrary.admin.errors.uploadFailed"),l),S[a]=l?.message||e("templateLibrary.admin.errors.uploadFailed")}finally{E.value=null}}};return b(()=>{r.templates.length||r.loadTemplates().catch(a=>{console.error(e("templateLibrary.notifications.loadFailure"),a)})}),(a,e)=>(s(),t("div",I,[v(k,{title:a.$t("templateLibrary.admin.title"),subtitle:a.$t("templateLibrary.admin.subtitle")},null,8,["title","subtitle"]),x.value?(s(),t("section",O,o(a.$t("templateLibrary.admin.loading")),1)):(s(),t("section",D,[(s(!0),t(L,null,_(F.value,e=>(s(),f(V,{key:e.code,template:e},{actions:g(()=>[l("button",{type:"button",class:"link-btn",onClick:a=>(async a=>{A[a]=!A[a],A[a]&&await U(a)})(e.code)},o(A[e.code]?a.$t("templateLibrary.admin.hideHistory"):a.$t("templateLibrary.admin.showHistory")),9,R)]),default:g(()=>[v(h(d),{file:e.file,label:a.$t("templateLibrary.admin.currentVersion"),"empty-text":a.$t("templateLibrary.admin.noFileUploaded"),"updated-at-label":a.$t("templateLibrary.admin.updatedAt"),"uploaded-by-label":a.$t("common.uploadedBy")},null,8,["file","label","empty-text","updated-at-label","uploaded-by-label"]),v(h(p),{"template-code":e.code,loading:H.value,"uploading-code":E.value,"uploading-label":a.$t("templateLibrary.admin.uploading"),"idle-label":a.$t("templateLibrary.admin.uploadNewVersion"),hint:a.$t("templateLibrary.admin.uploadHint"),error:S[e.code],onFileSelected:z},null,8,["template-code","loading","uploading-code","uploading-label","idle-label","hint","error"]),v(w,{name:"fade"},{default:g(()=>[A[e.code]?(s(),f(h(n),{key:0,records:P.value[e.code]??[],loading:h(j)[e.code],"loading-text":a.$t("templateLibrary.admin.historyLoading"),"empty-text":a.$t("templateLibrary.admin.noHistory"),"active-label":a.$t("templateLibrary.admin.active")},null,8,["records","loading","loading-text","empty-text","active-label"])):i("",!0)]),_:2},1024)]),_:2},1032,["template"]))),128))]))]))}}),[["__scopeId","data-v-74e8f419"]]);export{S as default};
