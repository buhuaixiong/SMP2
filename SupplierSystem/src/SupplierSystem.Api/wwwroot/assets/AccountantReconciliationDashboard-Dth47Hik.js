import{d as e,u as a,h as l,i as t,C as o,b as i,j as n,k as c,H as r,e as s,t as u,A as d,x as m,m as p,z as v,S as f,y as b,w as _,o as h,_ as y}from"./index-DYW-9HVg.js";import{v as $}from"./el-loading-EmpM09K0.js";import{a as D,E as g}from"./el-descriptions-item-DKdMSAb4.js";import{E as w,a as j}from"./el-table-column-eOofRe2j.js";import"./el-scrollbar-B8Y1GDoK.js";import{E as k}from"./el-tag-DEVBqNcX.js";import{E as V,a as x}from"./el-form-item-DqqqEY3e.js";import{E as A,a as F}from"./el-select-DpRgKpiV.js";import{E as Y}from"./el-date-picker-panel-BUIspTCl.js";/* empty css                 */import{E as C,a as T}from"./el-col-DFePBSau.js";import{E as R}from"./el-card-DVAl8v7r.js";import{E}from"./el-statistic-C0JFz7_w.js";import{fetchReconciliationDashboard as N,fetchReconciliationById as S,confirmReconciliation as U,fetchReconciliationReport as M}from"./reconciliation-CdBg07Gs.js";import{u as P}from"./useNotification-Bqjc37vL.js";import"./_baseClone-DNduPj-I.js";import"./castArray-C5ERpviB.js";import"./debounce-Dt_geyOi.js";import"./dayjs.min-CuEfV50W.js";import"./index-CIUigkvb.js";const O={class:"accountant-reconciliation-dashboard"},z={class:"header-title"},B={key:0},G={key:1,class:"text-muted"},q=y(e({__name:"AccountantReconciliationDashboard",setup(e){const y=P(),{t:q}=a(),I=l(!1),H=l(!1),W=l([]),J=l({total_reconciliations:0,matched_count:0,variance_count:0,unmatched_count:0,confirmed_count:0,total_variance_amount:0,avg_variance_amount:0}),K=t({startDate:"",endDate:"",status:""}),L=t({reportType:"summary",startDate:"",endDate:""}),Q=l(!1),X=l(!1),Z=l(null),ee=async()=>{I.value=!0;try{const e=await N(K);W.value=e.recentReconciliations,J.value=e.stats}catch(e){console.error(q("reconciliation.messages.fetchDataFailed"),e),y.error(q("reconciliation.messages.fetchDataFailed"))}finally{I.value=!1}},ae=()=>{K.startDate="",K.endDate="",K.status="",ee()},le=async e=>{try{Z.value=await S(e.id),Q.value=!0}catch(a){console.error(q("reconciliation.messages.fetchDetailsFailed"),a),y.error(q("reconciliation.messages.fetchDetailsFailed"))}},te=async(e,a)=>{try{const l=a?await y.prompt(q("reconciliation.prompts.confirmNotes"),q("reconciliation.prompts.confirmTitle"),{confirmButtonText:q("common.confirm"),cancelButtonText:q("common.cancel"),inputPattern:/.*/,inputPlaceholder:q("reconciliation.prompts.notesPlaceholder")}).then(({value:e})=>e).catch(()=>null):await y.prompt(q("reconciliation.prompts.rejectReason"),q("reconciliation.prompts.rejectTitle"),{confirmButtonText:q("reconciliation.buttons.reject"),cancelButtonText:q("common.cancel"),inputValidator:e=>!!e||q("reconciliation.validation.rejectReasonRequired"),inputPlaceholder:q("reconciliation.prompts.rejectReasonPlaceholder")}).then(({value:e})=>e).catch(()=>null);if(null===l&&!a)return;await U({reconciliationId:e.id,confirm:a,notes:l||void 0}),y.success(q(a?"reconciliation.messages.confirmSuccess":"reconciliation.messages.rejectSuccess")),ee()}catch(l){console.error(q(a?"reconciliation.messages.confirmFailed":"reconciliation.messages.rejectFailed"),l),y.error(q(a?"reconciliation.messages.confirmFailed":"reconciliation.messages.rejectFailed"))}},oe=async()=>{H.value=!0;try{const e=await M({reportType:L.reportType,startDate:L.startDate,endDate:L.endDate});y.success(q("reconciliation.messages.reportGeneratedSuccess")),console.log("Generated report:",e),X.value=!1}catch(e){console.error(q("reconciliation.messages.reportGeneratedFailed"),e),y.error(q("reconciliation.messages.reportGeneratedFailed"))}finally{H.value=!1}},ie=e=>({matched:"success",variance:"warning",unmatched:"info"}[e]||"info"),ne=e=>q(`reconciliation.status.${e}`,e);return o(()=>{ee()}),(e,a)=>{const l=d,t=E,o=R,y=T,N=C,S=Y,U=x,M=F,P=A,q=V,ce=w,re=k,se=j,ue=D,de=g,me=r,pe=$;return h(),i("div",O,[n(o,{class:"header-card"},{header:c(()=>[s("div",z,[s("h2",null,u(e.$t("reconciliation.dashboard.title")),1),n(l,{type:"primary",onClick:a[0]||(a[0]=e=>X.value=!0)},{default:c(()=>[m(u(e.$t("reconciliation.buttons.generateReport")),1)]),_:1})])]),default:c(()=>[n(N,{gutter:20,class:"stats-row"},{default:c(()=>[n(y,{span:6},{default:c(()=>[n(o,null,{default:c(()=>[n(t,{title:e.$t("reconciliation.stats.totalRecords"),value:J.value.total_reconciliations},null,8,["title","value"])]),_:1})]),_:1}),n(y,{span:6},{default:c(()=>[n(o,null,{default:c(()=>[n(t,{title:e.$t("reconciliation.stats.matched"),value:J.value.matched_count,"value-style":"color: #67c23a"},null,8,["title","value"])]),_:1})]),_:1}),n(y,{span:6},{default:c(()=>[n(o,null,{default:c(()=>[n(t,{title:e.$t("reconciliation.stats.varianceRecords"),value:J.value.variance_count,"value-style":"color: #e6a23c"},null,8,["title","value"])]),_:1})]),_:1}),n(y,{span:6},{default:c(()=>[n(o,null,{default:c(()=>[n(t,{title:e.$t("reconciliation.stats.unconfirmed"),value:J.value.total_reconciliations-J.value.confirmed_count,"value-style":"color: #f56c6c"},null,8,["title","value"])]),_:1})]),_:1})]),_:1})]),_:1}),n(o,{class:"filter-card"},{default:c(()=>[n(q,{inline:!0,model:K},{default:c(()=>[n(U,{label:e.$t("common.startDate")},{default:c(()=>[n(S,{modelValue:K.startDate,"onUpdate:modelValue":a[1]||(a[1]=e=>K.startDate=e),type:"date",placeholder:e.$t("placeholders.selectStartDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,{label:e.$t("common.endDate")},{default:c(()=>[n(S,{modelValue:K.endDate,"onUpdate:modelValue":a[2]||(a[2]=e=>K.endDate=e),type:"date",placeholder:e.$t("placeholders.selectEndDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,{label:e.$t("common.status")},{default:c(()=>[n(P,{modelValue:K.status,"onUpdate:modelValue":a[3]||(a[3]=e=>K.status=e),placeholder:e.$t("placeholders.selectStatus"),clearable:""},{default:c(()=>[n(M,{label:e.$t("common.all"),value:""},null,8,["label"]),n(M,{label:e.$t("reconciliation.status.matched"),value:"matched"},null,8,["label"]),n(M,{label:e.$t("reconciliation.status.variance"),value:"variance"},null,8,["label"]),n(M,{label:e.$t("reconciliation.status.unmatched"),value:"unmatched"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,null,{default:c(()=>[n(l,{type:"primary",onClick:ee},{default:c(()=>[m(u(e.$t("common.search")),1)]),_:1}),n(l,{onClick:ae},{default:c(()=>[m(u(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(o,null,{default:c(()=>[p((h(),v(se,{data:W.value,style:{width:"100%"},onRowClick:le},{default:c(()=>[n(ce,{label:e.$t("reconciliation.table.warehouseOrderNo"),prop:"warehouseOrderNo",width:"160"},null,8,["label"]),n(ce,{label:e.$t("reconciliation.table.supplier"),prop:"supplierName",width:"200"},null,8,["label"]),n(ce,{label:e.$t("reconciliation.table.receivedDate"),prop:"received_date",width:"120"},null,8,["label"]),n(ce,{label:e.$t("reconciliation.table.reconAmount"),width:"120"},{default:c(({row:e})=>[m(" ¥"+u(e.totalAmount.toFixed(2)),1)]),_:1},8,["label"]),n(ce,{label:e.$t("reconciliation.table.invoiceAmount"),width:"120"},{default:c(({row:a})=>[a.invoiceAmount?(h(),i("span",B,"¥"+u(a.invoiceAmount.toFixed(2)),1)):(h(),i("span",G,u(e.$t("reconciliation.table.notUploaded")),1))]),_:1},8,["label"]),n(ce,{label:e.$t("reconciliation.table.variance"),width:"120"},{default:c(({row:e})=>[s("span",{class:f({"variance-positive":e.variance_amount>0,"variance-negative":e.variance_amount<0})},u(e.variance_amount>=0?"+":"")+"¥"+u(e.variance_amount.toFixed(2)),3)]),_:1},8,["label"]),n(ce,{label:e.$t("common.status"),prop:"status",width:"100"},{default:c(({row:e})=>[n(re,{type:ie(e.status)},{default:c(()=>[m(u(ne(e.status)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),n(ce,{label:e.$t("reconciliation.table.confirmStatus"),width:"100"},{default:c(({row:a})=>[a.accountant_confirmed?(h(),v(re,{key:0,type:"success"},{default:c(()=>[m(u(e.$t("reconciliation.confirmStatus.confirmed")),1)]),_:1})):(h(),v(re,{key:1,type:"warning"},{default:c(()=>[m(u(e.$t("reconciliation.confirmStatus.pending")),1)]),_:1}))]),_:1},8,["label"]),n(ce,{label:e.$t("common.actions"),fixed:"right",width:"250"},{default:c(({row:a})=>[a.accountant_confirmed?b("",!0):(h(),v(l,{key:0,type:"success",size:"small",onClick:_(e=>te(a,!0),["stop"])},{default:c(()=>[m(u(e.$t("common.confirm")),1)]),_:1},8,["onClick"])),a.accountant_confirmed?b("",!0):(h(),v(l,{key:1,type:"danger",size:"small",onClick:_(e=>te(a,!1),["stop"])},{default:c(()=>[m(u(e.$t("reconciliation.buttons.reject")),1)]),_:1},8,["onClick"])),n(l,{size:"small",onClick:_(e=>le(a),["stop"])},{default:c(()=>[m(u(e.$t("common.view")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[pe,I.value]])]),_:1}),n(me,{modelValue:Q.value,"onUpdate:modelValue":a[5]||(a[5]=e=>Q.value=e),title:e.$t("reconciliation.detailsDialog.title"),width:"1000px"},{footer:c(()=>[n(l,{onClick:a[4]||(a[4]=e=>Q.value=!1)},{default:c(()=>[m(u(e.$t("common.close")),1)]),_:1})]),default:c(()=>[Z.value?(h(),v(de,{key:0,column:2,border:""},{default:c(()=>[n(ue,{label:e.$t("reconciliation.table.warehouseOrderNo")},{default:c(()=>[m(u(Z.value.warehouseOrderNo),1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.table.supplier")},{default:c(()=>[m(u(Z.value.supplierName),1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.table.receivedDate")},{default:c(()=>[m(u(Z.value.received_date),1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.table.reconAmount")},{default:c(()=>[m(" ¥"+u(Z.value.totalAmount.toFixed(2)),1)]),_:1},8,["label"]),Z.value.invoiceNumber?(h(),v(ue,{key:0,label:e.$t("invoice.number")},{default:c(()=>[m(u(Z.value.invoiceNumber),1)]),_:1},8,["label"])):b("",!0),Z.value.invoiceAmount?(h(),v(ue,{key:1,label:e.$t("reconciliation.table.invoiceAmount")},{default:c(()=>[m(" ¥"+u(Z.value.invoiceAmount.toFixed(2)),1)]),_:1},8,["label"])):b("",!0),n(ue,{label:e.$t("common.status")},{default:c(()=>[n(re,{type:ie(Z.value.status)},{default:c(()=>[m(u(ne(Z.value.status)),1)]),_:1},8,["type"])]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.detailsDialog.varianceAmount")},{default:c(()=>[s("span",{class:f({"variance-positive":Z.value.variance_amount>0,"variance-negative":Z.value.variance_amount<0})},u(Z.value.variance_amount>=0?"+":"")+"¥"+u(Z.value.variance_amount.toFixed(2)),3)]),_:1},8,["label"])]),_:1})):b("",!0),Z.value?.varianceAnalysis?(h(),v(o,{key:1,style:{"margin-top":"20px"}},{header:c(()=>[m(u(e.$t("reconciliation.detailsDialog.varianceAnalysis")),1)]),default:c(()=>[n(de,{column:2,border:""},{default:c(()=>[n(ue,{label:e.$t("reconciliation.detailsDialog.varianceAmount")},{default:c(()=>[m(" ¥"+u(Z.value.varianceAnalysis.variance_amount.toFixed(2)),1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.detailsDialog.variancePercentage")},{default:c(()=>[m(u(Z.value.varianceAnalysis.variance_percentage.toFixed(2))+"% ",1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.detailsDialog.varianceReason"),span:2},{default:c(()=>[m(u(Z.value.varianceAnalysis.variance_reason||e.$t("common.none")),1)]),_:1},8,["label"])]),_:1})]),_:1})):b("",!0)]),_:1},8,["modelValue","title"]),n(me,{modelValue:X.value,"onUpdate:modelValue":a[10]||(a[10]=e=>X.value=e),title:e.$t("reconciliation.reportDialog.title"),width:"600px"},{footer:c(()=>[n(l,{onClick:a[9]||(a[9]=e=>X.value=!1)},{default:c(()=>[m(u(e.$t("common.cancel")),1)]),_:1}),n(l,{type:"primary",onClick:oe,loading:H.value},{default:c(()=>[m(u(e.$t("reconciliation.buttons.generate")),1)]),_:1},8,["loading"])]),default:c(()=>[n(q,{model:L,"label-width":"120px"},{default:c(()=>[n(U,{label:e.$t("reconciliation.reportDialog.reportType")},{default:c(()=>[n(P,{modelValue:L.reportType,"onUpdate:modelValue":a[6]||(a[6]=e=>L.reportType=e),placeholder:e.$t("placeholders.selectReportType")},{default:c(()=>[n(M,{label:e.$t("reconciliation.reportDialog.types.summary"),value:"summary"},null,8,["label"]),n(M,{label:e.$t("reconciliation.reportDialog.types.variance"),value:"variance"},null,8,["label"]),n(M,{label:e.$t("reconciliation.reportDialog.types.supplierPerformance"),value:"supplier"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,{label:e.$t("common.startDate")},{default:c(()=>[n(S,{modelValue:L.startDate,"onUpdate:modelValue":a[7]||(a[7]=e=>L.startDate=e),type:"date",placeholder:e.$t("placeholders.selectStartDate"),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,{label:e.$t("common.endDate")},{default:c(()=>[n(S,{modelValue:L.endDate,"onUpdate:modelValue":a[8]||(a[8]=e=>L.endDate=e),type:"date",placeholder:e.$t("placeholders.selectEndDate"),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-b68418d8"]]);export{q as default};
