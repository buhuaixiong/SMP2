import{W as e,d as t,u as r,h as l,c as i,i as a,B as n,C as o,I as u,b as s,j as d,k as c,f as m,x as f,t as p,e as q,z as y,y as I,S as g,bA as h,O as v,et as b,F as P,U as C,E as w,A as L,r as _,aA as x,q as O,o as T,_ as U}from"./index-BBTXprD7.js";import{E as k,a as Q}from"./el-form-item--lL5pXgu.js";import{E as V}from"./el-upload-CFO4WlmH.js";import{E as R}from"./el-progress-g4hFwVd_.js";import{E as N}from"./el-divider-M9M4Oc_1.js";import{E as S}from"./el-tag-Cyh8bl2p.js";import{E as j,a as E}from"./el-select-CSgbKm39.js";import"./el-scrollbar-DavFVGsf.js";import{a as D,E as $}from"./el-table-column-Ctv3S--Z.js";/* empty css                 */import{E as F}from"./el-input-number-Doy4cSkM.js";import{E as z}from"./el-alert-BRCdnB3Q.js";import{E as A}from"./el-card-BK78pvjh.js";import{E as W,a as G}from"./el-descriptions-item-Bk5jw2lv.js";import{u as Y}from"./useNotification-CtllBzdG.js";import{f as H,p as B}from"./dataParsing-ZXXCcBwJ.js";import"./castArray-CE_UyA2K.js";import"./_baseClone-BSl38qjo.js";import"./cloneDeep-B8Bhv4eT.js";import"./debounce-DUfakjfK.js";import"./index-BIdsItxk.js";const Z={class:"supplier-quote-form"},J={class:"card-header"},M={class:"card-header"},X={class:"header-title-row"},K={class:"item-name"},ee={key:0,class:"item-spec"},te={class:"header-with-help"},re={class:"total-price"},le={class:"tariff-cell"},ie={class:"tariff-cell__value"},ae={class:"tariff-cell__meta"},ne={key:0},oe={class:"tariff-cell__total"},ue={key:1,class:"tariff-cell__empty"},se={class:"notes-header"},de={class:"notes-field-wrapper"},ce={class:"quote-summary"},me={class:"summary-item"},fe={class:"label"},pe={class:"value"},qe={class:"summary-item total"},ye={class:"label"},Ie={class:"value"},ge={key:0,class:"summary-item"},he={class:"label"},ve={class:"value"},be={class:"label"},Pe={class:"value"},Ce={style:{display:"flex",gap:"16px","align-items":"flex-start"}},we={style:{flex:"0 0 220px"}},Le={key:0,style:{flex:"0 0 180px"}},_e={class:"form-item-hint"},xe={style:{margin:"24px 0 16px 0"}},Oe={class:"el-upload__tip"},Te={class:"form-actions"},Ue=U(t({__name:"SupplierQuoteForm",props:{rfq:{},existingQuote:{}},emits:["submitted","cancel"],setup(t,{emit:U}){const Ue=Y(),ke=t,Qe=U,{t:Ve}=r();O();const Re=l(),Ne=l(),Se=l(!1),je=l(null),Ee=i(()=>ke.existingQuote),De=l([]),$e=l([]),Fe=a({}),ze=a({}),Ae=new Map,We=i(()=>[{value:"CNY",label:Ve("rfq.quote.currencyOptions.CNY")},{value:"USD",label:Ve("rfq.quote.currencyOptions.USD")},{value:"EUR",label:Ve("rfq.quote.currencyOptions.EUR")},{value:"JPY",label:Ve("rfq.quote.currencyOptions.JPY")},{value:"THB",label:Ve("rfq.quote.currencyOptions.THB")}]),Ge=i(()=>[{value:"EXW",label:Ve("supplierRegistration.incoterms.EXW")},{value:"FOB",label:Ve("supplierRegistration.incoterms.FOB")},{value:"CIF",label:Ve("supplierRegistration.incoterms.CIF")},{value:"CFR",label:Ve("supplierRegistration.incoterms.CFR")},{value:"DDP",label:Ve("supplierRegistration.incoterms.DDP")},{value:"DDU",label:Ve("supplierRegistration.incoterms.DDU")},{value:"DAP",label:Ve("supplierRegistration.incoterms.DAP")},{value:"DAT",label:Ve("supplierRegistration.incoterms.DAT")},{value:"FCA",label:Ve("supplierRegistration.incoterms.FCA")},{value:"CPT",label:Ve("supplierRegistration.incoterms.CPT")},{value:"CIP",label:Ve("supplierRegistration.incoterms.CIP")}]),Ye=l([]),He=a({notes:"",currency:"CNY",taxStatus:"inclusive",deliveryTerms:"",shippingCountry:"",lineItems:{}});function Be(e){if(!e)return"";const t=[];e.name&&t.push(e.name),e.nameZh&&e.nameZh!==e.name&&t.push(e.nameZh);const r=t.length>0?t.join(" / "):e.code;return e.code?`${r} (${e.code})`:r}async function Ze(){try{const{countries:t}=await async function(){return(await e("/tariffs/options")).data}();Array.isArray(t)&&t.length&&(Ye.value=t)}catch(t){console.error("[Tariff] Failed to load tariff options:",t)}}function Je(e){return De.value.find(t=>t.rfqLineItemId===e)}function Me(e){const t=Je(e);if(!t)return 0;const r=Number(t.quantity??0);return Number.isFinite(r)?r:0}function Xe(e=!1){De.value.forEach(t=>{!e&&Fe[t.rfqLineItemId]||Ke(t.rfqLineItemId)})}async function Ke(t){const r=He.lineItems[t],l=He.shippingCountry;if(!r||!l||!r.productGroup||!r.productOrigin||!r.unitPrice||r.unitPrice<=0)return void function(e){Fe[e]=null,ze[e]=!1;const t=Je(e);t&&(t.standardUnitCostLocal=null,t.standardUnitCostUsd=null,t.tariffCalculation=null)}(t);const i={originalPrice:r.unitPrice,shippingCountry:l,productGroup:r.productGroup,productOrigin:r.productOrigin,projectLocation:ke.rfq?.projectLocation||"HZ",deliveryTerms:He.deliveryTerms||"",currency:He.currency},a=Date.now();Ae.set(t,a),ze[t]=!0;try{const r=await async function(t){return(await e("/tariffs/calculate",{method:"POST",body:t})).data}(i);if(Ae.get(t)!==a)return;Fe[t]=r;const l=Je(t);l&&(l.standardUnitCostLocal=r.standardCostLocal??null,l.standardUnitCostUsd=r.standardCostUsd??null,l.tariffCalculation=r)}catch(n){console.error(`[Tariff] Failed to calculate standard cost for line ${t}:`,n)}finally{Ae.get(t)===a&&(ze[t]=!1)}}function et(e){return Fe[e]||null}function tt(e){const t=et(e);if(!t)return null;const r=Me(e);if(!r)return null;const l=Number(t.standardCost??0);return Number.isFinite(l)?Number((l*r).toFixed(2)):null}n(()=>He.shippingCountry,()=>{Xe(!0)}),n(()=>He.currency,()=>{Xe(!0)}),o(()=>{!function(){if(ke.rfq?.items&&ke.rfq.items.length>0){const e=ke.existingQuote?.quoteItems||[];De.value=ke.rfq.items.map(t=>{const r={...t,materialCategory:H(t.materialCategory,t.materialType,t.distributionCategory,t.distribution_category,""),itemName:H(t.itemName,t.item_name,t.description,t.remarks,""),specifications:H(t.specifications,t.parameters,t.remarks,""),currency:t.currency??ke.rfq?.currency??"CNY"},l=e.find(e=>e.rfqLineItemId===r.id),i=H(l?.unitPrice,l?.unit_price,void 0),a=Number(r.quantity??0),n=Number.isFinite(a)&&i?i*a:B(l?.totalPrice,l?.total_price,0);return He.lineItems[r.id]={unitPrice:i,minimumOrderQuantity:H(l?.minimumOrderQuantity,l?.moq,r.quantity,1),standardPackageQuantity:H(l?.standardPackageQuantity,void 0),deliveryPeriod:H(l?.deliveryPeriod,void 0),productOrigin:H(l?.productOrigin,l?.product_origin,""),productGroup:"OTHERS"},Fe[r.id]=H(l?.tariffCalculation,l?.tariff_calculation,null),ze[r.id]=!1,{...r,rfqLineItemId:r.id,unitPrice:i,minimumOrderQuantity:He.lineItems[r.id].minimumOrderQuantity,standardPackageQuantity:He.lineItems[r.id].standardPackageQuantity,totalPrice:n,deliveryPeriod:He.lineItems[r.id].deliveryPeriod,notes:H(l?.notes,""),brand:H(l?.brand,r.brand,""),productOrigin:He.lineItems[r.id].productOrigin,productGroup:"OTHERS",standardUnitCostLocal:H(l?.standardLineCostLocal,l?.standardUnitCostLocal,null),standardUnitCostUsd:H(l?.standardLineCostUsd,l?.standardUnitCostUsd,null),tariffCalculation:Fe[r.id]}}),ke.existingQuote&&(He.notes=H(ke.existingQuote.notes,""),He.deliveryTerms=H(ke.existingQuote.deliveryTerms,""),He.shippingCountry=H(ke.existingQuote.shippingCountry,ke.existingQuote.shipping_country,""),He.taxStatus=H(ke.existingQuote.taxStatus,"inclusive")),He.currency=H(ke.existingQuote?.currency,ke.rfq?.currency,He.currency),De.value.forEach(e=>{void 0===Fe[e.rfqLineItemId]&&(Fe[e.rfqLineItemId]=null)}),u(()=>{Xe(!1)})}}(),Ze()});const rt=i(()=>De.value.reduce((e,t)=>e+(t.totalPrice||0),0)),lt=i(()=>{const e={};let t=0,r=0,l=!1,i=!1;return De.value.forEach(a=>{const n=et(a.rfqLineItemId);if(!n)return;const o=Me(a.rfqLineItemId);if(!o)return;const u=Number(n.standardCost??0);if(!Number.isFinite(u))return;const s=u*o,d=n.standardCostCurrency||He.currency||"CNY";l=!0,"USD"===d?(t+=s,r+=1):e[d]=(e[d]||0)+s,n.hasSpecialTariff&&(i=!0)}),{hasData:l,usdTotal:r>0?Number(t.toFixed(2)):null,localTotals:Object.fromEntries(Object.entries(e).map(([e,t])=>[e,Number(t.toFixed(2))])),hasSpecialTariff:i}});function it(e,t="USD"){return null==e||Number.isNaN(e)?"-":`${e.toFixed(2)} ${t}`}function at(e){return null==e||Number.isNaN(e)?"-":`${(100*e).toFixed(2)}%`}function nt(e){if(!e)return"-";try{return new Date(e).toLocaleString()}catch{return e}}function ot(e,t="CNY"){return null==e?"-":`${e.toFixed(2)} ${t}`}function ut(e,t){$e.value=t}function st(e,t){$e.value=t}async function dt(){if(!Re.value)return;try{await Re.value.validate()}catch{return}const e=De.value.filter(e=>{const t=He.lineItems[e.rfqLineItemId];if(!t)return!0;const r=void 0!==t.unitPrice&&null!==t.unitPrice,l=String(H(e.notes,"")??"").trim().length>0;return!r&&!l});if(e.length>0){const t=e.map(e=>`#${e.rfqLineItemId}: ${e.itemName}`).join(", ");return void Ue.warning(Ve("rfq.quote.priceOrNotesRequired",{count:e.length,items:t}))}const t=De.value.filter(e=>{const t=He.lineItems[e.rfqLineItemId];return t&&void 0!==t.unitPrice&&null!==t.unitPrice});if(t.filter(e=>{const t=He.lineItems[e.rfqLineItemId];return!t?.minimumOrderQuantity||t.minimumOrderQuantity<=0}).length>0)return void Ue.warning(Ve("rfq.quote.moqRequiredWhenPriced"));if(t.filter(e=>{const t=He.lineItems[e.rfqLineItemId];return!t?.standardPackageQuantity||t.standardPackageQuantity<=0}).length>0)return void Ue.warning(Ve("rfq.quote.spqRequiredWhenPriced"));if(t.filter(e=>{const t=He.lineItems[e.rfqLineItemId];return!t?.productOrigin||""===t.productOrigin.trim()}).length>0)return void Ue.warning(Ve("rfq.quote.productOriginRequiredWhenPriced"));if(!He.shippingCountry)return void Ue.warning(Ve("rfq.quote.shippingCountryRequired"));if(t.filter(e=>{const t=He.lineItems[e.rfqLineItemId];return!t?.productGroup||""===t.productGroup.trim()}).length>0)Ue.warning(Ve("rfq.quote.productGroupRequiredWhenPriced"));else{je.value=null,Se.value=!0;try{const e=new FormData,t={currency:He.currency,taxStatus:He.taxStatus,lineItems:De.value.map(e=>({rfqLineItemId:e.rfqLineItemId,unitPrice:He.lineItems[e.rfqLineItemId]?.unitPrice,minimumOrderQuantity:He.lineItems[e.rfqLineItemId]?.minimumOrderQuantity,standardPackageQuantity:He.lineItems[e.rfqLineItemId]?.standardPackageQuantity,brand:e.brand,deliveryPeriod:He.lineItems[e.rfqLineItemId]?.deliveryPeriod,notes:e.notes,productOrigin:He.lineItems[e.rfqLineItemId]?.productOrigin,productGroup:He.lineItems[e.rfqLineItemId]?.productGroup,taxStatus:He.taxStatus})),deliveryTerms:He.deliveryTerms,shippingCountry:He.shippingCountry,notes:He.notes};e.append("quoteData",JSON.stringify(t)),$e.value.forEach(t=>{t.raw&&e.append("attachments",t.raw)});const r=!!ke.existingQuote,l=r?`/api/rfq-workflow/${ke.rfq.id}/quotes/${ke.existingQuote.id}`:`/api/rfq-workflow/${ke.rfq.id}/quotes`,i=await fetch(l,{method:r?"PUT":"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:e});if(!i.ok){const e=await i.json();throw new Error(e.message||"Failed to submit quote")}const a=r?"rfq.quote.updateSuccess":"rfq.quote.submitSuccess";je.value={type:"success",message:String(Ve(a))},Qe("submitted")}catch(r){je.value={type:"error",message:r?.message||String(Ve("rfq.quote.submitError"))}}finally{Se.value=!1}}}function ct(){Qe("cancel")}function mt(e){const t=He.lineItems[e.rfqLineItemId];return t&&void 0!==t.unitPrice&&null!==t.unitPrice}function ft(e){return e.notes&&"string"==typeof e.notes&&e.notes.trim().length>0}function pt(e){return!mt(e)&&!ft(e)}function qt(e){return mt(e)?Ve("rfq.lineItems.notesPlaceholder"):Ve("rfq.lineItems.notesRequiredPlaceholder")}function yt(){return De.value.filter(e=>{const t=He.lineItems[e.rfqLineItemId];if(!t)return!1;const r=void 0!==t.unitPrice&&null!==t.unitPrice,l=e.notes&&"string"==typeof e.notes&&e.notes.trim().length>0;return r||l}).length}function It(){const e=De.value.length;if(0===e)return 0;const t=yt();return Math.round(t/e*100)}function gt(){const e=It();return 100===e?"success":e>=50?"warning":"info"}function ht(){const e=It();return 100===e?"#67c23a":e>=50?"#e6a23c":"#909399"}return(e,r)=>{const l=G,i=S,a=W,n=A,o=z,u=R,O=$,U=F,Y=Q,H=v,B=h,ke=w,Qe=L,Ae=D,Ze=E,Je=j,Me=N,Xe=V,et=k;return T(),s("div",Z,[d(n,{class:"rfq-info-card",shadow:"never"},{header:c(()=>[q("div",J,[q("h3",null,p(m(Ve)("rfq.quote.rfqInfo")),1)])]),default:c(()=>[d(a,{column:2,border:""},{default:c(()=>[d(l,{label:m(Ve)("rfq.form.title")},{default:c(()=>[f(p(t.rfq?.title),1)]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.rfqType")},{default:c(()=>[d(i,{type:"short_term"===t.rfq?.rfqType?"success":"warning"},{default:c(()=>[f(p(m(Ve)(`rfq.rfqType.${t.rfq?.rfqType}`)),1)]),_:1},8,["type"])]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.deliveryPeriod")},{default:c(()=>[f(p(t.rfq?.deliveryPeriod)+" "+p(m(Ve)("common.days")),1)]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.validUntil")},{default:c(()=>[f(p(nt(t.rfq?.validUntil)),1)]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.description"),span:2},{default:c(()=>[f(p(t.rfq?.description||"-"),1)]),_:1},8,["label"])]),_:1})]),_:1}),d(n,{class:"quote-form-card"},{header:c(()=>[q("div",M,[q("div",X,[q("h3",null,p(m(Ve)("rfq.quote.lineItemQuotes")),1),d(i,{type:gt(),size:"large"},{default:c(()=>[f(p(`${yt()}/${De.value.length} ${Ve("rfq.quote.itemsResponded")||"items responded"}`),1)]),_:1},8,["type"])]),d(o,{title:m(Ve)("rfq.quote.quoteInstruction"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),d(u,{percentage:It(),color:ht(),"stroke-width":8,style:{"margin-top":"12px"}},null,8,["percentage","color"])])]),default:c(()=>[d(et,{ref_key:"formRef",ref:Re,model:He,"label-position":"top"},{default:c(()=>[d(Ae,{data:De.value,border:"",stripe:"","max-height":"600px"},{default:c(()=>[d(O,{type:"index",label:m(Ve)("rfq.items.lineNumber"),width:"70",align:"center"},null,8,["label"]),d(O,{label:m(Ve)("rfq.lineItems.materialCategory"),width:"120"},{default:c(({row:e})=>{return[f(p((t=e.materialCategory,t?"equipment"===t?Ve("rfq.distributionCategory.equipment"):"consumables"===t?Ve("rfq.lineItems.consumables"):"hardware"===t?Ve("rfq.distributionCategory.hardware"):"other"===t?Ve("common.other"):t:"-")),1)];var t}),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.items.itemName"),"min-width":"150"},{default:c(({row:e})=>[q("div",null,[q("div",K,p(e.itemName),1),e.specifications?(T(),s("div",ee,p(e.specifications),1)):I("",!0)])]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.items.quantity"),width:"120"},{default:c(({row:e})=>[f(p(e.quantity)+" "+p(e.unit),1)]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.quote.moq"),width:"150"},{header:c(()=>[q("div",null,p(m(Ve)("rfq.quote.moq")),1)]),default:c(({row:e,$index:t})=>[d(Y,{prop:`lineItems.${e.rfqLineItemId}.minimumOrderQuantity`,rules:[{validator:(t,r,l)=>{void 0!==He.lineItems[e.rfqLineItemId]?.unitPrice&&null!==He.lineItems[e.rfqLineItemId]?.unitPrice&&(!r||r<=0)?l(new Error(m(Ve)("rfq.quote.moqRequiredWhenPriced"))):l()},trigger:"change"}]},{default:c(()=>[d(U,{modelValue:He.lineItems[e.rfqLineItemId].minimumOrderQuantity,"onUpdate:modelValue":t=>He.lineItems[e.rfqLineItemId].minimumOrderQuantity=t,min:1,step:1,precision:0,size:"small","controls-position":"right",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.moqPlaceholder"),onChange:r=>function(e,t){const r=He.lineItems[e]?.minimumOrderQuantity,l=De.value[t];l&&(l.minimumOrderQuantity=r)}(e.rfqLineItemId,t)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.quote.spq"),width:"150"},{header:c(()=>[q("div",null,p(m(Ve)("rfq.quote.spq")),1)]),default:c(({row:e,$index:t})=>[d(Y,{prop:`lineItems.${e.rfqLineItemId}.standardPackageQuantity`,rules:[{validator:(t,r,l)=>{void 0!==He.lineItems[e.rfqLineItemId]?.unitPrice&&null!==He.lineItems[e.rfqLineItemId]?.unitPrice&&(!r||r<=0)?l(new Error(m(Ve)("rfq.quote.spqRequiredWhenPriced"))):l()},trigger:"change"}]},{default:c(()=>[d(U,{modelValue:He.lineItems[e.rfqLineItemId].standardPackageQuantity,"onUpdate:modelValue":t=>He.lineItems[e.rfqLineItemId].standardPackageQuantity=t,min:1,step:1,precision:0,size:"small","controls-position":"right",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.spqPlaceholder"),onChange:r=>function(e,t){const r=He.lineItems[e]?.standardPackageQuantity,l=De.value[t];l&&(l.standardPackageQuantity=r)}(e.rfqLineItemId,t)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.quote.unitPrice"),width:"150"},{header:c(()=>[q("div",te,[f(p(m(Ve)("rfq.quote.unitPrice"))+" ",1),d(B,{content:m(Ve)("rfq.quote.unitPriceHelpTip"),placement:"top"},{default:c(()=>[d(H,{class:"help-icon"},{default:c(()=>[d(m(b))]),_:1})]),_:1},8,["content"])])]),default:c(({row:e,$index:t})=>[d(Y,{prop:`lineItems.${e.rfqLineItemId}.unitPrice`,rules:[{type:"number",min:0,message:m(Ve)("rfq.quote.unitPriceMinZero"),trigger:"blur"}]},{default:c(()=>[d(U,{modelValue:He.lineItems[e.rfqLineItemId].unitPrice,"onUpdate:modelValue":t=>He.lineItems[e.rfqLineItemId].unitPrice=t,min:0,step:.01,"step-strictly":!1,precision:2,size:"small","controls-position":"right",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.unitPricePlaceholder"),class:g({"has-value":void 0!==He.lineItems[e.rfqLineItemId]?.unitPrice&&null!==He.lineItems[e.rfqLineItemId]?.unitPrice}),onChange:r=>function(e,t){const r=He.lineItems[e]?.unitPrice,l=De.value[t];l&&(l.unitPrice=r,r&&l.quantity?l.totalPrice=r*l.quantity:l.totalPrice=0),Ke(e)}(e.rfqLineItemId,t)},null,8,["modelValue","onUpdate:modelValue","placeholder","class","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.quote.totalPrice"),width:"140"},{default:c(({row:e})=>[q("span",re,p(ot(e.totalPrice,e.currency)),1)]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.quote.standardUnitCost"),"min-width":"220"},{default:c(({row:e})=>[q("div",le,[Fe[e.rfqLineItemId]?(T(),s(P,{key:0},[q("div",ie,[f(p(it(Fe[e.rfqLineItemId]?.standardCost??null,Fe[e.rfqLineItemId]?.standardCostCurrency||"USD"))+" ",1),Fe[e.rfqLineItemId]?.hasSpecialTariff?(T(),y(i,{key:0,type:"warning",size:"small",effect:"dark"},{default:c(()=>[f(p(m(Ve)("rfq.quote.specialTariffTag")),1)]),_:1})):I("",!0)]),q("div",ae,[q("span",null,p(m(Ve)("rfq.quote.tariffRateLabel",{rate:at(Fe[e.rfqLineItemId]?.freightRate??null)})),1),Fe[e.rfqLineItemId]?.specialTariffRate?(T(),s("span",ne,p(m(Ve)("rfq.quote.specialTariffRateLabel",{rate:at(Fe[e.rfqLineItemId]?.specialTariffRate??null)})),1)):I("",!0)]),q("div",oe,p(m(Ve)("rfq.quote.standardLineTotal",{value:it(tt(e.rfqLineItemId),Fe[e.rfqLineItemId]?.standardCostCurrency||"USD")})),1)],64)):(T(),s("div",ue,[ze[e.rfqLineItemId]?(T(),y(H,{key:0,class:"tariff-spinner"},{default:c(()=>[d(m(C))]),_:1})):I("",!0),q("span",null,p(m(Ve)("rfq.quote.tariffPending")),1)]))])]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.lineItems.brand"),width:"140"},{default:c(({row:e})=>[d(ke,{modelValue:e.brand,"onUpdate:modelValue":t=>e.brand=t,size:"small",placeholder:m(Ve)("rfq.lineItems.brandPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.quote.productOriginLabel"),width:"160"},{header:c(()=>[q("div",null,p(m(Ve)("rfq.quote.productOriginLabel")),1)]),default:c(({row:e,$index:t})=>[d(Y,{prop:`lineItems.${e.rfqLineItemId}.productOrigin`,rules:[{validator:(t,r,l)=>{!(void 0!==He.lineItems[e.rfqLineItemId]?.unitPrice&&null!==He.lineItems[e.rfqLineItemId]?.unitPrice)||r&&""!==r.trim()?l():l(new Error(m(Ve)("rfq.quote.productOriginRequiredWhenPriced")))},trigger:"blur"}]},{default:c(()=>[d(ke,{modelValue:He.lineItems[e.rfqLineItemId].productOrigin,"onUpdate:modelValue":t=>He.lineItems[e.rfqLineItemId].productOrigin=t,size:"small",placeholder:m(Ve)("rfq.quote.productOriginPlaceholder"),maxlength:"100",onChange:r=>function(e,t){const r=He.lineItems[e]?.productOrigin,l=De.value[t];l&&(l.productOrigin=r),Ke(e)}(e.rfqLineItemId,t)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.quote.deliveryPeriod"),width:"140"},{default:c(({row:e,$index:t})=>[d(U,{modelValue:He.lineItems[e.rfqLineItemId].deliveryPeriod,"onUpdate:modelValue":t=>He.lineItems[e.rfqLineItemId].deliveryPeriod=t,min:1,step:1,precision:0,size:"small","controls-position":"right",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.deliveryPeriodPlaceholder"),onChange:r=>function(e,t){const r=He.lineItems[e]?.deliveryPeriod,l=De.value[t];l&&(l.deliveryPeriod=r)}(e.rfqLineItemId,t)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:1},8,["label"]),d(O,{label:m(Ve)("rfq.lineItems.notes"),"min-width":"220"},{header:c(()=>[q("div",se,[q("span",null,p(m(Ve)("rfq.lineItems.notes")),1),d(B,{content:m(Ve)("rfq.quote.notesHelpText"),placement:"top"},{default:c(()=>[d(H,{class:"help-icon"},{default:c(()=>[d(m(b))]),_:1})]),_:1},8,["content"])])]),default:c(({row:e})=>[q("div",de,[d(ke,{modelValue:e.notes,"onUpdate:modelValue":t=>e.notes=t,type:"textarea",rows:2,size:"small",placeholder:qt(e),class:g({"notes-required":pt(e),"notes-filled":ft(e)})},null,8,["modelValue","onUpdate:modelValue","placeholder","class"]),mt(e)||ft(e)?I("",!0):(T(),y(Qe,{key:0,size:"small",type:"warning",plain:"",class:"no-quote-btn",onClick:t=>function(e){e.notes=Ve("rfq.quote.noQuoteTemplate"),Ue.success(Ve("rfq.quote.templateFilled"))}(e)},{default:c(()=>[f(p(m(Ve)("rfq.quote.cannotQuote")),1)]),_:1},8,["onClick"]))])]),_:1},8,["label"])]),_:1},8,["data"]),q("div",ce,[q("div",me,[q("span",fe,p(m(Ve)("rfq.quote.totalItems"))+":",1),q("span",pe,p(De.value.length),1)]),q("div",qe,[q("span",ye,p(m(Ve)("rfq.quote.grandTotal"))+":",1),q("span",Ie,p(ot(rt.value,He.currency)),1)]),lt.value.hasData&&null!==lt.value.usdTotal?(T(),s("div",ge,[q("span",he,p(m(Ve)("rfq.quote.standardCostTotalUsd"))+":",1),q("span",ve,p(it(lt.value.usdTotal,"USD")),1)])):I("",!0),(T(!0),s(P,null,_(lt.value.localTotals,(e,t)=>(T(),s("div",{key:`standard-${t}`,class:"summary-item"},[q("span",be,p(m(Ve)("rfq.quote.standardCostTotalWithCurrency",{currency:t}))+": ",1),q("span",Pe,p(it(e,String(t))),1)]))),128))]),lt.value.hasData&&lt.value.hasSpecialTariff?(T(),y(o,{key:0,type:"warning",closable:!1,title:m(Ve)("rfq.quote.specialTariffNotice"),"show-icon":"",style:{"margin-top":"12px"}},null,8,["title"])):I("",!0),d(Y,{label:m(Ve)("rfq.quote.currency"),class:"currency-field",required:""},{default:c(()=>[q("div",Ce,[q("div",we,[d(Je,{modelValue:He.currency,"onUpdate:modelValue":r[0]||(r[0]=e=>He.currency=e),style:{width:"100%"},placeholder:m(Ve)("rfq.quote.selectCurrency")},{default:c(()=>[(T(!0),s(P,null,_(We.value,e=>(T(),y(Ze,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),"CNY"===He.currency?(T(),s("div",Le,[d(Je,{modelValue:He.taxStatus,"onUpdate:modelValue":r[1]||(r[1]=e=>He.taxStatus=e),style:{width:"100%"},size:"default"},{default:c(()=>[d(Ze,{value:"inclusive",label:m(Ve)("rfq.quote.taxInclusive")},null,8,["label"]),d(Ze,{value:"exclusive",label:m(Ve)("rfq.quote.taxExclusive")},null,8,["label"])]),_:1},8,["modelValue"])])):I("",!0)]),q("p",_e,p(m(Ve)("rfq.quote.currencyHint")),1)]),_:1},8,["label"]),d(Me),q("h4",xe,p(m(Ve)("rfq.quote.additionalInfo")),1),d(Y,{label:m(Ve)("rfq.quote.deliveryTerms")},{default:c(()=>[d(Je,{modelValue:He.deliveryTerms,"onUpdate:modelValue":r[2]||(r[2]=e=>He.deliveryTerms=e),style:{width:"100%"},placeholder:m(Ve)("rfq.quote.deliveryTermsPlaceholder"),clearable:""},{default:c(()=>[(T(!0),s(P,null,_(Ge.value,e=>(T(),y(Ze,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),d(Y,{label:m(Ve)("rfq.quote.shippingCountry"),prop:"shippingCountry",rules:[{required:!0,message:m(Ve)("rfq.quote.shippingCountryRequired"),trigger:"change"}]},{default:c(()=>[d(Je,{modelValue:He.shippingCountry,"onUpdate:modelValue":r[3]||(r[3]=e=>He.shippingCountry=e),filterable:"",clearable:"",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.shippingCountryPlaceholder")},{default:c(()=>[(T(!0),s(P,null,_(Ye.value,e=>(T(),y(Ze,{key:e.code,label:Be(e),value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),d(Y,{label:m(Ve)("rfq.quote.notes")},{default:c(()=>[d(ke,{modelValue:He.notes,"onUpdate:modelValue":r[4]||(r[4]=e=>He.notes=e),type:"textarea",rows:4,placeholder:m(Ve)("rfq.quote.notesPlaceholder"),maxlength:"1000","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(Y,{label:m(Ve)("rfq.quote.attachments")},{default:c(()=>[d(Xe,{ref_key:"uploadRef",ref:Ne,"file-list":$e.value,"on-change":ut,"on-remove":st,"auto-upload":!1,limit:10,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",multiple:""},{trigger:c(()=>[d(Qe,{type:"primary",plain:""},{default:c(()=>[f(p(m(Ve)("rfq.quote.selectFiles")),1)]),_:1})]),tip:c(()=>[q("div",Oe,p(m(Ve)("rfq.quote.attachmentHint")),1)]),_:1},8,["file-list"])]),_:1},8,["label"]),q("div",Te,[d(Qe,{onClick:ct},{default:c(()=>[f(p(m(Ve)("common.cancel")),1)]),_:1}),d(Qe,{type:"primary",loading:Se.value,onClick:dt},{default:c(()=>[f(p(Ee.value?m(Ve)("rfq.quote.updateQuote"):m(Ve)("rfq.quote.submitQuote")),1)]),_:1},8,["loading"])]),d(x,{name:"el-fade-in"},{default:c(()=>[je.value?(T(),y(o,{key:0,class:"submit-feedback",type:je.value.type,title:je.value.message,"show-icon":"",closable:"",onClose:r[5]||(r[5]=e=>je.value=null)},null,8,["type","title"])):I("",!0)]),_:1})]),_:1},8,["model"])]),_:1})])}}}),[["__scopeId","data-v-eb13b54e"]]);export{Ue as default};
