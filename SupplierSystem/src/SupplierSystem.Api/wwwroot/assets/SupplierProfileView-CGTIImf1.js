import{d as e,u as a,g as l,a6 as r,c as s,h as o,i as t,B as u,C as n,b as i,z as d,y as p,k as m,f as c,F as f,j as y,x as g,O as b,aY as v,t as _,A as P,e as V,r as C,E as k,q as h,o as q,_ as x}from"./index-BvBqerML.js";import{E,a as N}from"./el-form-item-Co_AiMYC.js";import{E as j}from"./el-tag-CQCG2cqX.js";import{E as w,a as U}from"./el-select-C1K6T0CN.js";import"./el-scrollbar-DxKOmehB.js";/* empty css                 */import{E as R,a as I}from"./el-col-CybsrRYR.js";import{E as A}from"./el-alert-4ZKBtufh.js";import{E as T}from"./el-card-w4rvP2gj.js";import{E as S,a as F}from"./el-descriptions-item-esCweti3.js";import{E as M}from"./el-empty-BKPwCIhQ.js";import{E as D}from"./el-skeleton-item-gdt9_TbV.js";import{P as z}from"./PageHeader-B9bazl_i.js";import{u as O}from"./useNotification-kSmgsM5O.js";import"./castArray-Ba2iVpgQ.js";import"./_baseClone-E152d4sm.js";const Y={class:"supplier-profile-view"},$={class:"card-header"},B={class:"completion"},H={class:"percent"},W={class:"hint"},G={key:1},J={key:1},K={class:"card-header"},L={class:"documents-summary"},Q={class:"card-header"},X={key:0},Z=x(e({__name:"SupplierProfileView",setup(e){const x=O(),Z=h(),{t:ee}=a(),ae=l(),le=r(),re=s(()=>{const e=ae.user?.supplierId;if(null==e)return null;const a="number"==typeof e?e:Number(e);return Number.isFinite(a)?Math.trunc(a):null}),se=o(!1),oe=o(!1),te=o(!0),ue=o(),ne=t({companyName:"",companyId:"",contactPerson:"",contactPhone:"",contactEmail:"",category:"",address:"",businessRegistrationNumber:"",region:"",bankAccount:"",paymentTerms:"",paymentCurrency:"",notes:""}),ie={companyName:[{required:!0,message:ee("common.required"),trigger:"blur"}],companyId:[{required:!0,message:ee("common.required"),trigger:"blur"}],contactPerson:[{required:!0,message:ee("common.required"),trigger:"blur"}],contactEmail:[{required:!0,message:ee("common.required"),trigger:"blur"}],contactPhone:[{required:!0,message:ee("common.required"),trigger:"blur"}],category:[{required:!0,message:ee("common.required"),trigger:"change"}],address:[{required:!0,message:ee("common.required"),trigger:"blur"}],businessRegistrationNumber:[{required:!0,message:ee("common.required"),trigger:"blur"}],region:[{required:!0,message:ee("common.required"),trigger:"blur"}],bankAccount:[{required:!0,message:ee("common.required"),trigger:"blur"}],paymentTerms:[{required:!0,message:ee("common.required"),trigger:"blur"}],paymentCurrency:[{required:!0,message:ee("common.required"),trigger:"blur"}]},de=s(()=>le.selectedSupplier??null),pe=s(()=>de.value?.profileCompletion??0),me=s(()=>de.value?.documents?.length??0),ce=s(()=>de.value?.complianceSummary?.missingProfileFields??[]),fe=s(()=>de.value?.complianceSummary?.missingDocumentTypes??[]),ye=s(()=>{const e=de.value?.status??"unknown",a=ee(`supplier.status.${e}`,e);return a===e?e:a}),ge=e=>{ne.companyName=e?.companyName??"",ne.companyId=e?.companyId??"",ne.contactPerson=e?.contactPerson??"",ne.contactPhone=e?.contactPhone??"",ne.contactEmail=e?.contactEmail??"",ne.category=e?.category??"",ne.address=e?.address??"",ne.businessRegistrationNumber=e?.businessRegistrationNumber??"",ne.region=e?.region??"",ne.bankAccount=e?.bankAccount??"",ne.paymentTerms=e?.paymentTerms??"",ne.paymentCurrency=e?.paymentCurrency??"",ne.notes=e?.notes??""};u(de,e=>{ge(e)});const be=async()=>{if(re.value){se.value=!0;try{await le.selectSupplier(re.value)}catch(e){console.error("Failed to load supplier profile",e),x.error(ee("supplier.profilePage.loadError"))}finally{se.value=!1}}},ve=async()=>{if(!te.value&&re.value&&ue.value){try{await ue.value.validate()}catch{return}oe.value=!0;try{const e={...ne},a=await le.updateSupplier(re.value,e);a&&"object"==typeof a&&("isChangeRequest"in a||"flow"in a)?x.success(ee("supplier.profilePage.formCard.changeRequestCreated")):x.success(ee("supplier.profilePage.formCard.updateSuccess")),await be()}catch(e){console.error("Failed to submit profile update",e),x.error(ee("supplier.profilePage.formCard.submitError"))}finally{oe.value=!1}}},_e=()=>{Z.push("/supplier/file-uploads")},Pe=()=>{Z.back()};return n(()=>{ge(de.value),be()}),(e,a)=>{const l=b,r=P,s=D,o=M,t=j,u=F,n=S,h=T,x=I,O=A,Z=R,ae=k,le=N,re=U,ge=w,be=E;return q(),i("div",Y,[se.value?p("",!0):(q(),d(z,{key:0,title:c(ee)("supplier.profilePage.title"),subtitle:te.value?void 0:c(ee)("supplier.profilePage.subtitle")},{actions:m(()=>[y(r,{link:"",class:"back-button",onClick:Pe},{default:m(()=>[y(l,null,{default:m(()=>[y(c(v))]),_:1}),g(" "+_(c(ee)("common.back")),1)]),_:1})]),_:1},8,["title","subtitle"])),se.value?(q(),d(s,{key:1,rows:6,animated:""})):de.value?(q(),i(f,{key:3},[y(Z,{gutter:20,class:"summary-row"},{default:m(()=>[y(x,{xs:24,md:12},{default:m(()=>[y(h,{class:"summary-card"},{header:m(()=>[V("div",$,[V("span",null,_(c(ee)("supplier.profilePage.statusCard.title")),1)])]),default:m(()=>[y(n,{column:1,border:"",size:"small"},{default:m(()=>[y(u,{label:c(ee)("supplier.profilePage.statusCard.status")},{default:m(()=>[y(t,{type:"info"},{default:m(()=>[g(_(ye.value),1)]),_:1})]),_:1},8,["label"]),y(u,{label:"Compliance"},{default:m(()=>[V("div",B,[V("span",H,_(pe.value)+"%",1),V("span",W,_(c(ee)("supplier.profile.completion")),1)])]),_:1}),y(u,{label:c(ee)("supplier.profilePage.statusCard.missingFields")},{default:m(()=>[ce.value.length?(q(!0),i(f,{key:0},C(ce.value,e=>(q(),d(t,{key:e.key,type:"danger",class:"chip"},{default:m(()=>[g(_(e.label),1)]),_:2},1024))),128)):(q(),i("span",G,_(c(ee)("supplier.profilePage.statusCard.noMissingFields")),1))]),_:1},8,["label"]),y(u,{label:c(ee)("supplier.profilePage.statusCard.missingDocuments")},{default:m(()=>[fe.value.length?(q(!0),i(f,{key:0},C(fe.value,e=>(q(),d(t,{key:e.type,type:"warning",class:"chip"},{default:m(()=>[g(_(e.label),1)]),_:2},1024))),128)):(q(),i("span",J,_(c(ee)("supplier.profilePage.statusCard.noMissingDocuments")),1))]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(h,{class:"summary-card"},{header:m(()=>[V("div",K,[V("span",null,_(c(ee)("supplier.profilePage.documentsCard.title")),1)])]),default:m(()=>[V("div",L,[V("p",null,_(c(ee)("supplier.documents.title"))+": "+_(me.value),1),!te.value&&fe.value.length?(q(),d(O,{key:0,type:"warning",closable:!1,"show-icon":"",class:"alert"},{default:m(()=>[V("span",null,_(c(ee)("supplier.profilePage.documentsCard.uploadCta")),1)]),_:1})):p("",!0),te.value?p("",!0):(q(),d(r,{key:1,type:"primary",onClick:_e},{default:m(()=>[g(_(c(ee)("supplier.profilePage.documentsCard.uploadCta")),1)]),_:1}))])]),_:1})]),_:1})]),_:1}),y(h,{class:"form-card"},{header:m(()=>[V("div",Q,[V("span",null,_(te.value?c(ee)("supplier.profilePage.title"):c(ee)("supplier.profilePage.formCard.title")),1),te.value?p("",!0):(q(),i("small",X,_(c(ee)("supplier.profilePage.formCard.description")),1))])]),default:m(()=>[y(be,{ref_key:"formRef",ref:ue,model:ne,rules:ie,"label-position":"top"},{default:m(()=>[y(Z,{gutter:20},{default:m(()=>[y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"companyName",label:c(ee)("supplier.fields.companyName")},{default:m(()=>[y(ae,{modelValue:ne.companyName,"onUpdate:modelValue":a[0]||(a[0]=e=>ne.companyName=e),readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"companyId",label:c(ee)("supplier.fields.companyId")},{default:m(()=>[y(ae,{modelValue:ne.companyId,"onUpdate:modelValue":a[1]||(a[1]=e=>ne.companyId=e),readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"contactPerson",label:c(ee)("supplier.fields.contactPerson")},{default:m(()=>[y(ae,{modelValue:ne.contactPerson,"onUpdate:modelValue":a[2]||(a[2]=e=>ne.contactPerson=e),readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"contactEmail",label:c(ee)("supplier.fields.contactEmail")},{default:m(()=>[y(ae,{modelValue:ne.contactEmail,"onUpdate:modelValue":a[3]||(a[3]=e=>ne.contactEmail=e),type:"email",readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"contactPhone",label:c(ee)("supplier.fields.contactPhone")},{default:m(()=>[y(ae,{modelValue:ne.contactPhone,"onUpdate:modelValue":a[4]||(a[4]=e=>ne.contactPhone=e),readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"category",label:c(ee)("supplier.fields.category")},{default:m(()=>[y(ge,{modelValue:ne.category,"onUpdate:modelValue":a[5]||(a[5]=e=>ne.category=e),filterable:"","allow-create":"",disabled:te.value},{default:m(()=>[y(re,{value:"Raw material",label:c(ee)("supplier.categories.rawMaterial")},null,8,["label"]),y(re,{value:"IT",label:c(ee)("supplier.categories.it")},null,8,["label"]),y(re,{value:"Services",label:c(ee)("supplier.categories.services")},null,8,["label"])]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"region",label:c(ee)("supplier.fields.region")},{default:m(()=>[y(ae,{modelValue:ne.region,"onUpdate:modelValue":a[6]||(a[6]=e=>ne.region=e),readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"businessRegistrationNumber",label:c(ee)("supplier.fields.businessRegistrationNumber")},{default:m(()=>[y(ae,{modelValue:ne.businessRegistrationNumber,"onUpdate:modelValue":a[7]||(a[7]=e=>ne.businessRegistrationNumber=e),readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24},{default:m(()=>[y(le,{prop:"address",label:c(ee)("supplier.fields.address")},{default:m(()=>[y(ae,{modelValue:ne.address,"onUpdate:modelValue":a[8]||(a[8]=e=>ne.address=e),type:"textarea",rows:2,readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"bankAccount",label:c(ee)("supplier.fields.bankAccount")},{default:m(()=>[y(ae,{modelValue:ne.bankAccount,"onUpdate:modelValue":a[9]||(a[9]=e=>ne.bankAccount=e),readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"paymentTerms",label:c(ee)("supplier.fields.paymentTerms")},{default:m(()=>[y(ae,{modelValue:ne.paymentTerms,"onUpdate:modelValue":a[10]||(a[10]=e=>ne.paymentTerms=e),readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24,md:12},{default:m(()=>[y(le,{prop:"paymentCurrency",label:c(ee)("supplier.fields.paymentCurrency")},{default:m(()=>[y(ae,{modelValue:ne.paymentCurrency,"onUpdate:modelValue":a[11]||(a[11]=e=>ne.paymentCurrency=e),readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),y(x,{xs:24},{default:m(()=>[y(le,{prop:"notes",label:c(ee)("supplier.fields.notes")},{default:m(()=>[y(ae,{modelValue:ne.notes,"onUpdate:modelValue":a[12]||(a[12]=e=>ne.notes=e),type:"textarea",rows:3,readonly:te.value},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1})]),_:1}),te.value?p("",!0):(q(),d(le,{key:0},{default:m(()=>[y(r,{type:"primary",loading:oe.value,onClick:ve},{default:m(()=>[g(_(oe.value?c(ee)("supplier.profilePage.formCard.submitting"):c(ee)("supplier.profilePage.formCard.submit")),1)]),_:1},8,["loading"]),y(r,{text:"",type:"primary",onClick:_e},{default:m(()=>[g(_(c(ee)("supplier.profilePage.documentsCard.uploadCta")),1)]),_:1})]),_:1}))]),_:1},8,["model"])]),_:1})],64)):(q(),d(o,{key:2,description:c(ee)("supplier.profilePage.noSupplier"),class:"profile-empty"},null,8,["description"]))])}}}),[["__scopeId","data-v-41888646"]]);export{Z as default};
