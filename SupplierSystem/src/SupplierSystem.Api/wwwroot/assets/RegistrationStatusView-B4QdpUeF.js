import{d as t,u as e,g as a,h as s,c as l,s as r,B as u,b as i,e as n,z as o,y as c,j as p,k as m,A as d,t as v,f as y,x as g,F as f,r as h,q as A,o as S,_ as b}from"./index-CrVyv6Rw.js";import{E as k,a as w}from"./el-timeline-item-DuKI_xuX.js";import{E as _}from"./el-empty-DbsioVGH.js";import{E as j}from"./el-card-Bk1XgIcu.js";import{E as I}from"./el-tag-3jK7Rwl9.js";import{E as $}from"./el-skeleton-item-DUrTZpXw.js";import{E as N}from"./el-alert-En2LbMEc.js";import{fetchSupplierRegistrationStatus as E,fetchSupplierRegistrationStatusBySupplier as L,fetchSupplierRegistrationStatusForCurrentUser as x}from"./public-DgDFBaf8.js";import{u as C}from"./useNotification-XF7GEpuP.js";const z={class:"registration-status-page"},F={class:"status-header"},D={class:"status-subtitle"},T={key:1,class:"status-loading"},q={key:2},B={class:"status-summary"},O={class:"summary-grid"},R={class:"summary-label"},U={class:"summary-value"},V={class:"summary-label"},Y={class:"summary-value"},Z={class:"summary-label"},G={class:"summary-label"},H={class:"summary-value"},J={class:"summary-label"},K={class:"summary-value"},M={class:"summary-label"},P={class:"summary-value"},Q={class:"status-history"},W={class:"timeline-entry"},X={class:"timeline-title"},tt={key:0,class:"timeline-comments"},et={key:0,class:"temp-account-section"},at={class:"card-header"},st={class:"temp-account-grid"},lt=b(t({__name:"RegistrationStatusView",setup(t){const b=C(),lt=r(),rt=A(),{t:ut}=e(),it=a(),nt=s(!0),ot=s(null),ct=s(null),pt=s(!1),mt=l(()=>{const t=lt.params.applicationId,e=lt.query.applicationId;return t||e||null}),dt=l(()=>{if(!ct.value)return"-";const t=`registrationStatus.statuses.${ct.value.status}`,e=ut(t);return e===t?ct.value.status:e}),vt=l(()=>{switch(ct.value?.status){case"approved":case"completed":return"success";case"rejected":return"danger";default:return"info"}}),yt=l(()=>{if(!ct.value?.tempAccount?.username)return"-";const t=ct.value.tempAccount.username;return pt.value?t:t.replace(/./g,"*")}),gt=l(()=>{const t=ct.value?.tempAccount?.status;if(!t)return ut("registrationStatus.tempAccount.statuses.unknown");const e=`registrationStatus.tempAccount.statuses.${t}`,a=ut(e);return a===e?t:a}),ft=()=>{window.history.length>1?rt.back():rt.push({name:"dashboard"})},ht=()=>{pt.value=!pt.value},At=t=>{if(!t)return"-";const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString()},St=t=>{if(!t)return"-";const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleString()},bt=t=>{if("registration"===t.type)return ut("registrationStatus.history.submitted");const e=`registrationStatus.history.steps.${t.step}`,a=ut(e);return a===e?`${t.step??"approval"} (${t.status??"-"})`:`${a} (${t.status??"-"})`},kt=t=>`${t.type}-${t.step??"root"}-${t.occurredAt??"n/a"}`;return u(()=>[mt.value,it.user?.supplierId,it.user?.relatedApplicationId],()=>{(async()=>{nt.value=!0,ot.value=null,ct.value=null,pt.value=!1;try{const t=mt.value?Number(mt.value):null,e=it.user?.relatedApplicationId??null;t&&Number.isFinite(t)?ct.value=await E(t):null!=e?ct.value=await E(e):null!=it.user?.supplierId?ct.value=await L(it.user.supplierId):it.user?ct.value=await x():ot.value=ut("registrationStatus.errors.noIdentifier")}catch(t){console.error("Failed to fetch registration status",t),ot.value=t instanceof Error?t.message:ut("errors.general")}finally{nt.value=!1}})()},{immediate:!0}),(t,e)=>{const a=d,s=N,l=$,r=I,u=j,A=_,E=w,L=k;return S(),i("div",z,[n("header",F,[p(a,{link:"",type:"primary",onClick:ft},{default:m(()=>[g(v(y(ut)("common.back")),1)]),_:1}),n("h1",null,v(y(ut)("registrationStatus.title")),1),n("p",D,v(y(ut)("registrationStatus.subtitle")),1)]),ot.value?(S(),o(s,{key:0,type:"error",title:ot.value,"show-icon":"",class:"status-alert"},null,8,["title"])):c("",!0),nt.value?(S(),i("div",T,[p(l,{rows:6,animated:""})])):ct.value?(S(),i("div",q,[n("section",B,[p(u,{shadow:"hover"},{default:m(()=>[n("div",O,[n("div",null,[n("span",R,v(y(ut)("registrationStatus.fields.applicationId")),1),n("span",U,v(ct.value.applicationId),1)]),n("div",null,[n("span",V,v(y(ut)("registrationStatus.fields.supplierCode")),1),n("span",Y,v(ct.value.supplierCode||"-"),1)]),n("div",null,[n("span",Z,v(y(ut)("registrationStatus.fields.status")),1),p(r,{type:vt.value,class:"summary-tag"},{default:m(()=>[g(v(dt.value),1)]),_:1},8,["type"])]),n("div",null,[n("span",G,v(y(ut)("registrationStatus.fields.stage")),1),n("span",H,v(ct.value.supplierStage||y(ut)("registrationStatus.stage.pending")),1)]),n("div",null,[n("span",J,v(y(ut)("registrationStatus.fields.currentApprover")),1),n("span",K,v(ct.value.currentApprover||"-"),1)]),n("div",null,[n("span",M,v(y(ut)("registrationStatus.fields.lastUpdated")),1),n("span",P,v(At(ct.value.updatedAt)),1)])])]),_:1})]),n("section",Q,[n("h2",null,v(y(ut)("registrationStatus.history.title")),1),0===ct.value.history.length?(S(),o(A,{key:0,description:y(ut)("registrationStatus.history.empty")},null,8,["description"])):(S(),o(L,{key:1},{default:m(()=>[(S(!0),i(f,null,h(ct.value.history,t=>(S(),o(E,{key:kt(t),type:"approval"===t.type?"primary":"success",timestamp:St(t.occurredAt)},{default:m(()=>[n("div",W,[n("div",X,v(bt(t)),1),t.comments?(S(),i("div",tt,v(t.comments),1)):c("",!0)])]),_:2},1032,["type","timestamp"]))),128))]),_:1}))]),ct.value.tempAccount?(S(),i("section",et,[p(u,{shadow:"never"},{header:m(()=>[n("div",at,[n("span",null,v(y(ut)("registrationStatus.tempAccount.title")),1),p(r,{size:"small",type:"info"},{default:m(()=>[g(v(gt.value),1)]),_:1})])]),default:m(()=>[n("dl",st,[n("div",null,[n("dt",null,v(y(ut)("auth.usernameLabel")),1),n("dd",null,[g(v(ct.value.tempAccount.username||"-")+" ",1),ct.value.tempAccount.username?(S(),o(a,{key:0,size:"small",type:"primary",link:"",onClick:e[0]||(e[0]=t=>(async(t,e)=>{try{await navigator.clipboard.writeText(t),b.success(ut("registrationStatus.actions.copied",{label:e}))}catch(a){console.error("Clipboard copy failed",a),b.error(ut("errors.copyFailed"))}})(ct.value.tempAccount.username,y(ut)("auth.usernameLabel")))},{default:m(()=>[g(v(y(ut)("common.copy")),1)]),_:1})):c("",!0)])]),n("div",null,[n("dt",null,v(y(ut)("auth.passwordLabel")),1),n("dd",null,[g(v(yt.value)+" ",1),ct.value.tempAccount.username?(S(),o(a,{key:0,size:"small",type:"primary",link:"",onClick:ht},{default:m(()=>[g(v(pt.value?y(ut)("common.hide"):y(ut)("common.show")),1)]),_:1})):c("",!0)])]),n("div",null,[n("dt",null,v(y(ut)("registrationStatus.tempAccount.expiresAt")),1),n("dd",null,v(At(ct.value.tempAccount.expiresAt)),1)]),n("div",null,[n("dt",null,v(y(ut)("registrationStatus.tempAccount.lastLogin")),1),n("dd",null,v(St(ct.value.tempAccount.lastLoginAt)),1)])])]),_:1})])):c("",!0)])):(S(),o(A,{key:3,class:"status-empty",description:y(ut)("registrationStatus.empty")},null,8,["description"]))])}}}),[["__scopeId","data-v-ea06cb29"]]);export{lt as default};
