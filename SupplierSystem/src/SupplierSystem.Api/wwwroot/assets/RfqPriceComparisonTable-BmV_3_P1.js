import{d as e,u as i,c as r,h as a,b as l,e as s,j as n,t,f as o,k as p,F as c,r as d,z as u,y as m,x as f,A as y,O as v,es as C,H as g,o as b,_ as h}from"./index-BqVgmY2a.js";import{E as q,a as _}from"./el-table-column-CYI6_cgf.js";import"./el-scrollbar-Hhg6XmGO.js";import{E as w}from"./el-tag-BFFTmzKO.js";import{P}from"./PriceComparisonDetailDialog-DOJDN7uR.js";import{p as k,f as I,t as L,c as T,b as N,n as U}from"./dataParsing-ZXXCcBwJ.js";import"./_baseClone-DnYTnrzK.js";import"./castArray-B2VphuOT.js";import"./debounce-BP_d4msr.js";import"./el-alert-ZQ_1rrnl.js";import"./el-descriptions-item-Ckr4wpd8.js";import"./el-image-viewer-DPQjaeTh.js";const D={class:"rfq-price-comparison-table"},j={class:"comparison-header"},x={class:"item-cell"},A={class:"description-cell"},O={class:"price-cell"},R={class:"price-value"},S={key:0,class:"price-sub"},F={key:1,class:"no-quote"},G={key:1},z={class:"recommend-cell"},E={class:"supplier-name"},V={key:0,class:"price-advantage"},$={key:1},M={class:"detail-supplier"},Q={class:"detail-supplier__name"},B={class:"detail-row"},H={class:"label"},Y={class:"value"},Z={class:"detail-list"},J={class:"detail-row"},K={class:"label"},W={class:"value"},X={class:"detail-row"},ee={class:"label"},ie={class:"value"},re={class:"detail-row"},ae={class:"label"},le={class:"value"},se={key:0},ne={key:1},te={key:0,class:"detail-row"},oe={class:"label"},pe={class:"value"},ce={key:1,class:"detail-row"},de={class:"label"},ue={class:"value"},me={class:"detail-list"},fe={class:"detail-row"},ye={class:"label"},ve={class:"value"},Ce={class:"detail-row"},ge={class:"label"},be={class:"value"},he={class:"detail-row"},qe={class:"label"},_e={class:"value"},we={key:0,class:"detail-row"},Pe={class:"label"},ke={class:"value"},Ie={key:1,class:"detail-row"},Le={class:"label"},Te={class:"value"},Ne={key:2,class:"detail-row"},Ue={class:"label"},De={class:"value"},je="USD",xe=h(e({__name:"RfqPriceComparisonTable",props:{rfqId:{default:void 0},lineItems:{},quotes:{},priceComparisons:{},materialType:{default:"standard"}},emits:["refresh"],setup(e,{emit:h}){const xe=e,{t:Ae}=i(),Oe=r(()=>{const e=new Map;return xe.quotes.forEach(i=>{const r=i.supplierName||i.companyName;i.supplierId&&r&&e.set(i.supplierId,{id:i.supplierId,name:r})}),Array.from(e.values())}),Re=r(()=>xe.lineItems.map((e,i)=>{const r={},a=[];xe.quotes.forEach(l=>{if(!l||!l.supplierId)return;const s=l.supplierName||l.companyName||`#${l.supplierId}`,n=function(e,i,r){if(!Array.isArray(e)||0===e.length)return null;const a=N(i);if(a.size>0){const i=[["lineItemId","line_item_id","lineId","rfqLineItemId","rfq_line_item_id","rfqItemId","rfq_item_id"],["id"],["lineNumber","line_number","lineNo","line_no"],["itemNumber","item_number","itemNo","item_no","sku"]];for(const r of i){const i=e.find(e=>r.some(i=>{const r=U(e?.[i]);return null!==r&&a.has(r)}));if(i)return i}}if(1===xe.lineItems.length&&1===e.length)return e[0];if(1===e.length)return e[0];if(r>=0&&r<e.length)return e[r];return null}(Array.isArray(l.items)&&l.items.length?l.items:Array.isArray(l.quoteItems)?l.quoteItems:[],e,i);if(!n)return void a.push(function(e,i){return{supplierId:e.supplierId,supplierName:i,standardCost:null,standardCostCurrency:e.currency||je,originalUnitPrice:null,originalCurrency:e.currency||null,tariffRate:null,specialTariffRate:null,hasSpecialTariff:!1,productGroup:null,productOrigin:null,moq:null,spq:null,deliveryPeriod:null,deliveryTerms:e.deliveryTerms||null,shippingCountry:e.shippingCountry||e.shipping_country||null,shippingLocation:e.shippingLocation||e.shipping_location||null,isPlaceholder:!0,isLowest:!1}}(l,s));const t=n.tariffCalculation||{},o=k(t.standardCost,n.standardUnitCost,n.standardUnitCostUsd,n.standardUnitCostLocal),p=t.standardCostCurrency||(null!==t.standardCostUsd&&void 0!==t.standardCostUsd?"USD":n.currency||l.currency||je),c=k(n.unitPrice,n.unit_price,t.originalPrice),d=n.currency||t.originalCurrency||l.currency||null,u=k(t.specialTariffRate),m=Boolean(t.hasSpecialTariff||null!==u&&u>0);r[l.supplierId]={supplierId:l.supplierId,supplierName:s,price:o??c??null,standardCost:o,standardCostCurrency:p,currency:p,originalUnitPrice:c,originalCurrency:d,hasSpecialTariff:m,isLowest:!1};const f=I(n.moq,n.minimumOrderQuantity,n.minimum_order_quantity),y=I(n.spq,n.standardPackageQuantity,n.standard_package_quantity),v=I(n.deliveryPeriod,n.delivery_period,n.delivery_time,l.deliveryPeriod,l.delivery_period,l.delivery_time);a.push({supplierId:l.supplierId,supplierName:s,standardCost:o,standardCostCurrency:p,originalUnitPrice:c,originalCurrency:d,tariffRate:k(t.tariffRate),specialTariffRate:u,hasSpecialTariff:m,productGroup:t.productGroup||n.productGroup||n.product_group||null,productOrigin:t.productOrigin||n.productOrigin||n.product_origin||null,moq:f,spq:y,deliveryPeriod:v,deliveryTerms:l.deliveryTerms||n.deliveryTerms||null,shippingCountry:t.shippingCountry||l.shippingCountry||l.shipping_country||null,shippingLocation:l.shippingLocation||l.shipping_location||null,isPlaceholder:!1,isLowest:!1})});const l=a.map(e=>L(e.standardCost)).filter(e=>null!==e),s=a.map(e=>L(e.originalUnitPrice)).filter(e=>null!==e),n=0===l.length,t=n?s:l,o=t.length>0?Math.min(...t):null,p=a.map(e=>{const i=L(n?e.originalUnitPrice:e.standardCost),a=null!==o&&null!==i&&i===o,l=r[e.supplierId];return l&&(l.isLowest=a,l.price=i??l.price),{...e,isLowest:a}}).sort((e,i)=>{const r=L(n?e.originalUnitPrice:e.standardCost),a=L(n?i.originalUnitPrice:i.standardCost);return T(r,a)}),c=t.length>0?Math.min(...t):null;let d=null;if(null!==c){const e=Object.values(r).find(e=>e.price===c);e&&(d={name:e.supplierName})}return{...e,itemNumber:e.lineNumber||e.itemNumber||"-",description:e.itemName||e.description||"-",supplierPrices:r,supplierDetails:p,recommendation:d}})),Se=a(!1),Fe=a(null),Ge=a([]),ze=a(!1),Ee=a([]),Ve=a("");function $e(e){if(!e)return"-";return Me(L(e.standardCost??e.price),e.standardCostCurrency||e.currency)}function Me(e,i){const r=L(e);if(null===r)return"-";const a=(i||je).toUpperCase();try{return new Intl.NumberFormat(void 0,{style:"currency",currency:a,minimumFractionDigits:r>=1?2:4,maximumFractionDigits:4}).format(r)}catch(l){return`${a} ${r.toFixed(r>=1?2:4)}`}}function Qe(e){const i=L(e);return null===i?"-":`${(100*i).toFixed(2)}%`}function Be(e){if(null==e)return"-";const i=L(e);return null!==i?(new Intl.NumberFormat).format(i):"string"==typeof e?e:String(e)}function He(e){if(null==e)return"-";const i=L(e);if(null!==i)return Ae("rfq.priceComparison.leadTimeDays",{days:i});if("string"==typeof e){const i=e.trim();return""===i?"-":i}return String(e)}function Ye(e){e.downloadUrl&&window.open(e.downloadUrl,"_blank")}return(e,i)=>{const r=q,a=w,h=y,k=v,I=_,L=g;return b(),l("div",D,[s("div",j,[s("h3",null,t(o(Ae)("rfq.priceComparison.title")),1)]),n(I,{data:Re.value,border:"",stripe:"",style:{width:"100%"},"empty-text":o(Ae)("rfq.priceComparison.noData")},{default:p(()=>[n(r,{label:o(Ae)("rfq.priceComparison.table.itemNumber"),prop:"itemNumber",width:"150",fixed:""},{default:p(({row:e})=>[s("div",x,[s("strong",null,t(e.itemNumber),1)])]),_:1},8,["label"]),n(r,{label:o(Ae)("rfq.priceComparison.table.description"),prop:"description","min-width":"200"},{default:p(({row:e})=>[s("div",A,t(e.description),1)]),_:1},8,["label"]),(b(!0),l(c,null,d(Oe.value,e=>(b(),u(r,{key:e.id,label:e.name,width:"120",align:"center"},{default:p(({row:i})=>[s("div",O,[i.supplierPrices[e.id]?(b(),l(c,{key:0},[s("div",R,t($e(i.supplierPrices[e.id])),1),null!==i.supplierPrices[e.id].originalUnitPrice?(b(),l("div",S,t(Me(i.supplierPrices[e.id].originalUnitPrice,i.supplierPrices[e.id].originalCurrency||i.supplierPrices[e.id].currency)),1)):m("",!0),i.supplierPrices[e.id].isLowest?(b(),u(a,{key:1,type:"success",size:"small",effect:"dark"},{default:p(()=>[f(t(o(Ae)("rfq.priceComparison.lowest")),1)]),_:1})):m("",!0),i.supplierPrices[e.id].hasSpecialTariff?(b(),u(a,{key:2,type:"warning",size:"small",effect:"dark"},{default:p(()=>[f(t(o(Ae)("rfq.quote.specialTariffTag")),1)]),_:1})):m("",!0)],64)):(b(),l("span",F,"-"))])]),_:2},1032,["label"]))),128)),n(r,{label:o(Ae)("rfq.priceComparison.table.details"),width:"150",align:"center"},{default:p(({row:e})=>[e.supplierDetails&&e.supplierDetails.length?(b(),u(h,{key:0,type:"primary",link:"",onClick:i=>function(e){const i=Array.isArray(e?.supplierDetails)?e.supplierDetails:[];if(!i.length)return Ee.value=[],void(ze.value=!1);Ee.value=i;const r=[];e.itemNumber&&"-"!==e.itemNumber&&r.push(e.itemNumber),e.description&&"-"!==e.description&&r.push(e.description),Ve.value=r.join(" - "),ze.value=!0}(e)},{default:p(()=>[f(t(o(Ae)("rfq.priceComparison.viewDetail")),1)]),_:1},8,["onClick"])):(b(),l("span",G,"-"))]),_:1},8,["label"]),n(r,{label:o(Ae)("rfq.priceComparison.table.recommended"),width:"150",align:"center",fixed:"right"},{default:p(({row:e})=>[s("div",z,[e.recommendation?(b(),l(c,{key:0},[n(k,{class:"recommend-icon"},{default:p(()=>[n(o(C))]),_:1}),s("div",E,t(e.recommendation.name),1),e.recommendation.advantage?(b(),l("div",V,t(e.recommendation.advantage),1)):m("",!0)],64)):(b(),l("span",$,"-"))])]),_:1},8,["label"])]),_:1},8,["data","empty-text"]),n(P,{visible:Se.value,"onUpdate:visible":i[0]||(i[0]=e=>Se.value=e),"detail-data":Fe.value,"supplier-prices":Ge.value,onDownload:Ye},null,8,["visible","detail-data","supplier-prices"]),n(L,{modelValue:ze.value,"onUpdate:modelValue":i[2]||(i[2]=e=>ze.value=e),title:Ve.value||o(Ae)("rfq.priceComparison.detailDialogTitleFallback"),width:"960px","close-on-click-modal":!1,class:"supplier-detail-dialog"},{footer:p(()=>[n(h,{onClick:i[1]||(i[1]=e=>ze.value=!1)},{default:p(()=>[f(t(o(Ae)("common.close")),1)]),_:1})]),default:p(()=>[n(I,{data:Ee.value,border:""},{default:p(()=>[n(r,{label:o(Ae)("rfq.priceComparison.detailColumns.supplier"),"min-width":"200"},{default:p(({row:e})=>[s("div",M,[s("div",Q,t(e.supplierName),1),e.isLowest?(b(),u(a,{key:0,type:"success",size:"small"},{default:p(()=>[f(t(o(Ae)("rfq.priceComparison.bestStandardCost")),1)]),_:1})):m("",!0),s("div",B,[s("span",H,t(o(Ae)("rfq.priceComparison.detailLabels.standardCost"))+":",1),s("span",Y,t(Me(e.standardCost,e.standardCostCurrency)),1)])])]),_:1},8,["label"]),n(r,{label:o(Ae)("rfq.priceComparison.detailColumns.pricing"),"min-width":"320"},{default:p(({row:e})=>[s("div",Z,[s("div",J,[s("span",K,t(o(Ae)("rfq.priceComparison.detailLabels.originalPrice"))+":",1),s("span",W,t(Me(e.originalUnitPrice,e.originalCurrency||e.standardCostCurrency)),1)]),s("div",X,[s("span",ee,t(o(Ae)("rfq.priceComparison.detailLabels.baseTariff"))+":",1),s("span",ie,t(Qe(e.tariffRate)),1)]),s("div",re,[s("span",ae,t(o(Ae)("rfq.priceComparison.detailLabels.specialTariff"))+":",1),s("span",le,[null!==e.specialTariffRate?(b(),l("span",se,t(Qe(e.specialTariffRate)),1)):(b(),l("span",ne,t(o(Ae)("common.none")),1))])]),e.productGroup?(b(),l("div",te,[s("span",oe,t(o(Ae)("rfq.priceComparison.detailLabels.productGroup"))+":",1),s("span",pe,t(e.productGroup),1)])):m("",!0),e.productOrigin?(b(),l("div",ce,[s("span",de,t(o(Ae)("rfq.priceComparison.detailLabels.productOrigin"))+":",1),s("span",ue,t(e.productOrigin),1)])):m("",!0)])]),_:1},8,["label"]),n(r,{label:o(Ae)("rfq.priceComparison.detailColumns.terms"),"min-width":"320"},{default:p(({row:e})=>[s("div",me,[s("div",fe,[s("span",ye,t(o(Ae)("rfq.priceComparison.detailLabels.moq"))+":",1),s("span",ve,t(Be(e.moq)),1)]),s("div",Ce,[s("span",ge,t(o(Ae)("rfq.priceComparison.detailLabels.spq"))+":",1),s("span",be,t(Be(e.spq)),1)]),s("div",he,[s("span",qe,t(o(Ae)("rfq.priceComparison.detailLabels.leadTime"))+":",1),s("span",_e,t(He(e.deliveryPeriod)),1)]),e.deliveryTerms?(b(),l("div",we,[s("span",Pe,t(o(Ae)("rfq.priceComparison.detailLabels.deliveryTerms"))+":",1),s("span",ke,t(e.deliveryTerms),1)])):m("",!0),e.shippingCountry?(b(),l("div",Ie,[s("span",Le,t(o(Ae)("rfq.priceComparison.detailLabels.shippingCountry"))+":",1),s("span",Te,t(e.shippingCountry),1)])):m("",!0),e.shippingLocation?(b(),l("div",Ne,[s("span",Ue,t(o(Ae)("rfq.priceComparison.detailLabels.shippingLocation"))+":",1),s("span",De,t(e.shippingLocation),1)])):m("",!0)])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-627b7fd7"]]);export{xe as default};
