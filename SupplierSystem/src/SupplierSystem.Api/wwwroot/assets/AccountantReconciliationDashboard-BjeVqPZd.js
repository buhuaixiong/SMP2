import{d as e,u as a,h as l,i as t,C as o,b as i,j as n,k as c,H as r,e as s,t as u,A as d,x as m,m as p,z as v,S as f,y as b,w as _,o as h,_ as y}from"./index-CyQdnTIC.js";import{v as $}from"./el-loading-oesi7HFc.js";import{a as D,E as g}from"./el-descriptions-item-C3lsVx1m.js";import{E as w,a as j}from"./el-table-column-DvsfEAIW.js";import"./el-scrollbar-CTtrnhms.js";import{E as k}from"./el-tag-eQgnjs1v.js";import{E as V,a as x}from"./el-form-item-DJ87vTOW.js";import{E as A,a as F}from"./el-select-CdADVnxU.js";import{E as Y}from"./el-date-picker-panel-CmBAD9wS.js";/* empty css                 */import{E as C,a as T}from"./el-col-DeDAYdEB.js";import{E}from"./el-card-DJj_OhI8.js";import{E as R}from"./el-statistic-Bdf26E76.js";import{fetchReconciliationDashboard as N,fetchReconciliationById as S,confirmReconciliation as U,fetchReconciliationReport as M}from"./reconciliation-CnVgqgae.js";import{u as P}from"./useNotification-DAUqvaBw.js";import"./_baseClone-CxGxK45k.js";import"./castArray-C2ko8TfK.js";import"./debounce-B4S_WZO2.js";import"./dayjs.min-CuEfV50W.js";import"./index-CubmMpUU.js";const z={class:"accountant-reconciliation-dashboard"},O={class:"header-title"},B={key:0},G={key:1,class:"text-muted"},I=y(e({__name:"AccountantReconciliationDashboard",setup(e){const y=P(),{t:I}=a(),q=l(!1),H=l(!1),J=l([]),Q=l({total_reconciliations:0,matched_count:0,variance_count:0,unmatched_count:0,confirmed_count:0,total_variance_amount:0,avg_variance_amount:0}),W=t({startDate:"",endDate:"",status:""}),Z=t({reportType:"summary",startDate:"",endDate:""}),K=l(!1),L=l(!1),X=l(null),ee=async()=>{q.value=!0;try{const e=await N(W);J.value=e.recentReconciliations,Q.value=e.stats}catch(e){console.error(I("reconciliation.messages.fetchDataFailed"),e),y.error(I("reconciliation.messages.fetchDataFailed"))}finally{q.value=!1}},ae=()=>{W.startDate="",W.endDate="",W.status="",ee()},le=async e=>{try{X.value=await S(e.id),K.value=!0}catch(a){console.error(I("reconciliation.messages.fetchDetailsFailed"),a),y.error(I("reconciliation.messages.fetchDetailsFailed"))}},te=async(e,a)=>{try{const l=a?await y.prompt(I("reconciliation.prompts.confirmNotes"),I("reconciliation.prompts.confirmTitle"),{confirmButtonText:I("common.confirm"),cancelButtonText:I("common.cancel"),inputPattern:/.*/,inputPlaceholder:I("reconciliation.prompts.notesPlaceholder")}).then(({value:e})=>e).catch(()=>null):await y.prompt(I("reconciliation.prompts.rejectReason"),I("reconciliation.prompts.rejectTitle"),{confirmButtonText:I("reconciliation.buttons.reject"),cancelButtonText:I("common.cancel"),inputValidator:e=>!!e||I("reconciliation.validation.rejectReasonRequired"),inputPlaceholder:I("reconciliation.prompts.rejectReasonPlaceholder")}).then(({value:e})=>e).catch(()=>null);if(null===l&&!a)return;await U({reconciliationId:e.id,confirm:a,notes:l||void 0}),y.success(I(a?"reconciliation.messages.confirmSuccess":"reconciliation.messages.rejectSuccess")),ee()}catch(l){console.error(I(a?"reconciliation.messages.confirmFailed":"reconciliation.messages.rejectFailed"),l),y.error(I(a?"reconciliation.messages.confirmFailed":"reconciliation.messages.rejectFailed"))}},oe=async()=>{H.value=!0;try{const e=await M({reportType:Z.reportType,startDate:Z.startDate,endDate:Z.endDate});y.success(I("reconciliation.messages.reportGeneratedSuccess")),console.log("Generated report:",e),L.value=!1}catch(e){console.error(I("reconciliation.messages.reportGeneratedFailed"),e),y.error(I("reconciliation.messages.reportGeneratedFailed"))}finally{H.value=!1}},ie=e=>({matched:"success",variance:"warning",unmatched:"info"}[e]||"info"),ne=e=>I(`reconciliation.status.${e}`,e);return o(()=>{ee()}),(e,a)=>{const l=d,t=R,o=E,y=T,N=C,S=Y,U=x,M=F,P=A,I=V,ce=w,re=k,se=j,ue=D,de=g,me=r,pe=$;return h(),i("div",z,[n(o,{class:"header-card"},{header:c(()=>[s("div",O,[s("h2",null,u(e.$t("reconciliation.dashboard.title")),1),n(l,{type:"primary",onClick:a[0]||(a[0]=e=>L.value=!0)},{default:c(()=>[m(u(e.$t("reconciliation.buttons.generateReport")),1)]),_:1})])]),default:c(()=>[n(N,{gutter:20,class:"stats-row"},{default:c(()=>[n(y,{span:6},{default:c(()=>[n(o,null,{default:c(()=>[n(t,{title:e.$t("reconciliation.stats.totalRecords"),value:Q.value.total_reconciliations},null,8,["title","value"])]),_:1})]),_:1}),n(y,{span:6},{default:c(()=>[n(o,null,{default:c(()=>[n(t,{title:e.$t("reconciliation.stats.matched"),value:Q.value.matched_count,"value-style":"color: #67c23a"},null,8,["title","value"])]),_:1})]),_:1}),n(y,{span:6},{default:c(()=>[n(o,null,{default:c(()=>[n(t,{title:e.$t("reconciliation.stats.varianceRecords"),value:Q.value.variance_count,"value-style":"color: #e6a23c"},null,8,["title","value"])]),_:1})]),_:1}),n(y,{span:6},{default:c(()=>[n(o,null,{default:c(()=>[n(t,{title:e.$t("reconciliation.stats.unconfirmed"),value:Q.value.total_reconciliations-Q.value.confirmed_count,"value-style":"color: #f56c6c"},null,8,["title","value"])]),_:1})]),_:1})]),_:1})]),_:1}),n(o,{class:"filter-card"},{default:c(()=>[n(I,{inline:!0,model:W},{default:c(()=>[n(U,{label:e.$t("common.startDate")},{default:c(()=>[n(S,{modelValue:W.startDate,"onUpdate:modelValue":a[1]||(a[1]=e=>W.startDate=e),type:"date",placeholder:e.$t("placeholders.selectStartDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,{label:e.$t("common.endDate")},{default:c(()=>[n(S,{modelValue:W.endDate,"onUpdate:modelValue":a[2]||(a[2]=e=>W.endDate=e),type:"date",placeholder:e.$t("placeholders.selectEndDate"),"value-format":"YYYY-MM-DD"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,{label:e.$t("common.status")},{default:c(()=>[n(P,{modelValue:W.status,"onUpdate:modelValue":a[3]||(a[3]=e=>W.status=e),placeholder:e.$t("placeholders.selectStatus"),clearable:""},{default:c(()=>[n(M,{label:e.$t("common.all"),value:""},null,8,["label"]),n(M,{label:e.$t("reconciliation.status.matched"),value:"matched"},null,8,["label"]),n(M,{label:e.$t("reconciliation.status.variance"),value:"variance"},null,8,["label"]),n(M,{label:e.$t("reconciliation.status.unmatched"),value:"unmatched"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,null,{default:c(()=>[n(l,{type:"primary",onClick:ee},{default:c(()=>[m(u(e.$t("common.search")),1)]),_:1}),n(l,{onClick:ae},{default:c(()=>[m(u(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(o,null,{default:c(()=>[p((h(),v(se,{data:J.value,style:{width:"100%"},onRowClick:le},{default:c(()=>[n(ce,{label:e.$t("reconciliation.table.warehouseOrderNo"),prop:"warehouseOrderNo",width:"160"},null,8,["label"]),n(ce,{label:e.$t("reconciliation.table.supplier"),prop:"supplierName",width:"200"},null,8,["label"]),n(ce,{label:e.$t("reconciliation.table.receivedDate"),prop:"received_date",width:"120"},null,8,["label"]),n(ce,{label:e.$t("reconciliation.table.reconAmount"),width:"120"},{default:c(({row:e})=>[m(" ¥"+u(e.totalAmount.toFixed(2)),1)]),_:1},8,["label"]),n(ce,{label:e.$t("reconciliation.table.invoiceAmount"),width:"120"},{default:c(({row:a})=>[a.invoiceAmount?(h(),i("span",B,"¥"+u(a.invoiceAmount.toFixed(2)),1)):(h(),i("span",G,u(e.$t("reconciliation.table.notUploaded")),1))]),_:1},8,["label"]),n(ce,{label:e.$t("reconciliation.table.variance"),width:"120"},{default:c(({row:e})=>[s("span",{class:f({"variance-positive":e.variance_amount>0,"variance-negative":e.variance_amount<0})},u(e.variance_amount>=0?"+":"")+"¥"+u(e.variance_amount.toFixed(2)),3)]),_:1},8,["label"]),n(ce,{label:e.$t("common.status"),prop:"status",width:"100"},{default:c(({row:e})=>[n(re,{type:ie(e.status)},{default:c(()=>[m(u(ne(e.status)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),n(ce,{label:e.$t("reconciliation.table.confirmStatus"),width:"100"},{default:c(({row:a})=>[a.accountant_confirmed?(h(),v(re,{key:0,type:"success"},{default:c(()=>[m(u(e.$t("reconciliation.confirmStatus.confirmed")),1)]),_:1})):(h(),v(re,{key:1,type:"warning"},{default:c(()=>[m(u(e.$t("reconciliation.confirmStatus.pending")),1)]),_:1}))]),_:1},8,["label"]),n(ce,{label:e.$t("common.actions"),fixed:"right",width:"250"},{default:c(({row:a})=>[a.accountant_confirmed?b("",!0):(h(),v(l,{key:0,type:"success",size:"small",onClick:_(e=>te(a,!0),["stop"])},{default:c(()=>[m(u(e.$t("common.confirm")),1)]),_:1},8,["onClick"])),a.accountant_confirmed?b("",!0):(h(),v(l,{key:1,type:"danger",size:"small",onClick:_(e=>te(a,!1),["stop"])},{default:c(()=>[m(u(e.$t("reconciliation.buttons.reject")),1)]),_:1},8,["onClick"])),n(l,{size:"small",onClick:_(e=>le(a),["stop"])},{default:c(()=>[m(u(e.$t("common.view")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[pe,q.value]])]),_:1}),n(me,{modelValue:K.value,"onUpdate:modelValue":a[5]||(a[5]=e=>K.value=e),title:e.$t("reconciliation.detailsDialog.title"),width:"1000px"},{footer:c(()=>[n(l,{onClick:a[4]||(a[4]=e=>K.value=!1)},{default:c(()=>[m(u(e.$t("common.close")),1)]),_:1})]),default:c(()=>[X.value?(h(),v(de,{key:0,column:2,border:""},{default:c(()=>[n(ue,{label:e.$t("reconciliation.table.warehouseOrderNo")},{default:c(()=>[m(u(X.value.warehouseOrderNo),1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.table.supplier")},{default:c(()=>[m(u(X.value.supplierName),1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.table.receivedDate")},{default:c(()=>[m(u(X.value.received_date),1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.table.reconAmount")},{default:c(()=>[m(" ¥"+u(X.value.totalAmount.toFixed(2)),1)]),_:1},8,["label"]),X.value.invoiceNumber?(h(),v(ue,{key:0,label:e.$t("invoice.number")},{default:c(()=>[m(u(X.value.invoiceNumber),1)]),_:1},8,["label"])):b("",!0),X.value.invoiceAmount?(h(),v(ue,{key:1,label:e.$t("reconciliation.table.invoiceAmount")},{default:c(()=>[m(" ¥"+u(X.value.invoiceAmount.toFixed(2)),1)]),_:1},8,["label"])):b("",!0),n(ue,{label:e.$t("common.status")},{default:c(()=>[n(re,{type:ie(X.value.status)},{default:c(()=>[m(u(ne(X.value.status)),1)]),_:1},8,["type"])]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.detailsDialog.varianceAmount")},{default:c(()=>[s("span",{class:f({"variance-positive":X.value.variance_amount>0,"variance-negative":X.value.variance_amount<0})},u(X.value.variance_amount>=0?"+":"")+"¥"+u(X.value.variance_amount.toFixed(2)),3)]),_:1},8,["label"])]),_:1})):b("",!0),X.value?.varianceAnalysis?(h(),v(o,{key:1,style:{"margin-top":"20px"}},{header:c(()=>[m(u(e.$t("reconciliation.detailsDialog.varianceAnalysis")),1)]),default:c(()=>[n(de,{column:2,border:""},{default:c(()=>[n(ue,{label:e.$t("reconciliation.detailsDialog.varianceAmount")},{default:c(()=>[m(" ¥"+u(X.value.varianceAnalysis.variance_amount.toFixed(2)),1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.detailsDialog.variancePercentage")},{default:c(()=>[m(u(X.value.varianceAnalysis.variance_percentage.toFixed(2))+"% ",1)]),_:1},8,["label"]),n(ue,{label:e.$t("reconciliation.detailsDialog.varianceReason"),span:2},{default:c(()=>[m(u(X.value.varianceAnalysis.variance_reason||e.$t("common.none")),1)]),_:1},8,["label"])]),_:1})]),_:1})):b("",!0)]),_:1},8,["modelValue","title"]),n(me,{modelValue:L.value,"onUpdate:modelValue":a[10]||(a[10]=e=>L.value=e),title:e.$t("reconciliation.reportDialog.title"),width:"600px"},{footer:c(()=>[n(l,{onClick:a[9]||(a[9]=e=>L.value=!1)},{default:c(()=>[m(u(e.$t("common.cancel")),1)]),_:1}),n(l,{type:"primary",onClick:oe,loading:H.value},{default:c(()=>[m(u(e.$t("reconciliation.buttons.generate")),1)]),_:1},8,["loading"])]),default:c(()=>[n(I,{model:Z,"label-width":"120px"},{default:c(()=>[n(U,{label:e.$t("reconciliation.reportDialog.reportType")},{default:c(()=>[n(P,{modelValue:Z.reportType,"onUpdate:modelValue":a[6]||(a[6]=e=>Z.reportType=e),placeholder:e.$t("placeholders.selectReportType")},{default:c(()=>[n(M,{label:e.$t("reconciliation.reportDialog.types.summary"),value:"summary"},null,8,["label"]),n(M,{label:e.$t("reconciliation.reportDialog.types.variance"),value:"variance"},null,8,["label"]),n(M,{label:e.$t("reconciliation.reportDialog.types.supplierPerformance"),value:"supplier"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,{label:e.$t("common.startDate")},{default:c(()=>[n(S,{modelValue:Z.startDate,"onUpdate:modelValue":a[7]||(a[7]=e=>Z.startDate=e),type:"date",placeholder:e.$t("placeholders.selectStartDate"),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(U,{label:e.$t("common.endDate")},{default:c(()=>[n(S,{modelValue:Z.endDate,"onUpdate:modelValue":a[8]||(a[8]=e=>Z.endDate=e),type:"date",placeholder:e.$t("placeholders.selectEndDate"),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-b68418d8"]]);export{I as default};
