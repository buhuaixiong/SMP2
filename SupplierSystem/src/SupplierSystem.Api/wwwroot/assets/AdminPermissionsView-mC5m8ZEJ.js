import{W as e,aP as s,h as a,d as i,u as n,g as l,a6 as t,c as o,i as r,B as d,C as u,b as c,e as m,y as p,t as v,f as y,S as f,F as b,r as g,m as h,aQ as P,v as w,n as U,x as k,w as C,aR as A,o as I,_ as F}from"./index-CIahGNSM.js";import{u as S}from"./useNotification-DBBxtp1r.js";const x=e=>e&&"object"==typeof e&&"data"in e?e.data:e,z=async(s,a=20)=>{const i=new URLSearchParams({limit:String(a)});s&&i.set("q",s);const n=await e(`/permissions/suppliers/search?${i.toString()}`),l=x(n),t=Array.isArray(l)?l:Array.isArray(l.data)?l.data:[],o=(e,s)=>{for(const a of s)if(a in e)return e[a]},r=e=>"string"==typeof e?e:null!=e?String(e):"",d=[];return t.forEach(e=>{const s=(a=e)&&"object"==typeof a?a:null;var a;if(!s)return;const i=(e=>{if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e&&e.trim()){const s=Number(e);return Number.isFinite(s)?s:null}return null})(o(s,["id","Id","supplierId","SupplierId","supplier_id"]));if(null===i)return;const n=(e=>{if(null==e)return null;const s=r(e);return s.length?s:null})(o(s,["supplierCode","SupplierCode","supplier_code"])),l={id:i,companyName:r(o(s,["companyName","CompanyName","company_name"])),companyId:r(o(s,["companyId","CompanyId","company_id"]))};null!==n&&(l.supplierCode=n),d.push(l)}),d},R=s("permission",()=>{const s=a([]),i=a([]),n=a([]),l=a({}),t=a([]),o=a(!1),r=a(null),d=async()=>{const s=await(async()=>{const s=await e("/permissions/buyers");return x(s)})();return n.value=s.map(e=>({...e,assignmentCount:e.assignmentCount??0,contractAlertCount:e.contractAlertCount??0,profileAccessCount:e.profileAccessCount??0})),n.value},u=async s=>{await(async s=>await e(`/permissions/users/${encodeURIComponent(s)}`,{method:"DELETE"}))(s)};return{roles:s,users:i,buyers:n,buyerAssignments:l,supplierSearchResults:t,loading:o,error:r,fetchRoles:async()=>{o.value=!0,r.value=null;try{return s.value=await(async()=>{const s=await e("/permissions/roles");return x(s)})(),s.value}catch(a){throw r.value=a instanceof Error?a.message:"Failed to load roles",a}finally{o.value=!1}},fetchUsers:async()=>{o.value=!0,r.value=null;try{return i.value=await(async(s="internal")=>{const a=s?`?scope=${encodeURIComponent(s)}`:"",i=await e(`/permissions/users${a}`);return x(i)})(),i.value}catch(s){throw r.value=s instanceof Error?s.message:"Failed to load users",s}finally{o.value=!1}},createAccount:async s=>{const a=await(async s=>{const a=await e("/permissions/users",{method:"POST",body:s});return x(a)})(s),n=i.value.findIndex(e=>e.id===a.id);return n>=0?i.value.splice(n,1,a):i.value.push(a),"purchaser"===a.role&&await d(),a},changeUserRole:async(s,a,t)=>{const o=await(async(s,a)=>{const i=await e(`/permissions/users/${encodeURIComponent(s)}/role`,{method:"PUT",body:a});return x(i)})(s,{role:a,...t}),r=i.value.findIndex(e=>e.id===s);if(r>=0&&i.value.splice(r,1,o),"purchaser"===o.role)await d();else{const e=n.value.findIndex(e=>e.id===s);e>=0&&(n.value.splice(e,1),delete l.value[s])}return o},removeUser:async e=>{await u(e),i.value=i.value.filter(s=>s.id!==e);const s=n.value.findIndex(s=>s.id===e);s>=0&&(n.value.splice(s,1),delete l.value[e])},changeUserPassword:async(s,a)=>{await(async(s,a)=>await e(`/permissions/users/${encodeURIComponent(s)}/password`,{method:"PUT",body:{password:a}}))(s,a)},changeUserEmail:async(s,a)=>{const n=await(async(s,a)=>{const i=await e(`/permissions/users/${encodeURIComponent(s)}`,{method:"PUT",body:{email:a}});return x(i)})(s,a),l=i.value.findIndex(e=>e.id===s);return l>=0&&i.value.splice(l,1,n),n},fetchBuyers:d,fetchBuyerAssignments:async s=>{const{data:a,meta:i}=await(async s=>{const a=await e(`/permissions/buyers/${encodeURIComponent(s)}/assignments`);return{data:x(a),meta:a&&"object"==typeof a&&"meta"in a?a.meta:void 0}})(s);l.value={...l.value,[s]:a};const t=n.value.find(e=>e.id===s);return t&&(t.assignmentCount=a.length,t.contractAlertCount=a.filter(e=>e.contractAlert).length,t.profileAccessCount=a.filter(e=>e.profileAccess).length,i?.buyerName&&!t.name&&(t.name=i.buyerName)),a},saveBuyerAssignments:async(s,a)=>{const i=a.map(e=>({supplierId:e.supplierId,contractAlert:e.contractAlert,profileAccess:e.profileAccess})),{data:t}=await(async(s,a)=>{const i=await e(`/permissions/buyers/${encodeURIComponent(s)}/assignments`,{method:"POST",body:{assignments:a}});return{data:x(i),meta:i&&"object"==typeof i&&"meta"in i?i.meta:void 0}})(s,i);l.value={...l.value,[s]:t};const o=n.value.find(e=>e.id===s);return o&&(o.assignmentCount=t.length,o.contractAlertCount=t.filter(e=>e.contractAlert).length,o.profileAccessCount=t.filter(e=>e.profileAccess).length),t},searchSuppliers:async e=>{const s=await z(e);return t.value=s,s},freezeUser:async(s,a)=>{await(async(s,a)=>await e(`/permissions/users/${encodeURIComponent(s)}/freeze`,{method:"POST",body:{reason:a}}))(s,a)},unfreezeUser:async s=>{await(async s=>await e(`/permissions/users/${encodeURIComponent(s)}/unfreeze`,{method:"POST"}))(s)},deleteUser:u}});const N={class:"admin-permissions"},V={class:"page-header"},$={class:"muted"},B={class:"header-actions"},E={class:"mode-toggle"},T={key:0,class:"panel-stack"},_={key:0,class:"panel"},O={class:"role-list"},j={class:"panel"},q={class:"section-header"},D={key:0,class:"muted"},K={class:"user-table"},L={class:"email-cell"},M=["onUpdate:modelValue","placeholder","disabled","onBlur","onKeydown"],J={class:"current-role"},Q={class:"role-cell"},W=["value","disabled","onChange"],G=["value"],H={key:0,class:"micro-text"},X={class:"actions-cell"},Y=["onClick","disabled"],Z=["disabled","onClick"],ee=["disabled","onClick"],se=["disabled","onClick"],ae={key:1,class:"panel delegations-panel"},ie={class:"section-header"},ne={class:"buyer-assignment"},le={class:"buyer-list"},te={key:0,class:"placeholder"},oe={key:1},re=["onClick"],de={class:"buyer-name"},ue={class:"buyer-meta"},ce={key:0,class:"assignment-detail"},me={class:"assignment-header"},pe={class:"muted"},ve=["disabled"],ye={class:"assignment-body"},fe={class:"current-assignments"},be={key:0,class:"muted"},ge={key:1,class:"assignment-list"},he={class:"assignment-info"},Pe={class:"muted"},we={class:"assignment-permissions"},Ue=["onUpdate:modelValue"],ke=["onUpdate:modelValue"],Ce=["onClick"],Ae={key:2,class:"placeholder"},Ie={class:"supplier-search"},Fe={class:"assign-by-tags-section"},Se={class:"tag-assign-controls"},xe=["value"],ze=["disabled"],Re={key:0,class:"micro-text",style:{"margin-top":"4px",color:"#6b7280"}},Ne={class:"search-controls"},Ve=["placeholder"],$e=["disabled"],Be={key:0,class:"search-results"},Ee={class:"muted"},Te=["onClick"],_e={key:1,class:"placeholder"},Oe={key:1,class:"assignment-placeholder"},je={key:2,class:"modal",open:""},qe={class:"modal-header"},De={class:"modal-body"},Ke=["value"],Le={class:"modal-footer"},Me=["disabled"],Je={key:3,class:"modal",open:""},Qe={class:"modal-header"},We={class:"modal-body"},Ge={class:"muted"},He=["placeholder"],Xe=["placeholder"],Ye={class:"modal-footer"},Ze=["disabled"],es={key:4,class:"modal",open:""},ss={class:"modal-header"},as={class:"modal-body"},is={class:"muted"},ns=["placeholder"],ls={class:"modal-footer"},ts=["disabled"],os={key:5,class:"modal",open:""},rs={class:"modal-header"},ds={class:"modal-body"},us={class:"muted"},cs={class:"warning-text"},ms={class:"modal-footer"},ps=["disabled"],vs=F(i({__name:"AdminPermissionsView",setup(s){const i=S(),F=new Set(["temp_supplier","formal_supplier","supplier"]),{t:x}=n(),z=R(),vs=l(),ys=t(),fs=a("internal"),bs=o(()=>z.roles),gs=o(()=>z.users),hs=o(()=>gs.value.filter(e=>!sa(e.role))),Ps=o(()=>bs.value.filter(e=>!F.has(e.role))),ws=o(()=>bs.value.filter(e=>!F.has(e.role))),Us=o(()=>z.buyers),ks=o(()=>ys.availableTags),Cs=a(null),As=o(()=>Us.value.find(e=>e.id===Cs.value)??null),Is=a([]),Fs=a(!1),Ss=a(!1),xs=a(!1),zs=a(""),Rs=a(!1),Ns=a(!1),Vs=a([]),$s=a([]),Bs=a(!1),Es=(e,s)=>e instanceof Error&&e.message?e.message:s,Ts=a(!1),_s=a(!1),Os=r({id:"",name:"",role:"",password:"",email:"",supplierId:""}),js=a(!1),qs=a(null),Ds=o(()=>null!==qs.value),Ks=a(null),Ls=r({password:"",confirmPassword:""}),Ms=a({}),Js=a(null),Qs=a(!1),Ws=a(null),Gs=a(""),Hs=a(null),Xs=a(null),Ys=a(!1),Zs=a(null),ea=a(null),sa=e=>F.has(e),aa=e=>null!=vs.user&&String(vs.user.id)===e.id,ia=e=>{if(sa(e.role)){const s=bs.value.find(s=>s.role===e.role);return s?[s]:[]}return ws.value},na=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,la=e=>x("adminPermissions.delegations.buyerStats",{suppliers:e.assignmentCount,profiles:e.profileAccessCount,alerts:e.contractAlertCount}),ta=async()=>{try{await Promise.all([z.fetchRoles(),z.fetchUsers(),z.fetchBuyers()]),"delegations"===fs.value&&Us.value.length>0&&!Cs.value&&(Cs.value=Us.value[0].id)}catch(e){console.error(x("adminPermissions.notifications.loadPermissionsFailure"),e),i.error(Es(e,x("adminPermissions.notifications.loadPermissionsFailure")))}},oa=()=>{Ts.value=!0,Os.id="",Os.name="",Os.role=ws.value[0]?.role??"purchaser",Os.password="",Os.email="",Os.supplierId=""},ra=()=>{Ts.value=!1},da=()=>{js.value=!1,Ks.value=null,Ls.password="",Ls.confirmPassword=""},ua=async()=>{if(Ks.value&&Ls.password)if(Ls.password===Ls.confirmPassword){qs.value=Ks.value.id;try{await z.changeUserPassword(Ks.value.id,Ls.password),i.success(x("adminPermissions.notifications.passwordResetSuccess")),da()}catch(e){console.error(x("adminPermissions.notifications.passwordResetFailure"),e),i.error(Es(e,x("adminPermissions.notifications.passwordResetFailure")))}finally{qs.value=null}}else i.warning(x("adminPermissions.validation.passwordMismatch"));else i.warning(x("adminPermissions.validation.passwordRequired"))},ca=async()=>{const e=Os.id.trim(),s=Os.password.trim(),a=Os.email.trim();if(e&&s)if(!a||na.test(a)){_s.value=!0;try{await z.createAccount({id:e,username:e,name:Os.name.trim(),role:Os.role,password:s,supplierId:Os.supplierId.trim()||void 0,email:a||void 0}),i.success(x("adminPermissions.notifications.userCreated")),ra(),await z.fetchUsers()}catch(n){console.error(x("adminPermissions.notifications.userCreateFailure"),n),i.error(Es(n,x("adminPermissions.notifications.userCreateFailure")))}finally{_s.value=!1}}else i.warning(x("adminPermissions.validation.invalidEmail"));else i.warning(x("adminPermissions.validation.credentialsRequired"))},ma=async e=>{const s=(Ms.value[e.id]??"").trim(),a=e.email??"";if(s!==a){if(s&&!na.test(s))return i.warning(x("adminPermissions.validation.invalidEmail")),void(Ms.value[e.id]=a);Js.value=e.id;try{await z.changeUserEmail(e.id,s||null),i.success(x("adminPermissions.notifications.emailUpdateSuccess"))}catch(n){console.error(x("adminPermissions.notifications.emailUpdateFailure"),n),i.error(Es(n,x("adminPermissions.notifications.emailUpdateFailure"))),Ms.value[e.id]=a}finally{Js.value=null}}},pa=()=>{Qs.value=!1,Ws.value=null,Gs.value=""},va=async()=>{if(Ws.value){Hs.value=Ws.value.id;try{await z.freezeUser(Ws.value.id,Gs.value.trim()||void 0),i.success(x("adminPermissions.notifications.userFrozen")),pa(),await z.fetchUsers()}catch(e){console.error(x("adminPermissions.notifications.userFreezeFailure"),e),i.error(Es(e,x("adminPermissions.notifications.userFreezeFailure")))}finally{Hs.value=null}}},ya=()=>{Ys.value=!1,Zs.value=null},fa=async()=>{if(Zs.value){ea.value=Zs.value.id;try{await z.deleteUser(Zs.value.id),i.success(x("adminPermissions.notifications.userDeleted")),ya(),await z.fetchUsers()}catch(e){console.error(x("adminPermissions.notifications.userDeleteFailure"),e),i.error(Es(e,x("adminPermissions.notifications.userDeleteFailure")))}finally{ea.value=null}}},ba=async()=>{try{await z.fetchBuyers(),!(Us.value.length>0)||Cs.value&&Us.value.some(e=>e.id===Cs.value)||(Cs.value=Us.value[0].id)}catch(e){console.error(x("adminPermissions.notifications.loadBuyersFailure"),e),i.error(Es(e,x("adminPermissions.notifications.loadBuyersFailure")))}},ga=e=>{Cs.value!==e&&(Cs.value=e)};d(()=>fs.value,e=>{"delegations"===e&&Us.value.length>0&&!Cs.value&&(Cs.value=Us.value[0].id)}),d(Us,e=>{0===e.length?(Cs.value=null,Is.value=[],xs.value=!1):Cs.value&&!e.some(e=>e.id===Cs.value)&&(Cs.value=e[0].id)},{immediate:!0}),d(gs,e=>{const s={...Ms.value};e.forEach(e=>{s[e.id]=e.email??""}),Object.keys(s).forEach(a=>{e.some(e=>e.id===a)||delete s[a]}),Ms.value=s},{immediate:!0}),d(Cs,async e=>{if(Is.value=[],xs.value=!1,Vs.value=[],Ns.value=!1,e){Fs.value=!0;try{const s=await z.fetchBuyerAssignments(e);Is.value=s.map(e=>({...e}))}catch(s){console.error(x("adminPermissions.notifications.loadAssignmentsFailure"),s),i.error(Es(s,x("adminPermissions.notifications.loadAssignmentsFailure")))}finally{Fs.value=!1}}});const ha=e=>Is.value.some(s=>s.supplierId===e),Pa=()=>{xs.value=!0},wa=async()=>{if(!Cs.value)return void i.warning(x("adminPermissions.notifications.selectBuyerFirst"));const e=zs.value.trim();Rs.value=!0,Ns.value=!0;try{const s=await z.searchSuppliers(e);Vs.value=s.filter(e=>!ha(e.id))}catch(s){console.error(x("adminPermissions.notifications.searchSuppliersFailure"),s),i.error(Es(s,x("adminPermissions.notifications.searchSuppliersFailure")))}finally{Rs.value=!1}},Ua=async()=>{if(Cs.value){Ss.value=!0;try{const e=await z.saveBuyerAssignments(Cs.value,Is.value);Is.value=e.map(e=>({...e})),xs.value=!1,i.success(x("adminPermissions.notifications.assignmentsUpdated"))}catch(e){console.error(x("adminPermissions.notifications.assignmentsUpdateFailure"),e),i.error(Es(e,x("adminPermissions.notifications.assignmentsUpdateFailure")))}finally{Ss.value=!1}}},ka=async()=>{if(Cs.value&&0!==$s.value.length){Bs.value=!0;try{const s=await async function(s){return e("/buyer-assignments/by-tag",{method:"POST",body:JSON.stringify(s)})}({buyerId:Cs.value,tagIds:$s.value});i.success(s.message||`æˆåŠŸåˆ†é… ${s.data.assignedCount} ä¸ªä¾›åº”å•†åˆ°é‡‡è´­å‘˜ ${As.value?.name}`),await ga(Cs.value),$s.value=[]}catch(s){console.error("Error assigning suppliers by tags:",s),i.error(Es(s,"æŒ‰æ ‡ç­¾åˆ†é…ä¾›åº”å•†å¤±è´¥"))}finally{Bs.value=!1}}};return u(async()=>{await Promise.all([ta(),ys.ensureTags()])}),(e,s)=>(I(),c("div",N,[m("header",V,[m("div",null,[m("h1",null,v(y(x)("adminPermissions.title")),1),m("p",$,v(y(x)("adminPermissions.subtitle")),1)]),m("div",B,[m("button",{class:"link-btn",type:"button",onClick:ta},v(y(x)("adminPermissions.actions.refresh")),1),m("button",{class:"primary-btn",type:"button",onClick:oa}," + "+v(y(x)("adminPermissions.actions.createUser")),1)])]),m("nav",E,[m("button",{type:"button",class:f({active:"internal"===fs.value}),onClick:s[0]||(s[0]=e=>fs.value="internal")},v(y(x)("adminPermissions.tabs.internal")),3),m("button",{type:"button",class:f({active:"delegations"===fs.value}),onClick:s[1]||(s[1]=e=>fs.value="delegations")},v(y(x)("adminPermissions.tabs.delegations")),3)]),"internal"===fs.value?(I(),c("section",T,[Ps.value.length?(I(),c("section",_,[m("h2",null,v(y(x)("adminPermissions.internal.availableRoles")),1),m("ul",O,[(I(!0),c(b,null,g(Ps.value,e=>(I(),c("li",{key:e.role},v(e.label)+" ("+v(e.role)+")",1))),128))])])):p("",!0),m("section",j,[m("div",q,[m("h2",null,v(y(x)("adminPermissions.internal.users")),1),y(z).loading?(I(),c("span",D,v(y(x)("adminPermissions.internal.loading")),1)):p("",!0)]),m("table",K,[m("thead",null,[m("tr",null,[m("th",null,v(y(x)("adminPermissions.internal.table.userId")),1),m("th",null,v(y(x)("adminPermissions.internal.table.name")),1),m("th",null,v(y(x)("adminPermissions.internal.table.email")),1),m("th",null,v(y(x)("adminPermissions.internal.table.status")),1),m("th",null,v(y(x)("adminPermissions.internal.table.role")),1),m("th",null,v(y(x)("adminPermissions.internal.table.changeRole")),1),m("th",null,v(y(x)("adminPermissions.internal.table.actions")),1)])]),m("tbody",null,[(I(!0),c(b,null,g(hs.value,e=>{return I(),c("tr",{key:e.id},[m("td",null,v(e.id),1),m("td",null,v(e.name||y(x)("common.userFallback")),1),m("td",L,[h(m("input",{"onUpdate:modelValue":s=>Ms.value[e.id]=s,type:"email",placeholder:y(x)("adminPermissions.internal.table.emailPlaceholder"),disabled:Js.value===e.id||"deleted"===e.status,onBlur:s=>ma(e),onKeydown:U(C(s=>ma(e),["prevent"]),["enter"])},null,40,M),[[w,Ms.value[e.id]]])]),m("td",null,[m("span",{class:f(["status-pill",`status-${e.status||"active"}`])},v((s=e.status,x(`adminPermissions.internal.status.${s??"active"}`))),3)]),m("td",J,v(e.role),1),m("td",Q,[m("select",{value:e.role,disabled:sa(e.role),onChange:s=>(async(e,s)=>{if(e.role!==s)if(sa(e.role))i.info(x("adminPermissions.notifications.supplierRoleManaged"));else if(F.has(s))i.warning(x("adminPermissions.notifications.supplierRoleNotAllowed"));else try{await z.changeUserRole(e.id,s,{actorId:vs.user?String(vs.user.id):void 0,actorName:vs.user?.name??void 0}),i.success(x("adminPermissions.notifications.roleUpdated"))}catch(a){console.error(x("adminPermissions.notifications.roleUpdateFailure"),a),i.error(Es(a,x("adminPermissions.notifications.roleUpdateFailure")))}})(e,s.target.value)},[(I(!0),c(b,null,g(ia(e),e=>(I(),c("option",{key:e.role,value:e.role},v(e.label),9,G))),128))],40,W),sa(e.role)?(I(),c("p",H,v(y(x)("adminPermissions.internal.managedAutomatically")),1)):p("",!0)]),m("td",X,[m("button",{class:"link-btn reset-password-btn",type:"button",onClick:s=>(e=>{Ks.value=e,js.value=!0,Ls.password="",Ls.confirmPassword=""})(e),disabled:qs.value===e.id||"deleted"===e.status},v(qs.value===e.id?y(x)("adminPermissions.actions.resetting"):y(x)("adminPermissions.actions.resetPassword")),9,Y),"frozen"!==e.status?(I(),c("button",{key:0,class:"link-btn",type:"button",disabled:"deleted"===e.status||aa(e),onClick:s=>(e=>{vs.user&&String(vs.user.id)===e.id?i.warning(x("adminPermissions.notifications.cannotFreezeSelf")):(Ws.value=e,Gs.value="",Qs.value=!0)})(e)},v(y(x)("adminPermissions.actions.freeze")),9,Z)):(I(),c("button",{key:1,class:"link-btn",type:"button",disabled:Xs.value===e.id,onClick:s=>(async e=>{Xs.value=e.id;try{await z.unfreezeUser(e.id),i.success(x("adminPermissions.notifications.userUnfrozen")),await z.fetchUsers()}catch(s){console.error(x("adminPermissions.notifications.userUnfreezeFailure"),s),i.error(Es(s,x("adminPermissions.notifications.userUnfreezeFailure")))}finally{Xs.value=null}})(e)},v(Xs.value===e.id?y(x)("adminPermissions.actions.unfreezing"):y(x)("adminPermissions.actions.unfreeze")),9,ee)),m("button",{class:"link-btn danger",type:"button",disabled:"deleted"===e.status||aa(e),onClick:s=>(e=>{vs.user&&String(vs.user.id)===e.id?i.warning(x("adminPermissions.notifications.cannotDeleteSelf")):(Zs.value=e,Ys.value=!0)})(e)},v(y(x)("adminPermissions.actions.delete")),9,se)])]);var s}),128))])])])])):(I(),c("section",ae,[m("div",ie,[m("h2",null,v(y(x)("adminPermissions.delegations.title")),1),m("button",{class:"link-btn",type:"button",onClick:ba},v(y(x)("adminPermissions.actions.reloadBuyers")),1)]),m("div",ne,[m("aside",le,[0===Us.value.length?(I(),c("p",te,v(y(x)("adminPermissions.delegations.noBuyers")),1)):(I(),c("ul",oe,[(I(!0),c(b,null,g(Us.value,e=>(I(),c("li",{key:e.id,class:f({active:e.id===Cs.value})},[m("button",{type:"button",onClick:s=>ga(e.id)},[m("span",de,v(e.name||e.id),1),m("span",ue,v(la(e)),1)],8,re)],2))),128))]))]),As.value?(I(),c("div",ce,[m("header",me,[m("div",null,[m("h3",null,v(As.value.name||As.value.id),1),m("p",pe,v(y(x)("adminPermissions.delegations.instructions")),1)]),m("button",{class:"primary-btn",type:"button",disabled:!xs.value||Ss.value,onClick:Ua},v(Ss.value?y(x)("adminPermissions.actions.saving"):y(x)("adminPermissions.actions.saveChanges")),9,ve)]),m("div",ye,[m("section",fe,[m("h4",null,v(y(x)("adminPermissions.delegations.responsibleSuppliers")),1),Fs.value?(I(),c("p",be,v(y(x)("adminPermissions.delegations.loadingAssignments")),1)):Is.value.length?(I(),c("ul",ge,[(I(!0),c(b,null,g(Is.value,e=>(I(),c("li",{key:e.supplierId},[m("div",he,[m("strong",null,v(e.companyName),1),m("span",Pe,"#"+v(e.companyId),1)]),m("div",we,[m("label",null,[h(m("input",{type:"checkbox","onUpdate:modelValue":s=>e.profileAccess=s,onChange:Pa},null,40,Ue),[[A,e.profileAccess]]),k(" "+v(y(x)("adminPermissions.delegations.profileAccess")),1)]),m("label",null,[h(m("input",{type:"checkbox","onUpdate:modelValue":s=>e.contractAlert=s,onChange:Pa},null,40,ke),[[A,e.contractAlert]]),k(" "+v(y(x)("adminPermissions.delegations.contractAlert")),1)])]),m("button",{class:"link-btn remove",type:"button",onClick:s=>{return a=e.supplierId,Is.value=Is.value.filter(e=>e.supplierId!==a),void(xs.value=!0);var a}},v(y(x)("adminPermissions.actions.remove")),9,Ce)]))),128))])):(I(),c("p",Ae,v(y(x)("adminPermissions.delegations.noAssignments")),1))]),m("section",Ie,[m("h4",null,v(y(x)("adminPermissions.delegations.addSuppliers")),1),m("div",Fe,[s[13]||(s[13]=m("h5",{style:{margin:"0 0 8px","font-size":"0.9rem",color:"#6b7280"}}," ðŸ“Œ æŒ‰æ ‡ç­¾æ‰¹é‡åˆ†é… ",-1)),m("div",Se,[h(m("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>$s.value=e),multiple:"",style:{flex:"1","min-width":"200px",padding:"8px",border:"1px solid #d1d5db","border-radius":"6px"}},[(I(!0),c(b,null,g(ks.value,e=>(I(),c("option",{key:e.id,value:e.id},v(e.name)+" ("+v(e.description||"æ— æè¿°")+") ",9,xe))),128))],512),[[P,$s.value]]),m("button",{class:"primary-btn",type:"button",disabled:0===$s.value.length||Bs.value,onClick:ka},v(Bs.value?"åˆ†é…ä¸­...":"æŒ‰æ ‡ç­¾åˆ†é…"),9,ze)]),$s.value.length>0?(I(),c("p",Re," å°†åˆ†é…æ‰€æœ‰åŒ…å«æ‰€é€‰æ ‡ç­¾çš„ä¾›åº”å•†åˆ°å½“å‰é‡‡è´­å‘˜ ")):p("",!0)]),s[14]||(s[14]=m("div",{style:{margin:"16px 0","border-top":"1px solid #e5e7eb"}},null,-1)),s[15]||(s[15]=m("h5",{style:{margin:"0 0 8px","font-size":"0.9rem",color:"#6b7280"}}," ðŸ” æœç´¢å•ä¸ªä¾›åº”å•† ",-1)),m("div",Ne,[h(m("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>zs.value=e),type:"text",placeholder:y(x)("adminPermissions.delegations.searchPlaceholder"),onKeyup:U(wa,["enter"])},null,40,Ve),[[w,zs.value,void 0,{trim:!0}]]),m("button",{class:"link-btn",type:"button",disabled:Rs.value,onClick:wa},v(Rs.value?y(x)("adminPermissions.actions.searching"):y(x)("adminPermissions.actions.search")),9,$e)]),Vs.value.length?(I(),c("ul",Be,[(I(!0),c(b,null,g(Vs.value,e=>(I(),c("li",{key:e.id},[m("div",null,[m("strong",null,v(e.companyName),1),m("span",Ee,"#"+v(e.supplierCode||e.companyId),1)]),m("button",{class:"primary-btn",type:"button",onClick:s=>(e=>{ha(e.id)||(Is.value.push({supplierId:e.id,companyName:e.companyName,companyId:e.companyId,contractAlert:!1,profileAccess:!1}),xs.value=!0,Vs.value=Vs.value.filter(s=>s.id!==e.id))})(e)},v(y(x)("adminPermissions.actions.add")),9,Te)]))),128))])):Ns.value?(I(),c("p",_e,v(y(x)("adminPermissions.delegations.noResults")),1)):p("",!0)])])])):(I(),c("div",Oe,v(y(x)("adminPermissions.delegations.selectPrompt")),1))])])),Ts.value?(I(),c("dialog",je,[m("form",{class:"modal-content",onSubmit:C(ca,["prevent"])},[m("header",qe,[m("h2",null,v(y(x)("adminPermissions.dialogs.createUser.title")),1),m("button",{class:"link-btn",type:"button",onClick:ra},v(y(x)("common.close")),1)]),m("section",De,[m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.userId"))+" ",1),h(m("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>Os.id=e),type:"text",required:""},null,512),[[w,Os.id,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.name"))+" ",1),h(m("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>Os.name=e),type:"text"},null,512),[[w,Os.name,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.role"))+" ",1),h(m("select",{"onUpdate:modelValue":s[6]||(s[6]=e=>Os.role=e)},[(I(!0),c(b,null,g(ws.value,e=>(I(),c("option",{key:e.role,value:e.role},v(e.label),9,Ke))),128))],512),[[P,Os.role]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.password"))+" ",1),h(m("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>Os.password=e),type:"password",minlength:"6",required:""},null,512),[[w,Os.password,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.email"))+" ",1),h(m("input",{"onUpdate:modelValue":s[8]||(s[8]=e=>Os.email=e),type:"email"},null,512),[[w,Os.email,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.supplierId"))+" ",1),h(m("input",{"onUpdate:modelValue":s[9]||(s[9]=e=>Os.supplierId=e),type:"text"},null,512),[[w,Os.supplierId,void 0,{trim:!0}]])])]),m("footer",Le,[m("button",{class:"link-btn",type:"button",onClick:ra},v(y(x)("common.cancel")),1),m("button",{class:"primary-btn",type:"submit",disabled:_s.value},v(_s.value?y(x)("adminPermissions.dialogs.createUser.submitting"):y(x)("adminPermissions.dialogs.createUser.submit")),9,Me)])],32)])):p("",!0),js.value?(I(),c("dialog",Je,[m("form",{class:"modal-content",onSubmit:C(ua,["prevent"])},[m("header",Qe,[m("h2",null,v(y(x)("adminPermissions.dialogs.resetPassword.title")),1),m("button",{class:"link-btn",type:"button",onClick:da},v(y(x)("common.close")),1)]),m("section",We,[m("p",Ge,[k(v(y(x)("adminPermissions.dialogs.resetPassword.description"))+" ",1),m("strong",null,v(Ks.value?.id??"")+" - "+v(Ks.value?.name||y(x)("common.userFallback")),1)]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.resetPassword.fields.password"))+" ",1),h(m("input",{"onUpdate:modelValue":s[10]||(s[10]=e=>Ls.password=e),type:"password",minlength:"6",required:"",placeholder:y(x)("adminPermissions.dialogs.resetPassword.fields.passwordPlaceholder")},null,8,He),[[w,Ls.password,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.resetPassword.fields.confirm"))+" ",1),h(m("input",{"onUpdate:modelValue":s[11]||(s[11]=e=>Ls.confirmPassword=e),type:"password",minlength:"6",required:"",placeholder:y(x)("adminPermissions.dialogs.resetPassword.fields.confirmPlaceholder")},null,8,Xe),[[w,Ls.confirmPassword,void 0,{trim:!0}]])])]),m("footer",Ye,[m("button",{class:"link-btn",type:"button",onClick:da},v(y(x)("common.cancel")),1),m("button",{class:"primary-btn",type:"submit",disabled:!Ls.password||Ls.password!==Ls.confirmPassword||Ds.value},v(Ds.value?y(x)("adminPermissions.dialogs.resetPassword.submitting"):y(x)("adminPermissions.dialogs.resetPassword.submit")),9,Ze)])],32)])):p("",!0),Qs.value?(I(),c("dialog",es,[m("form",{class:"modal-content",onSubmit:C(va,["prevent"])},[m("header",ss,[m("h2",null,v(y(x)("adminPermissions.dialogs.freezeUser.title")),1),m("button",{class:"link-btn",type:"button",onClick:pa},v(y(x)("common.close")),1)]),m("section",as,[m("p",is,v(y(x)("adminPermissions.dialogs.freezeUser.description")),1),m("p",null,[k(v(y(x)("adminPermissions.dialogs.freezeUser.userName"))+" ",1),m("strong",null,v(Ws.value?.name||Ws.value?.id||""),1)]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.freezeUser.fields.reason"))+" ",1),h(m("input",{"onUpdate:modelValue":s[12]||(s[12]=e=>Gs.value=e),type:"text",placeholder:y(x)("adminPermissions.dialogs.freezeUser.fields.reasonPlaceholder")},null,8,ns),[[w,Gs.value,void 0,{trim:!0}]])])]),m("footer",ls,[m("button",{class:"link-btn",type:"button",onClick:pa},v(y(x)("common.cancel")),1),m("button",{class:"primary-btn",type:"submit",disabled:null!==Hs.value},v(null!==Hs.value?y(x)("adminPermissions.dialogs.freezeUser.submitting"):y(x)("adminPermissions.dialogs.freezeUser.submit")),9,ts)])],32)])):p("",!0),Ys.value?(I(),c("dialog",os,[m("form",{class:"modal-content",onSubmit:C(fa,["prevent"])},[m("header",rs,[m("h2",null,v(y(x)("adminPermissions.dialogs.deleteUser.title")),1),m("button",{class:"link-btn",type:"button",onClick:ya},v(y(x)("common.close")),1)]),m("section",ds,[m("p",us,v(y(x)("adminPermissions.dialogs.deleteUser.description")),1),m("p",null,[k(v(y(x)("adminPermissions.dialogs.deleteUser.userName"))+" ",1),m("strong",null,v(Zs.value?.name||Zs.value?.id||""),1)]),m("p",cs,v(y(x)("adminPermissions.dialogs.deleteUser.warning")),1)]),m("footer",ms,[m("button",{class:"link-btn",type:"button",onClick:ya},v(y(x)("common.cancel")),1),m("button",{class:"primary-btn danger",type:"submit",disabled:null!==ea.value},v(null!==ea.value?y(x)("adminPermissions.dialogs.deleteUser.submitting"):y(x)("adminPermissions.dialogs.deleteUser.submit")),9,ps)])],32)])):p("",!0)]))}}),[["__scopeId","data-v-6d11464d"]]);export{vs as default};
