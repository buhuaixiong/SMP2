import{W as e,d as a,u as t,h as l,c as r,C as n,b as o,j as c,z as s,y as i,k as d,f as u,H as m,A as p,a9 as f,x as h,t as g,$ as v,e as y,m as x,aM as w,F as R,r as b,E as _,o as D,_ as j}from"./index-pXGOuPyW.js";import{v as F}from"./el-loading-qaXHuhL_.js";import{E as k,a as V}from"./el-form-item-BQx-7ROG.js";/* empty css                 */import{E}from"./el-input-number-POccNq1u.js";import{E as U}from"./el-divider-C-odEMcn.js";import{E as T}from"./el-date-picker-panel-Bp5XiXRk.js";import"./el-scrollbar-XGMKFkn3.js";import{E as C}from"./el-tag-DUHqafut.js";import{E as S,a as Y}from"./el-select-Bm1ili4m.js";import{E as M}from"./el-card-mgp-E3yV.js";import{E as H}from"./el-empty-BQaRn8m8.js";import{E as A,a as B}from"./el-table-column-C9wzL857.js";import{E as P}from"./el-alert-DpRzcqbY.js";import{P as z}from"./PageHeader-D4LHld_T.js";import{u as N}from"./useNotification-Ctg5lnsL.js";import"./castArray-Cn0w7dP5.js";import"./_baseClone-B7uvG2yV.js";import"./index-Zun_rBPZ.js";import"./dayjs.min-CuEfV50W.js";import"./debounce-DSkP6Bt8.js";const O={class:"exchange-rate-management"},W={class:"card-header"},L={class:"card-title"},$={class:"rate-value"},I={class:"formula"},K={class:"rate-value"},G={class:"formula"},J={class:"card-header"},q={class:"card-title"},Q={class:"form-help"},X={class:"rates-grid"},Z={class:"rate-preview"},ee=j(a({__name:"AdminExchangeRateManagementView",setup(a){const j=N(),{t:ee}=t(),ae=l(null),te=l([]),le=l([]),re=l(""),ne=l(!1),oe=l(!1),ce=l(!1),se=l(!1),ie=l({effectiveDate:(new Date).toISOString().split("T")[0],notes:"",rates:{CNY:.1388889,HKD:.1282051,EUR:1.0989011,USD:1,KRW:7576e-7,GBP:1.35,JPY:.0068376,THB:.0277778}}),de=r(()=>{if(!ae.value)return null;const e=ae.value.defaultYear,a=ae.value.rates[e];return a?Object.entries(a).map(([e,a])=>({currency:e,rate:a})):null}),ue=r(()=>{if(!ae.value)return!1;const e=new Date(ae.value.updatedAt),a=new Date;Math.floor((a.getTime()-e.getTime())/864e5),a.getMonth();const t=a.getMonth()>0||a.getDate()>=3,l=e.getFullYear()<a.getFullYear();return t&&l}),me=async()=>{ne.value=!0;try{ae.value=await async function(){return(await e("/exchange-rates")).data}();const a=ae.value.defaultYear;ae.value.rates[a]&&(ie.value.rates={...ae.value.rates[a]})}catch(a){j.error(ee("exchangeRate.loadConfigFailed")),console.error("Failed to load config:",a)}finally{ne.value=!1}},pe=async()=>{oe.value=!0;try{te.value=await async function(a,t){const l={};return a&&(l.currency=a),l.limit=t,(await e("/exchange-rates/history",{params:l})).data}(re.value,50)}catch(a){j.error(ee("exchangeRate.loadHistoryFailed")),console.error("Failed to load history:",a)}finally{oe.value=!1}},fe=async()=>{try{le.value=await async function(){return(await e("/exchange-rates/currencies")).data}()}catch(a){console.error("Failed to load currencies:",a)}},he=()=>{me(),pe()},ge=async()=>{try{await j.confirm(ee("exchangeRate.confirmUpdateMessage"),ee("exchangeRate.confirmUpdateTitle"),{confirmButtonText:ee("common.confirm"),cancelButtonText:ee("common.cancel"),type:"warning"}),se.value=!0,await async function(a){return await e("/exchange-rates",{method:"POST",body:a})}({rates:ie.value.rates,effectiveDate:ie.value.effectiveDate,notes:ie.value.notes}),j.success(ee("exchangeRate.updateSuccess")),ce.value=!1,await me(),await pe()}catch(a){"cancel"!==a&&(j.error(a.message||ee("exchangeRate.updateFailed")),console.error("Failed to update rates:",a))}finally{se.value=!1}},ve=async a=>{try{await j.confirm(ee("exchangeRate.confirmDeleteMessage"),ee("exchangeRate.confirmDeleteTitle"),{confirmButtonText:ee("common.delete"),cancelButtonText:ee("common.cancel"),type:"warning"}),await async function(a){await e(`/exchange-rates/${a}`,{method:"DELETE"})}(a.id),j.success(ee("exchangeRate.deleteSuccess")),await pe()}catch(t){"cancel"!==t&&(j.error(t.message||ee("exchangeRate.deleteFailed")),console.error("Failed to delete record:",t))}},ye=e=>e?new Date(e).toLocaleDateString():"-";return n(()=>{me(),pe(),fe()}),(e,a)=>{const t=p,l=P,r=C,n=A,j=B,N=H,me=M,fe=Y,xe=S,we=T,Re=V,be=_,_e=U,De=E,je=k,Fe=m,ke=F;return D(),o("div",O,[c(z,null,{title:d(()=>[h(g(u(ee)("exchangeRate.title")),1)]),actions:d(()=>[c(t,{type:"primary",icon:u(f),onClick:he},{default:d(()=>[h(g(u(ee)("exchangeRate.refreshRates")),1)]),_:1},8,["icon"]),c(t,{type:"success",icon:u(v),onClick:a[0]||(a[0]=e=>ce.value=!0)},{default:d(()=>[h(g(u(ee)("exchangeRate.updateRates")),1)]),_:1},8,["icon"])]),_:1}),ue.value?(D(),s(l,{key:0,title:u(ee)("exchangeRate.reminderTitle"),type:"warning",closable:!1,"show-icon":"",class:"reminder-alert"},{default:d(()=>[y("div",null,g(u(ee)("exchangeRate.reminderMessage")),1),c(t,{size:"small",type:"warning",onClick:a[1]||(a[1]=e=>ce.value=!0),style:{"margin-top":"8px"}},{default:d(()=>[h(g(u(ee)("exchangeRate.updateNow")),1)]),_:1})]),_:1},8,["title"])):i("",!0),c(me,{class:"current-rates-card",shadow:"never"},{header:d(()=>[y("div",W,[y("span",L,g(u(ee)("exchangeRate.currentRates")),1),ae.value?(D(),s(r,{key:0,type:"info"},{default:d(()=>[h(g(u(ee)("exchangeRate.lastUpdated"))+": "+g(ye(ae.value.updatedAt)),1)]),_:1})):i("",!0)])]),default:d(()=>[x((D(),o("div",null,[de.value?(D(),s(j,{key:0,data:de.value,border:"",style:{width:"100%"}},{default:d(()=>[c(n,{label:u(ee)("exchangeRate.currency"),prop:"currency",width:"120"},{default:d(({row:e})=>[c(r,null,{default:d(()=>[h(g(e.currency),1)]),_:2},1024)]),_:1},8,["label"]),c(n,{label:u(ee)("exchangeRate.rate"),prop:"rate",width:"180"},{default:d(({row:e})=>[y("span",$,g(e.rate.toFixed(7)),1)]),_:1},8,["label"]),c(n,{label:u(ee)("exchangeRate.rateFormula"),"min-width":"200"},{default:d(({row:e})=>[y("span",I,"1 "+g(e.currency)+" = "+g(e.rate.toFixed(7))+" USD",1)]),_:1},8,["label"]),c(n,{label:u(ee)("exchangeRate.inverseRate"),width:"180"},{default:d(({row:e})=>[y("span",K,g((1/e.rate).toFixed(2)),1)]),_:1},8,["label"]),c(n,{label:u(ee)("exchangeRate.inverseFormula"),"min-width":"200"},{default:d(({row:e})=>[y("span",G,"1 USD = "+g((1/e.rate).toFixed(4))+" "+g(e.currency),1)]),_:1},8,["label"])]),_:1},8,["data"])):(D(),s(N,{key:1,description:u(ee)("exchangeRate.noData")},null,8,["description"]))])),[[ke,ne.value]])]),_:1}),c(me,{class:"history-card",shadow:"never"},{header:d(()=>[y("div",J,[y("span",q,g(u(ee)("exchangeRate.history")),1),c(xe,{modelValue:re.value,"onUpdate:modelValue":a[2]||(a[2]=e=>re.value=e),placeholder:u(ee)("exchangeRate.selectCurrency"),clearable:"",onChange:pe,style:{width:"200px"}},{default:d(()=>[(D(!0),o(R,null,b(le.value,e=>(D(),s(fe,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])])]),default:d(()=>[x((D(),o("div",null,[c(j,{data:te.value,border:"",style:{width:"100%"}},{default:d(()=>[c(n,{label:u(ee)("exchangeRate.effectiveDate"),prop:"effective_date",width:"140"},{default:d(({row:e})=>[h(g(ye(e.effective_date)),1)]),_:1},8,["label"]),c(n,{label:u(ee)("exchangeRate.currency"),prop:"currency",width:"100"},{default:d(({row:e})=>[c(r,{size:"small"},{default:d(()=>[h(g(e.currency),1)]),_:2},1024)]),_:1},8,["label"]),c(n,{label:u(ee)("exchangeRate.rate"),prop:"rate",width:"150"},{default:d(({row:e})=>[h(g(e.rate.toFixed(7)),1)]),_:1},8,["label"]),c(n,{label:u(ee)("exchangeRate.source"),prop:"source",width:"100"},{default:d(({row:e})=>[c(r,{type:"manual"===e.source?"warning":"info",size:"small"},{default:d(()=>[h(g(e.source),1)]),_:2},1032,["type"])]),_:1},8,["label"]),c(n,{label:u(ee)("exchangeRate.notes"),prop:"notes","min-width":"200","show-overflow-tooltip":""},null,8,["label"]),c(n,{label:u(ee)("exchangeRate.createdAt"),prop:"created_at",width:"160"},{default:d(({row:e})=>{return[h(g((a=e.created_at,a?new Date(a).toLocaleString():"-")),1)];var a}),_:1},8,["label"]),c(n,{label:u(ee)("common.actions"),width:"100",fixed:"right"},{default:d(({row:e})=>[c(t,{type:"danger",size:"small",icon:u(w),onClick:a=>ve(e),link:""},{default:d(()=>[h(g(u(ee)("common.delete")),1)]),_:1},8,["icon","onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),0!==te.value.length||oe.value?i("",!0):(D(),s(N,{key:0,description:u(ee)("exchangeRate.noHistory")},null,8,["description"]))])),[[ke,oe.value]])]),_:1}),c(Fe,{modelValue:ce.value,"onUpdate:modelValue":a[6]||(a[6]=e=>ce.value=e),title:u(ee)("exchangeRate.updateDialogTitle"),width:"800px","close-on-click-modal":!1},{footer:d(()=>[c(t,{onClick:a[5]||(a[5]=e=>ce.value=!1)},{default:d(()=>[h(g(u(ee)("common.cancel")),1)]),_:1}),c(t,{type:"primary",onClick:ge,loading:se.value},{default:d(()=>[h(g(u(ee)("exchangeRate.confirmUpdate")),1)]),_:1},8,["loading"])]),default:d(()=>[c(je,{model:ie.value,"label-width":"140px"},{default:d(()=>[c(Re,{label:u(ee)("exchangeRate.effectiveDate")},{default:d(()=>[c(we,{modelValue:ie.value.effectiveDate,"onUpdate:modelValue":a[3]||(a[3]=e=>ie.value.effectiveDate=e),type:"date",placeholder:u(ee)("exchangeRate.selectDate"),"value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue","placeholder"]),y("div",Q,g(u(ee)("exchangeRate.effectiveDateHelp")),1)]),_:1},8,["label"]),c(Re,{label:u(ee)("exchangeRate.notes")},{default:d(()=>[c(be,{modelValue:ie.value.notes,"onUpdate:modelValue":a[4]||(a[4]=e=>ie.value.notes=e),type:"textarea",rows:2,placeholder:u(ee)("exchangeRate.notesPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),c(_e),y("div",X,[(D(!0),o(R,null,b(ie.value.rates,(e,a)=>(D(),o("div",{key:a,class:"rate-input-item"},[c(Re,{label:a},{default:d(()=>[c(De,{modelValue:ie.value.rates[a],"onUpdate:modelValue":e=>ie.value.rates[a]=e,precision:7,min:1e-7,step:1e-7,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"]),y("div",Z," 1 "+g(a)+" = "+g(ie.value.rates[a]?.toFixed(7)||0)+" USD ",1)]),_:2},1032,["label"])]))),128))]),c(l,{title:u(ee)("exchangeRate.updateWarning"),type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"16px"}},null,8,["title"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-f42fd20f"]]);export{ee as default};
