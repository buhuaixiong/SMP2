const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SupplierFileUploadDialog-V5otoqPc.js","assets/index-CyQdnTIC.js","assets/index-D5VxGV9f.css","assets/el-form-item-DJ87vTOW.js","assets/castArray-C2ko8TfK.js","assets/_baseClone-CxGxK45k.js","assets/el-form-item-BWkJzdQ_.css","assets/el-date-picker-panel-CmBAD9wS.js","assets/dayjs.min-CuEfV50W.js","assets/el-scrollbar-CTtrnhms.js","assets/el-scrollbar-BWxh-h6K.css","assets/index-CubmMpUU.js","assets/debounce-B4S_WZO2.js","assets/el-date-picker-panel-C-Zz6Fhi.css","assets/el-upload-wfA8ygZ8.js","assets/el-progress-D5jEkcdx.js","assets/el-progress-Dw9yTa91.css","assets/cloneDeep-B3nGyXfn.js","assets/el-upload-C68BVP5f.css","assets/el-alert-BXhB-eTB.js","assets/el-alert-G57rL0jl.css","assets/fileUploads-Do05fzJO.js","assets/useNotification-DAUqvaBw.js","assets/SupplierFileUploadDialog-B_u3bPDf.css","assets/el-input-D6B3r8CH.css","assets/FileUploadTimeline-ynU4nCQy.js","assets/el-timeline-item-CvFovLIE.js","assets/el-timeline-item-BvbJTz1y.css","assets/el-tag-eQgnjs1v.js","assets/el-tag-DljBBxJR.css","assets/FileUploadTimeline-CEm7kSRR.css"])))=>i.map(i=>d[i]);
import{d as e,g as a,h as l,c as t,C as s,b as i,j as r,e as o,z as d,y as u,k as n,f as p,G as c,H as f,J as v,A as m,x as _,O as y,a9 as g,aO as w,a0 as b,t as h,a1 as k,Z as j,V as x,m as T,ak as D,cH as E,cI as C,o as z,_ as I}from"./index-CyQdnTIC.js";import{v as H}from"./el-loading-oesi7HFc.js";import{E as S}from"./el-image-viewer-Ob_QgRYt.js";import{E as U}from"./el-divider-BEySWtZA.js";import{E as V,a as A}from"./el-descriptions-item-C3lsVx1m.js";import{E as F,a as W}from"./el-table-column-DvsfEAIW.js";import"./el-scrollbar-CTtrnhms.js";import{E as N}from"./el-tag-eQgnjs1v.js";import{E as P}from"./el-card-DJj_OhI8.js";import{P as L}from"./PageHeader-CMpTsfBB.js";import{d as O}from"./dayjs.min-CuEfV50W.js";import{g as Y,a as $}from"./fileUploads-Do05fzJO.js";import{r as q}from"./apiBaseUrl-Bx8aB0Mq.js";import{u as M}from"./useNotification-DAUqvaBw.js";import"./debounce-B4S_WZO2.js";import"./_baseClone-CxGxK45k.js";import"./castArray-C2ko8TfK.js";const R={class:"file-uploads-page"},B={class:"header-actions"},G={class:"stats-cards"},J={class:"stat-content"},Q={class:"stat-icon",style:{background:"#e6f7ff"}},Z={class:"stat-info"},K={class:"stat-value"},X={class:"stat-content"},ee={class:"stat-icon",style:{background:"#fff7e6"}},ae={class:"stat-info"},le={class:"stat-value"},te={class:"stat-content"},se={class:"stat-icon",style:{background:"#f6ffed"}},ie={class:"stat-info"},re={class:"stat-value"},oe={class:"stat-content"},de={class:"stat-icon",style:{background:"#fff1f0"}},ue={class:"stat-info"},ne={class:"stat-value"},pe={style:{display:"flex","align-items":"center",gap:"8px"}},ce={key:1,style:{color:"#909399"}},fe={key:0},ve={key:1},me={style:{display:"flex","align-items":"center",gap:"8px"}},_e={class:"file-preview-container"},ye={key:0,class:"pdf-preview"},ge=["src"],we={key:1,class:"image-preview"},be={class:"image-error"},he={key:2,class:"no-preview"},ke=I(e({__name:"SupplierFileUploadsView",setup(e){const I=M(),ke=c(()=>v(()=>import("./SupplierFileUploadDialog-V5otoqPc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),je=c(()=>v(()=>import("./FileUploadTimeline-ynU4nCQy.js"),__vite__mapDeps([25,1,2,26,27,28,29,8,30]))),xe=a(),Te=l(!1),De=l(!1),Ee=l(!1),Ce=l(!1),ze=l([]),Ie=l(null),He=t(()=>xe.user?.supplierId||0),Se=t(()=>ze.value.length),Ue=t(()=>ze.value.filter(e=>e.status.startsWith("pending_")).length),Ve=t(()=>ze.value.filter(e=>"approved"===e.status).length),Ae=t(()=>ze.value.filter(e=>"rejected"===e.status).length),Fe=e=>({pending_purchaser:"待采购员审批",pending_quality_manager:"待品质审批",pending_procurement_manager:"待采购经理审批",pending_procurement_director:"待采购总监审批",pending_finance_director:"待财务总监审批",approved:"已批准",rejected:"已拒绝"}[e]||e),We=e=>"approved"===e?"success":"rejected"===e?"danger":e.startsWith("pending_")?"warning":"info",Ne=(e,a)=>{if("approved"===a)return"已完成";if("rejected"===a)return"已终止";return{purchaser:"采购员审批",quality_manager:"品质审批",procurement_manager:"采购经理审批",procurement_director:"采购总监审批",finance_director:"财务总监审批"}[e]||e},Pe=e=>O(e).format("YYYY-MM-DD HH:mm"),Le=(e,a)=>{if("approved"!==a||!e)return"";const l=new Date;l.setHours(0,0,0,0);const t=new Date(e);t.setHours(0,0,0,0);const s=Math.ceil((t.getTime()-l.getTime())/864e5);return s<0?"color: #f56c6c; font-weight: bold;":s<=7?"color: #e6a23c; font-weight: bold;":s<=30?"color: #409eff;":""},Oe=async()=>{if(He.value){Te.value=!0;try{ze.value=await Y(He.value)}catch(e){console.error("Failed to fetch file uploads:",e),I.error(e?.message||"获取上传记录失败")}finally{Te.value=!1}}else I.warning("无法获取供应商信息")},Ye=()=>{Ee.value=!1,Oe()},$e=e=>{const a=localStorage.getItem("token"),l=q(`/api/files/download/${e}`);if(!a)return l;const t=l.includes("?")?"&":"?";return`${l}${t}token=${a}`},qe=e=>{if(!e)return!1;const a=e.toLowerCase();return a.endsWith(".jpg")||a.endsWith(".jpeg")||a.endsWith(".png")},Me=()=>{if(!Ie.value)return;const e=$e(Ie.value.id);window.open(e,"_blank")};return s(()=>{Oe()}),(e,a)=>{const l=y,t=m,s=P,c=F,v=N,O=W,Y=A,q=V,M=U,xe=S,Re=f,Be=H;return z(),i("div",R,[r(L,{title:"文件上传管理",subtitle:"上传文件并查看审批状态"},{actions:n(()=>[o("div",B,[r(t,{onClick:Oe},{default:n(()=>[r(l,null,{default:n(()=>[r(p(g))]),_:1}),a[3]||(a[3]=_(" 刷新 ",-1))]),_:1}),r(t,{type:"primary",onClick:a[0]||(a[0]=e=>Ee.value=!0)},{default:n(()=>[r(l,null,{default:n(()=>[r(p(w))]),_:1}),a[4]||(a[4]=_(" 上传文件 ",-1))]),_:1})])]),_:1}),o("div",G,[r(s,{class:"stat-card"},{default:n(()=>[o("div",J,[o("div",Q,[r(l,{size:24,color:"#1890ff"},{default:n(()=>[r(p(b))]),_:1})]),o("div",Z,[a[5]||(a[5]=o("p",{class:"stat-label"},"总上传数",-1)),o("p",K,h(Se.value),1)])])]),_:1}),r(s,{class:"stat-card"},{default:n(()=>[o("div",X,[o("div",ee,[r(l,{size:24,color:"#fa8c16"},{default:n(()=>[r(p(k))]),_:1})]),o("div",ae,[a[6]||(a[6]=o("p",{class:"stat-label"},"审批中",-1)),o("p",le,h(Ue.value),1)])])]),_:1}),r(s,{class:"stat-card"},{default:n(()=>[o("div",te,[o("div",se,[r(l,{size:24,color:"#52c41a"},{default:n(()=>[r(p(j))]),_:1})]),o("div",ie,[a[7]||(a[7]=o("p",{class:"stat-label"},"已批准",-1)),o("p",re,h(Ve.value),1)])])]),_:1}),r(s,{class:"stat-card"},{default:n(()=>[o("div",oe,[o("div",de,[r(l,{size:24,color:"#ff4d4f"},{default:n(()=>[r(p(x))]),_:1})]),o("div",ue,[a[8]||(a[8]=o("p",{class:"stat-label"},"已拒绝",-1)),o("p",ne,h(Ae.value),1)])])]),_:1})]),r(s,null,{header:n(()=>[...a[9]||(a[9]=[o("span",null,"上传记录",-1)])]),default:n(()=>[T((z(),d(O,{data:ze.value,stripe:"",style:{width:"100%"}},{default:n(()=>[r(c,{prop:"id",label:"ID",width:"80"}),r(c,{prop:"fileName",label:"文件名","min-width":"200"},{default:n(({row:e})=>[o("div",pe,[r(l,null,{default:n(()=>[r(p(b))]),_:1}),o("span",null,h(e.fileName||"未命名文件"),1)])]),_:1}),r(c,{prop:"fileDescription",label:"文件说明","min-width":"150"},{default:n(({row:e})=>[o("span",null,h(e.fileDescription||"—"),1)]),_:1}),r(c,{prop:"status",label:"状态",width:"130"},{default:n(({row:e})=>[r(v,{type:We(e.status)},{default:n(()=>[_(h(Fe(e.status)),1)]),_:2},1032,["type"])]),_:1}),r(c,{prop:"currentStep",label:"当前步骤",width:"130"},{default:n(({row:e})=>[_(h(Ne(e.currentStep,e.status)),1)]),_:1}),r(c,{prop:"validTo",label:"过期日期",width:"120"},{default:n(({row:e})=>[e.validTo?(z(),i("span",{key:0,style:D(Le(e.validTo,e.status))},h(e.validTo),5)):(z(),i("span",ce,"—"))]),_:1}),r(c,{prop:"submittedAt",label:"提交时间",width:"160"},{default:n(({row:e})=>[_(h(Pe(e.submittedAt)),1)]),_:1}),r(c,{label:"操作",width:"120",fixed:"right"},{default:n(({row:e})=>[r(t,{type:"primary",link:"",onClick:a=>(async e=>{De.value=!0,Ce.value=!0;try{Ie.value=await $(e)}catch(a){console.error("Failed to fetch upload details:",a),I.error(a?.message||"获取详情失败"),Ce.value=!1}finally{De.value=!1}})(e.id)},{default:n(()=>[...a[10]||(a[10]=[_(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Be,Te.value]])]),_:1}),Ee.value?(z(),d(p(ke),{key:0,visible:Ee.value,"onUpdate:visible":a[1]||(a[1]=e=>Ee.value=e),"supplier-id":He.value,onSuccess:Ye},null,8,["visible","supplier-id"])):u("",!0),r(Re,{modelValue:Ce.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Ce.value=e),title:"文件上传详情",width:"900px","destroy-on-close":!0},{default:n(()=>{return[Ie.value?T((z(),i("div",fe,[r(q,{column:2,border:""},{default:n(()=>[r(Y,{label:"文件ID"},{default:n(()=>[_(h(Ie.value.id),1)]),_:1}),r(Y,{label:"文件名"},{default:n(()=>[_(h(Ie.value.fileName||"未命名"),1)]),_:1}),r(Y,{label:"文件说明",span:2},{default:n(()=>[_(h(Ie.value.fileDescription||"—"),1)]),_:1}),r(Y,{label:"生效日期"},{default:n(()=>[_(h(Ie.value.validFrom||"—"),1)]),_:1}),r(Y,{label:"过期日期"},{default:n(()=>[Ie.value.validTo?(z(),i("span",{key:0,style:D(Le(Ie.value.validTo,Ie.value.status))},h(Ie.value.validTo),5)):(z(),i("span",ve,"—"))]),_:1}),r(Y,{label:"当前状态"},{default:n(()=>[r(v,{type:We(Ie.value.status)},{default:n(()=>[_(h(Fe(Ie.value.status)),1)]),_:1},8,["type"])]),_:1}),r(Y,{label:"提交时间"},{default:n(()=>[_(h(Pe(Ie.value.submittedAt)),1)]),_:1})]),_:1}),r(M,{"content-position":"left"},{default:n(()=>[o("span",me,[a[12]||(a[12]=_(" 文件预览 ",-1)),r(t,{type:"primary",size:"small",onClick:Me},{default:n(()=>[r(l,null,{default:n(()=>[r(p(E))]),_:1}),a[11]||(a[11]=_(" 下载文件 ",-1))]),_:1})])]),_:1}),o("div",_e,[(e=Ie.value.fileName,e&&e.toLowerCase().endsWith(".pdf")?(z(),i("div",ye,[o("iframe",{src:$e(Ie.value.id),style:{width:"100%",height:"600px",border:"1px solid #dcdfe6","border-radius":"4px"},frameborder:"0"},null,8,ge)])):qe(Ie.value.fileName)?(z(),i("div",we,[r(xe,{src:$e(Ie.value.id),"preview-src-list":[$e(Ie.value.id)],fit:"contain",style:{"max-width":"100%","max-height":"600px"}},{error:n(()=>[o("div",be,[r(l,{size:48},{default:n(()=>[r(p(C))]),_:1}),a[13]||(a[13]=o("p",null,"图片加载失败",-1))])]),_:1},8,["src","preview-src-list"])])):(z(),i("div",he,[r(l,{size:64,color:"#909399"},{default:n(()=>[r(p(b))]),_:1}),a[15]||(a[15]=o("p",{style:{"margin-top":"16px",color:"#606266"}}," 此文件类型不支持在线预览，请下载后查看 ",-1)),r(t,{type:"primary",onClick:Me,style:{"margin-top":"12px"}},{default:n(()=>[r(l,null,{default:n(()=>[r(p(E))]),_:1}),a[14]||(a[14]=_(" 下载文件 ",-1))]),_:1})])))]),r(M,{"content-position":"left"},{default:n(()=>[...a[16]||(a[16]=[_("审批进度",-1)])]),_:1}),r(p(je),{workflow:Ie.value.workflow,"current-step":Ie.value.currentStep,status:Ie.value.status,"approval-history":Ie.value.approvalHistory},null,8,["workflow","current-step","status","approval-history"])])),[[Be,De.value]]):u("",!0)];var e}),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-43e7aba5"]]);export{ke as default};
