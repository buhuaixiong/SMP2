import{W as e,aT as t}from"./index-laeMBjmD.js";t.replace(/\/api\/?$/,"");function a(e){if(!e)return e;const t={...e};return null!=e.limit&&(t.pageSize=e.limit,delete t.limit),t}function r(e,t){const a=e&&"object"==typeof e?e:{},r=a.page??t.page,o=a.limit??a.pageSize??t.limit,n=a.total??t.total,i=a.totalPages??a.pageCount??t.totalPages,s=Number.isFinite(Number(r))&&Number(r)>0?Number(r):t.page,l=Number.isFinite(Number(o))&&Number(o)>0?Number(o):t.limit,c=Number.isFinite(Number(n))&&Number(n)>=0?Number(n):t.total;let u=Number.isFinite(Number(i))&&Number(i)>=0?Number(i):t.totalPages;return!u&&c&&l&&(u=Math.ceil(c/l)),{page:s,limit:l,total:c,totalPages:u}}async function o(t){const o=await e("/rfq-workflow",{params:a(t)}),n={page:t?.page??1,limit:t?.limit??20,total:0,totalPages:0};if(!o)return{data:[],pagination:n};const i=(s=o.data)&&"object"==typeof s?s:null;var s;const l=Array.isArray(o.data)?o.data:null,c=i&&Array.isArray(i.data)?i.data:null,u=l??c;if(u){return{data:u,pagination:r(l?o.pagination:i?.pagination??o.pagination,n)}}return{data:[],pagination:r(o.pagination,n)}}async function n(t){return(await e(`/rfq-workflow/${t}`)).data}async function i(t){return(await e(`/rfq-workflow/supplier/${t}`)).data}async function s(t){return await e(`/rfq-workflow/${t}/publish`,{method:"POST"})}async function l(t,a){return await e(`/rfq-workflow/${t}/close`,{method:"POST",body:{reason:a}})}async function c(){return(await e("/rfq-workflow/supplier/invitations")).data??[]}async function u(t){return(await e("/rfq-workflow/create",{method:"POST",body:t})).data}async function f(t){return(await e(`/rfq-workflow/${t}`)).data}async function d(t){return await e(`/rfq-workflow/${t}/publish`,{method:"POST"})}async function m(t,a){return await e(`/rfq-workflow/${t}/select-quote`,{method:"POST",body:{selectedQuoteId:a}})}async function p(t){return await e(`/rfq-workflow/${t}/submit-review`,{method:"POST"})}async function w(t){return(await e(`/rfq-workflow/${t}/approvals`)).data}async function g(t,a,r){return await e(`/rfq-workflow/${t}/approvals/${a}/approve`,{method:"POST",body:r})}async function y(t,a,r){return await e(`/rfq-workflow/${t}/approvals/${a}/reject`,{method:"POST",body:r})}async function I(t,a,r){return await e(`/rfq-workflow/${t}/approvals/${a}/comments`,{method:"POST",body:r})}async function N(t,a,r){return await e(`/rfq-workflow/${t}/approvals/${a}/invite-purchasers`,{method:"POST",body:r})}async function S(e,a,r,o,n,i){const s=new FormData;s.append("screenshot",r),s.append("platform",function(e){return"zhenkunxing"===e?"zkh":e}(a)),s.append("platformPrice",String(o)),s.append("productUrl",n),i&&s.append("lineItemId",String(i));const l=await fetch(`${t}/rfq-workflow/${e}/price-comparison`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:s});if(!l.ok){const e=await l.json();throw new Error(e.message||"Failed to upload price comparison")}return l.json()}async function E(t,a){return await e(`/rfq-workflow/${t}/fill-pr`,{method:"POST",body:a})}async function b(t){return(await e("/rfq-workflow/import-excel",{method:"POST",body:t})).data}async function T(e,a,r){const o=localStorage.getItem("token"),n=await fetch(`${t}/rfq-workflow/${e}/generate-pr-excel`,{method:"POST",headers:{"Content-Type":"application/json",...o&&{Authorization:`Bearer ${o}`}},body:JSON.stringify({lineItemIds:a,...r})});if(!n.ok){let e={};try{const t=await n.json();e=t&&"object"==typeof t?t:{message:"Failed to generate PR Excel file"}}catch{e={message:"Failed to generate PR Excel file"}}const t=e.received??"N/A",a=e.fileSizeKB??"N/A",r=e.maxSizeKB??"N/A",o={INVALID_RFQ_ID:"无效的RFQ ID",INVALID_LINE_ITEMS:"No line items selected",INVALID_LINE_ITEM_IDS:"选择的明细项ID无效",TOO_MANY_LINE_ITEMS:"Too many line items (max 1000). Selected: "+String(t),RESOURCE_NOT_FOUND:"找不到指定的RFQ或明细项",NO_VALID_LINE_ITEMS:"所选明细项中没有已批准的报价，无法生成PR",INVALID_LINE_ITEM_STATUS:"存在状态不允许导出的行项目",MISSING_SELECTED_QUOTE:"Missing selected quote for some line items",TEMPLATE_ERROR:"Excel模板文件缺失或损坏，请联系系统管理员",INVALID_BUFFER:"生成的Excel文件无效",FILE_TOO_SMALL:"Generated file is too small ("+String(a)+" KB).",FILE_TOO_LARGE:"Generated file is too large ("+String(a)+" KB). Max "+String(r)+" KB",GENERATION_FAILED:"Failed to generate PR Excel file"},i="string"==typeof e.error?e.error:"GENERATION_FAILED",s="string"==typeof e.message?e.message:void 0,l=o[i]||s||"生成PR Excel失败",c=new Error(l);throw c.code=i,c.details=e.details,c.status=n.status,c}const i=n.headers.get("X-File-Size-KB"),s=n.headers.get("X-Generation-Time-Ms"),l=n.headers.get("X-Line-Item-Count");return i&&s&&console.log("[PR Excel] Generated successfully: "+i+" KB in "+s+"ms ("+l+" items)"),await n.blob()}async function h(t){return await e("/rfq/line-items/pending-approvals",{params:t})}export{h as a,i as b,u as c,f as d,w as e,o as f,p as g,s as h,b as i,l as j,N as k,c as l,I as m,g as n,E as o,d as p,T as q,y as r,m as s,n as t,S as u};
