import{d as e,g as a,u as l,h as s,c as r,b as t,j as i,e as p,y as m,f as u,t as n,F as o,r as d,x as c,q as y,aJ as S,S as b,o as I,_ as v}from"./index-BvBqerML.js";import{P as f}from"./PageHeader-B9bazl_i.js";import{u as h}from"./useNotification-kSmgsM5O.js";const k={class:"import-page"},g={class:"card upload-card"},w={class:"card-hint"},x={class:"field-list"},T={class:"field-name"},N={class:"field-note"},R={class:"upload-controls"},_={class:"upload-button"},F={class:"file-name"},C=["disabled"],$=["disabled"],P={class:"card-hint"},j={key:0,class:"card results-card"},A={class:"section-header"},q={class:"section-subtitle"},D={key:0,class:"timestamp"},E={class:"summary-grid"},H={class:"summary-item"},O={class:"summary-label"},V={class:"summary-value"},J={class:"summary-item"},L={class:"summary-label"},z={class:"summary-value success"},B={class:"summary-item"},G={class:"summary-label"},K={class:"summary-value"},M={class:"summary-item"},Q={class:"summary-label"},U={class:"summary-value"},W={class:"summary-item"},X={class:"summary-label"},Y={class:"summary-value warning"},Z={class:"summary-item"},ee={class:"summary-label"},ae={class:"summary-value"},le={class:"card-hint"},se={key:0,class:"table-block"},re={key:1,class:"table-block error-block"},te={class:"error-hint"},ie=v(e({name:"AdminSupplierImportView",__name:"AdminSupplierImportView",setup(e){const v=h(),ie=y(),pe=a(),{t:me}=l(),ue=s(null),ne=s(!1),oe=s(null),de=s([]),ce=s(null),ye=r(()=>[{key:"vendor_code",label:me("adminSupplierImport.fields.vendorCode.label"),note:me("adminSupplierImport.fields.vendorCode.note")},{key:"supplier_name",label:me("adminSupplierImport.fields.supplierName.label"),note:me("adminSupplierImport.fields.supplierName.note")},{key:"contact",label:me("adminSupplierImport.fields.contact.label"),note:me("adminSupplierImport.fields.contact.note")},{key:"phone",label:me("adminSupplierImport.fields.phone.label"),note:me("adminSupplierImport.fields.phone.note")},{key:"email",label:me("adminSupplierImport.fields.email.label"),note:me("adminSupplierImport.fields.email.note")},{key:"address",label:me("adminSupplierImport.fields.address.label"),note:me("adminSupplierImport.fields.address.note")},{key:"payment_term",label:me("adminSupplierImport.fields.paymentTerm.label"),note:me("adminSupplierImport.fields.paymentTerm.note")},{key:"currency",label:me("adminSupplierImport.fields.currency.label"),note:me("adminSupplierImport.fields.currency.note")},{key:"tax",label:me("adminSupplierImport.fields.tax.label"),note:me("adminSupplierImport.fields.tax.note")},{key:"fax",label:me("adminSupplierImport.fields.fax.label"),note:me("adminSupplierImport.fields.fax.note")}]),Se=r(()=>ue.value?.name??me("adminSupplierImport.upload.noFileSelected")),be=r(()=>{if(!ce.value)return"";const e=new Date(ce.value);return Number.isNaN(e.getTime())?ce.value:e.toLocaleString()}),Ie=()=>{oe.value=null,de.value=[],ce.value=null},ve=()=>{ue.value=null,Ie()},fe=e=>{const a=e.target,l=a.files?.[0]??null;ue.value=l,a.value="",l&&Ie()},he=async()=>{if(!("function"==typeof pe.getToken?pe.getToken():window.localStorage?.getItem("token")))return v.error(me("adminSupplierImport.notifications.sessionExpired")),void ie.push({name:"login",query:{redirect:ie.currentRoute.value.fullPath}});if(ue.value){ne.value=!0;try{const e=await S(ue.value);oe.value=e.summary,de.value=e.results,ce.value=(new Date).toISOString(),v.success(me("adminSupplierImport.notifications.importFinished",{count:e.summary.importedRows}))}catch(e){const a=me("adminSupplierImport.notifications.importFailed"),l=e instanceof Error&&e.message?e.message:a;v.error(l)}finally{ne.value=!1}}else v.warning(me("adminSupplierImport.notifications.noFile"))};return(e,a)=>(I(),t("div",k,[i(f,{title:u(me)("adminSupplierImport.title"),subtitle:u(me)("adminSupplierImport.subtitle")},null,8,["title","subtitle"]),p("section",g,[p("h2",null,n(u(me)("adminSupplierImport.upload.title")),1),p("p",w,n(u(me)("adminSupplierImport.upload.supportedFormats")),1),p("ul",x,[(I(!0),t(o,null,d(ye.value,e=>(I(),t("li",{key:e.key,class:"field-item"},[p("span",T,n(e.label),1),p("span",N,n(e.note),1)]))),128))]),p("div",R,[p("label",_,[p("input",{type:"file",accept:".xls,.xlsx",onChange:fe},null,32),c(" "+n(u(me)("adminSupplierImport.upload.selectFile")),1)]),p("span",F,n(Se.value),1),p("button",{type:"button",class:"primary-button",disabled:!ue.value||ne.value,onClick:he},n(ne.value?u(me)("adminSupplierImport.upload.importing"):u(me)("adminSupplierImport.upload.start")),9,C),ue.value?(I(),t("button",{key:0,type:"button",class:"secondary-button",disabled:ne.value,onClick:ve},n(u(me)("common.clear")),9,$)):m("",!0)]),p("p",P,n(u(me)("adminSupplierImport.upload.importNote")),1)]),oe.value?(I(),t("section",j,[p("header",A,[p("div",null,[p("h2",null,n(u(me)("adminSupplierImport.summary.title")),1),p("p",q,n(oe.value.sheetName||u(me)("adminSupplierImport.summary.untitledSheet")),1)]),be.value?(I(),t("span",D,n(u(me)("adminSupplierImport.summary.runAt",{time:be.value})),1)):m("",!0)]),p("div",E,[p("div",H,[p("span",O,n(u(me)("adminSupplierImport.summary.stats.rowsScanned")),1),p("span",V,n(oe.value.scannedRows),1)]),p("div",J,[p("span",L,n(u(me)("adminSupplierImport.summary.stats.imported")),1),p("span",z,n(oe.value.importedRows),1)]),p("div",B,[p("span",G,n(u(me)("adminSupplierImport.summary.stats.newSuppliers")),1),p("span",K,n(oe.value.created),1)]),p("div",M,[p("span",Q,n(u(me)("adminSupplierImport.summary.stats.updated")),1),p("span",U,n(oe.value.updated),1)]),p("div",W,[p("span",X,n(u(me)("adminSupplierImport.summary.stats.skipped")),1),p("span",Y,n(oe.value.skipped),1)]),p("div",Z,[p("span",ee,n(u(me)("adminSupplierImport.summary.stats.passwordsReset")),1),p("span",ae,n(oe.value.passwordResets),1)])]),p("p",le,n(u(me)("adminSupplierImport.summary.passwordHint")),1),de.value.length?(I(),t("div",se,[p("h3",null,n(u(me)("adminSupplierImport.summary.successTable.title")),1),p("table",null,[p("thead",null,[p("tr",null,[p("th",null,n(u(me)("adminSupplierImport.summary.successTable.headers.excelRow")),1),p("th",null,n(u(me)("adminSupplierImport.summary.successTable.headers.action")),1),p("th",null,n(u(me)("adminSupplierImport.summary.successTable.headers.supplierCode")),1),p("th",null,n(u(me)("adminSupplierImport.summary.successTable.headers.supplierName")),1),p("th",null,n(u(me)("adminSupplierImport.summary.successTable.headers.systemId")),1),p("th",null,n(u(me)("adminSupplierImport.summary.successTable.headers.defaultPassword")),1)])]),p("tbody",null,[(I(!0),t(o,null,d(de.value,e=>(I(),t("tr",{key:`${e.action}-${e.rowNumber}-${e.supplierId}`},[p("td",null,n(e.rowNumber),1),p("td",null,[p("span",{class:b(["tag","created"===e.action?"tag-success":"tag-info"])},n("created"===e.action?u(me)("adminSupplierImport.summary.successTable.tags.created"):u(me)("adminSupplierImport.summary.successTable.tags.updated")),3)]),p("td",null,n(e.companyId),1),p("td",null,n(e.companyName),1),p("td",null,"#"+n(e.supplierId),1),p("td",null,n(e.defaultPassword??"--"),1)]))),128))])])])):m("",!0),oe.value.errors.length?(I(),t("div",re,[p("h3",null,n(u(me)("adminSupplierImport.summary.errors.title")),1),p("table",null,[p("thead",null,[p("tr",null,[p("th",null,n(u(me)("adminSupplierImport.summary.errors.headers.excelRow")),1),p("th",null,n(u(me)("adminSupplierImport.summary.errors.headers.reason")),1)])]),p("tbody",null,[(I(!0),t(o,null,d(oe.value.errors,e=>(I(),t("tr",{key:`${e.row}-${e.message}`},[p("td",null,n(e.row),1),p("td",null,n(e.message),1)]))),128))])]),p("p",te,n(u(me)("adminSupplierImport.summary.errors.hint")),1)])):m("",!0)])):m("",!0)]))}}),[["__scopeId","data-v-81158975"]]);export{ie as default};
