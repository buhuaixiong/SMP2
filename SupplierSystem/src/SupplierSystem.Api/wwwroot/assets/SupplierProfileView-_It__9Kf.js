import{d as e,u as a,g as l,a6 as r,c as s,h as t,i as o,B as u,C as i,b as n,z as p,y as d,k as m,f as c,F as f,j as g,x as b,O as y,aY as _,t as v,A as P,e as V,r as C,E as h,q as k,o as q,_ as x}from"./index-CKlweL-F.js";import{E,a as N}from"./el-form-item-D41_-den.js";import{E as j}from"./el-tag-DywyWHs3.js";import{E as w,a as U}from"./el-select-79r3EY9c.js";import"./el-scrollbar-XGQhG3En.js";/* empty css                 */import{E as R,a as I}from"./el-col-CMloViux.js";import{E as A}from"./el-alert-CxZeCMr_.js";import{E as T}from"./el-card-DUR3b4zZ.js";import{E as S,a as F}from"./el-descriptions-item-CNREaimo.js";import{E as M}from"./el-empty-Dish35Ni.js";import{E as D}from"./el-skeleton-item-BiS6SAvu.js";import{P as z}from"./PageHeader-CwTM2NWC.js";import{u as O}from"./useNotification-Hc2hupuL.js";import"./castArray-rcXHEszK.js";import"./_baseClone-gXXhZHtw.js";const Y={class:"supplier-profile-view"},$={class:"card-header"},B={class:"completion"},H={class:"percent"},W={class:"hint"},G={key:1},J={key:1},K={class:"card-header"},L={class:"documents-summary"},Q={class:"card-header"},X=x(e({__name:"SupplierProfileView",setup(e){const x=O(),X=k(),{t:Z}=a(),ee=l(),ae=r(),le=s(()=>{const e=ee.user?.supplierId;if(null==e)return null;const a="number"==typeof e?e:Number(e);return Number.isFinite(a)?Math.trunc(a):null}),re=t(!1),se=t(!1),te=t(),oe=o({companyName:"",companyId:"",contactPerson:"",contactPhone:"",contactEmail:"",category:"",address:"",businessRegistrationNumber:"",region:"",bankAccount:"",paymentTerms:"",paymentCurrency:"",notes:""}),ue={companyName:[{required:!0,message:Z("common.required"),trigger:"blur"}],companyId:[{required:!0,message:Z("common.required"),trigger:"blur"}],contactPerson:[{required:!0,message:Z("common.required"),trigger:"blur"}],contactEmail:[{required:!0,message:Z("common.required"),trigger:"blur"}],contactPhone:[{required:!0,message:Z("common.required"),trigger:"blur"}],category:[{required:!0,message:Z("common.required"),trigger:"change"}],address:[{required:!0,message:Z("common.required"),trigger:"blur"}],businessRegistrationNumber:[{required:!0,message:Z("common.required"),trigger:"blur"}],region:[{required:!0,message:Z("common.required"),trigger:"blur"}],bankAccount:[{required:!0,message:Z("common.required"),trigger:"blur"}],paymentTerms:[{required:!0,message:Z("common.required"),trigger:"blur"}],paymentCurrency:[{required:!0,message:Z("common.required"),trigger:"blur"}]},ie=s(()=>ae.selectedSupplier??null),ne=s(()=>ie.value?.profileCompletion??0),pe=s(()=>ie.value?.documents?.length??0),de=s(()=>ie.value?.complianceSummary?.missingProfileFields??[]),me=s(()=>ie.value?.complianceSummary?.missingDocumentTypes??[]),ce=s(()=>{const e=ie.value?.status??"unknown",a=Z(`supplier.status.${e}`,e);return a===e?e:a}),fe=e=>{oe.companyName=e?.companyName??"",oe.companyId=e?.companyId??"",oe.contactPerson=e?.contactPerson??"",oe.contactPhone=e?.contactPhone??"",oe.contactEmail=e?.contactEmail??"",oe.category=e?.category??"",oe.address=e?.address??"",oe.businessRegistrationNumber=e?.businessRegistrationNumber??"",oe.region=e?.region??"",oe.bankAccount=e?.bankAccount??"",oe.paymentTerms=e?.paymentTerms??"",oe.paymentCurrency=e?.paymentCurrency??"",oe.notes=e?.notes??""};u(ie,e=>{fe(e)});const ge=async()=>{if(le.value){re.value=!0;try{await ae.selectSupplier(le.value)}catch(e){console.error("Failed to load supplier profile",e),x.error(Z("supplier.profilePage.loadError"))}finally{re.value=!1}}},be=async()=>{if(le.value&&te.value){try{await te.value.validate()}catch{return}se.value=!0;try{const e={...oe},a=await ae.updateSupplier(le.value,e);a&&"object"==typeof a&&("isChangeRequest"in a||"flow"in a)?x.success(Z("supplier.profilePage.formCard.changeRequestCreated")):x.success(Z("supplier.profilePage.formCard.updateSuccess")),await ge()}catch(e){console.error("Failed to submit profile update",e),x.error(Z("supplier.profilePage.formCard.submitError"))}finally{se.value=!1}}},ye=()=>{X.push("/supplier/file-uploads")},_e=()=>{X.back()};return i(()=>{fe(ie.value),ge()}),(e,a)=>{const l=y,r=P,s=D,t=M,o=j,u=F,i=S,k=T,x=I,O=A,X=R,ee=h,ae=N,le=U,fe=w,ge=E;return q(),n("div",Y,[re.value?d("",!0):(q(),p(z,{key:0,title:c(Z)("supplier.profilePage.title"),subtitle:c(Z)("supplier.profilePage.subtitle")},{actions:m(()=>[g(r,{link:"",class:"back-button",onClick:_e},{default:m(()=>[g(l,null,{default:m(()=>[g(c(_))]),_:1}),b(" "+v(c(Z)("common.back")),1)]),_:1})]),_:1},8,["title","subtitle"])),re.value?(q(),p(s,{key:1,rows:6,animated:""})):ie.value?(q(),n(f,{key:3},[g(X,{gutter:20,class:"summary-row"},{default:m(()=>[g(x,{xs:24,md:12},{default:m(()=>[g(k,{class:"summary-card"},{header:m(()=>[V("div",$,[V("span",null,v(c(Z)("supplier.profilePage.statusCard.title")),1)])]),default:m(()=>[g(i,{column:1,border:"",size:"small"},{default:m(()=>[g(u,{label:c(Z)("supplier.profilePage.statusCard.status")},{default:m(()=>[g(o,{type:"info"},{default:m(()=>[b(v(ce.value),1)]),_:1})]),_:1},8,["label"]),g(u,{label:"Compliance"},{default:m(()=>[V("div",B,[V("span",H,v(ne.value)+"%",1),V("span",W,v(c(Z)("supplier.profile.completion")),1)])]),_:1}),g(u,{label:c(Z)("supplier.profilePage.statusCard.missingFields")},{default:m(()=>[de.value.length?(q(!0),n(f,{key:0},C(de.value,e=>(q(),p(o,{key:e.key,type:"danger",class:"chip"},{default:m(()=>[b(v(e.label),1)]),_:2},1024))),128)):(q(),n("span",G,v(c(Z)("supplier.profilePage.statusCard.noMissingFields")),1))]),_:1},8,["label"]),g(u,{label:c(Z)("supplier.profilePage.statusCard.missingDocuments")},{default:m(()=>[me.value.length?(q(!0),n(f,{key:0},C(me.value,e=>(q(),p(o,{key:e.type,type:"warning",class:"chip"},{default:m(()=>[b(v(e.label),1)]),_:2},1024))),128)):(q(),n("span",J,v(c(Z)("supplier.profilePage.statusCard.noMissingDocuments")),1))]),_:1},8,["label"])]),_:1})]),_:1})]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(k,{class:"summary-card"},{header:m(()=>[V("div",K,[V("span",null,v(c(Z)("supplier.profilePage.documentsCard.title")),1)])]),default:m(()=>[V("div",L,[V("p",null,v(c(Z)("supplier.documents.title"))+": "+v(pe.value),1),me.value.length?(q(),p(O,{key:0,type:"warning",closable:!1,"show-icon":"",class:"alert"},{default:m(()=>[V("span",null,v(c(Z)("supplier.profilePage.documentsCard.uploadCta")),1)]),_:1})):d("",!0),g(r,{type:"primary",onClick:ye},{default:m(()=>[b(v(c(Z)("supplier.profilePage.documentsCard.uploadCta")),1)]),_:1})])]),_:1})]),_:1})]),_:1}),g(k,{class:"form-card"},{header:m(()=>[V("div",Q,[V("span",null,v(c(Z)("supplier.profilePage.formCard.title")),1),V("small",null,v(c(Z)("supplier.profilePage.formCard.description")),1)])]),default:m(()=>[g(ge,{ref_key:"formRef",ref:te,model:oe,rules:ue,"label-position":"top"},{default:m(()=>[g(X,{gutter:20},{default:m(()=>[g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"companyName",label:c(Z)("supplier.fields.companyName")},{default:m(()=>[g(ee,{modelValue:oe.companyName,"onUpdate:modelValue":a[0]||(a[0]=e=>oe.companyName=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"companyId",label:c(Z)("supplier.fields.companyId")},{default:m(()=>[g(ee,{modelValue:oe.companyId,"onUpdate:modelValue":a[1]||(a[1]=e=>oe.companyId=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"contactPerson",label:c(Z)("supplier.fields.contactPerson")},{default:m(()=>[g(ee,{modelValue:oe.contactPerson,"onUpdate:modelValue":a[2]||(a[2]=e=>oe.contactPerson=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"contactEmail",label:c(Z)("supplier.fields.contactEmail")},{default:m(()=>[g(ee,{modelValue:oe.contactEmail,"onUpdate:modelValue":a[3]||(a[3]=e=>oe.contactEmail=e),type:"email"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"contactPhone",label:c(Z)("supplier.fields.contactPhone")},{default:m(()=>[g(ee,{modelValue:oe.contactPhone,"onUpdate:modelValue":a[4]||(a[4]=e=>oe.contactPhone=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"category",label:c(Z)("supplier.fields.category")},{default:m(()=>[g(fe,{modelValue:oe.category,"onUpdate:modelValue":a[5]||(a[5]=e=>oe.category=e),filterable:"","allow-create":""},{default:m(()=>[g(le,{value:"Raw material",label:c(Z)("supplier.categories.rawMaterial")},null,8,["label"]),g(le,{value:"IT",label:c(Z)("supplier.categories.it")},null,8,["label"]),g(le,{value:"Services",label:c(Z)("supplier.categories.services")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"region",label:c(Z)("supplier.fields.region")},{default:m(()=>[g(ee,{modelValue:oe.region,"onUpdate:modelValue":a[6]||(a[6]=e=>oe.region=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"businessRegistrationNumber",label:c(Z)("supplier.fields.businessRegistrationNumber")},{default:m(()=>[g(ee,{modelValue:oe.businessRegistrationNumber,"onUpdate:modelValue":a[7]||(a[7]=e=>oe.businessRegistrationNumber=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24},{default:m(()=>[g(ae,{prop:"address",label:c(Z)("supplier.fields.address")},{default:m(()=>[g(ee,{modelValue:oe.address,"onUpdate:modelValue":a[8]||(a[8]=e=>oe.address=e),type:"textarea",rows:2},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"bankAccount",label:c(Z)("supplier.fields.bankAccount")},{default:m(()=>[g(ee,{modelValue:oe.bankAccount,"onUpdate:modelValue":a[9]||(a[9]=e=>oe.bankAccount=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"paymentTerms",label:c(Z)("supplier.fields.paymentTerms")},{default:m(()=>[g(ee,{modelValue:oe.paymentTerms,"onUpdate:modelValue":a[10]||(a[10]=e=>oe.paymentTerms=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24,md:12},{default:m(()=>[g(ae,{prop:"paymentCurrency",label:c(Z)("supplier.fields.paymentCurrency")},{default:m(()=>[g(ee,{modelValue:oe.paymentCurrency,"onUpdate:modelValue":a[11]||(a[11]=e=>oe.paymentCurrency=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),g(x,{xs:24},{default:m(()=>[g(ae,{prop:"notes",label:c(Z)("supplier.fields.notes")},{default:m(()=>[g(ee,{modelValue:oe.notes,"onUpdate:modelValue":a[12]||(a[12]=e=>oe.notes=e),type:"textarea",rows:3},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),g(ae,null,{default:m(()=>[g(r,{type:"primary",loading:se.value,onClick:be},{default:m(()=>[b(v(se.value?c(Z)("supplier.profilePage.formCard.submitting"):c(Z)("supplier.profilePage.formCard.submit")),1)]),_:1},8,["loading"]),g(r,{text:"",type:"primary",onClick:ye},{default:m(()=>[b(v(c(Z)("supplier.profilePage.documentsCard.uploadCta")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],64)):(q(),p(t,{key:2,description:c(Z)("supplier.profilePage.noSupplier"),class:"profile-empty"},null,8,["description"]))])}}}),[["__scopeId","data-v-9572ca39"]]);export{X as default};
