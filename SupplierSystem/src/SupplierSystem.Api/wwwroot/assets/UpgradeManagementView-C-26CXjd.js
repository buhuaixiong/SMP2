import{d as e,u as a,g as t,h as n,i as l,c as r,C as i,aU as o,m as d,b as s,j as u,z as p,y as m,k as c,f as g,s as f,e as _,x as y,t as v,A as w,O as h,aO as M,a4 as b,P as k,bO as T,er as j,es as Y,Z as D,cI as F,F as q,r as I,ad as x,di as C,a0 as S,o as A,bA as E,I as L,_ as N}from"./index-CIahGNSM.js";import{v as z}from"./el-loading-B2Pv1QcV.js";import{a as U,E as R}from"./el-timeline-item-DU0J8VTN.js";import{E as H}from"./el-link-DKYHmLK0.js";import{E as $,a as O}from"./el-form-item-Diw6FjT1.js";import{E as V}from"./el-upload-Bw3Ev16w.js";import{E as B}from"./el-progress-IznxY5TJ.js";import{E as P}from"./el-date-picker-panel-D-lo7_KL.js";/* empty css                 */import"./el-scrollbar-DpKGSGct.js";import{E as W}from"./el-tag-D115ydDz.js";import{E as K,a as J}from"./el-select-xx8n2tlP.js";import{a as X,E as Z}from"./el-table-column-DstKGFzw.js";import{E as G}from"./el-alert-TFaY92GP.js";import{E as Q}from"./el-card-DDLg7AOV.js";import{a as ee,E as ae}from"./el-step-mhbQ0Aha.js";import{g as te,r as ne,d as le}from"./dayjs.min-CuEfV50W.js";import{P as re}from"./PageHeader-CrotsIXA.js";import{f as ie,a as oe,u as de,s as se,d as ue}from"./upgrade-DWAs1Acn.js";import{r as pe}from"./apiBaseUrl-Bx8aB0Mq.js";import{o as me}from"./fileDownload-WwkwAfZk.js";import{u as ce}from"./useNotification-DBBxtp1r.js";import"./castArray-Dly3askU.js";import"./_baseClone-BsxWOYhZ.js";import"./cloneDeep-D30Czs1D.js";import"./index-DUvAcYhB.js";import"./debounce-Q66eG0bw.js";import"./index-BTYaYcWI.js";var ge,fe={exports:{}};const _e=te(ge?fe.exports:(ge=1,fe.exports=function(e,a,t){e=e||{};var n=a.prototype,l={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function r(e,a,t,l){return n.fromToBase(e,a,t,l)}t.en.relativeTime=l,n.fromToBase=function(a,n,r,i,o){for(var d,s,u,p=r.$locale().relativeTime||l,m=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],c=m.length,g=0;g<c;g+=1){var f=m[g];f.d&&(d=i?t(a).diff(r,f.d,!0):r.diff(a,f.d,!0));var _=(e.rounding||Math.round)(Math.abs(d));if(u=d>0,_<=f.r||!f.r){_<=1&&g>0&&(f=m[g-1]);var y=p[f.l];o&&(_=o(""+_)),s="string"==typeof y?y.replace("%d",_):y(_,n,f.l,u);break}}if(n)return s;var v=u?p.future:p.past;return"function"==typeof v?v(s):v.replace("%s",s)},n.to=function(e,a){return r(e,a,this,!0)},n.from=function(e,a){return r(e,a,this)};var i=function(e){return e.$u?t.utc():t()};n.toNow=function(e){return this.to(i(this),e)},n.fromNow=function(e){return this.from(i(this),e)}}));var ye,ve={exports:{}};ye||(ye=1,ve.exports=function(e){function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=a(e),n={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(e,a){return"W"===a?e+"周":e+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(e,a){var t=100*e+a;return t<600?"凌晨":t<900?"早上":t<1100?"上午":t<1300?"中午":t<1800?"下午":"晚上"}};return t.default.locale(n,null,!0),n}(ne()));const we={class:"upgrade-page"},he={class:"header-actions"},Me={key:0,class:"deadline-date"},be={class:"card-header-content"},ke={class:"progress-text"},Te={class:"document-types-section"},je={class:"doc-name-cell"},Ye={key:1,class:"text-muted"},De={key:1,class:"upload-section"},Fe={class:"select-option-content"},qe={class:"el-upload__tip"},Ie={key:2,class:"uploaded-documents-section"},xe={key:0},Ce={class:"timeline-item"},Se={class:"timeline-title"},Ae={key:0},Ee=N(e({__name:"UpgradeManagementView",setup(e){const E=ce();le.extend(_e),le.locale("zh-cn");const{t:N}=a();function te(e){const a=`upgradeManagement.status.${e}`,t=N(a);return t!==a?t:e}const ne={not_submitted:"info",under_review:"warning",pending_procurement_review:"warning",pending_quality_review:"warning",pending_procurement_manager_review:"warning",pending_procurement_director_review:"warning",pending_finance_director_review:"warning",returned:"danger",approved:"success",rejected:"danger"};function ge(e){const a=`upgradeManagement.steps.${e}`,t=N(a);return t!==a?t:e}const fe={pending:"warning",approved:"success",rejected:"danger",cancelled:"info"},ye=new Set(["not_submitted","returned","rejected"]),ve=new Set(["not_submitted","returned","rejected","pending_procurement_review","pending_quality_review","pending_procurement_manager_review","pending_procurement_director_review","pending_finance_director_review"]),Ee=f(),Le=t(),Ne=n(!1),ze=n(!1),Ue=n(null),Re=n(!1),He=l({}),$e=l({supplierId:null,status:"not_submitted",requirements:[],documents:[],workflow:null,reviews:[],fileApprovals:[],application:null}),Oe=n(!1),Ve=n(),Be=l({documentType:"",validFrom:null,validTo:null,file:null}),Pe=r(()=>$e.documents),We=r(()=>Be.documentType&&Be.validFrom&&Be.validTo&&Be.file),Ke=r(()=>te($e.status)),Je=r(()=>ne[$e.status]||"info"),Xe=r(()=>!!$e.supplierId),Ze=r(()=>Xe.value&&ye.has($e.status)),Ge=r(()=>Xe.value&&ve.has($e.status)),Qe=(r(()=>Xe.value?ve.has($e.status)?"":N("upgradeManagement.upload.statusNotEditable"):N("upgradeManagement.upload.noSupplier")),r(()=>$e.requirements.map(e=>{const a=$e.documents.find(a=>a.requirementCode===e.code)??null,t=a?.file??null,n=He[e.code],l=n?.fileId??t?.id??e.documentId??null,r=n?.fileName??t?.originalName??"",i=t?.validFrom?new Date(t.validFrom):null,o=t?.validTo?new Date(t.validTo):null;return{code:e.code,name:e.name,description:e.description,required:!!e.required,fulfilled:!!n||!!(e.fulfilled||a||e.documentId),templateUrl:e.template?.downloadUrl?pe(e.template.downloadUrl):null,fileId:l,fileName:r,fileUrl:l?oa(l):null,validFrom:i,validTo:o}}))),ea=r(()=>!Ze.value||Qe.value.every(e=>!e.fileId)),aa=r(()=>{const e=[];$e.application&&e.push({key:"application",source:"upgrade_application",title:N("upgradeManagement.workflow.supplierSubmitted"),statusLabel:te($e.application.status)||N("upgradeManagement.workflow.submitted"),actor:$e.application.submittedBy||"",time:ia($e.application.submittedAt),remark:$e.application.rejectionReason||"",tagType:ne[$e.application.status]||"info"}),$e.fileApprovals.forEach(a=>{const t=a.fileName?` - ${a.fileName}`:"";e.push({key:`file_approval_${a.id}`,source:a.source,title:`${a.stepName}${t}`,statusLabel:"approved"===a.decision?N("common.approved"):N("common.rejected"),actor:a.decidedByName||"",time:ia(a.decidedAt),remark:a.comments||"",tagType:"approved"===a.decision?"success":"danger"})});const a=new Map($e.reviews.map(e=>[e.stepKey,e]));return $e.workflow?.steps?.forEach(t=>{const n=a.get(t.key),l=n?.decision||t.status||"pending";e.push({key:t.key,source:n?.source||"upgrade_application",title:t.name,statusLabel:ge(l),actor:n?.decidedByName||t.permission||"",time:ia(n?.decidedAt||t.completedAt),remark:n?.comments||t.notes||"",tagType:fe[l]||fe.pending})}),e.sort((e,a)=>new Date(e.time||0).getTime()-new Date(a.time||0).getTime())}),ta=r(()=>"not_submitted"!==$e.status),na=r(()=>({not_submitted:0,pending_procurement_review:1,pending_quality_review:2,pending_procurement_manager_review:3,pending_procurement_director_review:4,pending_finance_director_review:5,approved:6,returned:0,rejected:0}[$e.status]??0)),la=r(()=>{if(!$e.application?.dueAt||"not_submitted"===$e.status||"approved"===$e.status)return null;const e=le(),a=le($e.application.dueAt).diff(e,"hour"),t=Math.ceil(a/24);return a<0?{title:N("upgradeManagement.deadline.overtime"),message:N("upgradeManagement.deadline.overtimeMessage",{days:Math.abs(t)}),type:"error"}:t<1?{title:N("upgradeManagement.deadline.lessThanOneDay"),message:N("upgradeManagement.deadline.lessThanOneDayMessage",{hours:a}),type:"error"}:t<2?{title:N("upgradeManagement.deadline.remaining",{days:t}),message:N("upgradeManagement.deadline.urgent"),type:"warning"}:{title:N("upgradeManagement.deadline.remaining",{days:t}),message:N("upgradeManagement.deadline.inProgress"),type:"info"}}),ra=r(()=>{const e=Qe.value.filter(e=>e.required).length;if(0===e)return 0;const a=Qe.value.filter(e=>e.required&&e.fulfilled).length;return Math.round(a/e*100)});function ia(e){return e?le(e).format("YYYY-MM-DD HH:mm"):""}function oa(e){return pe(`/api/files/download/${e}`)}function da(e){if(Array.isArray(e))return da(e[0]);if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e&&e.trim().length){const a=Number(e);return Number.isFinite(a)?a:null}return null}async function sa(){Ne.value=!0,Ue.value=null;const e=da(Ee.params.id)??da(Ee.query.supplierId)??da(Le.user?.supplierId)??$e.supplierId;if(!e)return await ua(N("upgradeManagement.warnings.noSupplierInfo")),void(Ne.value=!1);$e.supplierId=e,Object.keys(He).forEach(e=>Reflect.deleteProperty(He,e));try{const a=await ie(e);$e.status=a.status??a.application?.status??"not_submitted",$e.requirements=a.requirements??[],$e.documents=a.documents??[],$e.workflow=a.workflow??null,$e.reviews=a.reviews??[],$e.fileApprovals=a.fileApprovals??[],$e.application=a.application??null,$e.requirements.length||await ua()}catch(a){console.error(N("upgradeManagement.warnings.loadStatusFailed"),a),await ua(N("upgradeManagement.warnings.loadStatusFailed"))}finally{Ne.value=!1}}async function ua(e){try{const a=await oe();$e.status="not_submitted",Object.keys(He).forEach(e=>Reflect.deleteProperty(He,e)),$e.requirements=a??[],$e.documents=[],$e.workflow=null,$e.reviews=[],$e.application=null,e?Ue.value=e:$e.requirements.length||(Ue.value=N("upgradeManagement.warnings.noRequirements"))}catch(a){console.error(N("upgradeManagement.warnings.loadRequirementsFailed"),a),Ue.value=e||N("upgradeManagement.warnings.loadRequirementsFailed")}}async function pa(){if(!$e.supplierId)return E.error(N("upgradeManagement.warnings.noSupplierInfo")),!1;if($e.application)return!0;try{await se($e.supplierId)}catch(e){console.error(N("upgradeManagement.actions.submitFailed"),e)}return await sa(),!!$e.application||(E.error(N("upgradeManagement.actions.submitFailed")),!1)}function ma(e){if(!(e.size/1024/1024<20))return E.error(N("upgradeManagement.upload.fileSizeLimit")),!1;const a=e.name.toLowerCase(),t=[".pdf",".doc",".docx",".xls",".xlsx",".jpg",".jpeg",".png"];return!!t.some(e=>a.endsWith(e))||(E.error({message:N("upgradeManagement.upload.unsupportedFormat",{formats:t.join(", ")}),duration:5e3}),!1)}function ca(){}function ga(e){Be.file=e.raw}async function fa(){if(We.value&&$e.supplierId)try{if(Oe.value=!0,!(await pa()))return;await de({supplierId:$e.supplierId,requirementCode:Be.documentType,file:Be.file,status:"submitted",validFrom:le(Be.validFrom).format("YYYY-MM-DD"),validTo:le(Be.validTo).format("YYYY-MM-DD")});E.success(N("upgradeManagement.upload.uploadSuccess")),await sa(),_a()}catch(e){console.error("Upload failed:",e),E.error(e.message||N("upgradeManagement.upload.uploadFailed"))}finally{Oe.value=!1}else E.warning(N("upgradeManagement.upload.pleaseCompleteForm"))}function _a(){Be.documentType="",Be.validFrom=null,Be.validTo=null,Be.file=null,Ve.value&&Ve.value.clearFiles()}async function ya(e){if(e)try{let a=e;e.startsWith("http")||(a=pe(e));const t=localStorage.getItem("token"),n={};t&&(n.Authorization=`Bearer ${t}`);const l=await fetch(a,{headers:n});if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);const r=await l.blob();if(0===r.size)throw new Error("Downloaded file is empty");let i="template";const o=l.headers.get("Content-Disposition");if(o){const e=o.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(i=e[1].replace(/['"]/g,""))}else{const e=a.split("/");i=e[e.length-1]}if(!(await(async()=>!(!Re.value||"undefined"==typeof document||"undefined"==typeof window||(await L(),0)))()))return;const d=window.URL.createObjectURL(r),s=document.createElement("a");s.href=d,s.download=decodeURIComponent(i),s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(d)},100),E.success(N("upgradeManagement.upload.downloadStarted"))}catch(a){console.error("[Template Download] Error:",a),E.error(N("upgradeManagement.upload.downloadFailed"))}else E.warning(N("upgradeManagement.notifications.templateNotProvided"))}function va(e){e?me(e).then(()=>{E.success(N("upgradeManagement.preview.downloadStarted"))}).catch(e=>{E.error(e?.message||N("upgradeManagement.upload.downloadFailed"))}):E.warning(N("upgradeManagement.preview.noContent"))}function wa(e){return e.getTime()<Date.now()-864e5}function ha(e,a){if(a.validFrom){const t=new Date(a.validFrom).getTime();return e.getTime()<=t}return e.getTime()<Date.now()-864e5}async function Ma(){if(!$e.supplierId)return void E.error(N("upgradeManagement.warnings.noSupplierInfo"));const e=Qe.value.filter(e=>e.fileId),a=Qe.value.filter(e=>e.required&&!e.fileId);if(a.length){const e=a.map(e=>e.name).join("、");E.info(N("upgradeManagement.actions.missingDocumentsWarning",{names:e}))}try{await E.confirm(N("upgradeManagement.actions.confirmSubmit"),N("upgradeManagement.actions.hint"),{type:"warning",confirmButtonText:N("upgradeManagement.actions.submit"),cancelButtonText:N("upgradeManagement.actions.cancel")})}catch{return}ze.value=!0;try{const a=e.map(e=>({requirementCode:e.code,fileId:e.fileId})),t=a.length?{documents:a}:{};await se($e.supplierId,t),E.success(N("upgradeManagement.actions.applicationSubmitted")),await sa()}catch(t){console.error(N("upgradeManagement.actions.submitFailed"),t),E.error(N("upgradeManagement.actions.submitFailed"))}finally{ze.value=!1}}function ba(){sa()}function ka(e){const a=$e.workflow?.steps?.find(a=>a.key===e);return a?ge(a.status):""}let Ta=null;return i(()=>{Re.value=!0,sa().then(()=>{$e.status&&"not_submitted"!==$e.status&&"approved"!==$e.status&&"returned"!==$e.status&&(Ta=setInterval(()=>{sa()},3e4))})}),o(()=>{Re.value=!1,Ta&&(clearInterval(Ta),Ta=null)}),(e,a)=>{const t=W,n=w,l=h,r=ee,i=ae,o=Q,f=G,L=B,te=Z,ne=X,le=J,ie=K,oe=O,de=P,se=V,pe=$,me=H,ce=U,ge=R,fe=z;return d((A(),s("div",we,[u(re,{title:g(N)("upgradeManagement.title"),subtitle:g(N)("upgradeManagement.subtitle")},{actions:c(()=>[_("div",he,[Ke.value?(A(),p(t,{key:0,type:Je.value},{default:c(()=>[y(v(Ke.value),1)]),_:1},8,["type"])):m("",!0),u(n,{size:"small",onClick:ba},{default:c(()=>[y(v(g(N)("upgradeManagement.refresh")),1)]),_:1}),Ze.value?(A(),p(n,{key:1,size:"small",type:"primary",loading:ze.value,disabled:ea.value,onClick:Ma},{default:c(()=>[y(v(g(N)("upgradeManagement.submitApplication")),1)]),_:1},8,["loading","disabled"])):m("",!0)])]),_:1},8,["title","subtitle"]),ta.value?(A(),p(o,{key:0,class:"progress-card",shadow:"never"},{default:c(()=>[u(i,{active:na.value,"finish-status":"success","align-center":""},{default:c(()=>[u(r,{title:g(N)("upgradeManagement.steps.submitApplication"),description:g(N)("upgradeManagement.steps.uploadFiles")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(M))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(N)("upgradeManagement.steps.purchaserReview"),description:ka("procurement_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(b))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(N)("upgradeManagement.steps.qualityReview"),description:ka("quality_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(k))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(N)("upgradeManagement.steps.procurementManagerReview"),description:ka("procurement_manager_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(T))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(N)("upgradeManagement.steps.procurementDirectorReview"),description:ka("procurement_director_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(j))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(N)("upgradeManagement.steps.financeDirectorReview"),description:ka("finance_director_review")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(Y))]),_:1})]),_:1},8,["title","description"]),u(r,{title:g(N)("upgradeManagement.steps.complete"),description:g(N)("upgradeManagement.steps.upgradeToFormal")},{icon:c(()=>[u(l,null,{default:c(()=>[u(g(D))]),_:1})]),_:1},8,["title","description"])]),_:1},8,["active"])]),_:1})):m("",!0),la.value?(A(),p(f,{key:1,title:la.value.title,type:la.value.type,closable:!1,"show-icon":"",class:"deadline-alert"},{default:c(()=>[_("p",null,v(la.value.message),1),$e.application?.dueAt?(A(),s("p",Me,v(g(N)("upgradeManagement.deadline.expectedCompletion"))+": "+v(ia($e.application.dueAt)),1)):m("",!0)]),_:1},8,["title","type"])):m("",!0),u(o,{class:"info-card",shadow:"never"},{header:c(()=>[_("span",null,v(g(N)("upgradeManagement.requirements.title")),1)]),default:c(()=>[u(f,{title:g(N)("upgradeManagement.requirements.description"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),Ue.value?(A(),p(f,{key:0,title:Ue.value,type:"warning",closable:!1,"show-icon":"",class:"mt-12"},null,8,["title"])):m("",!0)]),_:1}),u(o,{class:"upload-card",shadow:"never"},{header:c(()=>[_("div",be,[_("span",null,v(g(N)("upgradeManagement.upload.title")),1),ra.value<100?(A(),p(L,{key:0,percentage:ra.value,"stroke-width":8,color:100===ra.value?"#67c23a":"#409eff"},{default:c(({percentage:e})=>[_("span",ke,v(e)+"%",1)]),_:1},8,["percentage","color"])):(A(),p(t,{key:1,type:"success"},{default:c(()=>[u(l,null,{default:c(()=>[u(g(C))]),_:1}),y(" "+v(g(N)("upgradeManagement.requirements.completed")),1)]),_:1}))])]),default:c(()=>[Xe.value?m("",!0):(A(),p(f,{key:0,type:"warning","show-icon":"",closable:!1,title:g(N)("upgradeManagement.upload.noSupplier"),class:"mb-20"},null,8,["title"])),_("div",Te,[_("h3",null,v(g(N)("upgradeManagement.documentTypes.title")),1),u(ne,{data:Qe.value,border:"",stripe:""},{default:c(()=>[u(te,{type:"index",width:"50"}),u(te,{label:g(N)("upgradeManagement.documentTypes.name"),prop:"name","min-width":"200"},{default:c(({row:e})=>[_("div",je,[_("span",null,v(e.name),1),e.required?(A(),p(t,{key:0,type:"danger",size:"small",class:"ml-2"},{default:c(()=>[y(v(g(N)("upgradeManagement.upload.required")),1)]),_:1})):m("",!0)])]),_:1},8,["label"]),u(te,{label:g(N)("upgradeManagement.documentTypes.description"),prop:"description","min-width":"250"},null,8,["label"]),u(te,{label:g(N)("upgradeManagement.documentTypes.status"),width:"120",align:"center"},{default:c(({row:e})=>[e.fulfilled?(A(),p(t,{key:0,type:"success",size:"small"},{default:c(()=>[u(l,null,{default:c(()=>[u(g(k))]),_:1}),y(" "+v(g(N)("upgradeManagement.upload.uploaded")),1)]),_:1})):(A(),p(t,{key:1,type:"info",size:"small"},{default:c(()=>[y(v(g(N)("upgradeManagement.upload.notUploaded")),1)]),_:1}))]),_:1},8,["label"]),u(te,{label:g(N)("upgradeManagement.documentTypes.template"),width:"150",align:"center"},{default:c(({row:e})=>[e.templateUrl?(A(),p(n,{key:0,size:"small",type:"primary",link:"",onClick:a=>ya(e.templateUrl)},{default:c(()=>[u(l,null,{default:c(()=>[u(g(F))]),_:1}),y(" "+v(g(N)("common.download")),1)]),_:1},8,["onClick"])):(A(),s("span",Ye,v(g(N)("upgradeManagement.upload.noTemplate")),1))]),_:1},8,["label"])]),_:1},8,["data"])]),Ge.value?(A(),s("div",De,[_("h3",null,v(g(N)("upgradeManagement.upload.title")),1),u(pe,{model:Be,"label-width":"140px"},{default:c(()=>[u(oe,{label:g(N)("upgradeManagement.upload.documentType"),required:""},{default:c(()=>[u(ie,{modelValue:Be.documentType,"onUpdate:modelValue":a[0]||(a[0]=e=>Be.documentType=e),placeholder:g(N)("upgradeManagement.upload.selectDocumentType"),style:{width:"100%"},onChange:ca},{default:c(()=>[(A(!0),s(q,null,I(Qe.value,e=>(A(),p(le,{key:e.code,label:e.name,value:e.code},{default:c(()=>[_("div",Fe,[_("span",null,v(e.name),1),e.required?(A(),p(t,{key:0,type:"danger",size:"small"},{default:c(()=>[y(v(g(N)("upgradeManagement.upload.required")),1)]),_:1})):m("",!0),e.fulfilled?(A(),p(t,{key:1,type:"success",size:"small"},{default:c(()=>[y(v(g(N)("upgradeManagement.upload.uploaded")),1)]),_:1})):m("",!0)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(oe,{label:g(N)("upgradeManagement.upload.validFrom"),required:""},{default:c(()=>[u(de,{modelValue:Be.validFrom,"onUpdate:modelValue":a[1]||(a[1]=e=>Be.validFrom=e),type:"date",placeholder:g(N)("upgradeManagement.upload.selectDate"),"disabled-date":wa,style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(oe,{label:g(N)("upgradeManagement.upload.validTo"),required:""},{default:c(()=>[u(de,{modelValue:Be.validTo,"onUpdate:modelValue":a[2]||(a[2]=e=>Be.validTo=e),type:"date",placeholder:g(N)("upgradeManagement.upload.selectDate"),"disabled-date":e=>ha(e,Be),style:{width:"100%"}},null,8,["modelValue","placeholder","disabled-date"])]),_:1},8,["label"]),u(oe,{label:g(N)("upgradeManagement.upload.file"),required:""},{default:c(()=>[u(se,{ref_key:"uploadRef",ref:Ve,class:"upload-demo","auto-upload":!1,limit:1,"on-change":ga,"before-upload":ma,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"},{trigger:c(()=>[u(n,{type:"primary"},{default:c(()=>[u(l,null,{default:c(()=>[u(g(M))]),_:1}),y(" "+v(g(N)("upgradeManagement.upload.chooseFile")),1)]),_:1})]),tip:c(()=>[_("div",qe,v(g(N)("upgradeManagement.upload.fileTypeHint")),1)]),_:1},512)]),_:1},8,["label"]),u(oe,null,{default:c(()=>[u(n,{type:"primary",loading:Oe.value,disabled:!We.value,onClick:fa},{default:c(()=>[u(l,null,{default:c(()=>[u(g(x))]),_:1}),y(" "+v(g(N)("upgradeManagement.upload.uploadFile")),1)]),_:1},8,["loading","disabled"]),u(n,{onClick:_a},{default:c(()=>[y(v(g(N)("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])])):m("",!0),Pe.value.length?(A(),s("div",Ie,[_("h3",null,v(g(N)("upgradeManagement.upload.uploadedDocuments")),1),u(ne,{data:Pe.value,border:"",stripe:""},{default:c(()=>[u(te,{type:"index",width:"50"}),u(te,{label:g(N)("upgradeManagement.documentTypes.type"),prop:"requirementName","min-width":"180"},null,8,["label"]),u(te,{label:g(N)("upgradeManagement.documentTypes.fileName"),"min-width":"200"},{default:c(({row:e})=>[e.file?(A(),p(me,{key:0,type:"primary",onClick:a=>va(oa(e.file.id))},{default:c(()=>[y(v(e.file.originalName),1)]),_:2},1032,["onClick"])):m("",!0)]),_:1},8,["label"]),u(te,{label:g(N)("upgradeManagement.documentTypes.validityPeriod"),width:"220"},{default:c(({row:e})=>[e.file&&e.file.validFrom&&e.file.validTo?(A(),s("span",xe,v(ia(e.file.validFrom))+" ~ "+v(ia(e.file.validTo)),1)):m("",!0)]),_:1},8,["label"]),u(te,{label:g(N)("upgradeManagement.documentTypes.uploadedAt"),width:"180"},{default:c(({row:e})=>[y(v(e.file?ia(e.file.uploadTime):"-"),1)]),_:1},8,["label"]),u(te,{label:g(N)("common.actions"),width:"120",align:"center"},{default:c(({row:e})=>[Ge.value&&e.file?(A(),p(n,{key:0,size:"small",type:"danger",link:"",onClick:a=>async function(e){await E.confirm(N("upgradeManagement.upload.confirmDelete"),N("common.confirm"),{type:"warning"});try{if(!$e.supplierId)return void E.error(N("upgradeManagement.upload.noSupplier"));await ue($e.supplierId,e.id),E.success(N("common.operationSuccess")),await sa()}catch(a){E.error(a.message||N("common.operationFailed"))}}(e)},{default:c(()=>[y(v(g(N)("common.delete")),1)]),_:1},8,["onClick"])):m("",!0)]),_:1},8,["label"])]),_:1},8,["data"])])):m("",!0),m("",!0)]),_:1}),aa.value.length?(A(),p(o,{key:2,class:"timeline-card",shadow:"never"},{header:c(()=>[_("span",null,v(g(N)("upgradeManagement.workflow.title")),1)]),default:c(()=>[u(ge,null,{default:c(()=>[(A(!0),s(q,null,I(aa.value,e=>(A(),p(ce,{key:e.key,timestamp:e.time,type:e.tagType,placement:"top"},{default:c(()=>[_("div",Ce,[_("div",Se,["file_upload"===e.source?(A(),p(t,{key:0,size:"small",class:"source-tag file-upload-tag"},{default:c(()=>[u(l,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:c(()=>[u(g(S))]),_:1}),a[5]||(a[5]=y(" 文件审批 ",-1))]),_:1})):"upgrade_application"===e.source?(A(),p(t,{key:1,size:"small",class:"source-tag upgrade-app-tag"},{default:c(()=>[u(l,{style:{"vertical-align":"middle","margin-right":"4px"}},{default:c(()=>[u(g(M))]),_:1}),a[6]||(a[6]=y(" 升级申请 ",-1))]),_:1})):m("",!0),_("span",null,v(e.title),1),u(t,{size:"small",type:e.tagType},{default:c(()=>[y(v(e.statusLabel),1)]),_:2},1032,["type"])]),_("p",null,v(g(N)("upgradeManagement.workflow.handler"))+": "+v(e.actor||"—"),1),e.remark?(A(),s("p",Ae,v(g(N)("upgradeManagement.workflow.remark"))+": "+v(e.remark),1)):m("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})]),_:1})):m("",!0)])),[[fe,Ne.value]])}}}),[["__scopeId","data-v-67ed38d5"]]);export{Ee as default};
