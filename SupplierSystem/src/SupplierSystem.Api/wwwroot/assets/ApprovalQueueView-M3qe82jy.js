const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/public-CiB4-csd.js","assets/index-C0Mp4Qwi.js","assets/index-CMY-P_dF.css"])))=>i.map(i=>d[i]);
import{an as e,ao as a,ap as l,aq as t,c as s,ar as o,h as i,B as r,as as u,D as n,at as d,au as c,d as p,av as v,aw as f,ax as m,ay as y,az as _,z as b,o as h,k as g,j as w,aA as k,f as E,m as C,aB as R,aC as D,e as N,aD as A,w as j,b as z,y as P,S as F,aa as I,t as S,O as V,aE as x,ak as O,aF as L,aG as T,aH as $,a8 as U,g as q,u as B,i as Q,C as G,H,x as M,A as W,a9 as Z,F as Y,aI as J,r as X,Z as K,V as ee,X as ae,E as le,J as te,_ as se}from"./index-C0Mp4Qwi.js";import{v as oe}from"./el-loading-BCJTsewc.js";import{a as ie,E as re}from"./el-form-item-DWCJ_VJd.js";/* empty css                 */import{E as ue,a as ne}from"./el-radio-group-4TPsmP0H.js";import{E as de,a as ce}from"./el-timeline-item-CsSRO-oj.js";import{a as pe,E as ve}from"./el-descriptions-item-BbytzslA.js";import{E as fe}from"./el-divider-BqT9v3QR.js";import{E as me}from"./el-alert-BqOjwmvF.js";import{E as ye}from"./el-skeleton-item-D3_nZhSS.js";import{E as _e}from"./el-card-CBzeriAr.js";import{E as be}from"./el-empty-BClC4x72.js";import{E as he,a as ge}from"./el-table-column-DOYcPGOY.js";import"./el-scrollbar-BoZVtYc3.js";import{E as we}from"./el-tag-DYV3tCoS.js";import{P as ke}from"./PageHeader-CBRH-77e.js";import{fetchPendingRegistrations as Ee,fetchApprovedRegistrations as Ce,bindSupplierCode as Re}from"./public-CiB4-csd.js";import"./dayjs.min-CuEfV50W.js";import{r as De}from"./apiBaseUrl-Bx8aB0Mq.js";import{u as Ne}from"./useNotification-tfOtCi8G.js";import"./castArray-BThrTw9_.js";import"./_baseClone-DzPoAz_T.js";import"./debounce-DsZQvEKa.js";const Ae=a({...l,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},resizable:Boolean,size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),je=e;function ze(e,a){const{width:l,height:c}=t(),p=s(()=>["ltr","rtl"].includes(e.direction)),v=s(()=>["ltr","ttb"].includes(e.direction)?1:-1),f=s(()=>p.value?l.value:c.value),m=s(()=>o(y.value+v.value*_.value,4,f.value)),y=i(0),_=i(0),b=i(!1),h=i(!1);let g=[],w=[];r(()=>[e.size,e.resizable],()=>{h.value=!1,y.value=0,_.value=0,E()});const k=e=>{const{pageX:a,pageY:l}=e,t=a-g[0],s=l-g[1];_.value=p.value?t:s},E=()=>{g=[],y.value=m.value,_.value=0,b.value=!1,w.forEach(e=>null==e?void 0:e()),w=[]},C=u(a,"mousedown",l=>{e.resizable&&(h.value||(y.value=(()=>{var e;const l=null==(e=a.value)?void 0:e.closest('[aria-modal="true"]');return l?p.value?l.offsetWidth:l.offsetHeight:100})(),h.value=!0),g=[l.pageX,l.pageY],b.value=!0,w.push(u(window,"mouseup",E),u(window,"mousemove",k)))});return n(()=>{C(),E()}),{size:s(()=>h.value?`${m.value}px`:d(e.size)),isResizing:b,isHorizontal:p}}const Pe=p({name:"ElDrawer",inheritAttrs:!1});const Fe=$(c(p({...Pe,props:Ae,emits:je,setup(e,{expose:a}){const l=e,t=v();f({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},s(()=>!!t.title));const o=i(),r=i(),u=i(),n=m("drawer"),{t:d}=y(),{afterEnter:c,afterLeave:p,beforeLeave:$,visible:U,rendered:q,titleId:B,bodyId:Q,zIndex:G,onModalClick:H,onOpenAutoFocus:M,onCloseAutoFocus:W,onFocusoutPrevented:Z,onCloseRequested:Y,handleClose:J}=_(l,o),{isHorizontal:X,size:K,isResizing:ee}=ze(l,u),ae=s(()=>l.modalPenetrable&&!l.modal);return a({handleClose:J,afterEnter:c,afterLeave:p}),(e,a)=>(h(),b(E(T),{to:e.appendTo,disabled:"body"===e.appendTo&&!e.appendToBody},{default:g(()=>[w(k,{name:E(n).b("fade"),onAfterEnter:E(c),onAfterLeave:E(p),onBeforeLeave:E($),persisted:""},{default:g(()=>{var a;return[C(w(E(R),{mask:e.modal,"overlay-class":[E(n).is("drawer"),null!=(a=e.modalClass)?a:"",`${E(n).namespace.value}-modal-drawer`,E(n).is("penetrable",E(ae))],"z-index":E(G),onClick:E(H)},{default:g(()=>[w(E(D),{loop:"",trapped:E(U),"focus-trap-el":o.value,"focus-start-el":r.value,onFocusAfterTrapped:E(M),onFocusAfterReleased:E(W),onFocusoutPrevented:E(Z),onReleaseRequested:E(Y)},{default:g(()=>[N("div",A({ref_key:"drawerRef",ref:o,"aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:E(B),"aria-describedby":E(Q)},e.$attrs,{class:[E(n).b(),e.direction,E(U)&&"open",E(n).is("dragging",E(ee))],style:{[E(X)?"width":"height"]:E(K)},role:"dialog",onClick:j(()=>{},["stop"])}),[N("span",{ref_key:"focusStartRef",ref:r,class:F(E(n).e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(h(),z("header",{key:0,class:F([E(n).e("header"),e.headerClass])},[e.$slots.title?I(e.$slots,"title",{key:1},()=>[P(" DEPRECATED SLOT ")]):I(e.$slots,"header",{key:0,close:E(J),titleId:E(B),titleClass:E(n).e("title")},()=>[N("span",{id:E(B),role:"heading","aria-level":e.headerAriaLevel,class:F(E(n).e("title"))},S(e.title),11,["id","aria-level"])]),e.showClose?(h(),z("button",{key:2,"aria-label":E(d)("el.drawer.close"),class:F(E(n).e("close-btn")),type:"button",onClick:E(J)},[w(E(V),{class:F(E(n).e("close"))},{default:g(()=>[w(E(x))]),_:1},8,["class"])],10,["aria-label","onClick"])):P("v-if",!0)],2)):P("v-if",!0),E(q)?(h(),z("div",{key:1,id:E(Q),class:F([E(n).e("body"),e.bodyClass])},[I(e.$slots,"default")],10,["id"])):P("v-if",!0),e.$slots.footer?(h(),z("div",{key:2,class:F([E(n).e("footer"),e.footerClass])},[I(e.$slots,"footer")],2)):P("v-if",!0),e.resizable?(h(),z("div",{key:3,ref_key:"draggerRef",ref:u,style:O({zIndex:E(G)}),class:F(E(n).e("dragger"))},null,6)):P("v-if",!0)],16,["aria-label","aria-labelledby","aria-describedby","onClick"])]),_:3},8,["trapped","focus-trap-el","focus-start-el","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[L,E(U)]])]}),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}}),[["__file","drawer.vue"]])),Ie=e=>{if(!e)return"Unknown Status";return{[U.PENDING_INFO]:"Awaiting profile details",[U.PENDING_PURCHASER]:"Waiting for purchaser review",pending_code_binding:"Pending code binding",pending_cashier:"Cashier review",[U.REJECTED]:"Rejected"}[e]||e},Se=e=>{if(!e)return"info";return{[U.PENDING_INFO]:"info",[U.PENDING_PURCHASER]:"warning",[U.PENDING_QUALITY_REVIEW]:"warning",[U.PENDING_PURCHASE_MANAGER]:"warning",[U.PENDING_PURCHASE_DIRECTOR]:"warning",pending_code_binding:"warning",pending_cashier:"warning",[U.PENDING_FINANCE_MANAGER]:"warning",[U.APPROVED]:"success",[U.REJECTED]:"danger"}[e]||"info"},Ve={class:"approval-view"},xe={class:"content-wrapper"},Oe={class:"approval-stack"},Le={class:"card-header"},Te={class:"supplier-info"},$e={class:"supplier-name"},Ue={key:0,class:"supplier-code"},qe={key:0,class:"empty-state"},Be={class:"card-header"},Qe={class:"supplier-info"},Ge={class:"supplier-name"},He={key:0,class:"supplier-code"},Me={key:0,class:"empty-state"},We={key:0},Ze={key:1},Ye={key:2,class:"drawer-content"},Je={style:{"font-size":"15px","font-weight":"600"}},Xe={style:{"margin-top":"8px","font-size":"13px"}},Ke={class:"document-grid"},ea={class:"document-header"},aa={class:"document-meta"},la={class:"document-name"},ta={key:0,class:"document-size"},sa={class:"document-actions"},oa={key:1,class:"document-empty"},ia={class:"document-header"},ra={class:"document-meta"},ua={class:"document-name"},na={key:0,class:"document-size"},da={class:"document-actions"},ca={key:1,class:"document-empty"},pa={key:0},va={style:{"white-space":"pre-wrap","line-height":"1.6"}},fa={key:1},ma={class:"approval-history-entry"},ya={class:"history-header"},_a={class:"history-step"},ba={class:"history-meta"},ha={key:0,class:"history-comment"},ga={class:"drawer-footer"},wa=se(p({name:"ApprovalQueueView",__name:"ApprovalQueueView",setup(e){const a=Ne(),l=q(),{t:t}=B(),o=i(!1),r=i([]),u=i(!1),n=i([]),d=i(!1),c=i(null),p=i(null),v=i([]),f=i(!1),m=i(!1),y=i(!1),_=i("approved"),k=Q({value:"",submitting:!1}),R=i(!1),D=i(""),A=i(!1),j=s(()=>"finance_accountant"===l.user?.role),F=s(()=>j.value&&"pending_code_binding"===c.value?.status),I=async()=>{o.value=!0;try{r.value=await Ee()}catch(e){console.error("Failed to fetch pending registrations",e),a.error(t("errors.general"))}finally{o.value=!1}},x=async()=>{u.value=!0;try{n.value=await Ce()}catch(e){console.error("Failed to fetch approved registrations",e),a.error(t("errors.general"))}finally{u.value=!1}},O=async(e,a="pending")=>{c.value=e,d.value=!0,y.value="approved"===a,_.value="approved",k.value="",await L(e.id),console.log("[DEBUG openDetails] app.status:",e.status),console.log("[DEBUG openDetails] isFinanceAccountant:",j.value),console.log("[DEBUG openDetails] role:",l.user?.role),j.value&&"pending_code_binding"===e.status?.toLowerCase()&&(console.log("[DEBUG openDetails] 准备弹出绑定对话框"),D.value="",R.value=!0)},L=async e=>{m.value=!0,v.value=[],f.value=!1;try{const{fetchRegistrationDetail:a,fetchSupplierRegistrationStatus:l}=await te(async()=>{const{fetchRegistrationDetail:e,fetchSupplierRegistrationStatus:a}=await import("./public-CiB4-csd.js");return{fetchRegistrationDetail:e,fetchSupplierRegistrationStatus:a}},__vite__mapDeps([0,1,2])),[t,s]=await Promise.allSettled([a(e),l(e)]);if("fulfilled"!==t.status)throw t.reason;p.value=t.value,"fulfilled"===s.status?v.value=(s.value.history||[]).filter(e=>"approval"===e.type):(f.value=!0,console.error("Failed to fetch approval history",s.reason))}catch(l){p.value=null,console.error("Failed to fetch application detail",l),a.error(t("approvalQueue.errors.loadStatus")),f.value=!0}finally{m.value=!1}},T=async()=>{if(c.value)if("rejected"!==_.value&&"requestInfo"!==_.value||k.value.trim())try{k.submitting=!0;const e=c.value.id,l="approved"===_.value;let s;if(l){const{approveRegistration:l}=await te(async()=>{const{approveRegistration:e}=await import("./public-CiB4-csd.js");return{approveRegistration:e}},__vite__mapDeps([0,1,2])),o=await l(e,{comment:k.value.trim()||void 0});a.success(o.message||t("approvalQueue.notifications.approved")),s=o.nextStatus}else if("rejected"===_.value){const{rejectRegistration:l}=await te(async()=>{const{rejectRegistration:e}=await import("./public-CiB4-csd.js");return{rejectRegistration:e}},__vite__mapDeps([0,1,2])),s=await l(e,{reason:k.value});a.success(s.message||t("approvalQueue.notifications.rejected"))}else{const{requestRegistrationInfo:l}=await te(async()=>{const{requestRegistrationInfo:e}=await import("./public-CiB4-csd.js");return{requestRegistrationInfo:e}},__vite__mapDeps([0,1,2])),s=await l(e,{message:k.value});a.success(s.message||t("approvalQueue.notifications.requestedInfo"))}if(j.value&&l&&"pending_code_binding"===s?.toLowerCase()){d.value=!1,await I();const a=r.value.find(a=>a.id===e);a&&(c.value=a),D.value="",R.value=!0}else d.value=!1,c.value=null,await Promise.all([I(),x()])}catch(e){console.error("Failed to submit decision",e),a.error(e instanceof Error?e.message:t("errors.general"))}finally{k.submitting=!1}else a.warning(t("approvalQueue.validation.commentRequired"))},$=e=>{if(!e)return"-";return new Date(e).toLocaleString()},U=e=>!e||Number.isNaN(e)?"-":e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`,se=e=>{if(!e.step)return"审批";const a=`registrationStatus.history.steps.${e.step}`,l=t(a);return l===a?e.step:l},Ae=e=>{const a=(e.result||e.status||"").toLowerCase();return a?"approved"===a||"completed"===a?"批准":"rejected"===a||"refused"===a?"拒绝":a.includes("request")||a.includes("return")?"退回补充":a:""},je=e=>{const a=(e.result||e.status||"").toLowerCase();return"approved"===a||"completed"===a?"success":"rejected"===a||"refused"===a?"danger":a.includes("request")||a.includes("return")?"warning":"info"},ze=e=>`${e.step??"approval"}-${e.occurredAt??"time"}-${e.approver??"unknown"}`,Pe=e=>{const l=(e=>{if(!e)return null;const a=e.startsWith("/")?e:`/${e}`,l=localStorage.getItem("token"),t=De(`/uploads${a}`);if(!l)return t;const s=t.includes("?")?"&":"?";return`${t}${s}token=${encodeURIComponent(l)}`})(e);l?window.open(l,"_blank","noopener,noreferrer"):a.warning("未找到该文件，请联系供应商重新上传。")},wa=()=>{c.value&&(D.value="",R.value=!0)},ka=async()=>{if(c.value&&D.value.trim()){A.value=!0;try{const e=await Re(c.value.id,D.value.trim());a.success(e.message||"VENDOR CODE 绑定成功"),R.value=!1,await I(),await x()}catch(e){a.error(e.message||"绑定失败")}finally{A.value=!1}}else a.warning("请输入 VENDOR CODE")};return G(()=>{I(),x()}),(e,a)=>{const l=V,s=W,i=he,j=we,L=ge,q=be,B=_e,Q=ye,G=me,te=fe,Ee=pe,Ce=ve,Re=ce,De=de,Ne=ne,Ea=ue,Ca=ie,Ra=le,Da=re,Na=Fe,Aa=H,ja=oe;return h(),z("div",Ve,[w(ke,{title:E(t)("approvalQueue.title"),subtitle:E(t)("approvalQueue.subtitle")},null,8,["title","subtitle"]),N("div",xe,[N("div",Oe,[w(B,{class:"approval-card",shadow:"never"},{header:g(()=>[N("div",Le,[N("span",null,"待我审批 ("+S(r.value.length)+")",1),w(s,{type:"primary",size:"small",onClick:I},{default:g(()=>[w(l,null,{default:g(()=>[w(E(Z))]),_:1}),M(" "+S(E(t)("common.refresh")),1)]),_:1})])]),default:g(()=>[C((h(),b(L,{data:r.value,stripe:""},{default:g(()=>[w(i,{prop:"id",label:"申请编号",width:"100"}),w(i,{label:"供应商信息",width:"250"},{default:g(({row:e})=>[N("div",Te,[N("div",$e,S(e.companyName),1),e.supplierCode?(h(),z("div",Ue," 代码: "+S(e.supplierCode),1)):P("",!0)])]),_:1}),w(i,{label:"状态",width:"140"},{default:g(({row:e})=>[w(j,{type:E(Se)(e.status),size:"small"},{default:g(()=>[M(S(E(Ie)(e.status)),1)]),_:2},1032,["type"])]),_:1}),w(i,{label:"联系方式",width:"200"},{default:g(({row:e})=>[M(S(e.contactEmail),1)]),_:1}),w(i,{label:"负责采购员",width:"180"},{default:g(({row:e})=>[M(S(e.procurementEmail||"-"),1)]),_:1}),w(i,{prop:"createdAt",label:"提交时间",width:"180"},{default:g(({row:e})=>[M(S($(e.createdAt)),1)]),_:1}),w(i,{label:"操作",width:"200",fixed:"right"},{default:g(({row:e})=>[w(s,{type:"primary",size:"small",onClick:a=>O(e)},{default:g(()=>[M(S(E(t)("approvalQueue.actions.viewDetails")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ja,o.value]]),0!==r.value.length||o.value?P("",!0):(h(),z("div",qe,[w(q,{description:E(t)("approvalQueue.noSuppliers")},null,8,["description"])]))]),_:1}),w(B,{class:"approval-card",shadow:"never"},{header:g(()=>[N("div",Be,[N("span",null,"已审批 ("+S(n.value.length)+")",1),w(s,{type:"primary",size:"small",onClick:x},{default:g(()=>[w(l,null,{default:g(()=>[w(E(Z))]),_:1}),M(" "+S(E(t)("common.refresh")),1)]),_:1})])]),default:g(()=>[C((h(),b(L,{data:n.value,stripe:""},{default:g(()=>[w(i,{prop:"id",label:"申请编号",width:"100"}),w(i,{label:"供应商信息",width:"250"},{default:g(({row:e})=>[N("div",Qe,[N("div",Ge,S(e.companyName),1),e.supplierCode?(h(),z("div",He," 代码: "+S(e.supplierCode),1)):P("",!0)])]),_:1}),w(i,{label:"状态",width:"140"},{default:g(({row:e})=>[w(j,{type:E(Se)(e.status),size:"small"},{default:g(()=>[M(S(E(Ie)(e.status)),1)]),_:2},1032,["type"])]),_:1}),w(i,{label:"联系方式",width:"200"},{default:g(({row:e})=>[M(S(e.contactEmail),1)]),_:1}),w(i,{label:"负责采购员",width:"180"},{default:g(({row:e})=>[M(S(e.procurementEmail||"-"),1)]),_:1}),w(i,{prop:"createdAt",label:"提交时间",width:"180"},{default:g(({row:e})=>[M(S($(e.createdAt)),1)]),_:1}),w(i,{label:"操作",width:"200",fixed:"right"},{default:g(({row:e})=>[w(s,{type:"primary",size:"small",onClick:a=>O(e,"approved")},{default:g(()=>[M(S(E(t)("approvalQueue.actions.viewDetails")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ja,u.value]]),0!==n.value.length||u.value?P("",!0):(h(),z("div",Me,[w(q,{description:E(t)("approvalQueue.noSuppliers")},null,8,["description"])]))]),_:1})])]),d.value?(h(),b(Na,{key:0,modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=e=>d.value=e),title:c.value?.companyName||E(t)("approvalQueue.drawer.title"),size:"900px","destroy-on-close":""},{footer:g(()=>[N("div",ga,[w(s,{onClick:a[4]||(a[4]=e=>d.value=!1)},{default:g(()=>[...a[33]||(a[33]=[M("取消",-1)])]),_:1}),w(s,{type:"primary",loading:k.submitting,onClick:T,disabled:y.value||!c.value||F.value},{default:g(()=>[...a[34]||(a[34]=[M(" 提交审批 ",-1)])]),_:1},8,["loading","disabled"])])]),default:g(()=>[m.value?(h(),z("div",We,[w(Q,{rows:8,animated:""})])):p.value?(h(),z("div",Ye,[w(G,{type:"info",closable:!1,style:{"margin-bottom":"20px"}},{title:g(()=>[N("div",Je,S(p.value.companyName),1)]),default:g(()=>[N("div",Xe," 申请编号: "+S(p.value.id)+" | 提交时间: "+S($(p.value.createdAt)),1)]),_:1}),w(te,{"content-position":"left"},{default:g(()=>[...a[9]||(a[9]=[M("基本信息",-1)])]),_:1}),w(Ce,{column:2,border:""},{default:g(()=>[w(Ee,{label:"申请编号"},{default:g(()=>[M(S(p.value.id),1)]),_:1}),w(Ee,{label:"状态"},{default:g(()=>[w(j,{type:E(Se)(p.value.status),size:"small"},{default:g(()=>[M(S(E(Ie)(p.value.status)),1)]),_:1},8,["type"])]),_:1}),p.value.supplierCode?(h(),b(Ee,{key:0,label:"供应商代码"},{default:g(()=>[M(S(p.value.supplierCode),1)]),_:1})):P("",!0),w(Ee,{label:"最后更新"},{default:g(()=>[M(S($(p.value.updatedAt)),1)]),_:1})]),_:1}),w(te,{"content-position":"left"},{default:g(()=>[...a[10]||(a[10]=[M("公司信息",-1)])]),_:1}),w(Ce,{column:2,border:""},{default:g(()=>[w(Ee,{label:"公司名称（中文）"},{default:g(()=>[M(S(p.value.companyName),1)]),_:1}),p.value.companyNameEnglish?(h(),b(Ee,{key:0,label:"公司名称（英文）"},{default:g(()=>[M(S(p.value.companyNameEnglish),1)]),_:1})):P("",!0),w(Ee,{label:"英文名称"},{default:g(()=>[M(S(p.value.englishName||"-"),1)]),_:1}),w(Ee,{label:"供应商分类"},{default:g(()=>{return[M(S((e=p.value.supplierClassification,e?"DM"===e?`DM (${t("rfq.materialType.dm")})`:"IDM"===e?`IDM (${t("rfq.materialType.idm")})`:e:"-")),1)];var e}),_:1}),p.value.companyType?(h(),b(Ee,{key:1,label:"公司类型"},{default:g(()=>[M(S(p.value.companyType),1)]),_:1})):P("",!0),w(Ee,{label:"营业执照号"},{default:g(()=>[M(S(p.value.businessRegistrationNumber),1)]),_:1}),w(Ee,{label:"注册地址",span:2},{default:g(()=>[M(S(p.value.registeredOffice),1)]),_:1}),w(Ee,{label:"经营地址",span:2},{default:g(()=>[M(S(p.value.businessAddress),1)]),_:1}),p.value.companyPhone?(h(),b(Ee,{key:2,label:"公司电话"},{default:g(()=>[M(S(p.value.companyPhone),1)]),_:1})):P("",!0),p.value.companyFax?(h(),b(Ee,{key:3,label:"公司传真"},{default:g(()=>[M(S(p.value.companyFax),1)]),_:1})):P("",!0)]),_:1}),w(te,{"content-position":"left"},{default:g(()=>[...a[11]||(a[11]=[M("联系人信息",-1)])]),_:1}),w(Ce,{column:2,border:""},{default:g(()=>[w(Ee,{label:"联系人"},{default:g(()=>[M(S(p.value.contactName),1)]),_:1}),w(Ee,{label:"联系邮箱"},{default:g(()=>[M(S(p.value.contactEmail),1)]),_:1}),w(Ee,{label:"联系电话"},{default:g(()=>[M(S(p.value.contactPhone),1)]),_:1}),p.value.financeContactName?(h(),b(Ee,{key:0,label:"财务联系人"},{default:g(()=>[M(S(p.value.financeContactName),1)]),_:1})):P("",!0),p.value.financeContactEmail?(h(),b(Ee,{key:1,label:"财务联系邮箱"},{default:g(()=>[M(S(p.value.financeContactEmail),1)]),_:1})):P("",!0),p.value.financeContactPhone?(h(),b(Ee,{key:2,label:"财务联系电话"},{default:g(()=>[M(S(p.value.financeContactPhone),1)]),_:1})):P("",!0),p.value.procurementEmail?(h(),b(Ee,{key:3,label:"采购联系邮箱"},{default:g(()=>[M(S(p.value.procurementEmail),1)]),_:1})):P("",!0)]),_:1}),w(te,{"content-position":"left"},{default:g(()=>[...a[12]||(a[12]=[M("业务信息",-1)])]),_:1}),w(Ce,{column:2,border:""},{default:g(()=>[p.value.businessNature?(h(),b(Ee,{key:0,label:"业务性质"},{default:g(()=>[M(S(p.value.businessNature),1)]),_:1})):P("",!0),w(Ee,{label:"结算货币"},{default:g(()=>[M(S(p.value.operatingCurrency),1)]),_:1}),w(Ee,{label:"交货地点"},{default:g(()=>[M(S(p.value.deliveryLocation),1)]),_:1}),p.value.shipCode?(h(),b(Ee,{key:1,label:"Ship Code"},{default:g(()=>[M(S(p.value.shipCode),1)]),_:1})):P("",!0),p.value.productTypes?(h(),b(Ee,{key:2,label:"产品类型",span:2},{default:g(()=>[M(S(p.value.productTypes),1)]),_:1})):P("",!0),p.value.invoiceType?(h(),b(Ee,{key:3,label:"发票类型"},{default:g(()=>[M(S(p.value.invoiceType),1)]),_:1})):P("",!0),p.value.paymentTermsDays?(h(),b(Ee,{key:4,label:"付款条款"},{default:g(()=>[M(S(p.value.paymentTermsDays)+" 天 ",1)]),_:1})):P("",!0),p.value.paymentMethods?(h(),b(Ee,{key:5,label:"付款方式",span:2},{default:g(()=>[M(S(p.value.paymentMethods),1)]),_:1})):P("",!0)]),_:1}),w(te,{"content-position":"left"},{default:g(()=>[...a[13]||(a[13]=[M("银行信息",-1)])]),_:1}),w(Ce,{column:2,border:""},{default:g(()=>[w(Ee,{label:"银行名称"},{default:g(()=>[M(S(p.value.bankName),1)]),_:1}),w(Ee,{label:"银行地址"},{default:g(()=>[M(S(p.value.bankAddress),1)]),_:1}),w(Ee,{label:"银行账号",span:2},{default:g(()=>[M(S(p.value.bankAccountNumber),1)]),_:1}),p.value.swiftCode?(h(),b(Ee,{key:0,label:"SWIFT Code",span:2},{default:g(()=>[M(S(p.value.swiftCode),1)]),_:1})):P("",!0)]),_:1}),w(te,{"content-position":"left"},{default:g(()=>[...a[14]||(a[14]=[M("提交资料",-1)])]),_:1}),N("div",Ke,[w(B,{class:"document-card",shadow:"hover"},{header:g(()=>[N("div",ea,[a[17]||(a[17]=N("span",null,"营业执照",-1)),p.value.businessLicenseFilePath?(h(),b(j,{key:0,type:"success",size:"small"},{default:g(()=>[...a[15]||(a[15]=[M(" 已上传 ",-1)])]),_:1})):(h(),b(j,{key:1,type:"info",size:"small"},{default:g(()=>[...a[16]||(a[16]=[M("暂无",-1)])]),_:1}))])]),default:g(()=>[p.value.businessLicenseFilePath?(h(),z(Y,{key:0},[N("div",aa,[N("div",la,S(p.value.businessLicenseFileName||"business-license"),1),p.value.businessLicenseFileSize?(h(),z("div",ta," 大小："+S(U(p.value.businessLicenseFileSize)),1)):P("",!0)]),N("div",sa,[w(s,{type:"primary",link:"",onClick:a[0]||(a[0]=e=>Pe(p.value.businessLicenseFilePath))},{default:g(()=>[...a[18]||(a[18]=[M(" 查看 / 下载 ",-1)])]),_:1})])],64)):(h(),z("p",oa,"供应商未上传营业执照。"))]),_:1}),w(B,{class:"document-card",shadow:"hover"},{header:g(()=>[N("div",ia,[a[21]||(a[21]=N("span",null,"银行开户资料",-1)),p.value.bankAccountFilePath?(h(),b(j,{key:0,type:"success",size:"small"},{default:g(()=>[...a[19]||(a[19]=[M(" 已上传 ",-1)])]),_:1})):(h(),b(j,{key:1,type:"info",size:"small"},{default:g(()=>[...a[20]||(a[20]=[M("暂无",-1)])]),_:1}))])]),default:g(()=>[p.value.bankAccountFilePath?(h(),z(Y,{key:0},[N("div",ra,[N("div",ua,S(p.value.bankAccountFileName||"bank-account-document"),1),p.value.bankAccountFileSize?(h(),z("div",na," 大小："+S(U(p.value.bankAccountFileSize)),1)):P("",!0)]),N("div",da,[w(s,{type:"primary",link:"",onClick:a[1]||(a[1]=e=>Pe(p.value.bankAccountFilePath))},{default:g(()=>[...a[22]||(a[22]=[M(" 查看 / 下载 ",-1)])]),_:1})])],64)):(h(),z("p",ca,"供应商未上传银行开户资料。"))]),_:1})]),p.value.notes?(h(),z("div",pa,[w(te,{"content-position":"left"},{default:g(()=>[...a[23]||(a[23]=[M("备注",-1)])]),_:1}),w(G,{type:"info",closable:!1},{default:g(()=>[N("div",va,S(p.value.notes),1)]),_:1})])):P("",!0),F.value?(h(),z("div",fa,[w(te,{"content-position":"left"},{default:g(()=>[...a[24]||(a[24]=[M("绑定 VENDOR CODE",-1)])]),_:1}),w(G,{type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"16px"}},{default:g(()=>[...a[25]||(a[25]=[M(" 审批流程已完成，请为此供应商绑定 VENDOR CODE ",-1)])]),_:1}),w(s,{type:"primary",icon:E(J),onClick:wa},{default:g(()=>[...a[26]||(a[26]=[M(" 绑定 VENDOR CODE ",-1)])]),_:1},8,["icon"])])):P("",!0),F.value?P("",!0):(h(),z(Y,{key:2},[w(te,{"content-position":"left"},{default:g(()=>[...a[27]||(a[27]=[M("审批意见与备注",-1)])]),_:1}),f.value?(h(),b(G,{key:0,type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"12px"}},{default:g(()=>[...a[28]||(a[28]=[M(" 审批意见加载失败，请稍后重试。 ",-1)])]),_:1})):0===v.value.length?(h(),b(q,{key:1,description:"暂无审批记录"})):(h(),b(De,{key:2,class:"approval-history"},{default:g(()=>[(h(!0),z(Y,null,X(v.value,e=>(h(),b(Re,{key:ze(e),timestamp:$(e.occurredAt),type:je(e)},{default:g(()=>[N("div",ma,[N("div",ya,[N("span",_a,S(se(e)),1),Ae(e)?(h(),b(j,{key:0,type:je(e),size:"small"},{default:g(()=>[M(S(Ae(e)),1)]),_:2},1032,["type"])):P("",!0)]),N("div",ba,[N("span",null,"审批人: "+S(e.approver||"-"),1)]),e.comments?(h(),z("div",ha,S(e.comments),1)):P("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})),w(te,{"content-position":"left"},{default:g(()=>[...a[29]||(a[29]=[M("您的审批决定",-1)])]),_:1}),w(Da,{"label-width":"100px"},{default:g(()=>[w(Ca,{label:"审批决定",required:""},{default:g(()=>[w(Ea,{modelValue:_.value,"onUpdate:modelValue":a[2]||(a[2]=e=>_.value=e)},{default:g(()=>[w(Ne,{value:"approved"},{default:g(()=>[w(l,{color:"#67c23a"},{default:g(()=>[w(E(K))]),_:1}),a[30]||(a[30]=M(" 批准 ",-1))]),_:1}),w(Ne,{value:"rejected"},{default:g(()=>[w(l,{color:"#f56c6c"},{default:g(()=>[w(E(ee))]),_:1}),a[31]||(a[31]=M(" 拒绝 ",-1))]),_:1}),w(Ne,{value:"requestInfo"},{default:g(()=>[w(l,{color:"#e6a23c"},{default:g(()=>[w(E(ae))]),_:1}),a[32]||(a[32]=M(" 退回补充资料 ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),w(Ca,{label:"审批意见"},{default:g(()=>[w(Ra,{modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=e=>k.value=e),type:"textarea",rows:4,placeholder:"approved"===_.value?"请填写审批意见（可选）":"rejected"===_.value?"请说明驳回原因（必填）":"请填写需要供应商补充的内容（必填）"},null,8,["modelValue","placeholder"])]),_:1})]),_:1})],64))])):(h(),z("div",Ze,[w(q,{description:E(t)("approvalQueue.errors.noStatus")},null,8,["description"])]))]),_:1},8,["modelValue","title"])):P("",!0),w(Aa,{modelValue:R.value,"onUpdate:modelValue":a[8]||(a[8]=e=>R.value=e),title:"绑定 VENDOR CODE",width:"500px","close-on-click-modal":!1},{footer:g(()=>[w(s,{onClick:a[7]||(a[7]=e=>R.value=!1)},{default:g(()=>[...a[37]||(a[37]=[M("取消",-1)])]),_:1}),w(s,{type:"primary",loading:A.value,disabled:!D.value.trim(),onClick:ka},{default:g(()=>[...a[38]||(a[38]=[M(" 确认绑定 ",-1)])]),_:1},8,["loading","disabled"])]),default:g(()=>[w(G,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:g(()=>[a[35]||(a[35]=M(" 请为供应商 ",-1)),N("strong",null,S(c.value?.companyName),1),a[36]||(a[36]=M(" 绑定 VENDOR CODE ",-1))]),_:1}),w(Da,{"label-width":"120px"},{default:g(()=>[w(Ca,{label:"VENDOR CODE",required:""},{default:g(()=>[w(Ra,{modelValue:D.value,"onUpdate:modelValue":a[6]||(a[6]=e=>D.value=e),placeholder:"请输入 7 位供应商代码",maxlength:"7","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-72ca2b6f"]]);export{wa as default};
