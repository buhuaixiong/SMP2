const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SupplierFileUploadDialog-DtT_NsfS.js","assets/index-z18YH7Dc.js","assets/index-CMY-P_dF.css","assets/el-form-item-cm6i1Rmw.js","assets/castArray-0lMpEhXd.js","assets/_baseClone-DK5jo9D5.js","assets/el-form-item-BWkJzdQ_.css","assets/el-date-picker-panel-BdFQfbPX.js","assets/dayjs.min-CuEfV50W.js","assets/el-scrollbar-CG2II4zE.js","assets/el-scrollbar-BWxh-h6K.css","assets/index-Dr8Y1Rol.js","assets/debounce-CStugFZ2.js","assets/el-date-picker-panel-C-Zz6Fhi.css","assets/el-upload-C2NsIte_.js","assets/el-progress-BWguS6aN.js","assets/el-progress-Dw9yTa91.css","assets/cloneDeep-Doa3dCtQ.js","assets/el-upload-C68BVP5f.css","assets/el-alert-Cu2gEKbk.js","assets/el-alert-G57rL0jl.css","assets/fileUploads-CTZDRgIG.js","assets/useNotification-Bhw0wSDz.js","assets/SupplierFileUploadDialog-B_u3bPDf.css","assets/el-input-D6B3r8CH.css","assets/FileUploadTimeline-Bj0NpN9f.js","assets/el-timeline-item-CTcraKjO.js","assets/el-timeline-item-BvbJTz1y.css","assets/el-tag-S4xrfAE-.js","assets/el-tag-DljBBxJR.css","assets/FileUploadTimeline-CEm7kSRR.css"])))=>i.map(i=>d[i]);
import{d as e,g as a,h as l,c as t,C as s,b as i,j as r,e as o,z as d,y as u,k as n,f as p,G as c,H as f,J as v,A as m,x as _,O as y,a9 as g,aO as w,a0 as h,t as b,a1 as j,Z as k,V as x,m as D,ak as T,cI as C,cJ as E,o as z,_ as U}from"./index-z18YH7Dc.js";import{v as V}from"./el-loading-7xWQcrrA.js";import{E as A}from"./el-image-viewer-D6-fDWNv.js";import{E as H}from"./el-divider-BD_m2uVZ.js";import{E as I,a as W}from"./el-descriptions-item-BLj0c7L_.js";import{E as F,a as N}from"./el-table-column-CA4nIRHh.js";import"./el-scrollbar-CG2II4zE.js";import{E as S}from"./el-tag-S4xrfAE-.js";import{E as O}from"./el-card-D9ai6MQf.js";import{P as L}from"./PageHeader-Boi9sEgv.js";import{d as P}from"./dayjs.min-CuEfV50W.js";import{g as Y,a as M}from"./fileUploads-CTZDRgIG.js";import{r as q}from"./apiBaseUrl-Bx8aB0Mq.js";import{o as J}from"./fileDownload-CLokrmkZ.js";import{u as R}from"./useNotification-Bhw0wSDz.js";import"./debounce-CStugFZ2.js";import"./_baseClone-DK5jo9D5.js";import"./castArray-0lMpEhXd.js";const $={class:"file-uploads-page"},B={class:"header-actions"},G={class:"stats-cards"},X={class:"stat-content"},Z={class:"stat-icon",style:{background:"#e6f7ff"}},K={class:"stat-info"},Q={class:"stat-value"},ee={class:"stat-content"},ae={class:"stat-icon",style:{background:"#fff7e6"}},le={class:"stat-info"},te={class:"stat-value"},se={class:"stat-content"},ie={class:"stat-icon",style:{background:"#f6ffed"}},re={class:"stat-info"},oe={class:"stat-value"},de={class:"stat-content"},ue={class:"stat-icon",style:{background:"#fff1f0"}},ne={class:"stat-info"},pe={class:"stat-value"},ce={style:{display:"flex","align-items":"center",gap:"8px"}},fe={key:1,style:{color:"#909399"}},ve={key:0},me={key:1},_e={style:{display:"flex","align-items":"center",gap:"8px"}},ye={class:"file-preview-container"},ge={key:0,class:"pdf-preview"},we=["src"],he={key:1,class:"image-preview"},be={class:"image-error"},je={key:2,class:"no-preview"},ke=U(e({__name:"SupplierFileUploadsView",setup(e){const U=R(),ke=c(()=>v(()=>import("./SupplierFileUploadDialog-DtT_NsfS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]))),xe=c(()=>v(()=>import("./FileUploadTimeline-Bj0NpN9f.js"),__vite__mapDeps([25,1,2,26,27,28,29,8,30]))),De=a(),Te=l(!1),Ce=l(!1),Ee=l(!1),ze=l(!1),Ue=l([]),Ve=l(null),Ae=t(()=>De.user?.supplierId||0),He=t(()=>Ue.value.length),Ie=t(()=>Ue.value.filter(e=>e.status.startsWith("pending_")).length),We=t(()=>Ue.value.filter(e=>"approved"===e.status).length),Fe=t(()=>Ue.value.filter(e=>"rejected"===e.status).length),Ne=e=>({pending_purchaser:"待采购员审批",pending_quality_manager:"待品质审批",pending_procurement_manager:"待采购经理审批",pending_procurement_director:"待采购总监审批",pending_finance_director:"待财务总监审批",approved:"已批准",rejected:"已拒绝"}[e]||e),Se=e=>"approved"===e?"success":"rejected"===e?"danger":e.startsWith("pending_")?"warning":"info",Oe=(e,a)=>{if("approved"===a)return"已完成";if("rejected"===a)return"已终止";return{purchaser:"采购员审批",quality_manager:"品质审批",procurement_manager:"采购经理审批",procurement_director:"采购总监审批",finance_director:"财务总监审批"}[e]||e},Le=e=>P(e).format("YYYY-MM-DD HH:mm"),Pe=(e,a)=>{if("approved"!==a||!e)return"";const l=new Date;l.setHours(0,0,0,0);const t=new Date(e);t.setHours(0,0,0,0);const s=Math.ceil((t.getTime()-l.getTime())/864e5);return s<0?"color: #f56c6c; font-weight: bold;":s<=7?"color: #e6a23c; font-weight: bold;":s<=30?"color: #409eff;":""},Ye=async()=>{if(Ae.value){Te.value=!0;try{Ue.value=await Y(Ae.value)}catch(e){console.error("Failed to fetch file uploads:",e),U.error(e?.message||"获取上传记录失败")}finally{Te.value=!1}}else U.warning("无法获取供应商信息")},Me=()=>{Ee.value=!1,Ye()},qe=e=>q(`/api/files/download/${e}`),Je=e=>{if(!e)return!1;const a=e.toLowerCase();return a.endsWith(".jpg")||a.endsWith(".jpeg")||a.endsWith(".png")},Re=async()=>{if(!Ve.value)return;const e=qe(Ve.value.id);try{await J(e)}catch(a){U.error(a?.message||"文件下载失败")}};return s(()=>{Ye()}),(e,a)=>{const l=y,t=m,s=O,c=F,v=S,P=N,Y=W,q=I,J=H,R=A,De=f,$e=V;return z(),i("div",$,[r(L,{title:"文件上传管理",subtitle:"上传文件并查看审批状态"},{actions:n(()=>[o("div",B,[r(t,{onClick:Ye},{default:n(()=>[r(l,null,{default:n(()=>[r(p(g))]),_:1}),a[3]||(a[3]=_(" 刷新 ",-1))]),_:1}),r(t,{type:"primary",onClick:a[0]||(a[0]=e=>Ee.value=!0)},{default:n(()=>[r(l,null,{default:n(()=>[r(p(w))]),_:1}),a[4]||(a[4]=_(" 上传文件 ",-1))]),_:1})])]),_:1}),o("div",G,[r(s,{class:"stat-card"},{default:n(()=>[o("div",X,[o("div",Z,[r(l,{size:24,color:"#1890ff"},{default:n(()=>[r(p(h))]),_:1})]),o("div",K,[a[5]||(a[5]=o("p",{class:"stat-label"},"总上传数",-1)),o("p",Q,b(He.value),1)])])]),_:1}),r(s,{class:"stat-card"},{default:n(()=>[o("div",ee,[o("div",ae,[r(l,{size:24,color:"#fa8c16"},{default:n(()=>[r(p(j))]),_:1})]),o("div",le,[a[6]||(a[6]=o("p",{class:"stat-label"},"审批中",-1)),o("p",te,b(Ie.value),1)])])]),_:1}),r(s,{class:"stat-card"},{default:n(()=>[o("div",se,[o("div",ie,[r(l,{size:24,color:"#52c41a"},{default:n(()=>[r(p(k))]),_:1})]),o("div",re,[a[7]||(a[7]=o("p",{class:"stat-label"},"已批准",-1)),o("p",oe,b(We.value),1)])])]),_:1}),r(s,{class:"stat-card"},{default:n(()=>[o("div",de,[o("div",ue,[r(l,{size:24,color:"#ff4d4f"},{default:n(()=>[r(p(x))]),_:1})]),o("div",ne,[a[8]||(a[8]=o("p",{class:"stat-label"},"已拒绝",-1)),o("p",pe,b(Fe.value),1)])])]),_:1})]),r(s,null,{header:n(()=>[...a[9]||(a[9]=[o("span",null,"上传记录",-1)])]),default:n(()=>[D((z(),d(P,{data:Ue.value,stripe:"",style:{width:"100%"}},{default:n(()=>[r(c,{prop:"id",label:"ID",width:"80"}),r(c,{prop:"fileName",label:"文件名","min-width":"200"},{default:n(({row:e})=>[o("div",ce,[r(l,null,{default:n(()=>[r(p(h))]),_:1}),o("span",null,b(e.fileName||"未命名文件"),1)])]),_:1}),r(c,{prop:"fileDescription",label:"文件说明","min-width":"150"},{default:n(({row:e})=>[o("span",null,b(e.fileDescription||"—"),1)]),_:1}),r(c,{prop:"status",label:"状态",width:"130"},{default:n(({row:e})=>[r(v,{type:Se(e.status)},{default:n(()=>[_(b(Ne(e.status)),1)]),_:2},1032,["type"])]),_:1}),r(c,{prop:"currentStep",label:"当前步骤",width:"130"},{default:n(({row:e})=>[_(b(Oe(e.currentStep,e.status)),1)]),_:1}),r(c,{prop:"validTo",label:"过期日期",width:"120"},{default:n(({row:e})=>[e.validTo?(z(),i("span",{key:0,style:T(Pe(e.validTo,e.status))},b(e.validTo),5)):(z(),i("span",fe,"—"))]),_:1}),r(c,{prop:"submittedAt",label:"提交时间",width:"160"},{default:n(({row:e})=>[_(b(Le(e.submittedAt)),1)]),_:1}),r(c,{label:"操作",width:"120",fixed:"right"},{default:n(({row:e})=>[r(t,{type:"primary",link:"",onClick:a=>(async e=>{Ce.value=!0,ze.value=!0;try{Ve.value=await M(e)}catch(a){console.error("Failed to fetch upload details:",a),U.error(a?.message||"获取详情失败"),ze.value=!1}finally{Ce.value=!1}})(e.id)},{default:n(()=>[...a[10]||(a[10]=[_(" 查看详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[$e,Te.value]])]),_:1}),Ee.value?(z(),d(p(ke),{key:0,visible:Ee.value,"onUpdate:visible":a[1]||(a[1]=e=>Ee.value=e),"supplier-id":Ae.value,onSuccess:Me},null,8,["visible","supplier-id"])):u("",!0),r(De,{modelValue:ze.value,"onUpdate:modelValue":a[2]||(a[2]=e=>ze.value=e),title:"文件上传详情",width:"900px","destroy-on-close":!0},{default:n(()=>{return[Ve.value?D((z(),i("div",ve,[r(q,{column:2,border:""},{default:n(()=>[r(Y,{label:"文件ID"},{default:n(()=>[_(b(Ve.value.id),1)]),_:1}),r(Y,{label:"文件名"},{default:n(()=>[_(b(Ve.value.fileName||"未命名"),1)]),_:1}),r(Y,{label:"文件说明",span:2},{default:n(()=>[_(b(Ve.value.fileDescription||"—"),1)]),_:1}),r(Y,{label:"生效日期"},{default:n(()=>[_(b(Ve.value.validFrom||"—"),1)]),_:1}),r(Y,{label:"过期日期"},{default:n(()=>[Ve.value.validTo?(z(),i("span",{key:0,style:T(Pe(Ve.value.validTo,Ve.value.status))},b(Ve.value.validTo),5)):(z(),i("span",me,"—"))]),_:1}),r(Y,{label:"当前状态"},{default:n(()=>[r(v,{type:Se(Ve.value.status)},{default:n(()=>[_(b(Ne(Ve.value.status)),1)]),_:1},8,["type"])]),_:1}),r(Y,{label:"提交时间"},{default:n(()=>[_(b(Le(Ve.value.submittedAt)),1)]),_:1})]),_:1}),r(J,{"content-position":"left"},{default:n(()=>[o("span",_e,[a[12]||(a[12]=_(" 文件预览 ",-1)),r(t,{type:"primary",size:"small",onClick:Re},{default:n(()=>[r(l,null,{default:n(()=>[r(p(C))]),_:1}),a[11]||(a[11]=_(" 下载文件 ",-1))]),_:1})])]),_:1}),o("div",ye,[(e=Ve.value.fileName,e&&e.toLowerCase().endsWith(".pdf")?(z(),i("div",ge,[o("iframe",{src:qe(Ve.value.id),style:{width:"100%",height:"600px",border:"1px solid #dcdfe6","border-radius":"4px"},frameborder:"0"},null,8,we)])):Je(Ve.value.fileName)?(z(),i("div",he,[r(R,{src:qe(Ve.value.id),"preview-src-list":[qe(Ve.value.id)],fit:"contain",style:{"max-width":"100%","max-height":"600px"}},{error:n(()=>[o("div",be,[r(l,{size:48},{default:n(()=>[r(p(E))]),_:1}),a[13]||(a[13]=o("p",null,"图片加载失败",-1))])]),_:1},8,["src","preview-src-list"])])):(z(),i("div",je,[r(l,{size:64,color:"#909399"},{default:n(()=>[r(p(h))]),_:1}),a[15]||(a[15]=o("p",{style:{"margin-top":"16px",color:"#606266"}}," 此文件类型不支持在线预览，请下载后查看 ",-1)),r(t,{type:"primary",onClick:Re,style:{"margin-top":"12px"}},{default:n(()=>[r(l,null,{default:n(()=>[r(p(C))]),_:1}),a[14]||(a[14]=_(" 下载文件 ",-1))]),_:1})])))]),r(J,{"content-position":"left"},{default:n(()=>[...a[16]||(a[16]=[_("审批进度",-1)])]),_:1}),r(p(xe),{workflow:Ve.value.workflow,"current-step":Ve.value.currentStep,status:Ve.value.status,"approval-history":Ve.value.approvalHistory},null,8,["workflow","current-step","status","approval-history"])])),[[$e,Ce.value]]):u("",!0)];var e}),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-f4635524"]]);export{ke as default};
