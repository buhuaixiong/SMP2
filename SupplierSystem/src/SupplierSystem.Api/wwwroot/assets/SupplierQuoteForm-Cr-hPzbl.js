import{W as e,d as t,u as r,h as l,c as a,i,B as n,C as o,I as u,b as s,j as d,k as c,f as m,x as f,t as p,e as q,z as y,y as I,S as g,bA as h,O as v,eu as b,F as P,U as C,E as L,r as w,A as _,aA as x,q as T,o as O,_ as U}from"./index-laeMBjmD.js";import{E as k,a as Q}from"./el-form-item-CrzCFDCN.js";import{E as V}from"./el-upload-CykulBdm.js";import{E as S}from"./el-progress-Clv910z1.js";import{E as N}from"./el-divider-CnMs1Jud.js";import{a as R,E as j}from"./el-table-column-D1gszk-j.js";import"./el-scrollbar-B2b40u5S.js";import{E as D}from"./el-tag-DeIZXvv5.js";import{E,a as $}from"./el-select-BqR0v05J.js";/* empty css                 */import{E as F}from"./el-input-number-DUfzTbkn.js";import{E as A}from"./el-alert-BD4DqkFF.js";import{E as z}from"./el-card-olMaAOOo.js";import{E as W,a as H}from"./el-descriptions-item--OzcC0ge.js";import{u as G}from"./useNotification-d4mSM-hc.js";import{f as Y,p as B}from"./dataParsing-BO9ZKtBB.js";import"./castArray-BNrN1hNN.js";import"./_baseClone-BfkIVau5.js";import"./cloneDeep-Cuz-d5um.js";import"./debounce-BQTfVhVS.js";import"./index-BoXJp7U_.js";const M={class:"supplier-quote-form"},J={class:"card-header"},Z={class:"card-header"},X={class:"header-title-row"},K={class:"item-name"},ee={key:0,class:"item-spec"},te={class:"header-with-help"},re={class:"total-price"},le={class:"tariff-cell"},ae={class:"tariff-cell__value"},ie={class:"tariff-cell__meta"},ne={key:0},oe={class:"tariff-cell__total"},ue={key:1,class:"tariff-cell__empty"},se={class:"notes-header"},de={class:"notes-field-wrapper"},ce={class:"quote-summary"},me={class:"summary-item"},fe={class:"label"},pe={class:"value"},qe={class:"summary-item total"},ye={class:"label"},Ie={class:"value"},ge={key:0,class:"summary-item"},he={class:"label"},ve={class:"value"},be={class:"label"},Pe={class:"value"},Ce={style:{display:"flex",gap:"16px","align-items":"flex-start"}},Le={style:{flex:"0 0 220px"}},we={key:0,style:{flex:"0 0 180px"}},_e={class:"form-item-hint"},xe={style:{margin:"24px 0 16px 0"}},Te={class:"el-upload__tip"},Oe={class:"form-actions"},Ue=U(t({__name:"SupplierQuoteForm",props:{rfq:{},existingQuote:{}},emits:["submitted","cancel"],setup(t,{emit:U}){const Ue=G(),ke=t,Qe=U,{t:Ve}=r();T();const Se=l(),Ne=l(),Re=l(!1),je=l(null),De=a(()=>ke.existingQuote),Ee=l([]),$e=l([]),Fe=i({}),Ae=i({}),ze=new Map,We=a(()=>Y(ke.rfq?.projectLocation,ke.rfq?.project_location,"")),He=a(()=>{const e=Y(ke.rfq?.requiredDocuments,ke.rfq?.required_documents,[]);return Array.isArray(e)?e.map(e=>String(e??"").trim()).filter(e=>e.length>0):[]}),Ge={technicalspec:"rfq.documents.technicalSpec",businesslicense:"rfq.documents.businessLicense",qualitycert:"rfq.documents.qualityCert",taxcert:"rfq.documents.taxCert",bankinfo:"rfq.documents.bankInfo",references:"rfq.documents.references"},Ye=a(()=>He.value.length?He.value.map(e=>function(e){const t=e.toLowerCase().replace(/[^a-z0-9]/g,""),r=Ge[t];if(!r)return e;const l=Ve(r);return l!==r?l:e}(e)).join(", "):"-"),Be=a(()=>He.value.length>0),Me=a(()=>[{value:"CNY",label:Ve("rfq.quote.currencyOptions.CNY")},{value:"USD",label:Ve("rfq.quote.currencyOptions.USD")},{value:"EUR",label:Ve("rfq.quote.currencyOptions.EUR")},{value:"JPY",label:Ve("rfq.quote.currencyOptions.JPY")},{value:"THB",label:Ve("rfq.quote.currencyOptions.THB")}]),Je=["Australia","Bulgaria","CHINA","AMERICA","Germany","Spain","France","Indonesia","Italy","Japan","Korea","Morocco","Holland","Poland","Singapore","Slovenia","TAIWAN","England","MEXICO","THILAND","vietnam"],Ze=a(()=>[{value:"EXW",label:Ve("supplierRegistration.incoterms.EXW")},{value:"FOB",label:Ve("supplierRegistration.incoterms.FOB")},{value:"CIF",label:Ve("supplierRegistration.incoterms.CIF")},{value:"CFR",label:Ve("supplierRegistration.incoterms.CFR")},{value:"DDP",label:Ve("supplierRegistration.incoterms.DDP")},{value:"DDU",label:Ve("supplierRegistration.incoterms.DDU")},{value:"DAP",label:Ve("supplierRegistration.incoterms.DAP")},{value:"DAT",label:Ve("supplierRegistration.incoterms.DAT")},{value:"FCA",label:Ve("supplierRegistration.incoterms.FCA")},{value:"CPT",label:Ve("supplierRegistration.incoterms.CPT")},{value:"CIP",label:Ve("supplierRegistration.incoterms.CIP")}]),Xe=l([]),Ke=i({notes:"",currency:"CNY",taxStatus:"inclusive",deliveryTerms:"",shippingCountry:"",lineItems:{}});function et(e){if(!e)return"";const t=[];e.name&&t.push(e.name),e.nameZh&&e.nameZh!==e.name&&t.push(e.nameZh);const r=t.length>0?t.join(" / "):e.code;return e.code?`${r} (${e.code})`:r}function tt(e){if(!e)return"-";const t=`rfq.projectLocation.${e}`,r=Ve(t);return r!==t?r:String(e)}async function rt(){try{const{countries:t}=await async function(){return(await e("/tariffs/options")).data}();Array.isArray(t)&&t.length&&(Xe.value=t)}catch(t){console.error("[Tariff] Failed to load tariff options:",t)}}function lt(e){return Ee.value.find(t=>t.rfqLineItemId===e)}function at(e){const t=lt(e);if(!t)return 0;const r=Number(t.quantity??0);return Number.isFinite(r)?r:0}function it(e=!1){Ee.value.forEach(t=>{!e&&Fe[t.rfqLineItemId]||nt(t.rfqLineItemId)})}async function nt(t){const r=Ke.lineItems[t],l=Ke.shippingCountry;if(!r||!l||!r.productGroup||!r.productOrigin||!r.unitPrice||r.unitPrice<=0)return void function(e){Fe[e]=null,Ae[e]=!1;const t=lt(e);t&&(t.standardUnitCostLocal=null,t.standardUnitCostUsd=null,t.tariffCalculation=null)}(t);const a={originalPrice:r.unitPrice,shippingCountry:l,productGroup:r.productGroup,productOrigin:r.productOrigin,projectLocation:ke.rfq?.projectLocation||"HZ",deliveryTerms:Ke.deliveryTerms||"",currency:Ke.currency},i=Date.now();ze.set(t,i),Ae[t]=!0;try{const r=await async function(t){return(await e("/tariffs/calculate",{method:"POST",body:t})).data}(a);if(ze.get(t)!==i)return;Fe[t]=r;const l=lt(t);l&&(l.standardUnitCostLocal=r.standardCostLocal??null,l.standardUnitCostUsd=r.standardCostUsd??null,l.tariffCalculation=r)}catch(n){console.error(`[Tariff] Failed to calculate standard cost for line ${t}:`,n)}finally{ze.get(t)===i&&(Ae[t]=!1)}}function ot(e){return Fe[e]||null}function ut(e){const t=ot(e);if(!t)return null;const r=at(e);if(!r)return null;const l=Number(t.standardCost??0);return Number.isFinite(l)?Number((l*r).toFixed(2)):null}n(()=>Ke.shippingCountry,()=>{it(!0)}),n(()=>Ke.currency,()=>{it(!0)}),o(()=>{!function(){if(ke.rfq?.items&&ke.rfq.items.length>0){const e=ke.existingQuote?.quoteItems||[];Ee.value=ke.rfq.items.map(t=>{const r={...t,materialCategory:Y(t.materialCategory,t.materialType,t.distributionCategory,t.distribution_category,""),itemName:Y(t.itemName,t.item_name,t.description,t.remarks,""),specifications:Y(t.specifications,t.parameters,t.remarks,""),currency:t.currency??ke.rfq?.currency??"CNY"},l=e.find(e=>e.rfqLineItemId===r.id),a=Y(l?.unitPrice,l?.unit_price,void 0),i=Number(r.quantity??0),n=Number.isFinite(i)&&a?a*i:B(l?.totalPrice,l?.total_price,0);return Ke.lineItems[r.id]={unitPrice:a,minimumOrderQuantity:Y(l?.minimumOrderQuantity,l?.moq,r.quantity,1),standardPackageQuantity:Y(l?.standardPackageQuantity,void 0),deliveryPeriod:Y(l?.deliveryPeriod,void 0),productOrigin:Y(l?.productOrigin,l?.product_origin,""),productGroup:"OTHERS"},Fe[r.id]=Y(l?.tariffCalculation,l?.tariff_calculation,null),Ae[r.id]=!1,{...r,rfqLineItemId:r.id,unitPrice:a,minimumOrderQuantity:Ke.lineItems[r.id].minimumOrderQuantity,standardPackageQuantity:Ke.lineItems[r.id].standardPackageQuantity,totalPrice:n,deliveryPeriod:Ke.lineItems[r.id].deliveryPeriod,notes:Y(l?.notes,""),brand:Y(l?.brand,r.brand,""),productOrigin:Ke.lineItems[r.id].productOrigin,productGroup:"OTHERS",standardUnitCostLocal:Y(l?.standardLineCostLocal,l?.standardUnitCostLocal,null),standardUnitCostUsd:Y(l?.standardLineCostUsd,l?.standardUnitCostUsd,null),tariffCalculation:Fe[r.id]}}),ke.existingQuote&&(Ke.notes=Y(ke.existingQuote.notes,""),Ke.deliveryTerms=Y(ke.existingQuote.deliveryTerms,""),Ke.shippingCountry=Y(ke.existingQuote.shippingCountry,ke.existingQuote.shipping_country,""),Ke.taxStatus=Y(ke.existingQuote.taxStatus,"inclusive")),Ke.currency=Y(ke.existingQuote?.currency,ke.rfq?.currency,Ke.currency),Ee.value.forEach(e=>{void 0===Fe[e.rfqLineItemId]&&(Fe[e.rfqLineItemId]=null)}),u(()=>{it(!1)})}}(),rt()});const st=a(()=>Ee.value.reduce((e,t)=>e+(t.totalPrice||0),0)),dt=a(()=>{const e={};let t=0,r=0,l=!1,a=!1;return Ee.value.forEach(i=>{const n=ot(i.rfqLineItemId);if(!n)return;const o=at(i.rfqLineItemId);if(!o)return;const u=Number(n.standardCost??0);if(!Number.isFinite(u))return;const s=u*o,d=n.standardCostCurrency||Ke.currency||"CNY";l=!0,"USD"===d?(t+=s,r+=1):e[d]=(e[d]||0)+s,n.hasSpecialTariff&&(a=!0)}),{hasData:l,usdTotal:r>0?Number(t.toFixed(2)):null,localTotals:Object.fromEntries(Object.entries(e).map(([e,t])=>[e,Number(t.toFixed(2))])),hasSpecialTariff:a}});function ct(e,t="USD"){return null==e||Number.isNaN(e)?"-":`${e.toFixed(2)} ${t}`}function mt(e){return null==e||Number.isNaN(e)?"-":`${(100*e).toFixed(2)}%`}function ft(e){if(!e)return"-";try{return new Date(e).toLocaleString()}catch{return e}}function pt(e,t="CNY"){return null==e?"-":`${e.toFixed(2)} ${t}`}function qt(e,t){$e.value=t}function yt(e,t){$e.value=t}async function It(){if(!Se.value)return;try{await Se.value.validate()}catch{return}const e=Ee.value.filter(e=>{const t=Ke.lineItems[e.rfqLineItemId];if(!t)return!0;const r=void 0!==t.unitPrice&&null!==t.unitPrice,l=String(Y(e.notes,"")??"").trim().length>0;return!r&&!l});if(e.length>0){const t=e.map(e=>`#${e.rfqLineItemId}: ${e.itemName}`).join(", ");return void Ue.warning(Ve("rfq.quote.priceOrNotesRequired",{count:e.length,items:t}))}const t=Ee.value.filter(e=>{const t=Ke.lineItems[e.rfqLineItemId];return t&&void 0!==t.unitPrice&&null!==t.unitPrice});if(t.filter(e=>{const t=Ke.lineItems[e.rfqLineItemId];return!t?.minimumOrderQuantity||t.minimumOrderQuantity<=0}).length>0)return void Ue.warning(Ve("rfq.quote.moqRequiredWhenPriced"));if(t.filter(e=>{const t=Ke.lineItems[e.rfqLineItemId];return!t?.standardPackageQuantity||t.standardPackageQuantity<=0}).length>0)return void Ue.warning(Ve("rfq.quote.spqRequiredWhenPriced"));if(t.filter(e=>{const t=Ke.lineItems[e.rfqLineItemId];return!t?.productOrigin||""===t.productOrigin.trim()}).length>0)return void Ue.warning(Ve("rfq.quote.productOriginRequiredWhenPriced"));if(Be.value&&!function(){if($e.value.length>0)return!0;const e=De.value?.attachments;return Array.isArray(e)&&e.length>0}())return void Ue.warning(Ve("rfq.quote.requiredDocumentsUploadRequired"));if(!Ke.shippingCountry)return void Ue.warning(Ve("rfq.quote.shippingCountryRequired"));if(t.filter(e=>{const t=Ke.lineItems[e.rfqLineItemId];return!t?.productGroup||""===t.productGroup.trim()}).length>0)Ue.warning(Ve("rfq.quote.productGroupRequiredWhenPriced"));else{je.value=null,Re.value=!0;try{const e=new FormData,t={currency:Ke.currency,taxStatus:Ke.taxStatus,lineItems:Ee.value.map(e=>({rfqLineItemId:e.rfqLineItemId,unitPrice:Ke.lineItems[e.rfqLineItemId]?.unitPrice,minimumOrderQuantity:Ke.lineItems[e.rfqLineItemId]?.minimumOrderQuantity,standardPackageQuantity:Ke.lineItems[e.rfqLineItemId]?.standardPackageQuantity,brand:e.brand,deliveryPeriod:Ke.lineItems[e.rfqLineItemId]?.deliveryPeriod,notes:e.notes,productOrigin:Ke.lineItems[e.rfqLineItemId]?.productOrigin,productGroup:Ke.lineItems[e.rfqLineItemId]?.productGroup,taxStatus:Ke.taxStatus})),deliveryTerms:Ke.deliveryTerms,shippingCountry:Ke.shippingCountry,notes:Ke.notes};e.append("quoteData",JSON.stringify(t)),$e.value.forEach(t=>{t.raw&&e.append("attachments",t.raw)});const r=!!ke.existingQuote,l=r?`/api/rfq-workflow/${ke.rfq.id}/quotes/${ke.existingQuote.id}`:`/api/rfq-workflow/${ke.rfq.id}/quotes`,a=await fetch(l,{method:r?"PUT":"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:e});if(!a.ok){const e=await a.json();throw new Error(e.message||"Failed to submit quote")}const i=r?"rfq.quote.updateSuccess":"rfq.quote.submitSuccess";je.value={type:"success",message:String(Ve(i))},Qe("submitted")}catch(r){je.value={type:"error",message:r?.message||String(Ve("rfq.quote.submitError"))}}finally{Re.value=!1}}}function gt(){Qe("cancel")}function ht(e){const t=Ke.lineItems[e.rfqLineItemId];return t&&void 0!==t.unitPrice&&null!==t.unitPrice}function vt(e){return e.notes&&"string"==typeof e.notes&&e.notes.trim().length>0}function bt(e){return!ht(e)&&!vt(e)}function Pt(e){return ht(e)?Ve("rfq.lineItems.notesPlaceholder"):Ve("rfq.lineItems.notesRequiredPlaceholder")}function Ct(){return Ee.value.filter(e=>{const t=Ke.lineItems[e.rfqLineItemId];if(!t)return!1;const r=void 0!==t.unitPrice&&null!==t.unitPrice,l=e.notes&&"string"==typeof e.notes&&e.notes.trim().length>0;return r||l}).length}function Lt(){const e=Ee.value.length;if(0===e)return 0;const t=Ct();return Math.round(t/e*100)}function wt(){const e=Lt();return 100===e?"success":e>=50?"warning":"info"}function _t(){const e=Lt();return 100===e?"#67c23a":e>=50?"#e6a23c":"#909399"}return(e,r)=>{const l=H,a=D,i=W,n=z,o=A,u=S,T=j,U=F,G=Q,Y=v,B=h,ke=L,Qe=$,ze=E,He=_,Ge=R,Be=N,rt=V,lt=k;return O(),s("div",M,[d(n,{class:"rfq-info-card",shadow:"never"},{header:c(()=>[q("div",J,[q("h3",null,p(m(Ve)("rfq.quote.rfqInfo")),1)])]),default:c(()=>[d(i,{column:2,border:""},{default:c(()=>[d(l,{label:m(Ve)("rfq.form.title")},{default:c(()=>[f(p(t.rfq?.title),1)]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.rfqType")},{default:c(()=>[d(a,{type:"short_term"===t.rfq?.rfqType?"success":"warning"},{default:c(()=>[f(p(m(Ve)(`rfq.rfqType.${t.rfq?.rfqType}`)),1)]),_:1},8,["type"])]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.deliveryPeriod")},{default:c(()=>[f(p(t.rfq?.deliveryPeriod)+" "+p(m(Ve)("common.days")),1)]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.projectLocation")},{default:c(()=>[f(p(tt(We.value)),1)]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.validUntil")},{default:c(()=>[f(p(ft(t.rfq?.validUntil)),1)]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.requiredDocuments"),span:2},{default:c(()=>[f(p(Ye.value),1)]),_:1},8,["label"]),d(l,{label:m(Ve)("rfq.form.description"),span:2},{default:c(()=>[f(p(t.rfq?.description||"-"),1)]),_:1},8,["label"])]),_:1})]),_:1}),d(n,{class:"quote-form-card"},{header:c(()=>[q("div",Z,[q("div",X,[q("h3",null,p(m(Ve)("rfq.quote.lineItemQuotes")),1),d(a,{type:wt(),size:"large"},{default:c(()=>[f(p(`${Ct()}/${Ee.value.length} ${Ve("rfq.quote.itemsResponded")||"items responded"}`),1)]),_:1},8,["type"])]),d(o,{title:m(Ve)("rfq.quote.quoteInstruction"),type:"info",closable:!1,"show-icon":""},null,8,["title"]),d(u,{percentage:Lt(),color:_t(),"stroke-width":8,style:{"margin-top":"12px"}},null,8,["percentage","color"])])]),default:c(()=>[d(lt,{ref_key:"formRef",ref:Se,model:Ke,"label-position":"top"},{default:c(()=>[d(Ge,{data:Ee.value,border:"",stripe:"","max-height":"600px"},{default:c(()=>[d(T,{type:"index",label:m(Ve)("rfq.items.lineNumber"),width:"70",align:"center"},null,8,["label"]),d(T,{label:m(Ve)("rfq.lineItems.materialCategory"),width:"120"},{default:c(({row:e})=>{return[f(p((t=e.materialCategory,t?"equipment"===t?Ve("rfq.distributionCategory.equipment"):"consumables"===t?Ve("rfq.lineItems.consumables"):"hardware"===t?Ve("rfq.distributionCategory.hardware"):"other"===t?Ve("common.other"):t:"-")),1)];var t}),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.items.itemName"),"min-width":"150"},{default:c(({row:e})=>[q("div",null,[q("div",K,p(e.itemName),1),e.specifications?(O(),s("div",ee,p(e.specifications),1)):I("",!0)])]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.items.quantity"),width:"120"},{default:c(({row:e})=>[f(p(e.quantity)+" "+p(e.unit),1)]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.quote.moq"),width:"150"},{header:c(()=>[q("div",null,p(m(Ve)("rfq.quote.moq")),1)]),default:c(({row:e,$index:t})=>[d(G,{prop:`lineItems.${e.rfqLineItemId}.minimumOrderQuantity`,rules:[{validator:(t,r,l)=>{void 0!==Ke.lineItems[e.rfqLineItemId]?.unitPrice&&null!==Ke.lineItems[e.rfqLineItemId]?.unitPrice&&(!r||r<=0)?l(new Error(m(Ve)("rfq.quote.moqRequiredWhenPriced"))):l()},trigger:"change"}]},{default:c(()=>[d(U,{modelValue:Ke.lineItems[e.rfqLineItemId].minimumOrderQuantity,"onUpdate:modelValue":t=>Ke.lineItems[e.rfqLineItemId].minimumOrderQuantity=t,min:1,step:1,precision:0,size:"small","controls-position":"right",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.moqPlaceholder"),onChange:r=>function(e,t){const r=Ke.lineItems[e]?.minimumOrderQuantity,l=Ee.value[t];l&&(l.minimumOrderQuantity=r)}(e.rfqLineItemId,t)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.quote.spq"),width:"150"},{header:c(()=>[q("div",null,p(m(Ve)("rfq.quote.spq")),1)]),default:c(({row:e,$index:t})=>[d(G,{prop:`lineItems.${e.rfqLineItemId}.standardPackageQuantity`,rules:[{validator:(t,r,l)=>{void 0!==Ke.lineItems[e.rfqLineItemId]?.unitPrice&&null!==Ke.lineItems[e.rfqLineItemId]?.unitPrice&&(!r||r<=0)?l(new Error(m(Ve)("rfq.quote.spqRequiredWhenPriced"))):l()},trigger:"change"}]},{default:c(()=>[d(U,{modelValue:Ke.lineItems[e.rfqLineItemId].standardPackageQuantity,"onUpdate:modelValue":t=>Ke.lineItems[e.rfqLineItemId].standardPackageQuantity=t,min:1,step:1,precision:0,size:"small","controls-position":"right",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.spqPlaceholder"),onChange:r=>function(e,t){const r=Ke.lineItems[e]?.standardPackageQuantity,l=Ee.value[t];l&&(l.standardPackageQuantity=r)}(e.rfqLineItemId,t)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.quote.unitPrice"),width:"150"},{header:c(()=>[q("div",te,[f(p(m(Ve)("rfq.quote.unitPrice"))+" ",1),d(B,{content:m(Ve)("rfq.quote.unitPriceHelpTip"),placement:"top"},{default:c(()=>[d(Y,{class:"help-icon"},{default:c(()=>[d(m(b))]),_:1})]),_:1},8,["content"])])]),default:c(({row:e,$index:t})=>[d(G,{prop:`lineItems.${e.rfqLineItemId}.unitPrice`,rules:[{type:"number",min:0,message:m(Ve)("rfq.quote.unitPriceMinZero"),trigger:"blur"}]},{default:c(()=>[d(U,{modelValue:Ke.lineItems[e.rfqLineItemId].unitPrice,"onUpdate:modelValue":t=>Ke.lineItems[e.rfqLineItemId].unitPrice=t,min:0,step:.01,"step-strictly":!1,precision:2,size:"small","controls-position":"right",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.unitPricePlaceholder"),class:g({"has-value":void 0!==Ke.lineItems[e.rfqLineItemId]?.unitPrice&&null!==Ke.lineItems[e.rfqLineItemId]?.unitPrice}),onChange:r=>function(e,t){const r=Ke.lineItems[e]?.unitPrice,l=Ee.value[t];l&&(l.unitPrice=r,r&&l.quantity?l.totalPrice=r*l.quantity:l.totalPrice=0),nt(e)}(e.rfqLineItemId,t)},null,8,["modelValue","onUpdate:modelValue","placeholder","class","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.quote.totalPrice"),width:"140"},{default:c(({row:e})=>[q("span",re,p(pt(e.totalPrice,e.currency)),1)]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.quote.standardUnitCost"),"min-width":"220"},{default:c(({row:e})=>[q("div",le,[Fe[e.rfqLineItemId]?(O(),s(P,{key:0},[q("div",ae,[f(p(ct(Fe[e.rfqLineItemId]?.standardCost??null,Fe[e.rfqLineItemId]?.standardCostCurrency||"USD"))+" ",1),Fe[e.rfqLineItemId]?.hasSpecialTariff?(O(),y(a,{key:0,type:"warning",size:"small",effect:"dark"},{default:c(()=>[f(p(m(Ve)("rfq.quote.specialTariffTag")),1)]),_:1})):I("",!0)]),q("div",ie,[q("span",null,p(m(Ve)("rfq.quote.tariffRateLabel",{rate:mt(Fe[e.rfqLineItemId]?.freightRate??null)})),1),Fe[e.rfqLineItemId]?.specialTariffRate?(O(),s("span",ne,p(m(Ve)("rfq.quote.specialTariffRateLabel",{rate:mt(Fe[e.rfqLineItemId]?.specialTariffRate??null)})),1)):I("",!0)]),q("div",oe,p(m(Ve)("rfq.quote.standardLineTotal",{value:ct(ut(e.rfqLineItemId),Fe[e.rfqLineItemId]?.standardCostCurrency||"USD")})),1)],64)):(O(),s("div",ue,[Ae[e.rfqLineItemId]?(O(),y(Y,{key:0,class:"tariff-spinner"},{default:c(()=>[d(m(C))]),_:1})):I("",!0),q("span",null,p(m(Ve)("rfq.quote.tariffPending")),1)]))])]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.lineItems.brand"),width:"140"},{default:c(({row:e})=>[d(ke,{modelValue:e.brand,"onUpdate:modelValue":t=>e.brand=t,size:"small",placeholder:m(Ve)("rfq.lineItems.brandPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.quote.productOriginLabel"),width:"160"},{header:c(()=>[q("div",null,p(m(Ve)("rfq.quote.productOriginLabel")),1)]),default:c(({row:e,$index:t})=>[d(G,{prop:`lineItems.${e.rfqLineItemId}.productOrigin`,rules:[{validator:(t,r,l)=>{!(void 0!==Ke.lineItems[e.rfqLineItemId]?.unitPrice&&null!==Ke.lineItems[e.rfqLineItemId]?.unitPrice)||r&&""!==r.trim()?l():l(new Error(m(Ve)("rfq.quote.productOriginRequiredWhenPriced")))},trigger:"change"}]},{default:c(()=>[d(ze,{modelValue:Ke.lineItems[e.rfqLineItemId].productOrigin,"onUpdate:modelValue":t=>Ke.lineItems[e.rfqLineItemId].productOrigin=t,size:"small",filterable:"",clearable:"",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.productOriginPlaceholder"),onChange:r=>function(e,t){const r=Ke.lineItems[e]?.productOrigin,l=Ee.value[t];l&&(l.productOrigin=r),nt(e)}(e.rfqLineItemId,t)},{default:c(()=>[(O(),s(P,null,w(Je,e=>d(Qe,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["prop","rules"])]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.quote.deliveryPeriod"),width:"140"},{default:c(({row:e,$index:t})=>[d(U,{modelValue:Ke.lineItems[e.rfqLineItemId].deliveryPeriod,"onUpdate:modelValue":t=>Ke.lineItems[e.rfqLineItemId].deliveryPeriod=t,min:1,step:1,precision:0,size:"small","controls-position":"right",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.deliveryPeriodPlaceholder"),onChange:r=>function(e,t){const r=Ke.lineItems[e]?.deliveryPeriod,l=Ee.value[t];l&&(l.deliveryPeriod=r)}(e.rfqLineItemId,t)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:1},8,["label"]),d(T,{label:m(Ve)("rfq.lineItems.notes"),"min-width":"220"},{header:c(()=>[q("div",se,[q("span",null,p(m(Ve)("rfq.lineItems.notes")),1),d(B,{content:m(Ve)("rfq.quote.notesHelpText"),placement:"top"},{default:c(()=>[d(Y,{class:"help-icon"},{default:c(()=>[d(m(b))]),_:1})]),_:1},8,["content"])])]),default:c(({row:e})=>[q("div",de,[d(ke,{modelValue:e.notes,"onUpdate:modelValue":t=>e.notes=t,type:"textarea",rows:2,size:"small",placeholder:Pt(e),class:g({"notes-required":bt(e),"notes-filled":vt(e)})},null,8,["modelValue","onUpdate:modelValue","placeholder","class"]),ht(e)||vt(e)?I("",!0):(O(),y(He,{key:0,size:"small",type:"warning",plain:"",class:"no-quote-btn",onClick:t=>function(e){e.notes=Ve("rfq.quote.noQuoteTemplate"),Ue.success(Ve("rfq.quote.templateFilled"))}(e)},{default:c(()=>[f(p(m(Ve)("rfq.quote.cannotQuote")),1)]),_:1},8,["onClick"]))])]),_:1},8,["label"])]),_:1},8,["data"]),q("div",ce,[q("div",me,[q("span",fe,p(m(Ve)("rfq.quote.totalItems"))+":",1),q("span",pe,p(Ee.value.length),1)]),q("div",qe,[q("span",ye,p(m(Ve)("rfq.quote.grandTotal"))+":",1),q("span",Ie,p(pt(st.value,Ke.currency)),1)]),dt.value.hasData&&null!==dt.value.usdTotal?(O(),s("div",ge,[q("span",he,p(m(Ve)("rfq.quote.standardCostTotalUsd"))+":",1),q("span",ve,p(ct(dt.value.usdTotal,"USD")),1)])):I("",!0),(O(!0),s(P,null,w(dt.value.localTotals,(e,t)=>(O(),s("div",{key:`standard-${t}`,class:"summary-item"},[q("span",be,p(m(Ve)("rfq.quote.standardCostTotalWithCurrency",{currency:t}))+": ",1),q("span",Pe,p(ct(e,String(t))),1)]))),128))]),dt.value.hasData&&dt.value.hasSpecialTariff?(O(),y(o,{key:0,type:"warning",closable:!1,title:m(Ve)("rfq.quote.specialTariffNotice"),"show-icon":"",style:{"margin-top":"12px"}},null,8,["title"])):I("",!0),d(G,{label:m(Ve)("rfq.quote.currency"),class:"currency-field",required:""},{default:c(()=>[q("div",Ce,[q("div",Le,[d(ze,{modelValue:Ke.currency,"onUpdate:modelValue":r[0]||(r[0]=e=>Ke.currency=e),style:{width:"100%"},placeholder:m(Ve)("rfq.quote.selectCurrency")},{default:c(()=>[(O(!0),s(P,null,w(Me.value,e=>(O(),y(Qe,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),"CNY"===Ke.currency?(O(),s("div",we,[d(ze,{modelValue:Ke.taxStatus,"onUpdate:modelValue":r[1]||(r[1]=e=>Ke.taxStatus=e),style:{width:"100%"},size:"default"},{default:c(()=>[d(Qe,{value:"inclusive",label:m(Ve)("rfq.quote.taxInclusive")},null,8,["label"]),d(Qe,{value:"exclusive",label:m(Ve)("rfq.quote.taxExclusive")},null,8,["label"])]),_:1},8,["modelValue"])])):I("",!0)]),q("p",_e,p(m(Ve)("rfq.quote.currencyHint")),1)]),_:1},8,["label"]),d(Be),q("h4",xe,p(m(Ve)("rfq.quote.additionalInfo")),1),d(G,{label:m(Ve)("rfq.quote.deliveryTerms")},{default:c(()=>[d(ze,{modelValue:Ke.deliveryTerms,"onUpdate:modelValue":r[2]||(r[2]=e=>Ke.deliveryTerms=e),style:{width:"100%"},placeholder:m(Ve)("rfq.quote.deliveryTermsPlaceholder"),clearable:""},{default:c(()=>[(O(!0),s(P,null,w(Ze.value,e=>(O(),y(Qe,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),d(G,{label:m(Ve)("rfq.quote.shippingCountry"),prop:"shippingCountry",rules:[{required:!0,message:m(Ve)("rfq.quote.shippingCountryRequired"),trigger:"change"}]},{default:c(()=>[d(ze,{modelValue:Ke.shippingCountry,"onUpdate:modelValue":r[3]||(r[3]=e=>Ke.shippingCountry=e),filterable:"",clearable:"",style:{width:"100%"},placeholder:m(Ve)("rfq.quote.shippingCountryPlaceholder")},{default:c(()=>[(O(!0),s(P,null,w(Xe.value,e=>(O(),y(Qe,{key:e.code,label:et(e),value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),d(G,{label:m(Ve)("rfq.quote.notes")},{default:c(()=>[d(ke,{modelValue:Ke.notes,"onUpdate:modelValue":r[4]||(r[4]=e=>Ke.notes=e),type:"textarea",rows:4,placeholder:m(Ve)("rfq.quote.notesPlaceholder"),maxlength:"1000","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(G,{label:m(Ve)("rfq.quote.attachments")},{default:c(()=>[d(rt,{ref_key:"uploadRef",ref:Ne,"file-list":$e.value,"on-change":qt,"on-remove":yt,"auto-upload":!1,limit:10,accept:".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png",multiple:""},{trigger:c(()=>[d(He,{type:"primary",plain:""},{default:c(()=>[f(p(m(Ve)("rfq.quote.selectFiles")),1)]),_:1})]),tip:c(()=>[q("div",Te,p(m(Ve)("rfq.quote.attachmentHint")),1)]),_:1},8,["file-list"])]),_:1},8,["label"]),q("div",Oe,[d(He,{onClick:gt},{default:c(()=>[f(p(m(Ve)("common.cancel")),1)]),_:1}),d(He,{type:"primary",loading:Re.value,onClick:It},{default:c(()=>[f(p(De.value?m(Ve)("rfq.quote.updateQuote"):m(Ve)("rfq.quote.submitQuote")),1)]),_:1},8,["loading"])]),d(x,{name:"el-fade-in"},{default:c(()=>[je.value?(O(),y(o,{key:0,class:"submit-feedback",type:je.value.type,title:je.value.message,"show-icon":"",closable:"",onClose:r[5]||(r[5]=e=>je.value=null)},null,8,["type","title"])):I("",!0)]),_:1})]),_:1},8,["model"])]),_:1})])}}}),[["__scopeId","data-v-b86b4287"]]);export{Ue as default};
