import{a$ as e,b0 as a,b1 as l,b2 as r,aP as s,h as u,c as i,d as o,u as n,g as t,ab as p,B as c,C as d,b as m,j as v,e as g,m as h,k as f,f as y,E as b,z as G,H as w,y as _,x as V,O as I,b3 as S,t as A,A as k,b4 as C,F as x,r as F,w as N,b5 as M,o as U,_ as j}from"./index-CyRNMvNu.js";import{v as B}from"./el-loading-BOtuuplO.js";import{E as $,a as P}from"./el-radio-group-BuXSpwEH.js";import{E as z,a as T}from"./el-tab-pane-C-VzeyFm.js";import{E}from"./el-alert-C_2vi33t.js";import{E as R,a as D}from"./el-form-item-BQHiulRL.js";import{E as L}from"./el-switch-WC4C_ojf.js";import{E as O}from"./el-card-DXvXWoCD.js";import{E as q,a as W}from"./el-table-column-D7PrEwn8.js";import"./el-scrollbar-CdTVjh_P.js";import{E as H}from"./el-tag-DGgsViqv.js";import{E as Y,a as J}from"./el-select-Dj9cgJha.js";/* empty css                 */import{P as K}from"./PageHeader-8_jhZxUx.js";import{l as Q}from"./users-ey17_CaQ.js";import{u as X}from"./useNotification-DsktK-_s.js";import"./index-DBC3OMzC.js";import"./castArray-zz_IM52U.js";import"./_baseClone-CqMMMsoT.js";import"./debounce-DFNSnbDM.js";const Z=e=>e&&"object"==typeof e&&"data"in e?e.data:e,ee=(e,a,l="Uncategorized")=>{const r=new Map;return e.forEach(e=>{const s=a(e)||l;r.has(s)||r.set(s,[]),r.get(s).push(e)}),r},ae=s("purchasingGroups",()=>{const s=u([]),o=u(null),n=u([]),t=u([]),p=u({}),c=u({}),d=u([]),m=u(null),v=u(!1),g=u(!1),h=u(!1),f=u(!1),y=u(!1),b=i(()=>s.value.filter(e=>1===e.isActive)),G=i(()=>ee(s.value,e=>e.category||"","Uncategorized")),w=i(()=>ee(s.value,e=>e.region||"","Unspecified"));async function _(a,l={}){const r=!1!==l.updateState;r&&(g.value=!0);try{const l=await async function(a){return e(`/purchasing-groups/${a}/members`)}(a),s=Z(l);return p.value[a]=s,r&&(n.value=s),s}finally{r&&(g.value=!1)}}async function V(a,l={}){const r=!1!==l.updateState;r&&(h.value=!0);try{const l=await async function(a){return e(`/purchasing-groups/${a}/suppliers`)}(a),s=Z(l);return c.value[a]=s,r&&(t.value=s),s}finally{r&&(h.value=!1)}}async function I(a){f.value=!0;try{const l=await async function(a){return e(`/purchasing-groups/${a}/buyer-assignments`)}(a);return d.value=Z(l),d.value}finally{f.value=!1}}return{groups:s,currentGroup:o,members:n,suppliers:t,buyerAssignments:d,workloadAnalysis:m,loading:v,loadingMembers:g,loadingSuppliers:h,loadingAssignments:f,loadingWorkload:y,activeGroups:b,groupsByCategory:G,groupsByRegion:w,fetchGroups:async function(a){v.value=!0;try{const l=await async function(a){return e("/purchasing-groups",{params:a})}(a);return s.value=Z(l),s.value}finally{v.value=!1}},fetchGroup:async function(a){v.value=!0;try{const l=await async function(a){return e(`/purchasing-groups/${a}`)}(a);return o.value=Z(l),n.value=o.value.members||[],t.value=o.value.suppliers||[],o.value}finally{v.value=!1}},createGroup:async function(e){v.value=!0;try{const l=await async function(e){return a("/purchasing-groups",e)}(e),r=Z(l);return s.value.unshift(r),r}finally{v.value=!1}},updateGroup:async function(e,a){v.value=!0;try{const r=await async function(e,a){return l(`/purchasing-groups/${e}`,a)}(e,a),u=Z(r),i=s.value.findIndex(a=>a.id===e);return-1!==i&&(s.value[i]=u),o.value&&o.value.id===e&&(o.value={...o.value,...u}),u}finally{v.value=!1}},deleteGroup:async function(e){v.value=!0;try{await async function(e){return r(`/purchasing-groups/${e}`)}(e),s.value=s.value.filter(a=>a.id!==e),o.value&&o.value.id===e&&(o.value=null,n.value=[],t.value=[])}finally{v.value=!1}},fetchMembers:_,addMembers:async function(e,l){g.value=!0;try{await async function(e,l){return a(`/purchasing-groups/${e}/members`,l)}(e,l),await _(e);const r=s.value.findIndex(a=>a.id===e);-1!==r&&(s.value[r].memberCount=n.value.length)}finally{g.value=!1}},removeMember:async function(e,a){g.value=!0;try{await async function(e,a){return r(`/purchasing-groups/${e}/members/${a}`)}(e,a),n.value=n.value.filter(e=>e.buyerId!==a),p.value[e]=n.value;const l=s.value.findIndex(a=>a.id===e);-1!==l&&(s.value[l].memberCount=n.value.length)}finally{g.value=!1}},fetchSuppliers:V,hydrateGroupAssociations:function(e){const a=Object.prototype.hasOwnProperty.call(p.value,e),l=Object.prototype.hasOwnProperty.call(c.value,e);return n.value=a?p.value[e]:[],t.value=l?c.value[e]:[],{hasMembers:a,hasSuppliers:l}},prefetchGroupAssociations:async function(e){const a=Array.from(new Set(e.filter(e=>Number.isFinite(e)&&e>0)));await Promise.all(a.map(async e=>{try{await Promise.all([_(e,{updateState:!1}),V(e,{updateState:!1})])}catch(a){console.error("Failed to prefetch purchasing group associations",{groupId:e,error:a})}}))},addSuppliers:async function(e,l){h.value=!0;try{await async function(e,l){return a(`/purchasing-groups/${e}/suppliers`,l)}(e,l),await V(e);const r=s.value.findIndex(a=>a.id===e);-1!==r&&(s.value[r].supplierCount=t.value.length)}finally{h.value=!1}},removeSupplier:async function(e,a){h.value=!0;try{await async function(e,a){return r(`/purchasing-groups/${e}/suppliers/${a}`)}(e,a),t.value=t.value.filter(e=>e.supplierId!==a),c.value[e]=t.value;const l=s.value.findIndex(a=>a.id===e);-1!==l&&(s.value[l].supplierCount=t.value.length)}finally{h.value=!1}},fetchBuyerAssignments:I,assignSuppliersToBuyer:async function(e,l){f.value=!0;try{const r=await async function(e,l){return a(`/purchasing-groups/${e}/assign-to-buyer`,l)}(e,l),s=Z(r);return await I(e),s}finally{f.value=!1}},removeBuyerAssignment:async function(e,a){f.value=!0;try{await async function(e,a){return r(`/purchasing-groups/${e}/buyer-assignments/${a}`)}(e,a),d.value=d.value.filter(e=>e.id!==a)}finally{f.value=!1}},fetchWorkloadAnalysis:async function(){y.value=!0;try{const a=await async function(){return e("/purchasing-groups/analytics/workload")}();return m.value=Z(a),m.value}finally{y.value=!1}},rebuildCache:async function(){v.value=!0;try{await async function(){return a("/purchasing-groups/admin/rebuild-cache")}()}finally{v.value=!1}},clearCurrentGroup:function(){o.value=null,n.value=[],t.value=[],d.value=[]}}}),le={class:"purchasing-groups-view"},re={class:"filters-bar"},se={class:"filter-group"},ue={key:2,class:"no-access-text"},ie={class:"manage-section"},oe={class:"section-header"},ne={class:"manage-section"},te={class:"section-header"},pe={class:"manage-section"},ce={class:"section-header"},de={class:"assignment-actions"},me={style:{"margin-left":"10px",color:"#909399","font-size":"12px"}},ve=j(o({name:"PurchasingGroupsView",__name:"PurchasingGroupsView",setup(e){const a=X(),{t:l}=n(),r=t(),s=ae(),{groups:o,loading:j,members:Z,suppliers:ee,buyerAssignments:ve,loadingMembers:ge,loadingSuppliers:he,loadingAssignments:fe}=p(s),ye=u(""),be=u({category:"",region:"",isActive:""}),Ge=u(!1),we=u(!1),_e=u(!1),Ve=u(!1),Ie=u("members"),Se=u(!1),Ae=u(null),ke=u(null),Ce=u(),xe=u({code:"",name:"",description:"",category:"",region:"",isActive:!0}),Fe=i(()=>({code:[{required:!0,message:l("purchasingGroups.validation.codeRequired"),trigger:"blur"}],name:[{required:!0,message:l("purchasingGroups.validation.nameRequired"),trigger:"blur"}]})),Ne=u({buyerIds:[],role:"member",notes:""}),Me=u({supplierIds:[],isPrimary:!1,notes:""}),Ue=u({buyerId:"",supplierIds:[]}),je=()=>{Ue.value={buyerId:"",supplierIds:[]}},Be=u([]),$e=i(()=>r.hasPermission?.("admin.purchasing_groups.manage")??!1),Pe=i(()=>{const e=new Set;return(r.user?.purchasingGroups??[]).forEach(a=>{const l=Number(a?.id),r=String(a?.memberRole??"").toLowerCase();!Number.isFinite(l)||"lead"!==r&&"leader"!==r||e.add(l)}),e}),ze=i(()=>$e.value),Te=e=>null==e?$e.value:$e.value||(e=>null!=e&&Pe.value.has(Number(e)))(e),Ee=i(()=>Te(ke.value?.id)),Re=u([]),De=u(!1),Le=u("");let Oe=0;const qe=e=>{const a=e.companyName?.trim()||e.englishName?.trim()||e.chineseName?.trim()||`#${e.id}`,l=e.companyId?.trim();return l?`${a} (${l})`:a},We=async e=>{Le.value=e;const r=e.trim(),s=++Oe;De.value=!0;try{const e=((await M({q:r||void 0,limit:20,offset:0})).data??[]).map(e=>(e=>({id:e.id,companyName:e.companyName??null,companyId:e.companyId??null,englishName:e.englishName??null,chineseName:e.chineseName??null}))(e));if(!Ve.value||s!==Oe)return;((e,a)=>{const l=new Map;Re.value.filter(e=>a.has(e.id)).forEach(e=>l.set(e.id,e)),e.forEach(e=>l.set(e.id,e)),Re.value=Array.from(l.values())})(e,new Set(Me.value.supplierIds))}catch(u){s===Oe&&(console.error("Failed to search suppliers for purchasing group",u),a.error(l("purchasingGroups.errors.loadSuppliersFailure")))}finally{s===Oe&&(De.value=!1)}},He=async e=>{e&&await We(Le.value)};c(Ve,e=>{if(!e){const e=new Set(Me.value.supplierIds);Re.value=Re.value.filter(a=>e.has(a.id)),Le.value="",De.value=!1}}),c(Z,e=>{const a=new Set(e.map(e=>e.buyerId));Ue.value.buyerId&&!a.has(Ue.value.buyerId)&&(Ue.value.buyerId="")}),c(ee,e=>{const a=new Set(e.map(e=>e.supplierId));Ue.value.supplierIds=Ue.value.supplierIds.filter(e=>a.has(e))}),c(we,e=>{e||je()}),c(Ie,async e=>{"assignments"===e&&ke.value&&Ee.value&&await s.fetchBuyerAssignments(ke.value.id)});const Ye=i(()=>{let e=o.value;if(ye.value){const a=ye.value.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(a)||e.code.toLowerCase().includes(a)||e.description&&e.description.toLowerCase().includes(a))}if(be.value.category&&(e=e.filter(e=>e.category===be.value.category)),be.value.region&&(e=e.filter(e=>e.region===be.value.region)),""!==be.value.isActive){const a="true"===be.value.isActive;e=e.filter(e=>e.isActive===(a?1:0))}return e}),Je=i(()=>Array.from(new Set(o.value.map(e=>e.category).filter(Boolean)))),Ke=i(()=>Array.from(new Set(o.value.map(e=>e.region).filter(Boolean)))),Qe=i(()=>Z.value.map(e=>({value:e.buyerId,label:e.buyerName||e.buyerId}))),Xe=i(()=>ee.value.map(e=>({value:e.supplierId,label:e.companyName||e.companyId||`#${e.supplierId}`}))),Ze=e=>{if(!e)return"-";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString()},ea=e=>{aa(e)},aa=async e=>{if(Te(e.id))try{const a=await s.fetchGroup(e.id);ke.value=a,je();const l=s.hydrateGroupAssociations(e.id);l.hasMembers&&l.hasSuppliers||await Promise.all([l.hasMembers?Promise.resolve():s.fetchMembers(e.id),l.hasSuppliers?Promise.resolve():s.fetchSuppliers(e.id)]),Ee.value?(await s.fetchBuyerAssignments(e.id),Ie.value="assignments"):(ve.value=[],Ie.value="members"),we.value=!0}catch(r){console.error(l("purchasingGroups.errors.loadFailure"),r),403===r?.response?.status||404===r?.response?.status?a.warning(l("purchasingGroups.errors.manageAccessDenied")):a.error(l("purchasingGroups.errors.loadFailure"))}else a.warning(l("purchasingGroups.errors.manageAccessDenied"))},la=()=>{Ge.value=!1,Ae.value=null,Ce.value?.resetFields()},ra=async()=>{Ce.value&&await Ce.value.validate(async e=>{if(e){Se.value=!0;try{Ae.value?(await s.updateGroup(Ae.value.id,{name:xe.value.name,description:xe.value.description||void 0,category:xe.value.category||void 0,region:xe.value.region||void 0,isActive:xe.value.isActive}),a.success(l("purchasingGroups.notifications.updateSuccess"))):(await s.createGroup({code:xe.value.code,name:xe.value.name,description:xe.value.description||void 0,category:xe.value.category||void 0,region:xe.value.region||void 0}),a.success(l("purchasingGroups.notifications.createSuccess"))),la()}catch(r){console.error(l("purchasingGroups.errors.saveFailure"),r);const e=l("purchasingGroups.errors.saveFailure");a.error(r?.response?.data?.message??e)}finally{Se.value=!1}}})},sa=async()=>{if(ke.value&&Ne.value.buyerIds.length){Se.value=!0;try{await s.addMembers(ke.value.id,{buyerIds:Ne.value.buyerIds,role:Ne.value.role,notes:Ne.value.notes||void 0}),a.success(l("purchasingGroups.notifications.addMembersSuccess")),_e.value=!1,Ne.value={buyerIds:[],role:"member",notes:""}}catch(e){console.error(l("purchasingGroups.errors.addMembersFailure"),e),a.error(l("purchasingGroups.errors.addMembersFailure"))}finally{Se.value=!1}}else a.warning(l("purchasingGroups.validation.selectBuyer"))},ua=async()=>{if(ze.value)if(ke.value&&Me.value.supplierIds.length){Se.value=!0;try{await s.addSuppliers(ke.value.id,{supplierIds:Me.value.supplierIds,isPrimary:Me.value.isPrimary,notes:Me.value.notes||void 0}),a.success(l("purchasingGroups.notifications.addSuppliersSuccess")),Ve.value=!1,Me.value={supplierIds:[],isPrimary:!1,notes:""}}catch(e){console.error(l("purchasingGroups.errors.addSuppliersFailure"),e),a.error(l("purchasingGroups.errors.addSuppliersFailure"))}finally{Se.value=!1}}else a.warning(l("purchasingGroups.validation.selectSupplier"))},ia=async()=>{if(ke.value)if(Ue.value.buyerId)if(Ue.value.supplierIds.length)try{const e=await s.assignSuppliersToBuyer(ke.value.id,{buyerId:Ue.value.buyerId,supplierIds:[...Ue.value.supplierIds]}),r=e?.assignedCount??Ue.value.supplierIds.length;a.success(l("purchasingGroups.notifications.assignSuppliersSuccess",{count:r})),je()}catch(e){console.error(l("purchasingGroups.errors.assignSuppliersFailure"),e),a.error(l("purchasingGroups.errors.assignSuppliersFailure"))}else a.warning(l("purchasingGroups.validation.selectAssignmentSupplier"));else a.warning(l("purchasingGroups.validation.selectAssignmentBuyer"))},oa=async()=>{try{const e=await Q();Be.value=e.filter(e=>"purchaser"===e.role)}catch(e){console.error(l("purchasingGroups.errors.loadBuyersFailure"),e)}};return d(async()=>{await Promise.all([s.fetchGroups(),oa()]);const e=o.value.filter(e=>Te(e.id)).map(e=>e.id);e.length>0&&s.prefetchGroupAssociations(e)}),(e,r)=>{const u=I,i=k,o=b,n=J,t=Y,p=q,c=H,d=W,M=O,Q=D,X=L,ae=R,je=w,Pe=T,Le=E,Oe=z,oa=P,na=$,ta=B;return U(),m("div",le,[v(K,{title:y(l)("purchasingGroups.title"),subtitle:y(l)("purchasingGroups.subtitle")},{actions:f(()=>[$e.value?(U(),G(i,{key:0,type:"primary",onClick:r[0]||(r[0]=e=>Ge.value=!0)},{default:f(()=>[v(u,null,{default:f(()=>[v(y(S))]),_:1}),V(" "+A(y(l)("purchasingGroups.createGroup")),1)]),_:1})):_("",!0)]),_:1},8,["title","subtitle"]),g("div",re,[v(o,{modelValue:ye.value,"onUpdate:modelValue":r[1]||(r[1]=e=>ye.value=e),placeholder:y(l)("purchasingGroups.filters.search"),clearable:"",style:{"max-width":"400px"}},{prefix:f(()=>[v(u,null,{default:f(()=>[v(y(C))]),_:1})]),_:1},8,["modelValue","placeholder"]),g("div",se,[v(t,{modelValue:be.value.category,"onUpdate:modelValue":r[2]||(r[2]=e=>be.value.category=e),placeholder:y(l)("purchasingGroups.filters.category"),clearable:"",style:{width:"160px"}},{default:f(()=>[v(n,{label:y(l)("purchasingGroups.filters.allCategories"),value:""},null,8,["label"]),(U(!0),m(x,null,F(Je.value,e=>(U(),G(n,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),v(t,{modelValue:be.value.region,"onUpdate:modelValue":r[3]||(r[3]=e=>be.value.region=e),placeholder:y(l)("purchasingGroups.filters.region"),clearable:"",style:{width:"160px"}},{default:f(()=>[v(n,{label:y(l)("purchasingGroups.filters.allRegions"),value:""},null,8,["label"]),(U(!0),m(x,null,F(Ke.value,e=>(U(),G(n,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),v(t,{modelValue:be.value.isActive,"onUpdate:modelValue":r[4]||(r[4]=e=>be.value.isActive=e),placeholder:y(l)("purchasingGroups.filters.status"),clearable:"",style:{width:"140px"}},{default:f(()=>[v(n,{label:y(l)("purchasingGroups.filters.allStatus"),value:""},null,8,["label"]),v(n,{label:y(l)("purchasingGroups.status.active"),value:"true"},null,8,["label"]),v(n,{label:y(l)("purchasingGroups.status.inactive"),value:"false"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])])]),h((U(),G(M,{class:"groups-card"},{default:f(()=>[v(d,{data:Ye.value,stripe:"",onRowClick:ea},{default:f(()=>[v(p,{prop:"code",label:y(l)("purchasingGroups.table.columns.code"),width:"120"},null,8,["label"]),v(p,{prop:"name",label:y(l)("purchasingGroups.table.columns.name"),"min-width":"200"},null,8,["label"]),v(p,{prop:"category",label:y(l)("purchasingGroups.table.columns.category"),width:"140"},null,8,["label"]),v(p,{prop:"region",label:y(l)("purchasingGroups.table.columns.region"),width:"120"},null,8,["label"]),v(p,{label:y(l)("purchasingGroups.table.columns.members"),width:"100",align:"center"},{default:f(({row:e})=>[v(c,{size:"small"},{default:f(()=>[V(A(e.memberCount||0),1)]),_:2},1024)]),_:1},8,["label"]),v(p,{label:y(l)("purchasingGroups.table.columns.suppliers"),width:"100",align:"center"},{default:f(({row:e})=>[v(c,{size:"small",type:"success"},{default:f(()=>[V(A(e.supplierCount||0),1)]),_:2},1024)]),_:1},8,["label"]),v(p,{label:y(l)("purchasingGroups.table.columns.status"),width:"100",align:"center"},{default:f(({row:e})=>[v(c,{type:e.isActive?"success":"info",size:"small"},{default:f(()=>[V(A(e.isActive?y(l)("purchasingGroups.status.active"):y(l)("purchasingGroups.status.inactive")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),v(p,{label:y(l)("purchasingGroups.table.columns.actions"),width:"180",align:"center",fixed:"right"},{default:f(({row:e})=>[$e.value?(U(),G(i,{key:0,link:"",type:"primary",size:"small",onClick:N(a=>{return l=e,Ae.value=l,xe.value={code:l.code,name:l.name,description:l.description||"",category:l.category||"",region:l.region||"",isActive:1===l.isActive},void(Ge.value=!0);var l},["stop"])},{default:f(()=>[V(A(y(l)("common.edit")),1)]),_:1},8,["onClick"])):_("",!0),Te(e.id)?(U(),G(i,{key:1,link:"",type:"primary",size:"small",onClick:N(a=>aa(e),["stop"])},{default:f(()=>[V(A(y(l)("purchasingGroups.actions.manage")),1)]),_:1},8,["onClick"])):(U(),m("span",ue,A(y(l)("purchasingGroups.labels.noAccess")),1)),$e.value?(U(),G(i,{key:3,link:"",type:"danger",size:"small",onClick:N(r=>{return u=e,void a.confirm(l("purchasingGroups.confirmDeleteDialog.message",{name:u.name}),l("purchasingGroups.confirmDeleteDialog.title"),{confirmButtonText:l("purchasingGroups.confirmDeleteDialog.confirm"),cancelButtonText:l("purchasingGroups.confirmDeleteDialog.cancel"),type:"warning"}).then(async()=>{try{await s.deleteGroup(u.id),a.success(l("purchasingGroups.notifications.deleteSuccess"))}catch(e){console.error(l("purchasingGroups.errors.deleteFailure"),e),a.error(l("purchasingGroups.errors.deleteFailure"))}}).catch(()=>{});var u},["stop"])},{default:f(()=>[V(A(y(l)("common.delete")),1)]),_:1},8,["onClick"])):_("",!0)]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})),[[ta,y(j)]]),v(je,{modelValue:Ge.value,"onUpdate:modelValue":r[11]||(r[11]=e=>Ge.value=e),title:Ae.value?y(l)("purchasingGroups.dialogs.editTitle"):y(l)("purchasingGroups.dialogs.createTitle"),width:"600px"},{footer:f(()=>[v(i,{onClick:la},{default:f(()=>[V(A(y(l)("common.cancel")),1)]),_:1}),v(i,{type:"primary",loading:Se.value,onClick:ra},{default:f(()=>[V(A(Ae.value?y(l)("purchasingGroups.actions.update"):y(l)("purchasingGroups.actions.create")),1)]),_:1},8,["loading"])]),default:f(()=>[v(ae,{model:xe.value,rules:Fe.value,ref_key:"groupFormRef",ref:Ce,"label-width":"120px"},{default:f(()=>[v(Q,{label:y(l)("purchasingGroups.fields.code.label"),prop:"code"},{default:f(()=>[v(o,{modelValue:xe.value.code,"onUpdate:modelValue":r[5]||(r[5]=e=>xe.value.code=e),placeholder:y(l)("purchasingGroups.fields.code.placeholder"),disabled:!!Ae.value},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),v(Q,{label:y(l)("purchasingGroups.fields.name.label"),prop:"name"},{default:f(()=>[v(o,{modelValue:xe.value.name,"onUpdate:modelValue":r[6]||(r[6]=e=>xe.value.name=e),placeholder:y(l)("purchasingGroups.fields.name.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),v(Q,{label:y(l)("purchasingGroups.fields.description.label")},{default:f(()=>[v(o,{modelValue:xe.value.description,"onUpdate:modelValue":r[7]||(r[7]=e=>xe.value.description=e),type:"textarea",rows:3,placeholder:y(l)("purchasingGroups.fields.description.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),v(Q,{label:y(l)("purchasingGroups.fields.category.label")},{default:f(()=>[v(o,{modelValue:xe.value.category,"onUpdate:modelValue":r[8]||(r[8]=e=>xe.value.category=e),placeholder:y(l)("purchasingGroups.fields.category.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),v(Q,{label:y(l)("purchasingGroups.fields.region.label")},{default:f(()=>[v(o,{modelValue:xe.value.region,"onUpdate:modelValue":r[9]||(r[9]=e=>xe.value.region=e),placeholder:y(l)("purchasingGroups.fields.region.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),Ae.value?(U(),G(Q,{key:0,label:y(l)("purchasingGroups.fields.isActive.label")},{default:f(()=>[v(X,{modelValue:xe.value.isActive,"onUpdate:modelValue":r[10]||(r[10]=e=>xe.value.isActive=e)},null,8,["modelValue"])]),_:1},8,["label"])):_("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),v(je,{modelValue:we.value,"onUpdate:modelValue":r[17]||(r[17]=e=>we.value=e),title:y(l)("purchasingGroups.dialogs.manageTitle",{name:ke.value?.name??""}),width:"900px","destroy-on-close":""},{default:f(()=>[v(Oe,{modelValue:Ie.value,"onUpdate:modelValue":r[16]||(r[16]=e=>Ie.value=e)},{default:f(()=>[v(Pe,{label:y(l)("purchasingGroups.tabs.members"),name:"members"},{default:f(()=>[g("div",ie,[g("div",oe,[g("h3",null,A(y(l)("purchasingGroups.sections.members")),1),v(i,{size:"small",type:"primary",onClick:r[12]||(r[12]=e=>_e.value=!0)},{default:f(()=>[V(A(y(l)("purchasingGroups.actions.addMembers")),1)]),_:1})]),h((U(),G(d,{data:y(Z),stripe:""},{default:f(()=>[v(p,{prop:"buyerName",label:y(l)("purchasingGroups.tableMembers.buyerName")},null,8,["label"]),v(p,{prop:"buyerRole",label:y(l)("purchasingGroups.tableMembers.buyerRole"),width:"180"},null,8,["label"]),v(p,{prop:"role",label:y(l)("purchasingGroups.tableMembers.groupRole"),width:"120"},{default:f(({row:e})=>[v(c,{size:"small",type:"lead"===e.role?"warning":""},{default:f(()=>[V(A("lead"===e.role?y(l)("purchasingGroups.groupRole.leader"):y(l)("purchasingGroups.groupRole.member")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),v(p,{label:y(l)("purchasingGroups.table.columns.actions"),width:"100",align:"center"},{default:f(({row:e})=>[v(i,{link:"",type:"danger",size:"small",onClick:r=>(async e=>{if(ke.value)try{await a.confirm(l("purchasingGroups.removeMemberConfirm"),l("common.confirm"),{confirmButtonText:l("common.remove"),cancelButtonText:l("common.cancel"),type:"warning"}),await s.removeMember(ke.value.id,e),a.success(l("purchasingGroups.notifications.removeMemberSuccess"))}catch(r){"cancel"!==r&&(console.error(l("purchasingGroups.errors.removeMemberFailure"),r),a.error(l("purchasingGroups.errors.removeMemberFailure")))}})(e.buyerId)},{default:f(()=>[V(A(y(l)("common.remove")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[ta,y(ge)]])])]),_:1},8,["label"]),v(Pe,{label:y(l)("purchasingGroups.tabs.suppliers"),name:"suppliers"},{default:f(()=>[g("div",ne,[g("div",te,[g("h3",null,A(y(l)("purchasingGroups.sections.suppliers")),1),ze.value?(U(),G(i,{key:0,size:"small",type:"primary",onClick:r[13]||(r[13]=e=>Ve.value=!0)},{default:f(()=>[V(A(y(l)("purchasingGroups.actions.addSuppliers")),1)]),_:1})):_("",!0)]),!ze.value&&Ee.value?(U(),G(Le,{key:0,type:"info",title:y(l)("purchasingGroups.hints.managerControlsSuppliers"),"show-icon":"",class:"assignment-hint"},null,8,["title"])):_("",!0),h((U(),G(d,{data:y(ee),stripe:""},{default:f(()=>[v(p,{prop:"companyName",label:y(l)("purchasingGroups.tableSuppliers.companyName")},null,8,["label"]),v(p,{prop:"companyId",label:y(l)("purchasingGroups.tableSuppliers.companyId"),width:"150"},null,8,["label"]),v(p,{prop:"category",label:y(l)("purchasingGroups.table.columns.category"),width:"140"},null,8,["label"]),v(p,{prop:"region",label:y(l)("purchasingGroups.table.columns.region"),width:"120"},null,8,["label"]),v(p,{label:y(l)("purchasingGroups.table.columns.actions"),width:"100",align:"center"},{default:f(({row:e})=>[ze.value?(U(),G(i,{key:0,link:"",type:"danger",size:"small",onClick:r=>(async e=>{if(ze.value&&ke.value)try{await a.confirm(l("purchasingGroups.removeSupplierConfirm"),l("common.confirm"),{confirmButtonText:l("common.remove"),cancelButtonText:l("common.cancel"),type:"warning"}),await s.removeSupplier(ke.value.id,e),a.success(l("purchasingGroups.notifications.removeSupplierSuccess"))}catch(r){"cancel"!==r&&(console.error(l("purchasingGroups.errors.removeSupplierFailure"),r),a.error(l("purchasingGroups.errors.removeSupplierFailure")))}})(e.supplierId)},{default:f(()=>[V(A(y(l)("common.remove")),1)]),_:1},8,["onClick"])):_("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[ta,y(he)]])])]),_:1},8,["label"]),Ee.value?(U(),G(Pe,{key:0,label:y(l)("purchasingGroups.tabs.assignments"),name:"assignments"},{default:f(()=>[g("div",pe,[g("div",ce,[g("h3",null,A(y(l)("purchasingGroups.sections.assignments")),1)]),v(ae,{class:"assignment-form",model:Ue.value,"label-width":"140px"},{default:f(()=>[v(Q,{label:y(l)("purchasingGroups.fields.assignmentBuyer.label")},{default:f(()=>[v(t,{modelValue:Ue.value.buyerId,"onUpdate:modelValue":r[14]||(r[14]=e=>Ue.value.buyerId=e),filterable:"",clearable:"",placeholder:y(l)("purchasingGroups.fields.assignmentBuyer.placeholder")},{default:f(()=>[(U(!0),m(x,null,F(Qe.value,e=>(U(),G(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),v(Q,{label:y(l)("purchasingGroups.fields.assignmentSuppliers.label")},{default:f(()=>[v(t,{modelValue:Ue.value.supplierIds,"onUpdate:modelValue":r[15]||(r[15]=e=>Ue.value.supplierIds=e),multiple:"",filterable:"",placeholder:y(l)("purchasingGroups.fields.assignmentSuppliers.placeholder")},{default:f(()=>[(U(!0),m(x,null,F(Xe.value,e=>(U(),G(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),g("div",de,[v(i,{type:"primary",loading:y(fe),onClick:ia},{default:f(()=>[V(A(y(l)("purchasingGroups.actions.assignSuppliers")),1)]),_:1},8,["loading"])])]),_:1},8,["model"]),h((U(),G(d,{data:y(ve),stripe:"",class:"assignment-table"},{default:f(()=>[v(p,{prop:"buyerName",label:y(l)("purchasingGroups.tableAssignments.buyer")},{default:f(({row:e})=>[V(A(e.buyerName||e.buyerId),1)]),_:1},8,["label"]),v(p,{prop:"companyName",label:y(l)("purchasingGroups.tableAssignments.supplier")},null,8,["label"]),v(p,{prop:"companyId",label:y(l)("purchasingGroups.tableAssignments.supplierCode"),width:"160"},null,8,["label"]),v(p,{prop:"createdAt",label:y(l)("purchasingGroups.tableAssignments.assignedAt"),width:"200"},{default:f(({row:e})=>[V(A(Ze(e.createdAt)),1)]),_:1},8,["label"]),Ee.value?(U(),G(p,{key:0,label:y(l)("purchasingGroups.table.columns.actions"),width:"120",align:"center"},{default:f(({row:e})=>[v(i,{link:"",type:"danger",size:"small",onClick:r=>(async e=>{if(ke.value)try{await a.confirm(l("purchasingGroups.removeAssignmentConfirm"),l("common.confirm"),{confirmButtonText:l("common.remove"),cancelButtonText:l("common.cancel"),type:"warning"}),await s.removeBuyerAssignment(ke.value.id,e),a.success(l("purchasingGroups.notifications.removeAssignmentSuccess"))}catch(r){"cancel"!==r&&(console.error(l("purchasingGroups.errors.removeAssignmentFailure"),r),a.error(l("purchasingGroups.errors.removeAssignmentFailure")))}})(e.id)},{default:f(()=>[V(A(y(l)("common.remove")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])):_("",!0)]),_:1},8,["data"])),[[ta,y(fe)]])])]),_:1},8,["label"])):_("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),v(je,{modelValue:_e.value,"onUpdate:modelValue":r[22]||(r[22]=e=>_e.value=e),title:y(l)("purchasingGroups.dialogs.addMembersTitle"),width:"600px"},{footer:f(()=>[v(i,{onClick:r[21]||(r[21]=e=>_e.value=!1)},{default:f(()=>[V(A(y(l)("common.cancel")),1)]),_:1}),v(i,{type:"primary",loading:Se.value,onClick:sa},{default:f(()=>[V(A(y(l)("purchasingGroups.actions.addMembers")),1)]),_:1},8,["loading"])]),default:f(()=>[v(ae,{model:Ne.value,"label-width":"100px"},{default:f(()=>[v(Q,{label:y(l)("purchasingGroups.fields.buyers.label")},{default:f(()=>[v(t,{modelValue:Ne.value.buyerIds,"onUpdate:modelValue":r[18]||(r[18]=e=>Ne.value.buyerIds=e),multiple:"",filterable:"",placeholder:y(l)("purchasingGroups.fields.buyers.placeholder"),style:{width:"100%"}},{default:f(()=>[(U(!0),m(x,null,F(Be.value,e=>(U(),G(n,{key:e.id,label:`${e.name} (${e.role})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),v(Q,{label:y(l)("purchasingGroups.fields.role")},{default:f(()=>[v(na,{modelValue:Ne.value.role,"onUpdate:modelValue":r[19]||(r[19]=e=>Ne.value.role=e)},{default:f(()=>[v(oa,{value:"member"},{default:f(()=>[V(A(y(l)("purchasingGroups.groupRole.member")),1)]),_:1}),v(oa,{value:"lead"},{default:f(()=>[V(A(y(l)("purchasingGroups.groupRole.leader")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),v(Q,{label:y(l)("purchasingGroups.fields.notes")},{default:f(()=>[v(o,{modelValue:Ne.value.notes,"onUpdate:modelValue":r[20]||(r[20]=e=>Ne.value.notes=e),type:"textarea",rows:2},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),v(je,{modelValue:Ve.value,"onUpdate:modelValue":r[27]||(r[27]=e=>Ve.value=e),title:y(l)("purchasingGroups.dialogs.addSuppliersTitle"),width:"700px"},{footer:f(()=>[v(i,{onClick:r[26]||(r[26]=e=>Ve.value=!1)},{default:f(()=>[V(A(y(l)("common.cancel")),1)]),_:1}),v(i,{type:"primary",loading:Se.value,onClick:ua},{default:f(()=>[V(A(y(l)("purchasingGroups.actions.addSuppliers")),1)]),_:1},8,["loading"])]),default:f(()=>[v(ae,{model:Me.value,"label-width":"100px"},{default:f(()=>[v(Q,{label:y(l)("purchasingGroups.fields.suppliers.label")},{default:f(()=>[v(t,{modelValue:Me.value.supplierIds,"onUpdate:modelValue":r[23]||(r[23]=e=>Me.value.supplierIds=e),multiple:"",filterable:"",remote:"","remote-method":We,loading:De.value,"reserve-keyword":!0,placeholder:y(l)("purchasingGroups.fields.suppliers.placeholder"),style:{width:"100%"},onVisibleChange:He},{default:f(()=>[(U(!0),m(x,null,F(Re.value,e=>(U(),G(n,{key:e.id,label:qe(e),value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","placeholder"])]),_:1},8,["label"]),v(Q,{label:y(l)("purchasingGroups.fields.primary.label")},{default:f(()=>[v(X,{modelValue:Me.value.isPrimary,"onUpdate:modelValue":r[24]||(r[24]=e=>Me.value.isPrimary=e)},null,8,["modelValue"]),g("span",me,A(y(l)("purchasingGroups.fields.primary.hint")),1)]),_:1},8,["label"]),v(Q,{label:y(l)("purchasingGroups.fields.notes")},{default:f(()=>[v(o,{modelValue:Me.value.notes,"onUpdate:modelValue":r[25]||(r[25]=e=>Me.value.notes=e),type:"textarea",rows:2},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-0aa0fc02"]]);export{ve as default};
