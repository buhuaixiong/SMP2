const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChangeRequestTimeline-CbjIIfNR.js","assets/index-pXGOuPyW.js","assets/index-BKgpdITu.css","assets/el-timeline-item-R8MVo__T.js","assets/el-timeline-item-BvbJTz1y.css","assets/el-tag-DUHqafut.js","assets/el-tag-DljBBxJR.css","assets/ChangeRequestTimeline-D47c1gMW.css"])))=>i.map(i=>d[i]);
import{d as e,h as a,i as l,c as t,C as o,b as s,j as i,e as r,F as n,r as u,k as d,H as p,z as c,m,y as f,t as v,x as y,A as _,O as w,f as h,a9 as b,G as g,Z as k,V as j,E as x,J as V,o as C,_ as E}from"./index-pXGOuPyW.js";import{v as z}from"./el-loading-qaXHuhL_.js";import{E as A,a as T}from"./el-descriptions-item-z9P4wr-H.js";import{E as L,a as N}from"./el-form-item-BQx-7ROG.js";/* empty css                 */import{E as I,a as P}from"./el-radio-group-Cbs4-h2c.js";import{E as O}from"./el-divider-C-odEMcn.js";import{E as S}from"./el-alert-DpRzcqbY.js";import{E as B}from"./el-card-mgp-E3yV.js";import{E as H}from"./el-empty-BQaRn8m8.js";import{a as R,E as U}from"./el-table-column-C9wzL857.js";import"./el-scrollbar-XGMKFkn3.js";import{E as q}from"./el-tag-DUHqafut.js";import{P as D}from"./PageHeader-D4LHld_T.js";import{b as W,c as $,a as F,d as G}from"./changeRequests-D_habgp7.js";import{u as J}from"./useNotification-Ctg5lnsL.js";import"./castArray-Cn0w7dP5.js";import"./_baseClone-B7uvG2yV.js";import"./debounce-DSkP6Bt8.js";const Q={class:"approval-view"},Y={class:"content-wrapper"},Z={class:"approval-stack"},K={class:"card-header"},M={class:"supplier-info"},X={class:"supplier-name"},ee={class:"supplier-code"},ae={key:0,class:"empty-state"},le={key:0,class:"approval-content"},te={style:{"font-size":"15px","font-weight":"600"}},oe={style:{"margin-top":"8px","font-size":"13px"}},se={style:{color:"#409eff","font-weight":"600"}},ie={class:"dialog-footer"},re={key:0,class:"details-content"},ne=E(e({__name:"SupplierChangeApprovalView",setup(e){const E=J(),ne=g(()=>V(()=>import("./ChangeRequestTimeline-CbjIIfNR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),ue=a(!1),de=a([]),pe=a(!1),ce=a([]),me=a(!1),fe=a(!1),ve=a(null),ye=a(null),_e=a(!1),we=l({decision:"",comments:""}),he={companyName:"公司名称",companyId:"供应商代码",contactPerson:"主联系人",contactPhone:"联系电话",contactEmail:"联系邮箱",category:"供应商类别",address:"注册地址",businessRegistrationNumber:"营业执照号",paymentTerms:"付款条款",paymentCurrency:"付款币种",bankAccount:"银行账户",region:"地区"},be=async()=>{try{ue.value=!0,de.value=await W()}catch(e){console.error("加载待审批列表失败:",e),E.error(e.message||"加载失败")}finally{ue.value=!1}},ge=async()=>{try{pe.value=!0,ce.value=await $()}catch(e){console.error("加载已审批列表失败:",e),E.error(e.message||"加载失败")}finally{pe.value=!1}},ke=t(()=>[{key:"pending",title:"待我审批",items:de.value,loading:ue.value,emptyText:"暂无待审批的变更申请",refresh:be,canApprove:!0},{key:"approved",title:"已审批项",items:ce.value,loading:pe.value,emptyText:"暂无已审批的变更申请",refresh:ge,canApprove:!1}]),je=async()=>{if(ve.value)if(we.decision)if("rejected"!==we.decision||we.comments.trim())try{await E.confirm(`确认${"approved"===we.decision?"批准":"拒绝"}此变更申请?`,"确认操作",{confirmButtonText:"确认",cancelButtonText:"取消",type:"approved"===we.decision?"success":"warning"}),_e.value=!0;const e=await G(ve.value.id,we.decision,we.comments);E.success(e.message||"审批提交成功"),me.value=!1,await Promise.all([be(),ge()])}catch(e){"cancel"!==e&&(console.error("审批失败:",e),E.error(e.message||"审批失败"))}finally{_e.value=!1}else E.warning("拒绝时请填写拒绝理由");else E.warning("请选择审批决定")},xe=()=>{we.decision&&!_e.value?E.confirm("您有未提交的审批决定,确定关闭?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{me.value=!1}).catch(()=>{}):me.value=!1},Ve=e=>({high:"高风险",medium:"中风险",low:"低风险"}[e||"low"]||"未知"),Ce=e=>"high"===e?"danger":"medium"===e?"warning":"info",Ee=e=>e?Object.entries(e).map(([e,a])=>({key:e,label:he[e]||e,newValue:a})):[],ze=e=>e?new Date(e).toLocaleString("zh-CN"):"-";return o(()=>{be(),ge()}),(e,a)=>{const l=w,t=_,o=U,g=q,V=R,E=H,W=B,$=S,G=O,J=P,ue=I,de=N,pe=x,ce=L,he=p,be=T,ge=A,Ae=z;return C(),s("div",Q,[i(D,{title:"供应商资料变更审批",subtitle:"审批供应商提交的资料修改申请"}),r("div",Y,[r("div",Z,[(C(!0),s(n,null,u(ke.value,e=>(C(),c(W,{key:e.key,class:"approval-card",shadow:"never"},{header:d(()=>[r("div",K,[r("span",null,v(e.title)+" ("+v(e.items.length)+")",1),i(t,{type:"primary",size:"small",onClick:e.refresh},{default:d(()=>[i(l,null,{default:d(()=>[i(h(b))]),_:1}),a[4]||(a[4]=y(" 刷新 ",-1))]),_:1},8,["onClick"])])]),default:d(()=>[m((C(),c(V,{data:e.items,stripe:""},{default:d(()=>[i(o,{prop:"id",label:"申请编号",width:"100"}),i(o,{label:"供应商信息",width:"250"},{default:d(({row:e})=>[r("div",M,[r("div",X,v(e.companyName),1),r("div",ee,"代码: "+v(e.companyId),1)])]),_:1}),i(o,{label:"供应商阶段",width:"100"},{default:d(({row:e})=>[i(g,{type:"official"===e.stage?"success":"info",size:"small"},{default:d(()=>[y(v("official"===e.stage?"正式":"临时"),1)]),_:2},1032,["type"])]),_:1}),i(o,{label:"风险等级",width:"100"},{default:d(({row:e})=>[i(g,{type:"high"===e.riskLevel?"danger":"medium"===e.riskLevel?"warning":"info",size:"small"},{default:d(()=>[y(v(Ve(e.riskLevel)),1)]),_:2},1032,["type"])]),_:1}),i(o,{label:"修改字段",width:"120"},{default:d(({row:e})=>[i(g,{size:"small"},{default:d(()=>{return[y(v((a=e.payload,Object.keys(a||{}).length))+" 个字段",1)];var a}),_:2},1024)]),_:1}),i(o,{prop:"submittedAt",label:"提交时间",width:"180"},{default:d(({row:e})=>[y(v(ze(e.submittedAt)),1)]),_:1}),i(o,{label:"操作",width:"200",fixed:"right"},{default:d(({row:l})=>[e.canApprove?(C(),c(t,{key:0,type:"primary",size:"small",onClick:e=>(async e=>{ve.value=e,we.decision="",we.comments="",me.value=!0,ye.value=null;try{ye.value=await F(e.id)}catch(a){console.error("加载详情失败:",a)}})(l)},{default:d(()=>[...a[5]||(a[5]=[y(" 审批 ",-1)])]),_:1},8,["onClick"])):f("",!0),i(t,{type:"info",size:"small",link:"",onClick:e=>(async e=>{ve.value=e,fe.value=!0,ye.value=null;try{ye.value=await F(e.id)}catch(a){console.error("加载详情失败:",a)}})(l)},{default:d(()=>[...a[6]||(a[6]=[y(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["data"])),[[Ae,e.loading]]),0!==e.items.length||e.loading?f("",!0):(C(),s("div",ae,[i(E,{description:e.emptyText},null,8,["description"])]))]),_:2},1024))),128))])]),i(he,{modelValue:me.value,"onUpdate:modelValue":a[2]||(a[2]=e=>me.value=e),title:"审批变更申请",width:"900px","destroy-on-close":"","before-close":xe},{footer:d(()=>[r("span",ie,[i(t,{onClick:xe},{default:d(()=>[...a[12]||(a[12]=[y("取消",-1)])]),_:1}),i(t,{type:"primary",loading:_e.value,disabled:!we.decision,onClick:je},{default:d(()=>[...a[13]||(a[13]=[y(" 提交审批 ",-1)])]),_:1},8,["loading","disabled"])])]),default:d(()=>[ve.value?(C(),s("div",le,[i($,{type:"info",closable:!1,style:{"margin-bottom":"20px"}},{title:d(()=>[r("div",te,v(ve.value.companyName)+" ("+v(ve.value.companyId)+") ",1)]),default:d(()=>[r("div",oe,[y(" 提交时间: "+v(ze(ve.value.submittedAt))+" | 风险等级: ",1),i(g,{type:Ce(ve.value.riskLevel),size:"small"},{default:d(()=>[y(v(Ve(ve.value.riskLevel)),1)]),_:1},8,["type"])])]),_:1}),i(G,{"content-position":"left"},{default:d(()=>[...a[7]||(a[7]=[y("变更内容",-1)])]),_:1}),i(V,{data:Ee(ve.value.payload),border:""},{default:d(()=>[i(o,{prop:"label",label:"字段名称",width:"150"}),i(o,{label:"申请修改为"},{default:d(({row:e})=>[r("span",se,v(e.newValue||"-"),1)]),_:1})]),_:1},8,["data"]),i(G,{"content-position":"left"},{default:d(()=>[...a[8]||(a[8]=[y("审批进度",-1)])]),_:1}),ye.value?(C(),c(h(ne),{key:0,workflow:ye.value.workflow,"approval-history":ye.value.approvalHistory,"current-step":ve.value.currentStep,status:ve.value.status},null,8,["workflow","approval-history","current-step","status"])):f("",!0),i(G,{"content-position":"left"},{default:d(()=>[...a[9]||(a[9]=[y("您的审批决定",-1)])]),_:1}),i(ce,{model:we,"label-width":"100px"},{default:d(()=>[i(de,{label:"审批决定",required:""},{default:d(()=>[i(ue,{modelValue:we.decision,"onUpdate:modelValue":a[0]||(a[0]=e=>we.decision=e)},{default:d(()=>[i(J,{value:"approved"},{default:d(()=>[i(l,{color:"#67c23a"},{default:d(()=>[i(h(k))]),_:1}),a[10]||(a[10]=y(" 批准 ",-1))]),_:1}),i(J,{value:"rejected"},{default:d(()=>[i(l,{color:"#f56c6c"},{default:d(()=>[i(h(j))]),_:1}),a[11]||(a[11]=y(" 拒绝 ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),i(de,{label:"审批意见"},{default:d(()=>[i(pe,{modelValue:we.comments,"onUpdate:modelValue":a[1]||(a[1]=e=>we.comments=e),type:"textarea",rows:4,placeholder:"approved"===we.decision?"请填写批准意见(可选)":"请说明拒绝理由"},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model"])])):f("",!0)]),_:1},8,["modelValue"]),i(he,{modelValue:fe.value,"onUpdate:modelValue":a[3]||(a[3]=e=>fe.value=e),title:"变更申请详情",width:"800px","destroy-on-close":""},{default:d(()=>[ve.value?(C(),s("div",re,[i(ge,{column:2,border:""},{default:d(()=>[i(be,{label:"申请编号"},{default:d(()=>[y(v(ve.value.id),1)]),_:1}),i(be,{label:"供应商"},{default:d(()=>[y(v(ve.value.companyName),1)]),_:1}),i(be,{label:"供应商代码"},{default:d(()=>[y(v(ve.value.companyId),1)]),_:1}),i(be,{label:"风险等级"},{default:d(()=>[i(g,{type:Ce(ve.value.riskLevel),size:"small"},{default:d(()=>[y(v(Ve(ve.value.riskLevel)),1)]),_:1},8,["type"])]),_:1}),i(be,{label:"提交时间"},{default:d(()=>[y(v(ze(ve.value.submittedAt)),1)]),_:1}),i(be,{label:"当前状态"},{default:d(()=>{return[y(v((e=ve.value.status,"approved"===e?"已批准":"rejected"===e?"已拒绝":e.startsWith("pending_")?"审批中":e)),1)];var e}),_:1})]),_:1}),i(G,{"content-position":"left"},{default:d(()=>[...a[14]||(a[14]=[y("变更内容",-1)])]),_:1}),i(V,{data:Ee(ve.value.payload),border:""},{default:d(()=>[i(o,{prop:"label",label:"字段",width:"150"}),i(o,{prop:"newValue",label:"新值"})]),_:1},8,["data"]),i(G,{"content-position":"left"},{default:d(()=>[...a[15]||(a[15]=[y("审批进度",-1)])]),_:1}),ye.value?(C(),c(h(ne),{key:0,workflow:ye.value.workflow,"approval-history":ye.value.approvalHistory,"current-step":ve.value.currentStep,status:ve.value.status},null,8,["workflow","approval-history","current-step","status"])):f("",!0)])):f("",!0)]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-e0641a12"]]);export{ne as default};
