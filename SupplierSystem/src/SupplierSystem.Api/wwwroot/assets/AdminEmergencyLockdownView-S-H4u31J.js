import{d as a,u as e,aW as n,h as o,i as t,C as l,b as i,j as s,f as c,e as d,y as r,k as m,O as u,t as w,S as v,aX as k,A as p,z as y,a5 as h,R as f,E as g,x as b,o as _,_ as A}from"./index-BqVgmY2a.js";import{a as j,E as x}from"./el-table-column-CYI6_cgf.js";import"./el-scrollbar-Hhg6XmGO.js";import{E}from"./el-tag-BFFTmzKO.js";import{E as T,a as V}from"./el-form-item-D2sI2QvI.js";/* empty css                 */import{E as C}from"./el-skeleton-item-Cui5CDZo.js";import{P as B}from"./PageHeader-e2pKlIF2.js";import{u as L}from"./useNotification-CGrCsW-s.js";import"./_baseClone-DnYTnrzK.js";import"./castArray-B2VphuOT.js";import"./debounce-BP_d4msr.js";const z={class:"admin-emergency-lockdown"},O={key:0,class:"panel"},D={key:1,class:"content"},N={class:"status-header"},R={class:"status-icon"},q={class:"status-info"},M={key:0,class:"status-meta"},P={key:1,class:"status-meta"},W={key:0,class:"status-details"},F={class:"detail-item"},I={class:"detail-item"},S={class:"control-panel"},H={key:0,class:"activate-section"},K={class:"warning-text"},U={key:1,class:"deactivate-section"},X={class:"history-panel"},$={class:"history-header"},G={key:0},J={key:1},Q={key:1,class:"history-loading"},Y={key:2,class:"history-empty"},Z=A(a({name:"AdminEmergencyLockdownView",__name:"AdminEmergencyLockdownView",setup(a){const A=L(),{t:Z}=e(),aa=n(),ea=o(),na=t({reason:"",announcement:""}),oa={reason:[{required:!0,message:Z("lockdown.admin.form.reasonRequired"),trigger:"blur"},{min:10,message:Z("lockdown.admin.form.reasonMinLength"),trigger:"blur"}],announcement:[{required:!0,message:Z("lockdown.admin.form.announcementRequired"),trigger:"blur"},{min:20,message:Z("lockdown.admin.form.announcementMinLength"),trigger:"blur"}]},ta=o(!1),la=o(!1),ia=o(!1),sa=o([]),ca=a=>new Date(a).toLocaleString(),da=async()=>{ea.value&&await ea.value.validate(async a=>{if(a)try{await A.confirm(Z("lockdown.admin.activate.confirmMessage"),Z("lockdown.admin.activate.confirmTitle"),{confirmButtonText:Z("common.confirm"),cancelButtonText:Z("common.cancel"),type:"warning"}),ta.value=!0,await aa.activate({reason:na.reason,announcement:na.announcement}),A.success(Z("lockdown.admin.activate.success")),na.reason="",na.announcement="",ea.value?.resetFields(),await ma()}catch(e){"cancel"!==e&&(console.error("Error activating lockdown:",e),A.error(Z("lockdown.admin.activate.error")))}finally{ta.value=!1}})},ra=async()=>{try{await A.confirm(Z("lockdown.admin.deactivate.confirmMessage"),Z("lockdown.admin.deactivate.confirmTitle"),{confirmButtonText:Z("common.confirm"),cancelButtonText:Z("common.cancel"),type:"success"}),la.value=!0,await aa.deactivate(),A.success(Z("lockdown.admin.deactivate.success")),await ma()}catch(a){"cancel"!==a&&(console.error("Error deactivating lockdown:",a),A.error(Z("lockdown.admin.deactivate.error")))}finally{la.value=!1}},ma=async()=>{ia.value=!0;try{await aa.loadHistory(50),sa.value=aa.history}catch(a){console.error("Error loading history:",a),A.error(Z("lockdown.admin.history.error"))}finally{ia.value=!1}};return l(async()=>{await aa.checkFullStatus(),await ma()}),(a,e)=>{const n=C,o=u,t=g,l=V,A=p,L=T,ua=E,wa=x,va=j;return _(),i("div",z,[s(B,{title:c(Z)("lockdown.admin.title"),subtitle:c(Z)("lockdown.admin.subtitle")},null,8,["title","subtitle"]),c(aa).loading?(_(),i("section",O,[s(n,{rows:6,animated:""})])):(_(),i("section",D,[d("div",{class:v(["status-panel",{active:c(aa).isActive}])},[d("div",N,[d("div",R,[s(o,{size:48},{default:m(()=>[(_(),y(h(c(aa).isActive?c(f):c(k))))]),_:1})]),d("div",q,[d("h2",null,w(c(aa).isActive?c(Z)("lockdown.admin.status.active"):c(Z)("lockdown.admin.status.inactive")),1),c(aa).isActive&&c(aa).activatedAt?(_(),i("p",M,w(c(Z)("lockdown.admin.activatedAt"))+": "+w(ca(c(aa).activatedAt)),1)):r("",!0),c(aa).isActive&&c(aa).activatedBy?(_(),i("p",P,w(c(Z)("lockdown.admin.activatedBy"))+": "+w(c(aa).activatedBy),1)):r("",!0)])]),c(aa).isActive?(_(),i("div",W,[d("div",F,[d("strong",null,w(c(Z)("lockdown.admin.reason"))+":",1),d("p",null,w(c(aa).reason||c(Z)("lockdown.admin.noReason")),1)]),d("div",I,[d("strong",null,w(c(Z)("lockdown.admin.announcement"))+":",1),d("p",null,w(c(aa).announcement||c(Z)("lockdown.admin.noAnnouncement")),1)])])):r("",!0)],2),d("div",S,[c(aa).isActive?(_(),i("div",U,[d("h3",null,w(c(Z)("lockdown.admin.deactivate.title")),1),d("p",null,w(c(Z)("lockdown.admin.deactivate.description")),1),s(A,{type:"success",size:"large",loading:la.value,icon:c(k),onClick:ra},{default:m(()=>[b(w(c(Z)("lockdown.admin.deactivate.button")),1)]),_:1},8,["loading","icon"])])):(_(),i("div",H,[d("h3",null,w(c(Z)("lockdown.admin.activate.title")),1),d("p",K,w(c(Z)("lockdown.admin.activate.warning")),1),s(L,{model:na,rules:oa,ref_key:"activateFormRef",ref:ea,"label-width":"140px"},{default:m(()=>[s(l,{label:c(Z)("lockdown.admin.form.reason"),prop:"reason"},{default:m(()=>[s(t,{modelValue:na.reason,"onUpdate:modelValue":e[0]||(e[0]=a=>na.reason=a),type:"textarea",rows:3,placeholder:c(Z)("lockdown.admin.form.reasonPlaceholder"),maxlength:"500","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(l,{label:c(Z)("lockdown.admin.form.announcement"),prop:"announcement"},{default:m(()=>[s(t,{modelValue:na.announcement,"onUpdate:modelValue":e[1]||(e[1]=a=>na.announcement=a),type:"textarea",rows:4,placeholder:c(Z)("lockdown.admin.form.announcementPlaceholder"),maxlength:"1000","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(l,null,{default:m(()=>[s(A,{type:"danger",size:"large",loading:ta.value,icon:c(f),onClick:da},{default:m(()=>[b(w(c(Z)("lockdown.admin.activate.button")),1)]),_:1},8,["loading","icon"])]),_:1})]),_:1},8,["model"])]))]),d("div",X,[d("div",$,[d("h3",null,w(c(Z)("lockdown.admin.history.title")),1),s(A,{type:"primary",size:"small",loading:ia.value,onClick:ma},{default:m(()=>[b(w(c(Z)("lockdown.admin.history.refresh")),1)]),_:1},8,["loading"])]),!ia.value&&sa.value.length>0?(_(),y(va,{key:0,data:sa.value,stripe:"",style:{width:"100%"}},{default:m(()=>[s(wa,{prop:"action",label:c(Z)("lockdown.admin.history.action"),width:"180"},{default:m(({row:a})=>[s(ua,{type:"LOCKDOWN_ACTIVATED"===a.action?"danger":"success",size:"small"},{default:m(()=>{return[b(w((e=a.action,Z("LOCKDOWN_ACTIVATED"===e?"lockdown.admin.history.activated":"lockdown.admin.history.deactivated"))),1)];var e}),_:2},1032,["type"])]),_:1},8,["label"]),s(wa,{prop:"actorName",label:c(Z)("lockdown.admin.history.actor"),width:"150"},null,8,["label"]),s(wa,{prop:"timestamp",label:c(Z)("lockdown.admin.history.timestamp"),width:"180"},{default:m(({row:a})=>[b(w(ca(a.timestamp)),1)]),_:1},8,["label"]),s(wa,{prop:"ipAddress",label:c(Z)("lockdown.admin.history.ipAddress"),width:"150"},null,8,["label"]),s(wa,{label:c(Z)("lockdown.admin.history.details")},{default:m(({row:a})=>[a.changes.reason?(_(),i("div",G,[d("strong",null,w(c(Z)("lockdown.admin.reason"))+":",1),b(" "+w(a.changes.reason),1)])):r("",!0),a.changes.announcement?(_(),i("div",J,[d("strong",null,w(c(Z)("lockdown.admin.announcement"))+":",1),b(" "+w(a.changes.announcement),1)])):r("",!0)]),_:1},8,["label"])]),_:1},8,["data"])):ia.value?(_(),i("div",Q,[s(n,{rows:5,animated:""})])):(_(),i("div",Y,w(c(Z)("lockdown.admin.history.empty")),1))])]))])}}}),[["__scopeId","data-v-7bbd8d2a"]]);export{Z as default};
