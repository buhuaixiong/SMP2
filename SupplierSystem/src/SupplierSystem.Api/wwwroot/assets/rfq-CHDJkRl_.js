import{W as a,aT as e}from"./index-BvBqerML.js";function t(a){if(!a)return a;const e={...a};return null!=e.limit&&(e.pageSize=e.limit,delete e.limit),e}function r(a,e){const t=a?.page??e.page,r=a?.limit??a?.pageSize??e.limit,o=a?.total??e.total,n=a?.totalPages??a?.pageCount??e.totalPages,i=Number.isFinite(Number(t))&&Number(t)>0?Number(t):e.page,s=Number.isFinite(Number(r))&&Number(r)>0?Number(r):e.limit,l=Number.isFinite(Number(o))&&Number(o)>=0?Number(o):e.total;let c=Number.isFinite(Number(n))&&Number(n)>=0?Number(n):e.totalPages;return!c&&l&&s&&(c=Math.ceil(l/s)),{page:i,limit:s,total:l,totalPages:c}}async function o(e){const o=await a("/rfq-workflow",{params:t(e)}),n={page:e?.page??1,limit:e?.limit??20,total:0,totalPages:0};if(!o)return{data:[],pagination:n};const i=Array.isArray(o.data)?o.data:null,s=o.data&&Array.isArray(o.data.data)?o.data.data:null,l=i??s;if(l){return{data:l,pagination:r(i?o.pagination:o.data.pagination??o.pagination,n)}}return{data:[],pagination:r(o.pagination,n)}}async function n(e){return(await a(`/rfq-workflow/${e}`)).data}async function i(e){return(await a(`/rfq-workflow/supplier/${e}`)).data}async function s(e){return await a(`/rfq-workflow/${e}/publish`,{method:"POST"})}async function l(e,t){return await a(`/rfq-workflow/${e}/close`,{method:"POST",body:{reason:t}})}async function c(){return(await a("/rfq-workflow/supplier/invitations")).data??[]}async function u(e){return(await a("/rfq-workflow/create",{method:"POST",body:e})).data}async function f(e){return(await a(`/rfq-workflow/${e}`)).data}async function d(e){return await a(`/rfq-workflow/${e}/publish`,{method:"POST"})}async function m(e,t){return await a(`/rfq-workflow/${e}/select-quote`,{method:"POST",body:{selectedQuoteId:t}})}async function w(e){return await a(`/rfq-workflow/${e}/submit-review`,{method:"POST"})}async function p(e){return(await a(`/rfq-workflow/${e}/approvals`)).data}async function g(e,t,r){return await a(`/rfq-workflow/${e}/approvals/${t}/approve`,{method:"POST",body:r})}async function y(e,t,r){return await a(`/rfq-workflow/${e}/approvals/${t}/reject`,{method:"POST",body:r})}async function I(e,t,r){return await a(`/rfq-workflow/${e}/approvals/${t}/comments`,{method:"POST",body:r})}async function N(e,t,r){return await a(`/rfq-workflow/${e}/approvals/${t}/invite-purchasers`,{method:"POST",body:r})}async function S(a,t,r,o,n,i){const s=new FormData;s.append("screenshot",r),s.append("platform",function(a){return"zhenkunxing"===a?"zkh":a}(t)),s.append("platformPrice",String(o)),s.append("productUrl",n),i&&s.append("lineItemId",String(i));const l=await fetch(`${e}/rfq-workflow/${a}/price-comparison`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:s});if(!l.ok){const a=await l.json();throw new Error(a.message||"Failed to upload price comparison")}return l.json()}async function E(e,t){return await a(`/rfq-workflow/${e}/fill-pr`,{method:"POST",body:t})}async function T(e){return(await a("/rfq-workflow/import-excel",{method:"POST",body:e})).data}async function h(a,t,r){const o=localStorage.getItem("token"),n=await fetch(`${e}/rfq-workflow/${a}/generate-pr-excel`,{method:"POST",headers:{"Content-Type":"application/json",...o&&{Authorization:`Bearer ${o}`}},body:JSON.stringify({lineItemIds:t,...r})});if(!n.ok){let a;try{a=await n.json()}catch{a={message:"Failed to generate PR Excel file"}}const e={INVALID_RFQ_ID:"鏃犳晥鐨凴FQ ID",INVALID_LINE_ITEMS:"No line items selected",INVALID_LINE_ITEM_IDS:"閫夋嫨鐨勬槑缁嗛」ID鏃犳晥",TOO_MANY_LINE_ITEMS:"Too many line items (max 1000). Selected: "+(a.received||"N/A"),RESOURCE_NOT_FOUND:"鎵句笉鍒版寚瀹氱殑RFQ鎴栨槑缁嗛」",NO_VALID_LINE_ITEMS:"鎵€閫夋槑缁嗛」涓病鏈夊凡鎵瑰噯鐨勬姤浠凤紝鏃犳硶鐢熸垚PR",INVALID_LINE_ITEM_STATUS:"瀛樺湪鐘舵€佷笉鍏佽瀵煎嚭鐨勮椤圭洰",MISSING_SELECTED_QUOTE:"Missing selected quote for some line items",TEMPLATE_ERROR:"Excel妯℃澘鏂囦欢缂哄け鎴栨崯鍧忥紝璇疯仈绯荤郴缁熺鐞嗗憳",INVALID_BUFFER:"鐢熸垚鐨凟xcel鏂囦欢鏃犳晥",FILE_TOO_SMALL:"Generated file is too small ("+(a.fileSizeKB||"N/A")+" KB).",FILE_TOO_LARGE:"Generated file is too large ("+(a.fileSizeKB||"N/A")+" KB). Max "+(a.maxSizeKB||"N/A")+" KB",GENERATION_FAILED:"Failed to generate PR Excel file"},t=a.error||"GENERATION_FAILED",r=e[t]||a.message||"鐢熸垚PR Excel澶辫触",o=new Error(r);throw o.code=t,o.details=a.details,o.status=n.status,o}const i=n.headers.get("X-File-Size-KB"),s=n.headers.get("X-Generation-Time-Ms"),l=n.headers.get("X-Line-Item-Count");return i&&s&&console.log("[PR Excel] Generated successfully: "+i+" KB in "+s+"ms ("+l+" items)"),await n.blob()}async function b(e){return await a("/rfq/line-items/pending-approvals",{params:e})}e.replace(/\/api\/?$/,"");export{b as a,i as b,u as c,f as d,p as e,o as f,w as g,s as h,T as i,l as j,N as k,c as l,I as m,g as n,E as o,d as p,h as q,y as r,m as s,n as t,S as u};
