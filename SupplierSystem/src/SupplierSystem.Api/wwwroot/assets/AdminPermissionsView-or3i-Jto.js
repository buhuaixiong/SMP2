import{W as e,aP as s,h as a,d as i,u as n,g as l,a6 as t,c as o,i as r,B as d,C as u,b as c,e as m,y as p,t as v,f as y,S as b,F as f,r as g,m as h,aQ as P,v as w,n as U,x as k,w as C,aR as I,o as A,_ as F}from"./index-pXGOuPyW.js";import{u as S}from"./useNotification-Ctg5lnsL.js";const x=e=>e&&"object"==typeof e&&"data"in e?e.data:e,z=s("permission",()=>{const s=a([]),i=a([]),n=a([]),l=a({}),t=a([]),o=a(!1),r=a(null),d=async()=>{const s=await(async()=>{const s=await e("/permissions/buyers");return x(s)})();return n.value=s.map(e=>({...e,assignmentCount:e.assignmentCount??0,contractAlertCount:e.contractAlertCount??0,profileAccessCount:e.profileAccessCount??0})),n.value},u=async s=>{await(async s=>await e(`/permissions/users/${encodeURIComponent(s)}`,{method:"DELETE"}))(s)};return{roles:s,users:i,buyers:n,buyerAssignments:l,supplierSearchResults:t,loading:o,error:r,fetchRoles:async()=>{o.value=!0,r.value=null;try{return s.value=await(async()=>{const s=await e("/permissions/roles");return x(s)})(),s.value}catch(a){throw r.value=a instanceof Error?a.message:"Failed to load roles",a}finally{o.value=!1}},fetchUsers:async()=>{o.value=!0,r.value=null;try{return i.value=await(async(s="internal")=>{const a=s?`?scope=${encodeURIComponent(s)}`:"",i=await e(`/permissions/users${a}`);return x(i)})(),i.value}catch(s){throw r.value=s instanceof Error?s.message:"Failed to load users",s}finally{o.value=!1}},createAccount:async s=>{const a=await(async s=>{const a=await e("/permissions/users",{method:"POST",body:s});return x(a)})(s),n=i.value.findIndex(e=>e.id===a.id);return n>=0?i.value.splice(n,1,a):i.value.push(a),"purchaser"===a.role&&await d(),a},changeUserRole:async(s,a,t)=>{const o=await(async(s,a)=>{const i=await e(`/permissions/users/${encodeURIComponent(s)}/role`,{method:"PUT",body:a});return x(i)})(s,{role:a,...t}),r=i.value.findIndex(e=>e.id===s);if(r>=0&&i.value.splice(r,1,o),"purchaser"===o.role)await d();else{const e=n.value.findIndex(e=>e.id===s);e>=0&&(n.value.splice(e,1),delete l.value[s])}return o},removeUser:async e=>{await u(e),i.value=i.value.filter(s=>s.id!==e);const s=n.value.findIndex(s=>s.id===e);s>=0&&(n.value.splice(s,1),delete l.value[e])},changeUserPassword:async(s,a)=>{await(async(s,a)=>await e(`/permissions/users/${encodeURIComponent(s)}/password`,{method:"PUT",body:{password:a}}))(s,a)},changeUserEmail:async(s,a)=>{const n=await(async(s,a)=>{const i=await e(`/permissions/users/${encodeURIComponent(s)}`,{method:"PUT",body:{email:a}});return x(i)})(s,a),l=i.value.findIndex(e=>e.id===s);return l>=0&&i.value.splice(l,1,n),n},fetchBuyers:d,fetchBuyerAssignments:async s=>{const{data:a,meta:i}=await(async s=>{const a=await e(`/permissions/buyers/${encodeURIComponent(s)}/assignments`);return{data:x(a),meta:a&&"object"==typeof a&&"meta"in a?a.meta:void 0}})(s);l.value={...l.value,[s]:a};const t=n.value.find(e=>e.id===s);return t&&(t.assignmentCount=a.length,t.contractAlertCount=a.filter(e=>e.contractAlert).length,t.profileAccessCount=a.filter(e=>e.profileAccess).length,i?.buyerName&&!t.name&&(t.name=i.buyerName)),a},saveBuyerAssignments:async(s,a)=>{const i=a.map(e=>({supplierId:e.supplierId,contractAlert:e.contractAlert,profileAccess:e.profileAccess})),{data:t}=await(async(s,a)=>{const i=await e(`/permissions/buyers/${encodeURIComponent(s)}/assignments`,{method:"POST",body:{assignments:a}});return{data:x(i),meta:i&&"object"==typeof i&&"meta"in i?i.meta:void 0}})(s,i);l.value={...l.value,[s]:t};const o=n.value.find(e=>e.id===s);return o&&(o.assignmentCount=t.length,o.contractAlertCount=t.filter(e=>e.contractAlert).length,o.profileAccessCount=t.filter(e=>e.profileAccess).length),t},searchSuppliers:async s=>{const a=await(async(s,a=20)=>{const i=new URLSearchParams({limit:String(a)});s&&i.set("q",s);const n=await e(`/permissions/suppliers/search?${i.toString()}`),l=x(n);return(Array.isArray(l)?l:Array.isArray(l?.data)?l.data:[]).map(e=>({id:e.id??e.Id??e.supplierId??e.SupplierId??e.supplier_id??e.supplierId,companyName:e.companyName??e.CompanyName??e.company_name??"",companyId:e.companyId??e.CompanyId??e.company_id??"",supplierCode:e.supplierCode??e.SupplierCode??e.supplier_code??null})).filter(e=>null!=e.id)})(s);return t.value=a,a},freezeUser:async(s,a)=>{await(async(s,a)=>await e(`/permissions/users/${encodeURIComponent(s)}/freeze`,{method:"POST",body:{reason:a}}))(s,a)},unfreezeUser:async s=>{await(async s=>await e(`/permissions/users/${encodeURIComponent(s)}/unfreeze`,{method:"POST"}))(s)},deleteUser:u}});const R={class:"admin-permissions"},V={class:"page-header"},$={class:"muted"},B={class:"header-actions"},N={class:"mode-toggle"},E={key:0,class:"panel-stack"},T={key:0,class:"panel"},_={class:"role-list"},O={class:"panel"},q={class:"section-header"},j={key:0,class:"muted"},D={class:"user-table"},K={class:"email-cell"},L=["onUpdate:modelValue","placeholder","disabled","onBlur","onKeydown"],M={class:"current-role"},J={class:"role-cell"},Q=["value","disabled","onChange"],W=["value"],G={key:0,class:"micro-text"},H={class:"actions-cell"},X=["onClick","disabled"],Y=["disabled","onClick"],Z=["disabled","onClick"],ee=["disabled","onClick"],se={key:1,class:"panel delegations-panel"},ae={class:"section-header"},ie={class:"buyer-assignment"},ne={class:"buyer-list"},le={key:0,class:"placeholder"},te={key:1},oe=["onClick"],re={class:"buyer-name"},de={class:"buyer-meta"},ue={key:0,class:"assignment-detail"},ce={class:"assignment-header"},me={class:"muted"},pe=["disabled"],ve={class:"assignment-body"},ye={class:"current-assignments"},be={key:0,class:"muted"},fe={key:1,class:"assignment-list"},ge={class:"assignment-info"},he={class:"muted"},Pe={class:"assignment-permissions"},we=["onUpdate:modelValue"],Ue=["onUpdate:modelValue"],ke=["onClick"],Ce={key:2,class:"placeholder"},Ie={class:"supplier-search"},Ae={class:"assign-by-tags-section"},Fe={class:"tag-assign-controls"},Se=["value"],xe=["disabled"],ze={key:0,class:"micro-text",style:{"margin-top":"4px",color:"#6b7280"}},Re={class:"search-controls"},Ve=["placeholder"],$e=["disabled"],Be={key:0,class:"search-results"},Ne={class:"muted"},Ee=["onClick"],Te={key:1,class:"placeholder"},_e={key:1,class:"assignment-placeholder"},Oe={key:2,class:"modal",open:""},qe={class:"modal-header"},je={class:"modal-body"},De=["value"],Ke={class:"modal-footer"},Le=["disabled"],Me={key:3,class:"modal",open:""},Je={class:"modal-header"},Qe={class:"modal-body"},We={class:"muted"},Ge=["placeholder"],He=["placeholder"],Xe={class:"modal-footer"},Ye=["disabled"],Ze={key:4,class:"modal",open:""},es={class:"modal-header"},ss={class:"modal-body"},as={class:"muted"},is=["placeholder"],ns={class:"modal-footer"},ls=["disabled"],ts={key:5,class:"modal",open:""},os={class:"modal-header"},rs={class:"modal-body"},ds={class:"muted"},us={class:"warning-text"},cs={class:"modal-footer"},ms=["disabled"],ps=F(i({__name:"AdminPermissionsView",setup(s){const i=S(),F=new Set(["temp_supplier","formal_supplier","supplier"]),{t:x}=n(),ps=z(),vs=l(),ys=t(),bs=a("internal"),fs=o(()=>ps.roles),gs=o(()=>ps.users),hs=o(()=>gs.value.filter(e=>!sa(e.role))),Ps=o(()=>fs.value.filter(e=>!F.has(e.role))),ws=o(()=>fs.value.filter(e=>!F.has(e.role))),Us=o(()=>ps.buyers),ks=o(()=>ys.availableTags),Cs=a(null),Is=o(()=>Us.value.find(e=>e.id===Cs.value)??null),As=a([]),Fs=a(!1),Ss=a(!1),xs=a(!1),zs=a(""),Rs=a(!1),Vs=a(!1),$s=a([]),Bs=a([]),Ns=a(!1),Es=(e,s)=>e instanceof Error&&e.message?e.message:s,Ts=a(!1),_s=a(!1),Os=r({id:"",name:"",role:"",password:"",email:"",supplierId:""}),qs=a(!1),js=a(null),Ds=o(()=>null!==js.value),Ks=a(null),Ls=r({password:"",confirmPassword:""}),Ms=a({}),Js=a(null),Qs=a(!1),Ws=a(null),Gs=a(""),Hs=a(null),Xs=a(null),Ys=a(!1),Zs=a(null),ea=a(null),sa=e=>F.has(e),aa=e=>null!=vs.user&&String(vs.user.id)===e.id,ia=e=>{if(sa(e.role)){const s=fs.value.find(s=>s.role===e.role);return s?[s]:[]}return ws.value},na=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,la=e=>x("adminPermissions.delegations.buyerStats",{suppliers:e.assignmentCount,profiles:e.profileAccessCount,alerts:e.contractAlertCount}),ta=async()=>{try{await Promise.all([ps.fetchRoles(),ps.fetchUsers(),ps.fetchBuyers()]),"delegations"===bs.value&&Us.value.length>0&&!Cs.value&&(Cs.value=Us.value[0].id)}catch(e){console.error(x("adminPermissions.notifications.loadPermissionsFailure"),e),i.error(Es(e,x("adminPermissions.notifications.loadPermissionsFailure")))}},oa=()=>{Ts.value=!0,Os.id="",Os.name="",Os.role=ws.value[0]?.role??"purchaser",Os.password="",Os.email="",Os.supplierId=""},ra=()=>{Ts.value=!1},da=()=>{qs.value=!1,Ks.value=null,Ls.password="",Ls.confirmPassword=""},ua=async()=>{if(Ks.value&&Ls.password)if(Ls.password===Ls.confirmPassword){js.value=Ks.value.id;try{await ps.changeUserPassword(Ks.value.id,Ls.password),i.success(x("adminPermissions.notifications.passwordResetSuccess")),da()}catch(e){console.error(x("adminPermissions.notifications.passwordResetFailure"),e),i.error(Es(e,x("adminPermissions.notifications.passwordResetFailure")))}finally{js.value=null}}else i.warning(x("adminPermissions.validation.passwordMismatch"));else i.warning(x("adminPermissions.validation.passwordRequired"))},ca=async()=>{const e=Os.id.trim(),s=Os.password.trim(),a=Os.email.trim();if(e&&s)if(!a||na.test(a)){_s.value=!0;try{await ps.createAccount({id:e,username:e,name:Os.name.trim(),role:Os.role,password:s,supplierId:Os.supplierId.trim()||void 0,email:a||void 0}),i.success(x("adminPermissions.notifications.userCreated")),ra(),await ps.fetchUsers()}catch(n){console.error(x("adminPermissions.notifications.userCreateFailure"),n),i.error(Es(n,x("adminPermissions.notifications.userCreateFailure")))}finally{_s.value=!1}}else i.warning(x("adminPermissions.validation.invalidEmail"));else i.warning(x("adminPermissions.validation.credentialsRequired"))},ma=async e=>{const s=(Ms.value[e.id]??"").trim(),a=e.email??"";if(s!==a){if(s&&!na.test(s))return i.warning(x("adminPermissions.validation.invalidEmail")),void(Ms.value[e.id]=a);Js.value=e.id;try{await ps.changeUserEmail(e.id,s||null),i.success(x("adminPermissions.notifications.emailUpdateSuccess"))}catch(n){console.error(x("adminPermissions.notifications.emailUpdateFailure"),n),i.error(Es(n,x("adminPermissions.notifications.emailUpdateFailure"))),Ms.value[e.id]=a}finally{Js.value=null}}},pa=()=>{Qs.value=!1,Ws.value=null,Gs.value=""},va=async()=>{if(Ws.value){Hs.value=Ws.value.id;try{await ps.freezeUser(Ws.value.id,Gs.value.trim()||void 0),i.success(x("adminPermissions.notifications.userFrozen")),pa(),await ps.fetchUsers()}catch(e){console.error(x("adminPermissions.notifications.userFreezeFailure"),e),i.error(Es(e,x("adminPermissions.notifications.userFreezeFailure")))}finally{Hs.value=null}}},ya=()=>{Ys.value=!1,Zs.value=null},ba=async()=>{if(Zs.value){ea.value=Zs.value.id;try{await ps.deleteUser(Zs.value.id),i.success(x("adminPermissions.notifications.userDeleted")),ya(),await ps.fetchUsers()}catch(e){console.error(x("adminPermissions.notifications.userDeleteFailure"),e),i.error(Es(e,x("adminPermissions.notifications.userDeleteFailure")))}finally{ea.value=null}}},fa=async()=>{try{await ps.fetchBuyers(),!(Us.value.length>0)||Cs.value&&Us.value.some(e=>e.id===Cs.value)||(Cs.value=Us.value[0].id)}catch(e){console.error(x("adminPermissions.notifications.loadBuyersFailure"),e),i.error(Es(e,x("adminPermissions.notifications.loadBuyersFailure")))}},ga=e=>{Cs.value!==e&&(Cs.value=e)};d(()=>bs.value,e=>{"delegations"===e&&Us.value.length>0&&!Cs.value&&(Cs.value=Us.value[0].id)}),d(Us,e=>{0===e.length?(Cs.value=null,As.value=[],xs.value=!1):Cs.value&&!e.some(e=>e.id===Cs.value)&&(Cs.value=e[0].id)},{immediate:!0}),d(gs,e=>{const s={...Ms.value};e.forEach(e=>{s[e.id]=e.email??""}),Object.keys(s).forEach(a=>{e.some(e=>e.id===a)||delete s[a]}),Ms.value=s},{immediate:!0}),d(Cs,async e=>{if(As.value=[],xs.value=!1,$s.value=[],Vs.value=!1,e){Fs.value=!0;try{const s=await ps.fetchBuyerAssignments(e);As.value=s.map(e=>({...e}))}catch(s){console.error(x("adminPermissions.notifications.loadAssignmentsFailure"),s),i.error(Es(s,x("adminPermissions.notifications.loadAssignmentsFailure")))}finally{Fs.value=!1}}});const ha=e=>As.value.some(s=>s.supplierId===e),Pa=()=>{xs.value=!0},wa=async()=>{if(!Cs.value)return void i.warning(x("adminPermissions.notifications.selectBuyerFirst"));const e=zs.value.trim();Rs.value=!0,Vs.value=!0;try{const s=await ps.searchSuppliers(e);$s.value=s.filter(e=>!ha(e.id))}catch(s){console.error(x("adminPermissions.notifications.searchSuppliersFailure"),s),i.error(Es(s,x("adminPermissions.notifications.searchSuppliersFailure")))}finally{Rs.value=!1}},Ua=async()=>{if(Cs.value){Ss.value=!0;try{const e=await ps.saveBuyerAssignments(Cs.value,As.value);As.value=e.map(e=>({...e})),xs.value=!1,i.success(x("adminPermissions.notifications.assignmentsUpdated"))}catch(e){console.error(x("adminPermissions.notifications.assignmentsUpdateFailure"),e),i.error(Es(e,x("adminPermissions.notifications.assignmentsUpdateFailure")))}finally{Ss.value=!1}}},ka=async()=>{if(Cs.value&&0!==Bs.value.length){Ns.value=!0;try{const s=await async function(s){return e("/buyer-assignments/by-tag",{method:"POST",body:JSON.stringify(s)})}({buyerId:Cs.value,tagIds:Bs.value});i.success(s.message||`æˆåŠŸåˆ†é… ${s.data.assignedCount} ä¸ªä¾›åº”å•†åˆ°é‡‡è´­å‘˜ ${Is.value?.name}`),await ga(Cs.value),Bs.value=[]}catch(s){console.error("Error assigning suppliers by tags:",s),i.error(Es(s,"æŒ‰æ ‡ç­¾åˆ†é…ä¾›åº”å•†å¤±è´¥"))}finally{Ns.value=!1}}};return u(async()=>{await Promise.all([ta(),ys.ensureTags()])}),(e,s)=>(A(),c("div",R,[m("header",V,[m("div",null,[m("h1",null,v(y(x)("adminPermissions.title")),1),m("p",$,v(y(x)("adminPermissions.subtitle")),1)]),m("div",B,[m("button",{class:"link-btn",type:"button",onClick:ta},v(y(x)("adminPermissions.actions.refresh")),1),m("button",{class:"primary-btn",type:"button",onClick:oa}," + "+v(y(x)("adminPermissions.actions.createUser")),1)])]),m("nav",N,[m("button",{type:"button",class:b({active:"internal"===bs.value}),onClick:s[0]||(s[0]=e=>bs.value="internal")},v(y(x)("adminPermissions.tabs.internal")),3),m("button",{type:"button",class:b({active:"delegations"===bs.value}),onClick:s[1]||(s[1]=e=>bs.value="delegations")},v(y(x)("adminPermissions.tabs.delegations")),3)]),"internal"===bs.value?(A(),c("section",E,[Ps.value.length?(A(),c("section",T,[m("h2",null,v(y(x)("adminPermissions.internal.availableRoles")),1),m("ul",_,[(A(!0),c(f,null,g(Ps.value,e=>(A(),c("li",{key:e.role},v(e.label)+" ("+v(e.role)+")",1))),128))])])):p("",!0),m("section",O,[m("div",q,[m("h2",null,v(y(x)("adminPermissions.internal.users")),1),y(ps).loading?(A(),c("span",j,v(y(x)("adminPermissions.internal.loading")),1)):p("",!0)]),m("table",D,[m("thead",null,[m("tr",null,[m("th",null,v(y(x)("adminPermissions.internal.table.userId")),1),m("th",null,v(y(x)("adminPermissions.internal.table.name")),1),m("th",null,v(y(x)("adminPermissions.internal.table.email")),1),m("th",null,v(y(x)("adminPermissions.internal.table.status")),1),m("th",null,v(y(x)("adminPermissions.internal.table.role")),1),m("th",null,v(y(x)("adminPermissions.internal.table.changeRole")),1),m("th",null,v(y(x)("adminPermissions.internal.table.actions")),1)])]),m("tbody",null,[(A(!0),c(f,null,g(hs.value,e=>{return A(),c("tr",{key:e.id},[m("td",null,v(e.id),1),m("td",null,v(e.name||y(x)("common.userFallback")),1),m("td",K,[h(m("input",{"onUpdate:modelValue":s=>Ms.value[e.id]=s,type:"email",placeholder:y(x)("adminPermissions.internal.table.emailPlaceholder"),disabled:Js.value===e.id||"deleted"===e.status,onBlur:s=>ma(e),onKeydown:U(C(s=>ma(e),["prevent"]),["enter"])},null,40,L),[[w,Ms.value[e.id]]])]),m("td",null,[m("span",{class:b(["status-pill",`status-${e.status||"active"}`])},v((s=e.status,x(`adminPermissions.internal.status.${s??"active"}`))),3)]),m("td",M,v(e.role),1),m("td",J,[m("select",{value:e.role,disabled:sa(e.role),onChange:s=>(async(e,s)=>{if(e.role!==s)if(sa(e.role))i.info(x("adminPermissions.notifications.supplierRoleManaged"));else if(F.has(s))i.warning(x("adminPermissions.notifications.supplierRoleNotAllowed"));else try{await ps.changeUserRole(e.id,s,{actorId:vs.user?String(vs.user.id):void 0,actorName:vs.user?.name??void 0}),i.success(x("adminPermissions.notifications.roleUpdated"))}catch(a){console.error(x("adminPermissions.notifications.roleUpdateFailure"),a),i.error(Es(a,x("adminPermissions.notifications.roleUpdateFailure")))}})(e,s.target.value)},[(A(!0),c(f,null,g(ia(e),e=>(A(),c("option",{key:e.role,value:e.role},v(e.label),9,W))),128))],40,Q),sa(e.role)?(A(),c("p",G,v(y(x)("adminPermissions.internal.managedAutomatically")),1)):p("",!0)]),m("td",H,[m("button",{class:"link-btn reset-password-btn",type:"button",onClick:s=>(e=>{Ks.value=e,qs.value=!0,Ls.password="",Ls.confirmPassword=""})(e),disabled:js.value===e.id||"deleted"===e.status},v(js.value===e.id?y(x)("adminPermissions.actions.resetting"):y(x)("adminPermissions.actions.resetPassword")),9,X),"frozen"!==e.status?(A(),c("button",{key:0,class:"link-btn",type:"button",disabled:"deleted"===e.status||aa(e),onClick:s=>(e=>{vs.user&&String(vs.user.id)===e.id?i.warning(x("adminPermissions.notifications.cannotFreezeSelf")):(Ws.value=e,Gs.value="",Qs.value=!0)})(e)},v(y(x)("adminPermissions.actions.freeze")),9,Y)):(A(),c("button",{key:1,class:"link-btn",type:"button",disabled:Xs.value===e.id,onClick:s=>(async e=>{Xs.value=e.id;try{await ps.unfreezeUser(e.id),i.success(x("adminPermissions.notifications.userUnfrozen")),await ps.fetchUsers()}catch(s){console.error(x("adminPermissions.notifications.userUnfreezeFailure"),s),i.error(Es(s,x("adminPermissions.notifications.userUnfreezeFailure")))}finally{Xs.value=null}})(e)},v(Xs.value===e.id?y(x)("adminPermissions.actions.unfreezing"):y(x)("adminPermissions.actions.unfreeze")),9,Z)),m("button",{class:"link-btn danger",type:"button",disabled:"deleted"===e.status||aa(e),onClick:s=>(e=>{vs.user&&String(vs.user.id)===e.id?i.warning(x("adminPermissions.notifications.cannotDeleteSelf")):(Zs.value=e,Ys.value=!0)})(e)},v(y(x)("adminPermissions.actions.delete")),9,ee)])]);var s}),128))])])])])):(A(),c("section",se,[m("div",ae,[m("h2",null,v(y(x)("adminPermissions.delegations.title")),1),m("button",{class:"link-btn",type:"button",onClick:fa},v(y(x)("adminPermissions.actions.reloadBuyers")),1)]),m("div",ie,[m("aside",ne,[0===Us.value.length?(A(),c("p",le,v(y(x)("adminPermissions.delegations.noBuyers")),1)):(A(),c("ul",te,[(A(!0),c(f,null,g(Us.value,e=>(A(),c("li",{key:e.id,class:b({active:e.id===Cs.value})},[m("button",{type:"button",onClick:s=>ga(e.id)},[m("span",re,v(e.name||e.id),1),m("span",de,v(la(e)),1)],8,oe)],2))),128))]))]),Is.value?(A(),c("div",ue,[m("header",ce,[m("div",null,[m("h3",null,v(Is.value.name||Is.value.id),1),m("p",me,v(y(x)("adminPermissions.delegations.instructions")),1)]),m("button",{class:"primary-btn",type:"button",disabled:!xs.value||Ss.value,onClick:Ua},v(Ss.value?y(x)("adminPermissions.actions.saving"):y(x)("adminPermissions.actions.saveChanges")),9,pe)]),m("div",ve,[m("section",ye,[m("h4",null,v(y(x)("adminPermissions.delegations.responsibleSuppliers")),1),Fs.value?(A(),c("p",be,v(y(x)("adminPermissions.delegations.loadingAssignments")),1)):As.value.length?(A(),c("ul",fe,[(A(!0),c(f,null,g(As.value,e=>(A(),c("li",{key:e.supplierId},[m("div",ge,[m("strong",null,v(e.companyName),1),m("span",he,"#"+v(e.companyId),1)]),m("div",Pe,[m("label",null,[h(m("input",{type:"checkbox","onUpdate:modelValue":s=>e.profileAccess=s,onChange:Pa},null,40,we),[[I,e.profileAccess]]),k(" "+v(y(x)("adminPermissions.delegations.profileAccess")),1)]),m("label",null,[h(m("input",{type:"checkbox","onUpdate:modelValue":s=>e.contractAlert=s,onChange:Pa},null,40,Ue),[[I,e.contractAlert]]),k(" "+v(y(x)("adminPermissions.delegations.contractAlert")),1)])]),m("button",{class:"link-btn remove",type:"button",onClick:s=>{return a=e.supplierId,As.value=As.value.filter(e=>e.supplierId!==a),void(xs.value=!0);var a}},v(y(x)("adminPermissions.actions.remove")),9,ke)]))),128))])):(A(),c("p",Ce,v(y(x)("adminPermissions.delegations.noAssignments")),1))]),m("section",Ie,[m("h4",null,v(y(x)("adminPermissions.delegations.addSuppliers")),1),m("div",Ae,[s[13]||(s[13]=m("h5",{style:{margin:"0 0 8px","font-size":"0.9rem",color:"#6b7280"}}," ðŸ“Œ æŒ‰æ ‡ç­¾æ‰¹é‡åˆ†é… ",-1)),m("div",Fe,[h(m("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>Bs.value=e),multiple:"",style:{flex:"1","min-width":"200px",padding:"8px",border:"1px solid #d1d5db","border-radius":"6px"}},[(A(!0),c(f,null,g(ks.value,e=>(A(),c("option",{key:e.id,value:e.id},v(e.name)+" ("+v(e.description||"æ— æè¿°")+") ",9,Se))),128))],512),[[P,Bs.value]]),m("button",{class:"primary-btn",type:"button",disabled:0===Bs.value.length||Ns.value,onClick:ka},v(Ns.value?"åˆ†é…ä¸­...":"æŒ‰æ ‡ç­¾åˆ†é…"),9,xe)]),Bs.value.length>0?(A(),c("p",ze," å°†åˆ†é…æ‰€æœ‰åŒ…å«æ‰€é€‰æ ‡ç­¾çš„ä¾›åº”å•†åˆ°å½“å‰é‡‡è´­å‘˜ ")):p("",!0)]),s[14]||(s[14]=m("div",{style:{margin:"16px 0","border-top":"1px solid #e5e7eb"}},null,-1)),s[15]||(s[15]=m("h5",{style:{margin:"0 0 8px","font-size":"0.9rem",color:"#6b7280"}}," ðŸ” æœç´¢å•ä¸ªä¾›åº”å•† ",-1)),m("div",Re,[h(m("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>zs.value=e),type:"text",placeholder:y(x)("adminPermissions.delegations.searchPlaceholder"),onKeyup:U(wa,["enter"])},null,40,Ve),[[w,zs.value,void 0,{trim:!0}]]),m("button",{class:"link-btn",type:"button",disabled:Rs.value,onClick:wa},v(Rs.value?y(x)("adminPermissions.actions.searching"):y(x)("adminPermissions.actions.search")),9,$e)]),$s.value.length?(A(),c("ul",Be,[(A(!0),c(f,null,g($s.value,e=>(A(),c("li",{key:e.id},[m("div",null,[m("strong",null,v(e.companyName),1),m("span",Ne,"#"+v(e.supplierCode||e.companyId),1)]),m("button",{class:"primary-btn",type:"button",onClick:s=>(e=>{ha(e.id)||(As.value.push({supplierId:e.id,companyName:e.companyName,companyId:e.companyId,contractAlert:!1,profileAccess:!1}),xs.value=!0,$s.value=$s.value.filter(s=>s.id!==e.id))})(e)},v(y(x)("adminPermissions.actions.add")),9,Ee)]))),128))])):Vs.value?(A(),c("p",Te,v(y(x)("adminPermissions.delegations.noResults")),1)):p("",!0)])])])):(A(),c("div",_e,v(y(x)("adminPermissions.delegations.selectPrompt")),1))])])),Ts.value?(A(),c("dialog",Oe,[m("form",{class:"modal-content",onSubmit:C(ca,["prevent"])},[m("header",qe,[m("h2",null,v(y(x)("adminPermissions.dialogs.createUser.title")),1),m("button",{class:"link-btn",type:"button",onClick:ra},v(y(x)("common.close")),1)]),m("section",je,[m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.userId"))+" ",1),h(m("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>Os.id=e),type:"text",required:""},null,512),[[w,Os.id,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.name"))+" ",1),h(m("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>Os.name=e),type:"text"},null,512),[[w,Os.name,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.role"))+" ",1),h(m("select",{"onUpdate:modelValue":s[6]||(s[6]=e=>Os.role=e)},[(A(!0),c(f,null,g(ws.value,e=>(A(),c("option",{key:e.role,value:e.role},v(e.label),9,De))),128))],512),[[P,Os.role]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.password"))+" ",1),h(m("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>Os.password=e),type:"password",minlength:"6",required:""},null,512),[[w,Os.password,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.email"))+" ",1),h(m("input",{"onUpdate:modelValue":s[8]||(s[8]=e=>Os.email=e),type:"email"},null,512),[[w,Os.email,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.createUser.fields.supplierId"))+" ",1),h(m("input",{"onUpdate:modelValue":s[9]||(s[9]=e=>Os.supplierId=e),type:"text"},null,512),[[w,Os.supplierId,void 0,{trim:!0}]])])]),m("footer",Ke,[m("button",{class:"link-btn",type:"button",onClick:ra},v(y(x)("common.cancel")),1),m("button",{class:"primary-btn",type:"submit",disabled:_s.value},v(_s.value?y(x)("adminPermissions.dialogs.createUser.submitting"):y(x)("adminPermissions.dialogs.createUser.submit")),9,Le)])],32)])):p("",!0),qs.value?(A(),c("dialog",Me,[m("form",{class:"modal-content",onSubmit:C(ua,["prevent"])},[m("header",Je,[m("h2",null,v(y(x)("adminPermissions.dialogs.resetPassword.title")),1),m("button",{class:"link-btn",type:"button",onClick:da},v(y(x)("common.close")),1)]),m("section",Qe,[m("p",We,[k(v(y(x)("adminPermissions.dialogs.resetPassword.description"))+" ",1),m("strong",null,v(Ks.value?.id??"")+" - "+v(Ks.value?.name||y(x)("common.userFallback")),1)]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.resetPassword.fields.password"))+" ",1),h(m("input",{"onUpdate:modelValue":s[10]||(s[10]=e=>Ls.password=e),type:"password",minlength:"6",required:"",placeholder:y(x)("adminPermissions.dialogs.resetPassword.fields.passwordPlaceholder")},null,8,Ge),[[w,Ls.password,void 0,{trim:!0}]])]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.resetPassword.fields.confirm"))+" ",1),h(m("input",{"onUpdate:modelValue":s[11]||(s[11]=e=>Ls.confirmPassword=e),type:"password",minlength:"6",required:"",placeholder:y(x)("adminPermissions.dialogs.resetPassword.fields.confirmPlaceholder")},null,8,He),[[w,Ls.confirmPassword,void 0,{trim:!0}]])])]),m("footer",Xe,[m("button",{class:"link-btn",type:"button",onClick:da},v(y(x)("common.cancel")),1),m("button",{class:"primary-btn",type:"submit",disabled:!Ls.password||Ls.password!==Ls.confirmPassword||Ds.value},v(Ds.value?y(x)("adminPermissions.dialogs.resetPassword.submitting"):y(x)("adminPermissions.dialogs.resetPassword.submit")),9,Ye)])],32)])):p("",!0),Qs.value?(A(),c("dialog",Ze,[m("form",{class:"modal-content",onSubmit:C(va,["prevent"])},[m("header",es,[m("h2",null,v(y(x)("adminPermissions.dialogs.freezeUser.title")),1),m("button",{class:"link-btn",type:"button",onClick:pa},v(y(x)("common.close")),1)]),m("section",ss,[m("p",as,v(y(x)("adminPermissions.dialogs.freezeUser.description")),1),m("p",null,[k(v(y(x)("adminPermissions.dialogs.freezeUser.userName"))+" ",1),m("strong",null,v(Ws.value?.name||Ws.value?.id||""),1)]),m("label",null,[k(v(y(x)("adminPermissions.dialogs.freezeUser.fields.reason"))+" ",1),h(m("input",{"onUpdate:modelValue":s[12]||(s[12]=e=>Gs.value=e),type:"text",placeholder:y(x)("adminPermissions.dialogs.freezeUser.fields.reasonPlaceholder")},null,8,is),[[w,Gs.value,void 0,{trim:!0}]])])]),m("footer",ns,[m("button",{class:"link-btn",type:"button",onClick:pa},v(y(x)("common.cancel")),1),m("button",{class:"primary-btn",type:"submit",disabled:null!==Hs.value},v(null!==Hs.value?y(x)("adminPermissions.dialogs.freezeUser.submitting"):y(x)("adminPermissions.dialogs.freezeUser.submit")),9,ls)])],32)])):p("",!0),Ys.value?(A(),c("dialog",ts,[m("form",{class:"modal-content",onSubmit:C(ba,["prevent"])},[m("header",os,[m("h2",null,v(y(x)("adminPermissions.dialogs.deleteUser.title")),1),m("button",{class:"link-btn",type:"button",onClick:ya},v(y(x)("common.close")),1)]),m("section",rs,[m("p",ds,v(y(x)("adminPermissions.dialogs.deleteUser.description")),1),m("p",null,[k(v(y(x)("adminPermissions.dialogs.deleteUser.userName"))+" ",1),m("strong",null,v(Zs.value?.name||Zs.value?.id||""),1)]),m("p",us,v(y(x)("adminPermissions.dialogs.deleteUser.warning")),1)]),m("footer",cs,[m("button",{class:"link-btn",type:"button",onClick:ya},v(y(x)("common.cancel")),1),m("button",{class:"primary-btn danger",type:"submit",disabled:null!==ea.value},v(null!==ea.value?y(x)("adminPermissions.dialogs.deleteUser.submitting"):y(x)("adminPermissions.dialogs.deleteUser.submit")),9,ms)])],32)])):p("",!0)]))}}),[["__scopeId","data-v-6d11464d"]]);export{ps as default};
