const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SupplierRegistrationStepProfile-Bn1uCZ4j.js","assets/index-CIahGNSM.js","assets/index-CMY-P_dF.css","assets/SupplierRegistrationStepContacts-BISlbEau.js","assets/SupplierRegistrationStepBusiness-VfiPwE7-.js","assets/SupplierRegistrationStepFinance-ei65GHGn.js","assets/SupplierRegistrationStepBanking-DCI-j0lH.js","assets/SupplierRegistrationStepDocuments-BuPkn4sm.js","assets/el-alert-TFaY92GP.js","assets/el-alert-G57rL0jl.css","assets/useNotification-DBBxtp1r.js","assets/SupplierRegistrationStepDocuments-DYeTdDiy.css","assets/SupplierRegistrationSubmissionCard-BwP2U6cs.js"])))=>i.map(i=>d[i]);
import{d as e,b as a,e as t,t as i,o as s,j as n,y as r,z as l,A as o,k as u,x as c,u as p,g as d,h as m,c as g,i as v,B as y,C as f,s as b,D as h,f as w,G as k,H as R,q as C,I as A,F as N,r as T,E as _,J as S,K as E,L as O,M as P,N as D,_ as F}from"./index-CIahGNSM.js";import{E as L,a as M}from"./el-form-item-Diw6FjT1.js";/* empty css                 */import{E as I,a as U}from"./el-step-mhbQ0Aha.js";import{E as j}from"./el-alert-TFaY92GP.js";import{fetchSupplierRegistrationDraft as x,saveSupplierRegistrationDraft as B,submitSupplierRegistration as V}from"./public-Cwuqf_ne.js";import{v as q}from"./whitelistBlacklist-BFF0YCmV.js";import{P as $}from"./PageHeader-CrotsIXA.js";import{u as z}from"./useNotification-DBBxtp1r.js";import"./castArray-Dly3askU.js";import"./_baseClone-BsxWOYhZ.js";import"./index-BTYaYcWI.js";const Y={class:"invitation-banner"},H={class:"banner-content"},G=e({__name:"SupplierRegistrationInvitationBanner",props:{translateOr:{type:Function}},setup:e=>(n,r)=>(s(),a("div",Y,[r[0]||(r[0]=t("div",{class:"banner-icon"},"ðŸ“¨",-1)),t("div",H,[t("h3",null,i(e.translateOr("supplierRegistration.invitation.title","RFQ Invitation Linked")),1),t("p",null,i(e.translateOr("supplierRegistration.invitation.subtitle","Complete the wizard to unlock RFQ details and tracking.")),1)])]))}),Q={class:"wizard-footer"},W={class:"footer-left"},J={key:0,class:"draft-meta"},X={class:"footer-right"},K=e({__name:"SupplierRegistrationWizardFooter",props:{translateOr:{type:Function},isFirstStep:{type:Boolean},isLastStep:{type:Boolean},loading:{type:Boolean},previewLoading:{type:Boolean},draftSaving:{type:Boolean},draftLoading:{type:Boolean},draftExpiresAt:{},formatDateTime:{type:Function},handleSaveDraft:{type:Function},goPreviousStep:{type:Function},goNextStep:{type:Function},handlePreview:{type:Function},handleSubmit:{type:Function}},setup:e=>(p,d)=>{const m=o;return s(),a("div",Q,[t("div",W,[n(m,{class:"ghost-button",loading:e.draftSaving,disabled:e.draftSaving||e.draftLoading||e.loading,onClick:e.handleSaveDraft},{default:u(()=>[c(i(e.translateOr("supplierRegistration.actions.saveDraft","Save Draft")),1)]),_:1},8,["loading","disabled","onClick"]),e.draftExpiresAt?(s(),a("span",J,i(e.translateOr("supplierRegistration.draft.expiresAt","Expires"))+": "+i(e.formatDateTime(e.draftExpiresAt)),1)):r("",!0),e.isFirstStep?r("",!0):(s(),l(m,{key:1,onClick:e.goPreviousStep,disabled:e.loading||e.previewLoading},{default:u(()=>[c(i(e.translateOr("common.previous","Previous")),1)]),_:1},8,["onClick","disabled"]))]),t("div",X,[e.isLastStep?(s(),l(m,{key:0,loading:e.previewLoading,class:"ghost-button",onClick:e.handlePreview},{default:u(()=>[c(i(e.translateOr("supplierRegistration.actions.previewApproval","Preview Approval Flow")),1)]),_:1},8,["loading","onClick"])):r("",!0),n(m,{type:"primary",loading:e.loading,onClick:d[0]||(d[0]=a=>e.isLastStep?e.handleSubmit():e.goNextStep())},{default:u(()=>[c(i(e.isLastStep?e.translateOr("supplierRegistration.actions.submit","Submit Registration"):e.translateOr("common.next","Next")),1)]),_:1},8,["loading"])])])}}),Z=e=>{if(!e)return"";const a=new Date(e);return Number.isNaN(a.getTime())?"":a.toLocaleString()},ee=e=>{const a=(e??"").trim();return a.length?a:void 0},ae=e=>null!=e&&"object"==typeof e&&!Array.isArray(e),te=(e,a)=>{if(e===a)return!0;if(Array.isArray(e)&&Array.isArray(a))return e.length===a.length&&e.every((e,t)=>te(e,a[t]));if(ae(e)&&ae(a)){const t=Object.keys(e),i=Object.keys(a);return t.length===i.length&&t.every(t=>te(e[t],a[t]))}return!1},ie={class:"registration-page"},se={class:"registration-header"},ne={class:"registration-content"},re={key:3,class:"wizard-card"},le={class:"wizard-header"},oe={class:"wizard-body"},ue={key:0,class:"tracking-account-password-note tracking-account-password-note--success"},ce={key:1,class:"tracking-account-password-note"},pe={class:"tracking-account-actions"},de="supplierRegistrationDraftToken",me=F(e({__name:"SupplierRegistrationView",setup(e){const F=z(),Y=k(()=>S(()=>import("./SupplierRegistrationStepProfile-Bn1uCZ4j.js"),__vite__mapDeps([0,1,2]))),H=k(()=>S(()=>import("./SupplierRegistrationStepContacts-BISlbEau.js"),__vite__mapDeps([3,1,2]))),Q=k(()=>S(()=>import("./SupplierRegistrationStepBusiness-VfiPwE7-.js"),__vite__mapDeps([4,1,2]))),W=k(()=>S(()=>import("./SupplierRegistrationStepFinance-ei65GHGn.js"),__vite__mapDeps([5,1,2]))),J=k(()=>S(()=>import("./SupplierRegistrationStepBanking-DCI-j0lH.js"),__vite__mapDeps([6,1,2]))),X=k(()=>S(()=>import("./SupplierRegistrationStepDocuments-BuPkn4sm.js"),__vite__mapDeps([7,1,2,8,9,10,11]))),me=k(()=>S(()=>import("./SupplierRegistrationSubmissionCard-BwP2U6cs.js"),__vite__mapDeps([12,1,2]))),{t:ge}=p(),ve=b(),ye=C();d();const fe=(e,a)=>((e,a,t)=>{const i=e(a);return i===a?t:i})(ge,e,a),be=[{key:"profile",title:fe("supplierRegistration.stepTitles.profile","Company Profile"),description:fe("supplierRegistration.stepDescriptions.profile","Provide basic company identifiers.")},{key:"contacts",title:fe("supplierRegistration.stepTitles.contacts","Registration & Contacts"),description:fe("supplierRegistration.stepDescriptions.contacts","Share legal addresses and key contacts.")},{key:"business",title:fe("supplierRegistration.stepTitles.business","Business Scope"),description:fe("supplierRegistration.stepDescriptions.business","Outline your operating coverage.")},{key:"finance",title:fe("supplierRegistration.stepTitles.finance","Finance & Payment"),description:fe("supplierRegistration.stepDescriptions.finance","Define billing and payment preferences.")},{key:"banking",title:fe("supplierRegistration.stepTitles.banking","Bank & Submission"),description:fe("supplierRegistration.stepDescriptions.banking","Confirm bank details and preview approvals.")},{key:"documents",title:fe("supplierRegistration.stepTitles.documents","Supporting Documents"),description:fe("supplierRegistration.stepDescriptions.documents","Upload business license and bank account proof.")}],he=m(0),we=m(new Set),ke=g(()=>0===he.value),Re=g(()=>he.value===be.length-1),Ce=v({companyName:"",englishName:"",chineseName:"",registeredOffice:"",businessRegistrationNumber:"",businessAddress:"",companyType:"limited",companyTypeOther:"",supplierClassification:"DM",operatingCurrency:"RMB",deliveryLocation:"",shipCode:"",productOrigin:"",businessNature:"",contactName:"",contactEmail:"",procurementEmail:"",contactPhone:"",financeContactName:"",financeContactEmail:"",financeContactPhone:"",invoiceType:"general_vat",paymentTermsDays:"",paymentMethods:[],paymentMethodsOther:"",bankName:"",bankAddress:"",bankAccountNumber:"",swiftCode:"",notes:"",businessLicenseFile:null,bankAccountFile:null}),Ae=e=>{Object.assign(Ce,e)},Ne=m(!1),Te=m(!1),_e=m(null),Se=m(null),Ee=m(null),Oe=m(!1),Pe=m(!1),De=m(null),Fe=m(null),Le=m(null),Me=m(null),Ie=m({}),Ue=m([]),je=m(!1);let xe=null;const Be=m(""),Ve=m(""),qe=m(!1),$e=g(()=>Ie.value.procurementEmail||""),ze=m(""),Ye=m(""),He=m(!1),Ge=m(null),Qe=m(null),We=m(!1),Je=m(!1),Xe=v({username:"",password:"",message:""}),Ke=m(!1),Ze=m(!1),ea="https://quickchart.io".replace(/\/+$/,"");let aa=null,ta=null;const ia=g(()=>{if(!Ge.value)return"";const e=Ge.value.password??"";return We.value?e:e.replace(/./g,"?")}),sa=g(()=>Ge.value&&ea?`${ea}/qr?text=${encodeURIComponent(`user=${Ge.value.username}&pass=${Ge.value.password}`)}`:""),na=()=>{aa&&(clearTimeout(aa),aa=null)},ra=()=>{ta&&(clearTimeout(ta),ta=null)},la=e=>{e.trackingUsername&&e.trackingPassword&&(Xe.username=e.trackingUsername,Xe.password=e.trackingPassword,Xe.message=e.trackingMessage||e.message||fe("supplierRegistration.tempAccount.instructions","Use the credentials below to track your approval progress."),Ke.value=!1,Je.value=!0,"undefined"!=typeof window&&(na(),aa=setTimeout(()=>{Xe.password=""},3e5)))},oa=e=>{Je.value=!1,Xe.username="",Xe.password="",Xe.message="",Ke.value=!1,ra(),na(),!1!==e?.redirect&&ye.push("/login")},ua=new Set(["companyName","englishName","chineseName","bankName","bankAddress","bankAccountNumber","swiftCode","financeContactName","financeContactEmail","financeContactPhone","invoiceType","paymentTermsDays","paymentMethods"]),ca=g(()=>fe("supplierRegistration.categoryA.label","Category A")),pa=g(()=>fe("supplierRegistration.categoryA.tooltip","Editing after registration triggers full approval.")),da=e=>ua.has(e),ma=[{value:"CA",label:"CA - Cash in Advance"},{value:"PO",label:"PO - TERM BY PO"},{value:"00",label:"00 - COD"},{value:"04",label:"04 - 1% 10 Net 30"},{value:"05",label:"05 - 1% 15 Net 30"},{value:"07",label:"07 - 7 days net"},{value:"1A",label:"1A - 120 days AMS"},{value:"1B",label:"1B - 150 days AMS"},{value:"1C",label:"1C - 180 days AMS"},{value:"1D",label:"1D - 210 days AMS"},{value:"1E",label:"1E - 240 days AMS"},{value:"10",label:"10 - 10 days net"},{value:"12",label:"12 - 120 days net"},{value:"14",label:"14 - 14 days net"},{value:"15",label:"15 - 150 days net"},{value:"16",label:"16 - 105 days net"},{value:"18",label:"18 - 180 days net"},{value:"21",label:"21 - 21 days net"},{value:"3A",label:"3A - 30 days AMS"},{value:"3B",label:"3B - 30 Days 10th Dy"},{value:"30",label:"30 - 30 days net"},{value:"32",label:"32 - Net 15 Days"},{value:"33",label:"33 - Net 135 days"},{value:"35",label:"35 - 35 days net"},{value:"4A",label:"4A - 45 days AMS"},{value:"40",label:"40 - NET 40 DAYS"},{value:"45",label:"45 - 45 days net"},{value:"5A",label:"5A - 5 days net"},{value:"52",label:"52 - Net 115 Days"},{value:"55",label:"55 - 55 days net"},{value:"6A",label:"6A - 60 days AMS"},{value:"60",label:"60 - 60 days net"},{value:"65",label:"65 - 65 days net"},{value:"68",label:"68 - Net 195 Days"},{value:"7A",label:"7A - 75 days AMS"},{value:"70",label:"70 - 70 days net"},{value:"75",label:"75 - 75 DAYS NET"},{value:"76",label:"76 - 1.5% Net 75"},{value:"9A",label:"9A - 90 days AMS"},{value:"90",label:"90 - 90 days net"}],ga=new Set(ma.map(e=>e.value)),va=g(()=>ma),ya=g(()=>[{value:"cash",label:fe("supplierRegistration.paymentMethods.cash","Cash")},{value:"cheque",label:fe("supplierRegistration.paymentMethods.cheque","Cheque / Banker Draft")},{value:"wire",label:fe("supplierRegistration.paymentMethods.wire","Wire Transfer")},{value:"other",label:fe("supplierRegistration.paymentMethods.other","Other")}]),fa=[["companyName","companyType","supplierClassification","operatingCurrency"],["registeredOffice","businessAddress","businessRegistrationNumber","contactName","contactEmail","contactPhone","procurementEmail","financeContactName","financeContactPhone"],["deliveryLocation","shipCode","productOrigin"],["invoiceType","paymentMethods"],["bankName","bankAddress","bankAccountNumber"],["businessLicenseFile","bankAccountFile"]],ba=g(()=>({companyName:ge("supplier.fields.companyName"),companyType:fe("supplierRegistration.fields.companyType","Company Type"),companyTypeOther:fe("supplierRegistration.fields.companyTypeOther","Other Company Type"),supplierClassification:fe("supplierRegistration.fields.supplierClassification","Supplier Classification"),operatingCurrency:fe("supplierRegistration.fields.operatingCurrency","Operating Currency"),registeredOffice:ge("supplier.fields.address"),businessAddress:fe("supplierRegistration.fields.businessAddress","Business Address"),businessRegistrationNumber:ge("supplier.fields.businessRegistrationNumber"),contactName:ge("supplier.fields.contactPerson"),contactEmail:ge("supplier.fields.contactEmail"),procurementEmail:fe("supplierRegistration.fields.procurementEmail","Procurement Contact Email"),contactPhone:ge("supplier.fields.contactPhone"),financeContactName:fe("supplierRegistration.fields.financeContact","Finance Contact"),financeContactEmail:fe("supplierRegistration.fields.financeContactEmail","Finance Contact Email"),financeContactPhone:fe("supplierRegistration.fields.financeContactPhone","Finance Contact Phone"),deliveryLocation:fe("supplierRegistration.fields.deliveryLocation","Delivery Location"),shipCode:fe("supplierRegistration.fields.shipCode","Incoterms"),productOrigin:fe("supplierRegistration.fields.productOrigin","Product Origin"),invoiceType:fe("supplierRegistration.fields.invoiceType","Invoice Type"),paymentMethods:fe("supplierRegistration.fields.paymentMethods","Payment Methods"),paymentMethodsOther:fe("supplierRegistration.fields.paymentMethodsOther","Other payment method"),paymentTermsDays:fe("supplierRegistration.fields.paymentTermsDays","Payment Terms (days)"),bankName:fe("supplierRegistration.fields.bankName","Bank Name"),bankAddress:fe("supplierRegistration.fields.bankAddress","Bank Address"),bankAccountNumber:fe("supplierRegistration.fields.bankAccountNumber","Bank Account Number"),businessLicenseFile:fe("supplierRegistration.documents.businessLicense.title","Business License"),bankAccountFile:fe("supplierRegistration.documents.bankCertificate.title","Bank Account Certificate")})),ha=fa.reduce((e,a,t)=>(a.forEach(a=>{e[a]=t}),e),{}),wa={companyTypeOther:0,financeContactEmail:1,paymentTermsDays:3,paymentMethodsOther:3,businessLicenseFile:5,bankAccountFile:5},ka=e=>{const a=e;return Object.prototype.hasOwnProperty.call(wa,a)?wa[a]??null:Object.prototype.hasOwnProperty.call(ha,a)?ha[a]:null},Ra=e=>Object.prototype.hasOwnProperty.call(Ce,e),Ca=e=>{const a=Object.entries(e);if(!a.length)return"";return a.sort((e,a)=>{const t=ka(e[0]),i=ka(a[0]);return(null===t?Number.MAX_SAFE_INTEGER:t)-(null===i?Number.MAX_SAFE_INTEGER:i)}).map(([e,a])=>`${(e=>ba.value[e]||e)(e)}: ${a}`).join("; ")},Aa=e=>{const a=(e=>{if(ae(e)){const a=e.response;if(a&&ae(a.data))return a.data;if("string"==typeof e.message)return{message:e.message}}return e instanceof Error?{message:e.message}:{}})(e),t={},i="string"==typeof a.message?a.message:"",s="string"==typeof a.error?a.error:"",n="string"==typeof a.reason?a.reason:"",r="string"==typeof a.field?a.field:"",l="string"==typeof a.blacklist_type?a.blacklist_type:"",o=ae(a.errors)?a.errors:null;if("VALIDATION_FAILED"===i&&o&&Object.entries(o).forEach(([e,a])=>{const i="string"==typeof a?a:String(a??"");t[e]=((e,a)=>{switch(a){case"REQUIRED":return fe("validation.required","This field is required");case"INVALID_EMAIL":return fe("validation.email","Please enter a valid email address");case"INVALID_PHONE":return fe("validation.phone","Please enter a valid phone number");case"UNSUPPORTED_CURRENCY":return fe("supplierRegistration.validation.unsupportedCurrency","Unsupported operating currency");case"UNSUPPORTED_CLASSIFICATION":return fe("supplierRegistration.validation.unsupportedClassification","Unsupported supplier classification");case"UNSUPPORTED_SHIP_CODE":return fe("supplierRegistration.validation.unsupportedShipCode","Unsupported delivery terms");case"INVALID_PAYMENT_TERMS":return fe("supplierRegistration.validation.paymentTerms","Please select a valid payment term.");case"NOT_FOUND":return"procurementEmail"===e?fe("supplierRegistration.validation.procurementEmailNotFound","Procurement email not found"):fe("supplierRegistration.validation.notFound","Not found");default:return a||fe("errors.general","Unexpected error occurred.")}})(e,i)}),"DUPLICATE_REGISTRATION"===i&&r&&(t[r]=s||fe("supplierRegistration.errors.duplicate","Duplicate registration")),l){const e="credit_code"===l,a=e?fe("supplierRegistration.validation.blacklistCreditCodeReason","This business registration number has been blacklisted: {reason}"):fe("supplierRegistration.validation.blacklistEmailReason","This email address has been blacklisted: {reason}"),i=(u=a,(c=n)?u.replace("{reason}",c):u);e?(Be.value=i,t.businessRegistrationNumber=i):(Ve.value=i,t.contactEmail=i)}var u,c;if(i){const e=(e=>{const a=e.toLowerCase();return a.includes("business-license")?"businessLicenseFile":a.includes("bank-account")?"bankAccountFile":null})(i);e&&(i.toLowerCase().includes("document_exceeds_limit")?t[e]=fe("supplierRegistration.documents.errors.fileTooLarge","File size exceeds 10MB limit."):"UNSUPPORTED_FILE_TYPE"==n?t[e]=fe("supplierRegistration.documents.errors.unsupportedType","Unsupported file type. Please upload a PDF or image."):"MIME_TYPE_MISMATCH"==n?t[e]=fe("supplierRegistration.documents.errors.mimeMismatch","File type does not match its content. Please upload the original file."):t[e]||(t[e]=fe("supplierRegistration.documents.errors.invalidDocument","Invalid document. Please upload again.")))}if(!Object.keys(t).length&&i){const e=i.toLowerCase();e.includes("supplierclassification")&&(t.supplierClassification=fe("supplierRegistration.validation.unsupportedClassification","Unsupported supplier classification")),e.includes("operatingcurrency")&&(t.operatingCurrency=fe("supplierRegistration.validation.unsupportedCurrency","Unsupported operating currency"))}const p=Ca(t);return{message:p?`${fe("supplierRegistration.errors.submitFailed","Failed to submit supplier registration")}: ${p}`:s||i||fe("errors.general","Unexpected error occurred."),fieldErrors:t}},Na=()=>{Oa(he.value)&&(Re.value||(he.value+=1))},Ta=()=>{he.value>0&&(he.value-=1)},_a=()=>JSON.parse(JSON.stringify({...Ce,paymentMethods:[...Ce.paymentMethods]})),Sa=()=>{xe&&(clearTimeout(xe),xe=null)},Ea=()=>{Ne.value||Oe.value||Pe.value||!Ue.value.length||(Sa(),"undefined"!=typeof window&&(xe=window.setTimeout(()=>{xe=null,Ia({silent:!0})},6e3)))},Oa=e=>{const a=(fa[e]||[]).filter(e=>!(e=>{const a=Ce[e];if(Array.isArray(a))return a.length>0;if(a&&"object"==typeof a){if("content"in a){const e=a.content;return"string"==typeof e&&e.trim().length>0}return Object.keys(a).length>0}return String(a??"").trim().length>0})(e));return a.length?(we.value=new Set(a),F.warning(fe("supplierRegistration.validation.completeStep","Please complete all required fields for this step before continuing.")),!1):(we.value=new Set,0!==e||"other"!==Ce.companyType||Ce.companyTypeOther.trim()?1===e&&(Be.value||Ve.value)?(F.error(fe("supplierRegistration.validation.resolveBlacklist","Please resolve the highlighted blacklist warnings before continuing.")),!1):!(3===e&&Ce.paymentMethods.includes("other")&&!Ce.paymentMethodsOther.trim())||(F.warning(fe("supplierRegistration.validation.describeOtherPayment","Please describe the additional payment method.")),!1):(F.warning(fe("supplierRegistration.validation.specifyCompanyType","Please specify the company type.")),!1))},Pa=()=>String(Ce.paymentTermsDays??"").trim().toUpperCase(),Da=()=>{const e=Pa();if(!e)return!0;if(ga.has(e))return!0;const a=Number(e);return Number.isFinite(a)&&a>=0&&a<=365},Fa=()=>({companyName:Ce.companyName.trim(),englishName:ee(Ce.englishName),chineseName:ee(Ce.chineseName),companyType:Ce.companyType,companyTypeOther:ee(Ce.companyTypeOther),supplierClassification:Ce.supplierClassification,authorizedCapital:void 0,issuedCapital:void 0,directors:void 0,owners:void 0,registeredOffice:Ce.registeredOffice.trim(),businessRegistrationNumber:Ce.businessRegistrationNumber.trim(),businessAddress:Ce.businessAddress.trim(),businessPhone:void 0,businessFax:void 0,contactName:Ce.contactName.trim(),contactEmail:Ce.contactEmail.trim(),procurementEmail:Ce.procurementEmail.trim(),contactPhone:Ce.contactPhone.trim(),financeContactName:Ce.financeContactName.trim(),financeContactEmail:ee(Ce.financeContactEmail),financeContactPhone:Ce.financeContactPhone.trim(),businessNature:ee(Ce.businessNature),operatingCurrency:Ce.operatingCurrency,deliveryLocation:Ce.deliveryLocation.trim(),shipCode:Ce.shipCode.trim(),productOrigin:Ce.productOrigin.trim(),productTypes:void 0,invoiceType:Ce.invoiceType||void 0,paymentTermsDays:Pa()||void 0,paymentMethods:[...Ce.paymentMethods],paymentMethodsOther:ee(Ce.paymentMethodsOther),bankName:Ce.bankName.trim(),bankAddress:Ce.bankAddress.trim(),bankAccountNumber:Ce.bankAccountNumber.trim(),swiftCode:ee(Ce.swiftCode),notes:ee(Ce.notes),businessLicenseFile:Ce.businessLicenseFile??void 0,bankAccountFile:Ce.bankAccountFile??void 0}),La=e=>{const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString()},Ma=async()=>{if(Re.value&&Oa(he.value))if(Da()){Te.value=!0,_e.value=null;try{const e=Fa(),a=await E({payload:e,changedFields:[...Ue.value]});Se.value=a}catch(e){console.error("Failed to preview approval flow:",e),_e.value=e instanceof Error?e.message:fe("supplierRegistration.preview.failed","Unable to generate approval preview at this time.")}finally{Te.value=!1}}else F.warning(fe("supplierRegistration.validation.paymentTerms","Please select a valid payment term."))},Ia=async({silent:e=!1}={})=>{if(Ue.value.length){Oe.value=!0;try{const t=_a(),i=(a=he.value,be[a]?.key??null),s=await B({draftToken:De.value??void 0,form:t,lastStep:i});De.value=s.draftToken,Fe.value=s.expiresAt??null,"undefined"!=typeof window&&window.localStorage.setItem(de,s.draftToken);const n=_a();Ue.value=((e,a)=>{const t=new Set([...Object.keys(e),...Object.keys(a)]);return Array.from(t).filter(t=>!te(e[t],a[t]))})(t,n),Le.value=null,Ue.value.length&&Ea(),e||F.success(fe("supplierRegistration.draft.saveSuccess","Draft saved successfully."))}catch(t){console.error("Failed to save draft:",t);const a=t instanceof Error?t.message:fe("supplierRegistration.draft.saveFailed","Unable to save draft.");Le.value=a,e||F.error(a),Ea()}finally{Oe.value=!1}var a}else e||F.info(fe("supplierRegistration.draft.noChanges","Nothing new to save."))},Ua=async e=>{Pe.value=!0;try{const a=await x(e);De.value=a.draftToken,Fe.value=a.expiresAt??null,(e=>{const a={companyName:"",englishName:"",chineseName:"",registeredOffice:"",businessRegistrationNumber:"",businessAddress:"",companyType:"limited",companyTypeOther:"",supplierClassification:"DM",operatingCurrency:"RMB",deliveryLocation:"",shipCode:"",productOrigin:"",businessNature:"",contactName:"",contactEmail:"",procurementEmail:"",contactPhone:"",financeContactName:"",financeContactEmail:"",financeContactPhone:"",invoiceType:"general_vat",paymentTermsDays:"",paymentMethods:[],paymentMethodsOther:"",bankName:"",bankAddress:"",bankAccountNumber:"",swiftCode:"",notes:"",businessLicenseFile:null,bankAccountFile:null};je.value=!0;const t=Ce,i=e;Object.entries(a).forEach(([e,a])=>{const s=i[e];if(Array.isArray(a)){const i=Array.isArray(s)?[...s]:[...a];t[e]=i}else if("string"==typeof a){const a=null==s?"":String(s);t[e]="paymentTermsDays"===e?a.trim().toUpperCase():a}else t[e]=s??a}),Se.value=null,_e.value=null,Ue.value=[],Le.value=null,Ge.value=null,Qe.value=null,We.value=!1,Sa(),A(()=>{je.value=!1})})(a.form),Ee.value=null,Ge.value=null,Qe.value=null,We.value=!1;const t=a.lastStep?be.findIndex(e=>e.key===a.lastStep):-1;t>=0&&(he.value=t),"undefined"!=typeof window&&window.localStorage.setItem(de,a.draftToken)}catch(a){console.error("Failed to load draft:",a),Le.value=a instanceof Error?a.message:fe("supplierRegistration.draft.loadFailed","Unable to load saved draft."),De.value=null,Fe.value=null,"undefined"!=typeof window&&window.localStorage.removeItem(de)}finally{Pe.value=!1}},ja=async(e,a)=>{const t=fe("supplierRegistration.tempAccount.copied",`${a} copied to clipboard.`),i=fe("supplierRegistration.tempAccount.copyFailed","Unable to copy to clipboard."),s=await(async e=>{if("undefined"!=typeof navigator&&navigator.clipboard?.writeText)try{return await navigator.clipboard.writeText(e),!0}catch{}if("undefined"==typeof document)return!1;const a=document.createElement("textarea");a.value=e,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.focus(),a.select();let t=!1;try{t=document.execCommand("copy")}finally{document.body.removeChild(a)}return t})(e);return s?F.success(t):F.warning(i),s},xa=async(e,a,t={})=>{if(!e)return;await ja(e,a)&&t.markPassword&&(Ke.value=!0,ra(),ta=setTimeout(()=>{Ke.value=!1,ta=null},3e3))};y(Ce,(e,a)=>{je.value||(Object.keys(e).forEach(t=>{const i=t;if(e[i]!==a?.[i]&&(Ue.value.includes(t)||Ue.value.push(t),Ie.value[i])){const e={...Ie.value};delete e[i],Ie.value=e,Object.keys(e).length||(Me.value=null)}}),Se.value&&(Se.value=null,_e.value=null),Ea())},{deep:!0});const Ba=async()=>{const e=Ce.businessRegistrationNumber.trim();if(e){qe.value=!0;try{const a=await q({credit_code:e});a.is_blacklisted?Be.value="critical"===a.severity?fe("supplierRegistration.validation.blacklistCreditCode","This registration number is blacklisted."):fe("supplierRegistration.validation.blacklistCreditCodeReason","This registration number requires manual review."):Be.value=""}catch(a){console.error(fe("supplierRegistration.errors.validateCreditCode","Validation failed"),a),Be.value=""}finally{qe.value=!1}}else Be.value=""},Va=async()=>{const e=Ce.contactEmail.trim();if(e){qe.value=!0;try{const a=await q({email:e});a.is_blacklisted?Ve.value="critical"===a.severity?fe("supplierRegistration.validation.blacklistEmail","This email is blacklisted."):fe("supplierRegistration.validation.blacklistEmailReason","This email requires manual review."):Ve.value=""}catch(a){console.error(fe("supplierRegistration.errors.validateEmail","Email validation failed"),a),Ve.value=""}finally{qe.value=!1}}else Ve.value=""},qa=async()=>{if(Oa(he.value)&&Da())if(Be.value||Ve.value)F.error(fe("supplierRegistration.validation.resolveBlacklist","Please resolve the highlighted blacklist warnings before continuing."));else{Me.value=null,Ie.value={},Ge.value=null,Qe.value=null,We.value=!1,Ne.value=!0;try{const a=await V(Fa());if(Ee.value=a,Se.value=null,_e.value=null,Ue.value=[],await(async e=>{const a=[];if(e.applicationId&&a.push({label:fe("supplierRegistration.confirmation.applicationId","Application ID"),value:String(e.applicationId)}),e.supplierCode&&a.push({label:fe("supplierRegistration.confirmation.supplierId","Supplier ID"),value:e.supplierCode}),e.trackingUrl){const t="undefined"!=typeof window?window.location.origin:"",i=t?`${t}${e.trackingUrl}`:e.trackingUrl;a.push({label:fe("supplierRegistration.confirmation.viewStatus","View Application Status"),value:i})}const t=P("div",{class:"registration-success-dialog__body"},[P("p",{class:"registration-success-dialog__intro"},fe("supplierRegistration.confirmation.successMessage","Thank you for submitting your supplier registration.")),a.length?P("ul",{class:"registration-success-dialog__list"},a.map(e=>P("li",{class:"registration-success-dialog__list-item"},[P("span",{class:"registration-success-dialog__list-label"},`${e.label}`),P("span",{class:"registration-success-dialog__list-value"},e.value)]))):null,P("p",{class:"registration-success-dialog__note"},fe("supplierRegistration.confirmation.pendingMessage","Your application is under review. We will notify you by email."))]);await D.alert(t,fe("supplierRegistration.confirmation.title","Application Submitted"),{confirmButtonText:fe("supplierRegistration.confirmation.viewStatus","View Application Status"),type:"success",customClass:"registration-success-dialog"})})(a),la(a),De.value&&"undefined"!=typeof window&&window.localStorage.removeItem(de),De.value=null,Fe.value=null,Sa(),F.success(`${fe("supplier.registration","Supplier Registration")} ${fe("approval.notifications.approveSuccess","submitted successfully")}`),Me.value=null,Ie.value={},a.supplierId)try{const e=await O(a.supplierId,{currency:Ce.operatingCurrency});Ge.value=e,We.value=!1}catch(e){console.error("Failed to issue temporary account:",e),Qe.value=e instanceof Error?e.message:fe("supplierRegistration.tempAccount.issueFailed","Temporary account could not be issued automatically.")}}catch(a){console.error(fe("supplierRegistration.errors.submitFailed","Registration failed"),a);const e=Aa(a);((e,a)=>{Me.value=e,Ie.value=a;const t=Object.keys(a).filter(Ra);if(t.length){we.value=new Set(t);const e=t.map(ka).filter(e=>null!==e);e.length&&(he.value=Math.min(...e))}})(e.message,e.fieldErrors),F.error(e.message)}finally{Ne.value=!1}}else Da()||F.warning(fe("supplierRegistration.validation.paymentTerms","Please select a valid payment term."))},$a=()=>{We.value=!We.value},za=()=>{Ee.value&&ye.push(`/registration-status/${Ee.value.applicationId}`)},Ya=()=>{oa({redirect:!1}),za()},Ha=()=>{ye.push("/login")};return f(()=>{Ze.value=!0;const e=ve.query.token,a=ve.query.rfqId;e&&a&&(ze.value=e,Ye.value=a,He.value=!0);const t=ve.query.draftToken,i="undefined"!=typeof window?window.localStorage.getItem(de):null,s=t||i||null;s&&Ua(s)}),h(()=>{Ze.value=!1,Sa(),na(),ra()}),(e,p)=>{const d=j,m=U,g=I,v=o,y=_,f=M,b=L,h=R;return s(),a("div",ie,[n($,null,{title:u(()=>[t("div",se,[t("h1",null,i(w(ge)("common.appName")),1)])]),_:1}),t("main",ne,[Le.value?(s(),l(d,{key:0,type:"warning",closable:!1,class:"draft-alert"},{default:u(()=>[c(i(Le.value),1)]),_:1})):r("",!0),Me.value?(s(),l(d,{key:1,type:"error",closable:!0,class:"submit-alert",onClose:p[0]||(p[0]=()=>{Me.value=null,Ie.value={}})},{default:u(()=>[c(i(Me.value),1)]),_:1})):r("",!0),He.value?(s(),l(G,{key:2,"translate-or":fe})):r("",!0),Ee.value?(s(),l(w(me),{key:4,"translate-or":fe,submission:Ee.value,"temp-account":Ge.value,"temp-account-error":Qe.value,"temp-account-qr-url":sa.value,"masked-temp-password":ia.value,"show-temp-password":We.value,"format-date-time":w(Z),"copy-to-clipboard":ja,"toggle-temp-password":$a,"view-status":za,"return-to-login":Ha},null,8,["submission","temp-account","temp-account-error","temp-account-qr-url","masked-temp-password","show-temp-password","format-date-time"])):(s(),a("section",re,[t("div",le,[n(g,{active:he.value,"finish-status":"success","align-center":""},{default:u(()=>[(s(),a(N,null,T(be,e=>n(m,{key:e.key,title:e.title,description:e.description},null,8,["title","description"])),64))]),_:1},8,["active"])]),t("div",oe,[0===he.value?(s(),l(w(Y),{key:0,title:be[0].title,description:be[0].description,form:Ce,"onUpdate:form":Ae,"translate-or":fe,"is-category-a":da,"category-badge-label":ca.value,"category-badge-tooltip":pa.value},null,8,["title","description","form","category-badge-label","category-badge-tooltip"])):1===he.value?(s(),l(w(H),{key:1,title:be[1].title,description:be[1].description,form:Ce,"translate-or":fe,"is-category-a":da,"category-badge-label":ca.value,"category-badge-tooltip":pa.value,"credit-code-error":Be.value,"email-error":Ve.value,"procurement-email-error":$e.value,"validate-credit-code":Ba,"validate-contact-email":Va},null,8,["title","description","form","category-badge-label","category-badge-tooltip","credit-code-error","email-error","procurement-email-error"])):2===he.value?(s(),l(w(Q),{key:2,title:be[2].title,description:be[2].description,form:Ce,"translate-or":fe},null,8,["title","description","form"])):3===he.value?(s(),l(w(W),{key:3,title:be[3].title,description:be[3].description,form:Ce,"translate-or":fe,"is-category-a":da,"category-badge-label":ca.value,"category-badge-tooltip":pa.value,"payment-method-options":ya.value,"payment-term-options":va.value},null,8,["title","description","form","category-badge-label","category-badge-tooltip","payment-method-options","payment-term-options"])):4===he.value?(s(),l(w(J),{key:4,title:be[4].title,description:be[4].description,form:Ce,"translate-or":fe,"is-category-a":da,"category-badge-label":ca.value,"category-badge-tooltip":pa.value},null,8,["title","description","form","category-badge-label","category-badge-tooltip"])):5===he.value?(s(),l(w(X),{key:5,title:be[5].title,description:be[5].description,form:Ce,"onUpdate:form":Ae,"translate-or":fe,"approval-preview":Se.value,"preview-loading":Te.value,"preview-error":_e.value,"format-eta":La,"request-preview":Ma},null,8,["title","description","form","approval-preview","preview-loading","preview-error"])):r("",!0)]),n(K,{"translate-or":fe,"is-first-step":ke.value,"is-last-step":Re.value,loading:Ne.value,"preview-loading":Te.value,"draft-saving":Oe.value,"draft-loading":Pe.value,"draft-expires-at":Fe.value,"format-date-time":w(Z),"handle-save-draft":Ia,"go-previous-step":Ta,"go-next-step":Na,"handle-preview":Ma,"handle-submit":qa},null,8,["is-first-step","is-last-step","loading","preview-loading","draft-saving","draft-loading","draft-expires-at","format-date-time"])])),n(h,{modelValue:Je.value,"onUpdate:modelValue":p[4]||(p[4]=e=>Je.value=e),class:"tracking-account-dialog",title:fe("supplierRegistration.confirmation.trackingDialogTitle","Registration Successful - Tracking Account Created"),width:"520px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,onClose:p[5]||(p[5]=()=>oa())},{footer:u(()=>[t("div",pe,[n(v,{onClick:p[3]||(p[3]=()=>oa())},{default:u(()=>[c(i(fe("common.close","Close")),1)]),_:1}),n(v,{type:"primary",onClick:Ya},{default:u(()=>[c(i(fe("supplierRegistration.confirmation.viewStatus","View Application Status")),1)]),_:1})])]),default:u(()=>[n(d,{class:"tracking-account-alert",type:"success",closable:!1,"show-icon":"",title:Xe.message||fe("supplierRegistration.tempAccount.instructions","Use the credentials below to track your approval progress.")},null,8,["title"]),n(b,{"label-width":"120px",class:"tracking-account-form"},{default:u(()=>[n(f,{label:fe("auth.usernameLabel","Username")},{default:u(()=>[n(y,{"model-value":Xe.username,readonly:""},{append:u(()=>[n(v,{link:"",disabled:!Xe.username,onClick:p[1]||(p[1]=e=>xa(Xe.username,fe("auth.usernameLabel","Username")))},{default:u(()=>[c(i(fe("common.copy","Copy")),1)]),_:1},8,["disabled"])]),_:1},8,["model-value"])]),_:1},8,["label"]),n(f,{label:fe("auth.passwordLabel","Password")},{default:u(()=>[n(y,{"model-value":Xe.password||"â€¢â€¢â€¢â€¢â€¢â€¢",readonly:""},{append:u(()=>[n(v,{link:"",disabled:!Xe.password,onClick:p[2]||(p[2]=e=>xa(Xe.password,fe("auth.passwordLabel","Password"),{markPassword:!0}))},{default:u(()=>[c(i(fe("common.copy","Copy")),1)]),_:1},8,["disabled"])]),_:1},8,["model-value"]),Ke.value?(s(),a("span",ue,i(fe("supplierRegistration.tempAccount.copied","Copied to clipboard.")),1)):Xe.password?r("",!0):(s(),a("span",ce,i(fe("supplierRegistration.confirmation.passwordCleared","For security, the password is cleared a few minutes after it is shown.")),1))]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])])])}}}),[["__scopeId","data-v-0989a389"]]);export{me as default};
